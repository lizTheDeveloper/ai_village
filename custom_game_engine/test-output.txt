
> @ai-village/game-engine@0.1.0 test
> npm run validate-data && vitest run


> @ai-village/game-engine@0.1.0 validate-data
> npx tsx scripts/validate-all-data.ts

ðŸ” Scanning for data files...

Looking for plant files: **/plant-species/**/*.ts
  Found 9 file(s)
  âš ï¸  No plant objects found in packages/world/src/plant-species/index.ts
  âš ï¸  No plant objects found in packages/world/src/plant-species/wild/index.ts
Looking for item files: **/items/**/*.ts
  Found 40 file(s)
  âš ï¸  No item objects found in packages/core/src/items/surrealMaterials.ts
  âš ï¸  No item objects found in packages/core/src/items/migration.ts
  âš ï¸  No item objects found in packages/core/src/items/index.ts
  âš ï¸  No item objects found in packages/core/src/items/defaultItems.ts
  âš ï¸  No item objects found in packages/core/src/items/SeedItemFactory.ts
  âš ï¸  No item objects found in packages/core/src/items/ItemTraits.ts
  âš ï¸  No item objects found in packages/core/src/items/ItemRegistry.ts
  âš ï¸  No item objects found in packages/core/src/items/ItemQuality.ts
  âš ï¸  No item objects found in packages/core/src/items/ItemLoader.ts
  âš ï¸  No item objects found in packages/core/src/items/ItemInstanceRegistry.ts
  âš ï¸  No item objects found in packages/core/src/items/ItemInstance.ts
  âš ï¸  No item objects found in packages/core/src/items/ItemDefinition.ts
  âš ï¸  No item objects found in packages/core/src/items/CrossRealmPhones.ts
  âš ï¸  No item objects found in packages/core/src/items/ArtifactSystem.ts
  âš ï¸  No item objects found in packages/core/src/items/weapons/ranged.ts
  âš ï¸  No item objects found in packages/core/src/items/weapons/melee.ts
  âš ï¸  No item objects found in packages/core/src/items/weapons/magic.ts
  âš ï¸  No item objects found in packages/core/src/items/weapons/firearms.ts
  âš ï¸  No item objects found in packages/core/src/items/weapons/exotic.ts
  âš ï¸  No item objects found in packages/core/src/items/weapons/energy.ts
  âš ï¸  No item objects found in packages/core/src/items/weapons/creative.ts
  âš ï¸  No item objects found in packages/core/src/items/ammo/index.ts
  âš ï¸  No item objects found in packages/core/src/items/__tests__/migration.test.ts
  âš ï¸  No item objects found in packages/core/src/items/__tests__/TraitComposition.integration.test.ts
  âš ï¸  No item objects found in packages/core/src/items/__tests__/ItemTraits.test.ts
  âš ï¸  No item objects found in packages/core/src/items/__tests__/ItemRegistry.test.ts
  âš ï¸  No item objects found in packages/core/src/items/__tests__/ItemQuality.test.ts
  âš ï¸  No item objects found in packages/core/src/items/__tests__/ItemLoader.test.ts
  âš ï¸  No item objects found in packages/core/src/items/__tests__/ItemInstance.test.ts
  âš ï¸  No item objects found in packages/core/src/items/traits/index.ts
  âš ï¸  No item objects found in packages/core/src/items/traits/WeaponTrait.ts
  âš ï¸  No item objects found in packages/core/src/items/traits/ToolTrait.ts
  âš ï¸  No item objects found in packages/core/src/items/traits/StatBonusTrait.ts
  âš ï¸  No item objects found in packages/core/src/items/traits/MaterialTrait.ts
  âš ï¸  No item objects found in packages/core/src/items/traits/MagicalTrait.ts
  âš ï¸  No item objects found in packages/core/src/items/traits/EdibleTrait.ts
  âš ï¸  No item objects found in packages/core/src/items/traits/ContainerTrait.ts
  âš ï¸  No item objects found in packages/core/src/items/traits/ClothingTrait.ts
  âš ï¸  No item objects found in packages/core/src/items/traits/ArmorTrait.ts
  âš ï¸  No item objects found in packages/core/src/items/traits/AmmoTrait.ts
Looking for spell files: **/magic/**/*Spells.ts
  Found 6 file(s)
  âš ï¸  No spell objects found in packages/magic/src/TileConstructionSpells.ts
  âš ï¸  No spell objects found in packages/magic/src/MaterialCreationSpells.ts
  âš ï¸  No spell objects found in packages/magic/src/ExpandedSpells.ts
  âš ï¸  No spell objects found in packages/core/src/magic/TileConstructionSpells.ts
  âš ï¸  No spell objects found in packages/core/src/magic/MaterialCreationSpells.ts
  âš ï¸  No spell objects found in packages/core/src/magic/ExpandedSpells.ts
Looking for animal files: **/data/animalSpecies.ts
  Found 1 file(s)
Looking for recipe files: **/recipes/**/*.ts
  Found 0 file(s)
Looking for building files: **/buildings/**/*Registry.ts
  Found 2 file(s)
  âš ï¸  No building objects found in packages/core/src/buildings/TileBasedBlueprintRegistry.ts
  âš ï¸  No building objects found in packages/core/src/buildings/BuildingBlueprintRegistry.ts
Looking for summonable_entity files: **/magic/SummonableEntities.ts
  Found 1 file(s)
Found summonable entities file - manual validation recommended
  âš ï¸  No summonable_entity objects found in packages/core/src/magic/SummonableEntities.ts

================================================================================
VALIDATION RESULTS
================================================================================

âœ… All data files validated successfully!


 RUN  v1.6.1 /Users/annhoward/src/ai_village/custom_game_engine

stderr | packages/core/src/actions/__tests__/TillAction.test.ts > Tilling Action > Invalid Terrain Rejection > should throw error when tilling stone terrain
[SoilSystem] âŒ ERROR: Cannot till stone terrain at (5,5). Only grass and dirt can be tilled.

stderr | packages/core/src/actions/__tests__/TillAction.test.ts > Tilling Action > Invalid Terrain Rejection > should throw error when tilling water terrain
[SoilSystem] âŒ ERROR: Cannot till water terrain at (3,8). Only grass and dirt can be tilled.

stderr | packages/core/src/actions/__tests__/TillAction.test.ts > Tilling Action > Invalid Terrain Rejection > should throw error when tilling sand terrain
[SoilSystem] âŒ ERROR: Cannot till sand terrain at (10,10). Only grass and dirt can be tilled.

stderr | packages/core/src/actions/__tests__/TillAction.test.ts > Tilling Action > Invalid Terrain Rejection > should NOT modify tile state on invalid terrain
[SoilSystem] âŒ ERROR: Cannot till stone terrain at (5,5). Only grass and dirt can be tilled.

stderr | packages/core/src/actions/__tests__/TillAction.test.ts > Tilling Action > EventBus Integration > should NOT emit soil:tilled event on invalid terrain
[SoilSystem] âŒ ERROR: Cannot till stone terrain at (5,5). Only grass and dirt can be tilled.

stderr | packages/core/src/actions/__tests__/TillAction.test.ts > Tilling Action > Biome-Specific Fertility > should throw error for undefined biome (CLAUDE.md: no silent fallbacks)
[SoilSystem] âŒ CRITICAL ERROR: Tile at (5,5) has no biome data. Terrain generation failed or chunk not generated. Cannot determine fertility for farming.
[SoilSystem] Tile state: {
  "terrain": "grass",
  "moisture": 50,
  "fertility": 0,
  "tilled": false,
  "plantability": 0,
  "nutrients": {
    "nitrogen": 0,
    "phosphorus": 0,
    "potassium": 0
  },
  "fertilized": false,
  "fertilizerDuration": 0,
  "lastWatered": 0,
  "lastTilled": 0,
  "composted": false
}

stderr | packages/core/src/actions/__tests__/TillAction.test.ts > Tilling Action > Re-tilling Behavior > should throw error when attempting to re-till before depletion
[SoilSystem] âŒ ERROR: Tile at (5,5) is already tilled. Plantability: 2/3 uses remaining. Wait until depleted to re-till.

stderr | packages/core/src/actions/__tests__/TillAction.test.ts > Tilling Action > Re-tilling Behavior > should throw error when attempting to re-till with plantability=1
[SoilSystem] âŒ ERROR: Tile at (5,5) is already tilled. Plantability: 1/3 uses remaining. Wait until depleted to re-till.

stderr | packages/core/src/actions/__tests__/TillAction.test.ts > Tilling Action > Error Handling - CLAUDE.md Compliance > should throw clear error for invalid terrain type
[SoilSystem] âŒ ERROR: Cannot till stone terrain at (5,5). Only grass and dirt can be tilled.

stderr | packages/core/src/actions/__tests__/TillAction.test.ts > Tilling Action > Error Handling - CLAUDE.md Compliance > should include position in error message
[SoilSystem] âŒ ERROR: Cannot till water terrain at (15,20). Only grass and dirt can be tilled.

stderr | packages/core/src/actions/__tests__/TillAction.test.ts > Tilling Action > Error Handling - CLAUDE.md Compliance > should include terrain type in error message
[SoilSystem] âŒ ERROR: Cannot till sand terrain at (5,5). Only grass and dirt can be tilled.

 â¯ packages/core/src/__tests__/SpeciesGeneticsBody.integration.test.ts  (16 tests | 2 failed) 24ms
   â¯ packages/core/src/__tests__/SpeciesGeneticsBody.integration.test.ts > Species + Genetics + Body - Complete Integration > Mutation System > should apply mutations at the configured rate
     â†’ expected false to be true // Object.is equality
   â¯ packages/core/src/__tests__/SpeciesGeneticsBody.integration.test.ts > Species + Genetics + Body - Complete Integration > Mutation System > should create extra limb mutations
     â†’ expected 0 to be greater than 0
 âœ“ packages/core/src/actions/__tests__/TillAction.test.ts  (50 tests | 8 skipped) 19ms
 âœ“ packages/core/src/__tests__/ParasiticHiveMind.integration.test.ts  (49 tests) 35ms
 âœ“ packages/divinity/src/__tests__/AnimalBeliefTypes.test.ts  (97 tests) 38ms
 âœ“ packages/core/src/__tests__/MetricsCollector.test.ts  (63 tests) 52ms
 âœ“ packages/core/src/divinity/__tests__/AnimalBeliefTypes.test.ts  (97 tests) 49ms
 âœ“ packages/divinity/src/__tests__/AnimistTypes.test.ts  (145 tests) 41ms
 âœ“ packages/core/src/divinity/__tests__/AnimistTypes.test.ts  (145 tests) 55ms
 âœ“ packages/core/src/systems/__tests__/CreatorSurveillanceSystem.test.ts  (26 tests) 91ms
stderr | packages/core/src/systems/__tests__/CreatorSurveillanceSystem.test.ts > CreatorSurveillanceSystem > Adversarial Tests > should handle malformed event data gracefully
Error in event handler for magic:spell_cast: TypeError: Cannot destructure property 'spellId' of 'event.data' as it is undefined.
    at CreatorSurveillanceSystem.monitorSpellCast (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/CreatorSurveillanceSystem.ts:141:13)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/CreatorSurveillanceSystem.ts:115:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/__tests__/CreatorSurveillanceSystem.test.ts:762:18
    at Proxy.assertThrows (/Users/annhoward/src/ai_village/custom_game_engine/node_modules/chai/lib/chai/core/assertions.js:2644:7)
    at Proxy.methodWrapper (/Users/annhoward/src/ai_village/custom_game_engine/node_modules/chai/lib/chai/utils/addMethod.js:57:25)
    at Proxy.<anonymous> (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/expect/dist/index.js:850:16)
    at Proxy.overwritingMethodWrapper (/Users/annhoward/src/ai_village/custom_game_engine/node_modules/chai/lib/chai/utils/overwriteMethod.js:78:33)
    at Proxy.<anonymous> (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/expect/dist/index.js:1324:19)

 âœ“ packages/core/src/divinity/__tests__/UniverseModification.test.ts  (42 tests) 48ms
 â¯ packages/core/src/__tests__/BehaviorEndToEnd.integration.test.ts  (30 tests | 2 failed) 105ms
   â¯ packages/core/src/__tests__/BehaviorEndToEnd.integration.test.ts > Behavior End-to-End Integration Tests > Resource Gathering Behaviors > Gather Behavior - Resources > should harvest resources when adjacent
     â†’ expected false to be true // Object.is equality
   â¯ packages/core/src/__tests__/BehaviorEndToEnd.integration.test.ts > Behavior End-to-End Integration Tests > Resource Gathering Behaviors > Gather Behavior - Resources > should emit resource:gathered event when harvesting
     â†’ expected 0 to be greater than 0
 â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts  (99 tests | 20 failed | 1 skipped) 123ms
   â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Lifecycle > initializes romantic tracking
     â†’ initializeRomantic is not a function
   â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Lifecycle > updates attraction levels
     â†’ initializeRomantic is not a function
   â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Lifecycle > starts courtship
     â†’ initializeRomantic is not a function
   â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Lifecycle > progresses courtship through gifts/displays
     â†’ initializeRomantic is not a function
   â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Lifecycle > accepts courtship - transitions to dating
     â†’ initializeRomantic is not a function
   â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Lifecycle > rejects courtship - emotional milestone recorded
     â†’ initializeRomantic is not a function
   â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Lifecycle > forms bonds of increasing strength
     â†’ initializeRomantic is not a function
   â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Lifecycle > tracks intimacy encounters
     â†’ initializeRomantic is not a function
   â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Lifecycle > records offspring from relationship
     â†’ initializeRomantic is not a function
   â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Lifecycle > ends relationships with appropriate reason tracking
     â†’ initializeRomantic is not a function
   â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Queries > gets all romantic relationships
     â†’ initializeRomantic is not a function
   â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Queries > gets current partners
     â†’ initializeRomantic is not a function
   â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Queries > gets primary partner
     â†’ initializeRomantic is not a function
   â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Queries > checks exclusive relationship status
     â†’ initializeRomantic is not a function
   â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Queries > gets attraction level
     â†’ initializeRomantic is not a function
   â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Full Lifecycle: Human Romance > simulates meeting to marriage to children
     â†’ initializeRomantic is not a function
   â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Full Lifecycle: Kemmer Partners > simulates kemmer cycle and conception
     â†’ initializeRomantic is not a function
   â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Full Lifecycle: Mystif Union Magic > simulates union magic reproduction
     â†’ formBond is not a function
   â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Edge Cases > handles empty relationship romantic operations
     â†’ updateAttraction is not a function
   â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts > The Grand Multiverse Romance > simulates cross-paradigm love story
     â†’ initializeRomantic is not a function
 â¯ packages/renderer/src/__tests__/ContextMenuManager.test.ts  (71 tests | 2 failed) 655ms
   â¯ packages/renderer/src/__tests__/ContextMenuManager.test.ts > ContextMenuManager > Criterion 5: Selection Context Menu > should include "Formation" submenu with options
     â†’ expected false to be true // Object.is equality
   â¯ packages/renderer/src/__tests__/ContextMenuManager.test.ts > ContextMenuManager > Criterion 7: Resource/Harvestable Actions > should include "Prioritize" submenu with priority options
     â†’ expected false to be true // Object.is equality
 âœ“ packages/divinity/src/__tests__/UniverseModification.test.ts  (42 tests) 23ms
stderr | ComponentRegistry.register (/Users/annhoward/src/ai_village/custom_game_engine/packages/introspection/src/registry/ComponentRegistry.ts:45:15)
[ComponentRegistry] Schema 'interests' is already registered. Overwriting.

 â¯ packages/core/src/__tests__/ProgressiveSkillReveal.test.ts  (62 tests | 1 failed) 23ms
   â¯ packages/core/src/__tests__/ProgressiveSkillReveal.test.ts > Random Starting Skills > generateRandomStartingSkills > should favor skills that match personality affinities (statistical)
     â†’ expected 52 to be greater than or equal to 60
 â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts  (36 tests | 36 failed) 14ms
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > considerCourtship (idle -> interested) > should return false if on cooldown
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > considerCourtship (idle -> interested) > should return false if not actively seeking
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > considerCourtship (idle -> interested) > should return false if compatibility below threshold
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > considerCourtship (idle -> interested) > should return true and transition to interested if conditions met
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > considerCourtship (idle -> interested) > should respect per-agent rejection cooldown
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > considerCourtship (idle -> interested) > should use romantic inclination to adjust threshold
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > initiateCourtship (interested -> courting) > should transition agent to courting state
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > initiateCourtship (interested -> courting) > should create active courtship record
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > initiateCourtship (interested -> courting) > should notify target agent
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > initiateCourtship (interested -> courting) > should create received courtship record on target
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > initiateCourtship (interested -> courting) > should record start tick
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > performCourtshipTactic > should record tactic in attempted tactics
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > performCourtshipTactic > should calculate and record reception
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > performCourtshipTactic > should update target interest level
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > performCourtshipTactic > should cap interest at 1.0
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > performCourtshipTactic > should update relationship affinity and familiarity
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > performCourtshipTactic > should update success probability
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > evaluateCourtship (being_courted -> accept/reject/continue) > should return "continue" if paradigm requirements not met
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > evaluateCourtship (being_courted -> accept/reject/continue) > should return "reject" if interest too low
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > evaluateCourtship (being_courted -> accept/reject/continue) > should return "accept" if decision score exceeds threshold
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > evaluateCourtship (being_courted -> accept/reject/continue) > should set willingToConsent to true on accept
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > evaluateCourtship (being_courted -> accept/reject/continue) > should use romantic inclination to adjust threshold
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > evaluateCourtship (being_courted -> accept/reject/continue) > should check all required tactics are present
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > evaluateCourtship (being_courted -> accept/reject/continue) > should allow optional tactics to count toward minimum
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > transitionToMating (both consenting -> mating) > should set both agents to consenting state
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > transitionToMating (both consenting -> mating) > should emit courtship:consent event
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > transitionToMating (both consenting -> mating) > should include mating behavior in event
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > checkParadigmRequirements > should return false if required tactics missing
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > checkParadigmRequirements > should return false if minimum tactics not met
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > checkParadigmRequirements > should return true if all requirements met
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > checkParadigmRequirements > should fail if forbidden tactic was used
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > Error handling > should throw when agent missing CourtshipComponent
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > Error handling > should throw when agent missing SexualityComponent
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > Error handling > should handle invalid target gracefully
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > Error handling > should throw when performing tactic without active courtship
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > Error handling > should NOT use fallback for missing paradigm requirements
     â†’ World is not a constructor
 â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts  (37 tests | 37 failed) 14ms
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > CourtshipComponent creation > should create courtship component with default state
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > CourtshipComponent creation > should track romantic inclination between 0 and 1
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > CourtshipComponent creation > should initialize with empty courtship arrays
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > CourtshipComponent creation > should store courtship paradigm
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship state transitions > should transition from idle to interested when potential mate is near
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship state transitions > should transition from interested to courting when initiating
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship state transitions > should track being courted state
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship state transitions > should transition to consenting when both agree
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship tactics > should record attempted tactic
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship tactics > should record tactic response
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship tactics > should track tactics received by target
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship tactics > should increase interest based on preferred tactics
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship tactics > should decrease interest based on disliked tactics
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship paradigms > should define required tactics for human courtship
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship paradigms > should define forbidden tactics for human courtship
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship paradigms > should specify minimum tactics needed
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship paradigms > should define mating behavior for humans
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship paradigms > should have different paradigm for dwarves
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship paradigms > should have different paradigm for bird-folk
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Compatibility calculation > should calculate compatibility between two agents
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Compatibility calculation > should factor in sexual compatibility
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Compatibility calculation > should factor in personality compatibility
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Compatibility calculation > should factor in relationship strength
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Compatibility calculation > should return 0 if not mutually attracted
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Cooldowns and rejections > should enforce courtship cooldown
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Cooldowns and rejections > should track per-agent rejection cooldown
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Cooldowns and rejections > should record past courtships
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Mating behaviors > should require private location for human mating
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Mating behaviors > should require nest location for bird-folk mating
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Mating behaviors > should allow public mating for mystif union magic
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Mating behaviors > should define post-mating effects
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Error handling > should throw when romantic inclination is out of range
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Error handling > should throw when paradigm is missing
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Error handling > should throw when state is invalid
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Error handling > should NOT use fallback for missing required fields
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Error handling > should throw when compatibility score is out of range
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Error handling > should throw when interest level is out of range
     â†’ World is not a constructor
 âœ“ packages/core/src/__tests__/MagicCostSystem.test.ts  (55 tests) 17ms
 âœ“ packages/core/src/reproduction/__tests__/CourtshipSystem.test.ts  (37 tests) 22ms
 âœ“ packages/divinity/src/__tests__/MultiverseCrossing.test.ts  (56 tests) 21ms
 âœ“ packages/core/src/reproduction/__tests__/CourtshipStateMachine.test.ts  (36 tests) 56ms
 âœ“ packages/core/src/systems/__tests__/StorageDeposit.test.ts  (14 tests | 1 skipped) 18ms
 âœ“ packages/core/src/targeting/__tests__/Targeting.integration.test.ts  (16 tests) 14ms
 âœ“ packages/core/src/divinity/__tests__/MultiverseCrossing.test.ts  (56 tests) 24ms
 âœ“ packages/core/src/systems/__tests__/ResourceGathering.test.ts  (37 tests) 18ms
 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts  (39 tests | 29 failed) 74ms
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 1: Tree Visualization > should draw dependency lines between nodes
     â†’ expected "spy" to be called at least once
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 1: Tree Visualization > should display XP available for current paradigm
     â†’ expected undefined not to be undefined
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 2: Node States > should display unlocked nodes with green background
     â†’ expected 0 to be greater than 0
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 2: Node States > should display available nodes with yellow glow
     â†’ expected 0 to be greater than 0
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 2: Node States > should display locked nodes with gray background
     â†’ expected 0 to be greater than 0
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 2: Node States > should display hidden nodes as "???"
     â†’ expected undefined not to be undefined
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 3: Unlock Conditions Display > should show all unlock conditions on node hover
     â†’ expected undefined not to be undefined
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 3: Unlock Conditions Display > should display met conditions with checkmark icon
     â†’ expected 0 to be greater than 0
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 3: Unlock Conditions Display > should display unmet conditions with X icon
     â†’ expected 0 to be greater than 0
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 3: Unlock Conditions Display > should display XP cost prominently
     â†’ expected undefined not to be undefined
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 4: Node Unlocking > should unlock node when player clicks available node
     â†’ expected "spy" to be called with arguments: [ â€¦(4) ]

Received: 



Number of calls: 0

   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 4: Node Unlocking > should deduct XP when node unlocked
     â†’ expected 500 to be 400 // Object.is equality
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 4: Node Unlocking > should emit magic:skill_node_unlocked event
     â†’ expected "spy" to be called with arguments: [ 'magic:skill_node_unlocked', â€¦(1) ]

Received: 



Number of calls: 0

   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 4: Node Unlocking > should update UI immediately after unlock
     â†’ expected 0 to be greater than 0
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 5: Multi-Paradigm Support > should show independent XP pools for each paradigm
     â†’ expected undefined not to be undefined
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 5: Multi-Paradigm Support > should switch paradigm when tab clicked
     â†’ expected null to be 'allomancy' // Object.is equality
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 5: Multi-Paradigm Support > should not allow XP cross-contamination between paradigms
     â†’ expected 500 to be 400 // Object.is equality
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 6: Discovery Mechanics > should reveal hidden node when prerequisite met
     â†’ expected undefined not to be undefined
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 6: Discovery Mechanics > should show notification when hidden node reveals
     â†’ expected "spy" to be called with arguments: [ 'ui:notification', { â€¦(2) } ]

Received: 



Number of calls: 0

   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 6: Discovery Mechanics > should display tooltip explaining what unlocked hidden node
     â†’ expected undefined not to be undefined
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 7: Keyboard Navigation > should navigate nodes with arrow keys
     â†’ expected null not to be null // Object.is equality
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 7: Keyboard Navigation > should unlock selected node with Enter key
     â†’ expected "spy" to be called at least once
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 7: Keyboard Navigation > should close panel with Escape key
     â†’ expected true to be false // Object.is equality
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Edge Cases > should hide tabs when agent has only one paradigm
     â†’ expected 1 to be +0 // Object.is equality
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Edge Cases > should handle scrollable tab bar when agent has 10+ paradigms
     â†’ expected 0 to be greater than 0
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Edge Cases > should handle node with 10+ unlock conditions via scrollable tooltip
     â†’ expected undefined not to be undefined
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Error Handling > should throw when required entity is missing
     â†’ expected [Function] to throw an error
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Error Handling > should throw when paradigm tree not found
     â†’ expected [Function] to throw an error
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Error Handling > should throw when magic component missing on magic entity
     â†’ expected [Function] to throw an error
 âœ“ packages/core/src/magic/__tests__/MagicSkillTree.test.ts  (58 tests) 17ms
 âœ“ packages/magic/src/__tests__/MagicSkillTree.test.ts  (58 tests) 17ms
 âœ“ packages/core/src/__tests__/MagicSystemCrossExploits.test.ts  (28 tests) 15ms
 âœ“ packages/core/src/__tests__/InterestEvolutionSystem.test.ts  (26 tests) 159ms
 â¯ packages/core/src/magic/__tests__/CostCalculators.test.ts  (36 tests | 2 failed) 18ms
   â¯ packages/core/src/magic/__tests__/CostCalculators.test.ts > CostCalculators - Divine Paradigm > should cost favor as primary resource
     â†’ expected 14 to be 12 // Object.is equality
   â¯ packages/core/src/magic/__tests__/CostCalculators.test.ts > CostCalculators - Divine Paradigm > should reduce cost for aligned spells
     â†’ expected 17 to be less than or equal to 15
 â¯ packages/core/src/__tests__/MagicSystemBreaking.test.ts  (48 tests | 1 failed) 27ms
   â¯ packages/core/src/__tests__/MagicSystemBreaking.test.ts > Magic System Breaking - Cross-Paradigm Chaos > should handle paradox magic breaking other paradigms
     â†’ expected 0 to be greater than 0
 â¯ packages/core/src/magic/__tests__/MagicSystemEdgeCases.test.ts  (27 tests | 1 failed) 16ms
   â¯ packages/core/src/magic/__tests__/MagicSystemEdgeCases.test.ts > Resource Depletion Edge Cases > should handle casting when resources hit zero mid-cast
     â†’ expected false to be true // Object.is equality
stderr | ComponentRegistry.register (/Users/annhoward/src/ai_village/custom_game_engine/packages/introspection/src/registry/ComponentRegistry.ts:45:15)
[ComponentRegistry] Schema 'interests' is already registered. Overwriting.

 âœ“ packages/core/src/__tests__/AnimalHousingIntegration.test.ts  (14 tests | 1 skipped) 9ms
 â¯ packages/magic/src/__tests__/CostCalculators.test.ts  (36 tests | 2 failed) 19ms
   â¯ packages/magic/src/__tests__/CostCalculators.test.ts > CostCalculators - Divine Paradigm > should cost favor as primary resource
     â†’ expected 14 to be 12 // Object.is equality
   â¯ packages/magic/src/__tests__/CostCalculators.test.ts > CostCalculators - Divine Paradigm > should reduce cost for aligned spells
     â†’ expected 17 to be less than or equal to 15
 â¯ packages/magic/src/__tests__/MagicSystemEdgeCases.test.ts  (27 tests | 1 failed) 18ms
   â¯ packages/magic/src/__tests__/MagicSystemEdgeCases.test.ts > Resource Depletion Edge Cases > should handle casting when resources hit zero mid-cast
     â†’ expected false to be true // Object.is equality
 âœ“ packages/core/src/components/__tests__/SpatialMemoryComponent.test.ts  (59 tests) 15ms
stderr | packages/core/src/__tests__/BuildingSystem.test.ts > BuildingSystem > error handling - validation > should emit building:placement:failed event on unknown building type
Error in event handler for building:placement:confirmed: Error: Unknown building type: "invalid-building-type". Add resource cost to BuildingSystem.ts:getResourceCost()
    at BuildingSystem.getResourceCost (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/BuildingSystem.ts:819:13)
    at BuildingSystem.handleBuildingPlacement (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/BuildingSystem.ts:339:31)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/BuildingSystem.ts:113:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/BuildingSystem.test.ts:202:22
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)

stderr | packages/core/src/__tests__/BuildingSystem.test.ts > BuildingSystem > error handling - validation > should handle building completion event for non-existent entity gracefully
Error in event handler for building:complete: Error: [BuildingSystem] Entity non-existent-entity not found for building completion - entity may have been deleted before completion event processed
    at BuildingSystem.handleBuildingComplete (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/BuildingSystem.ts:141:13)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/BuildingSystem.ts:118:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/BuildingSystem.test.ts:219:22
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)

stderr | packages/core/src/__tests__/BuildingSystem.test.ts > BuildingSystem > governance buildings > should add town hall component on completion
Error in event handler for building:complete: Error: Unknown building type: "undefined". Add fuel config to BuildingSystem.ts
    at BuildingSystem.getFuelConfiguration (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/BuildingSystem.ts:294:13)
    at BuildingSystem.handleBuildingComplete (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/BuildingSystem.ts:175:29)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/BuildingSystem.ts:118:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/BuildingSystem.test.ts:554:22
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)

stderr | packages/core/src/__tests__/BuildingSystem.test.ts > BuildingSystem > governance buildings > should add census bureau component on completion
Error in event handler for building:complete: Error: Unknown building type: "undefined". Add fuel config to BuildingSystem.ts
    at BuildingSystem.getFuelConfiguration (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/BuildingSystem.ts:294:13)
    at BuildingSystem.handleBuildingComplete (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/BuildingSystem.ts:175:29)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/BuildingSystem.ts:118:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/BuildingSystem.test.ts:575:22
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)

stderr | packages/core/src/__tests__/BuildingSystem.test.ts > BuildingSystem > governance buildings > should add weather station component on completion
Error in event handler for building:complete: Error: Unknown building type: "undefined". Add fuel config to BuildingSystem.ts
    at BuildingSystem.getFuelConfiguration (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/BuildingSystem.ts:294:13)
    at BuildingSystem.handleBuildingComplete (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/BuildingSystem.ts:175:29)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/BuildingSystem.ts:118:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/BuildingSystem.test.ts:596:22
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)

stderr | packages/core/src/__tests__/BuildingSystem.test.ts > BuildingSystem > governance buildings > should add health clinic component on completion
Error in event handler for building:complete: Error: Unknown building type: "undefined". Add fuel config to BuildingSystem.ts
    at BuildingSystem.getFuelConfiguration (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/BuildingSystem.ts:294:13)
    at BuildingSystem.handleBuildingComplete (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/BuildingSystem.ts:175:29)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/BuildingSystem.ts:118:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/BuildingSystem.test.ts:617:22
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)

 â¯ packages/core/src/__tests__/BuildingSystem.test.ts  (36 tests | 4 failed) 36ms
   â¯ packages/core/src/__tests__/BuildingSystem.test.ts > BuildingSystem > governance buildings > should add town hall component on completion
     â†’ expected undefined not to be undefined
   â¯ packages/core/src/__tests__/BuildingSystem.test.ts > BuildingSystem > governance buildings > should add census bureau component on completion
     â†’ expected undefined not to be undefined
   â¯ packages/core/src/__tests__/BuildingSystem.test.ts > BuildingSystem > governance buildings > should add weather station component on completion
     â†’ expected undefined not to be undefined
   â¯ packages/core/src/__tests__/BuildingSystem.test.ts > BuildingSystem > governance buildings > should add health clinic component on completion
     â†’ expected undefined not to be undefined
stderr | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Edge Cases > should not overflow panel bounds with many resources
[AgentInfoPanel] World not available or missing getEntity method

 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts  (32 tests | 23 failed) 262ms
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 1: Inventory Section Appears > should render inventory section below needs section when agent is selected
     â†’ expected undefined not to be undefined
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 2: Resource Counts Display > should display stone resources with icon and quantity
     â†’ expected undefined not to be undefined
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 2: Resource Counts Display > should display food resources with icon and quantity
     â†’ expected undefined not to be undefined
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 3: Empty Inventory State > should show "(empty)" when inventory has no items
     â†’ expected undefined not to be undefined
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 3: Empty Inventory State > should show capacity as "Weight: 0/100 Slots: 0/8" when empty
     â†’ expected undefined not to be undefined
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 4: Capacity Display > should display current weight and max weight
     â†’ expected undefined not to be undefined
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 4: Capacity Display > should display current slots and max slots
     â†’ expected undefined not to be undefined
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 4: Capacity Display > should calculate weight correctly for mixed resources
     â†’ expected undefined not to be undefined
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 5: Capacity Warning Colors > should use white color when weight is below 80%
     â†’ expected '#aaaaaa' to be '#ffffff' // Object.is equality
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 5: Capacity Warning Colors > should use yellow color when weight exceeds 80%
     â†’ expected -1 to be greater than -1
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 5: Capacity Warning Colors > should use red color when weight reaches 100%
     â†’ expected -1 to be greater than -1
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 5: Capacity Warning Colors > should use yellow color when slots exceed 80%
     â†’ expected -1 to be greater than -1
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 5: Capacity Warning Colors > should use red color when slots reach 100%
     â†’ expected -1 to be greater than -1
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 6: Real-time Updates > should update capacity display when weight changes
     â†’ expected undefined not to be undefined
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 6: Real-time Updates > should show empty state when all resources are consumed
     â†’ expected undefined not to be undefined
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Error Handling (per CLAUDE.md) > should throw when inventory.maxWeight is missing
     â†’ expected [Function] to throw an error
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Error Handling (per CLAUDE.md) > should throw when inventory.maxWeight is undefined
     â†’ expected [Function] to throw an error
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Error Handling (per CLAUDE.md) > should throw when inventory.slots is not an array
     â†’ expected [Function] to throw an error
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Error Handling (per CLAUDE.md) > should throw when inventory.slots is null
     â†’ expected [Function] to throw an error
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Error Handling (per CLAUDE.md) > should throw when inventory.currentWeight is missing
     â†’ expected [Function] to throw an error
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Error Handling (per CLAUDE.md) > should throw when inventory.maxSlots is missing
     â†’ expected [Function] to throw an error
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Edge Cases > should handle inventory with only empty slots
     â†’ expected undefined not to be undefined
   â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Edge Cases > should handle inventory with partial slots filled
     â†’ expected undefined not to be undefined
 âœ“ packages/core/src/navigation/__tests__/Navigation.integration.test.ts  (23 tests) 19ms
 â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts  (16 tests | 15 failed | 1 skipped) 35ms
   â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Criterion 4: Reality Anchor Charging Consumes Power > should drain 5,000,000 kW during charging phase
     â†’ Cannot read properties of undefined (reading 'totalGeneration')
   â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Criterion 4: Reality Anchor Charging Consumes Power > should NOT charge when isPowered=false (insufficient power)
     â†’ Cannot set property tick of #<WorldImpl> which has only a getter
   â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Criterion 4: Reality Anchor Charging Consumes Power > should charge normally when isPowered=true
     â†’ expected false to be true // Object.is equality
   â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Criterion 4: Reality Anchor Charging Consumes Power > should emit event when charging interrupted by power loss
     â†’ Cannot set property tick of #<WorldImpl> which has only a getter
   â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Criterion 5: Reality Anchor Active Field Consumes Power > should drain 50,000,000 kW when field is active
     â†’ Cannot read properties of undefined (reading 'totalGeneration')
   â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Criterion 5: Reality Anchor Active Field Consumes Power > should collapse field when isPowered=false during active state
     â†’ Cannot set property tick of #<WorldImpl> which has only a getter
   â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Criterion 5: Reality Anchor Active Field Consumes Power > should emit reality_anchor:power_loss event when power fails during active field
     â†’ Cannot set property tick of #<WorldImpl> which has only a getter
   â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Criterion 5: Reality Anchor Active Field Consumes Power > should emit reality_anchor:field_collapse event when field collapses from power loss
     â†’ Cannot set property tick of #<WorldImpl> which has only a getter
   â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Criterion 5: Reality Anchor Active Field Consumes Power > should maintain field when power is sufficient
     â†’ Cannot set property tick of #<WorldImpl> which has only a getter
   â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Power Network Isolation Edge Cases > should fail gracefully when Reality Anchor has no power network connection
     â†’ Cannot set property tick of #<WorldImpl> which has only a getter
   â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Power Network Isolation Edge Cases > should handle Reality Anchor with wrong power type gracefully
     â†’ expected +0 to be 2 // Object.is equality
   â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Partial Power Scenarios > should emit reality_anchor:power_insufficient when receiving 25-50% power
     â†’ Cannot set property tick of #<WorldImpl> which has only a getter
   â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Mid-Battle Power Loss Scenario > should restore god divinity when field collapses from power loss
     â†’ Cannot set property tick of #<WorldImpl> which has only a getter
   â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Error Handling > should handle Reality Anchor without PowerComponent gracefully
     â†’ Cannot set property tick of #<WorldImpl> which has only a getter
   â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Error Handling > should handle destroyed Reality Anchor gracefully
     â†’ Cannot set property tick of #<WorldImpl> which has only a getter
 âœ“ packages/divinity/src/__tests__/UniverseConfig.test.ts  (68 tests) 11ms
 âœ“ packages/core/src/divinity/__tests__/UniverseConfig.test.ts  (68 tests) 14ms
 â¯ packages/core/src/__tests__/PlantSystem.test.ts  (32 tests | 10 failed) 25ms
   â¯ packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > update - plant lifecycle > should throw when plant missing position field
     â†’ expected [Function] to throw an error
   â¯ packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > update - plant lifecycle > should decrease hydration over time
     â†’ expected 80 to be less than 80
   â¯ packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > error handling - validation > should throw when plant missing health field
     â†’ expected [Function] to throw an error
   â¯ packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > error handling - validation > should throw when plant missing hydration field
     â†’ expected [Function] to throw an error
   â¯ packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > error handling - validation > should throw when plant missing nutrition field
     â†’ expected [Function] to throw an error
   â¯ packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > plant health and damage > should damage plant when hydration is low
     â†’ expected 100 to be less than 100
   â¯ packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > plant health and damage > should damage plant when nutrition is low
     â†’ expected 100 to be less than 100
   â¯ packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > plant health and damage > should set stage to dead when health reaches zero
     â†’ expected 'vegetative' to be 'dead' // Object.is equality
   â¯ packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > weather effects > should increase hydration when rain event occurs
     â†’ expected 50 to be greater than 50
   â¯ packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > stage transitions > should advance stageProgress over time
     â†’ expected 0 to be greater than 0
stderr | packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > update - plant lifecycle > should throw when plant missing position field
[PlantSystem] Plant entity 0e6e87e2-e821-467e-b599-de58eeb13f93 missing required position field - skipping
[BugReporter] {
  id: 'bug-1767698206409-j6wy0y',
  timestamp: '2026-01-06T11:16:46.409Z',
  category: 'corrupted_data',
  severity: 'high',
  component: 'PlantSystem',
  entityId: '0e6e87e2-e821-467e-b599-de58eeb13f93',
  entityType: 'plant',
  error: 'Corrupted plant entity: Missing position field',
  details: {
    reason: 'Missing position field',
    plantData: { speciesId: 'wheat', stage: 'seed', health: 85 }
  },
  stackTrace: undefined
}

stderr | packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > error handling - validation > should throw when plant missing health field
[PlantSystem] Plant entity 33a8f790-2a62-4cd9-818e-c0a57e413880 failed validation: Error: Plant health not set - required for lifecycle - skipping
[BugReporter] {
  id: 'bug-1767698206417-wtyg93',
  timestamp: '2026-01-06T11:16:46.417Z',
  category: 'corrupted_data',
  severity: 'high',
  component: 'PlantSystem',
  entityId: '33a8f790-2a62-4cd9-818e-c0a57e413880',
  entityType: 'plant',
  error: 'Corrupted plant entity: Validation failed: Error: Plant health not set - required for lifecycle',
  details: {
    reason: 'Validation failed: Error: Plant health not set - required for lifecycle',
    plantData: {
      speciesId: 'wheat',
      stage: 'seed',
      health: undefined,
      hydration: 70,
      nutrition: 80,
      position: [Object]
    }
  },
  stackTrace: undefined
}

stderr | packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > error handling - validation > should throw when plant missing hydration field
[PlantSystem] Plant entity 09f7dc68-7941-47a2-8f6e-fa97ffa97fb5 failed validation: Error: Plant hydration not set - required for lifecycle - skipping
[BugReporter] {
  id: 'bug-1767698206418-cbkpc3',
  timestamp: '2026-01-06T11:16:46.418Z',
  category: 'corrupted_data',
  severity: 'high',
  component: 'PlantSystem',
  entityId: '09f7dc68-7941-47a2-8f6e-fa97ffa97fb5',
  entityType: 'plant',
  error: 'Corrupted plant entity: Validation failed: Error: Plant hydration not set - required for lifecycle',
  details: {
    reason: 'Validation failed: Error: Plant hydration not set - required for lifecycle',
    plantData: {
      speciesId: 'wheat',
      stage: 'seed',
      health: 100,
      hydration: undefined,
      nutrition: 80,
      position: [Object]
    }
  },
  stackTrace: undefined
}

stderr | packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > error handling - validation > should throw when plant missing nutrition field
[PlantSystem] Plant entity 7f60f816-a65c-4934-be82-21874a1bcb3c failed validation: Error: Plant nutrition not set - required for lifecycle - skipping
[BugReporter] {
  id: 'bug-1767698206419-p3loum',
  timestamp: '2026-01-06T11:16:46.419Z',
  category: 'corrupted_data',
  severity: 'high',
  component: 'PlantSystem',
  entityId: '7f60f816-a65c-4934-be82-21874a1bcb3c',
  entityType: 'plant',
  error: 'Corrupted plant entity: Validation failed: Error: Plant nutrition not set - required for lifecycle',
  details: {
    reason: 'Validation failed: Error: Plant nutrition not set - required for lifecycle',
    plantData: {
      speciesId: 'wheat',
      stage: 'seed',
      health: 100,
      hydration: 70,
      nutrition: undefined,
      position: [Object]
    }
  },
  stackTrace: undefined
}

stderr | packages/renderer/src/__tests__/ContextMenuIntegration.test.ts > ContextMenu Integration > Error recovery > should emit failure event when action execution throws
[ContextMenuManager] Failed to execute action test_throwing_action: Error: Action execution failed
    at Object.execute (/Users/annhoward/src/ai_village/custom_game_engine/packages/renderer/src/__tests__/ContextMenuIntegration.test.ts:625:17)
    at ContextActionRegistry.execute (/Users/annhoward/src/ai_village/custom_game_engine/packages/renderer/src/context-menu/ContextActionRegistry.ts:107:16)
    at ContextMenuManager.executeAction (/Users/annhoward/src/ai_village/custom_game_engine/packages/renderer/src/ContextMenuManager.ts:557:21)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/renderer/src/__tests__/ContextMenuIntegration.test.ts:647:21
    at Proxy.assertThrows (/Users/annhoward/src/ai_village/custom_game_engine/node_modules/chai/lib/chai/core/assertions.js:2644:7)
    at Proxy.methodWrapper (/Users/annhoward/src/ai_village/custom_game_engine/node_modules/chai/lib/chai/utils/addMethod.js:57:25)
    at Proxy.<anonymous> (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/expect/dist/index.js:850:16)
    at Proxy.overwritingMethodWrapper (/Users/annhoward/src/ai_village/custom_game_engine/node_modules/chai/lib/chai/utils/overwriteMethod.js:78:33)
    at Proxy.<anonymous> (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/expect/dist/index.js:1324:19)
    at Proxy.<anonymous> (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/expect/dist/index.js:800:17)

 âœ“ packages/renderer/src/__tests__/ContextMenuIntegration.test.ts  (20 tests) 96ms
 â¯ packages/core/src/divinity/__tests__/DivinitySystemEdgeCases.test.ts  (35 tests | 1 failed) 2524ms
   â¯ packages/core/src/divinity/__tests__/DivinitySystemEdgeCases.test.ts > Pantheon Relationship Deadlocks > should detect circular dependency in pantheon hierarchy
     â†’ Invalid array length
 âœ“ packages/core/src/divinity/__tests__/Divinity.integration.test.ts  (13 tests) 7ms
stderr | packages/renderer/src/__tests__/WindowManager.integration.test.ts > WindowManager Integration Tests > Acceptance Criterion 7: LocalStorage Fallback > should handle corrupted localStorage gracefully
Failed to load window layout, using defaults: SyntaxError: Unexpected token 'i', "invalid json {{{" is not valid JSON
    at JSON.parse (<anonymous>)
    at WindowManager.loadLayout (/Users/annhoward/src/ai_village/custom_game_engine/packages/renderer/src/WindowManager.ts:854:40)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/renderer/src/__tests__/WindowManager.integration.test.ts:335:23
    at Proxy.assertThrows (/Users/annhoward/src/ai_village/custom_game_engine/node_modules/chai/lib/chai/core/assertions.js:2644:7)
    at Proxy.methodWrapper (/Users/annhoward/src/ai_village/custom_game_engine/node_modules/chai/lib/chai/utils/addMethod.js:57:25)
    at Proxy.<anonymous> (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/expect/dist/index.js:850:16)
    at Proxy.overwritingMethodWrapper (/Users/annhoward/src/ai_village/custom_game_engine/node_modules/chai/lib/chai/utils/overwriteMethod.js:78:33)
    at Proxy.<anonymous> (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/expect/dist/index.js:1324:19)
    at Proxy.<anonymous> (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/expect/dist/index.js:800:17)
    at Proxy.methodWrapper (/Users/annhoward/src/ai_village/custom_game_engine/node_modules/chai/lib/chai/utils/addMethod.js:57:25)

 âœ“ packages/renderer/src/__tests__/WindowManager.integration.test.ts  (32 tests) 101ms
 âœ“ packages/divinity/src/__tests__/DivineServantTypes.test.ts  (53 tests) 15ms
 âœ“ packages/divinity/src/__tests__/Divinity.integration.test.ts  (13 tests) 13ms
 âœ“ packages/core/src/divinity/__tests__/DivineServantTypes.test.ts  (53 tests) 12ms
 âœ“ packages/core/src/__tests__/PartnerSelector.test.ts  (30 tests) 8ms
 â¯ packages/divinity/src/__tests__/DivinitySystemEdgeCases.test.ts  (35 tests | 1 failed) 2968ms
   â¯ packages/divinity/src/__tests__/DivinitySystemEdgeCases.test.ts > Pantheon Relationship Deadlocks > should detect circular dependency in pantheon hierarchy
     â†’ Invalid array length
 â¯ packages/core/src/systems/__tests__/MovementOscillation.integration.test.ts  (11 tests | 6 failed | 5 skipped) 12ms
   â¯ packages/core/src/systems/__tests__/MovementOscillation.integration.test.ts > Movement Oscillation Detection > Oscillation Detection Algorithm > should detect no oscillation for stationary agent
     â†’ Cannot read properties of undefined (reading 'velocityX')
   â¯ packages/core/src/systems/__tests__/MovementOscillation.integration.test.ts > Movement Oscillation Detection > Oscillation Detection Algorithm > should detect no oscillation for agent moving in straight line
     â†’ Cannot read properties of undefined (reading 'velocityX')
   â¯ packages/core/src/systems/__tests__/MovementOscillation.integration.test.ts > Movement Oscillation Detection > Oscillation Detection Algorithm > should detect oscillation for agent with alternating velocity
     â†’ Cannot read properties of undefined (reading 'velocityX')
   â¯ packages/core/src/systems/__tests__/MovementOscillation.integration.test.ts > Movement Oscillation Detection > Steering vs AgentBrainSystem Conflict Detection > should not oscillate when MovementSystem syncs velocity to movement
     â†’ SteeringSystem failed for entity df2e95fa-5076-48ff-95e9-993aa0900665: Error: Steering component missing
   â¯ packages/core/src/systems/__tests__/MovementOscillation.integration.test.ts > Movement Oscillation Detection > Steering vs AgentBrainSystem Conflict Detection > should detect oscillation if velocity is externally modified each tick
     â†’ Cannot read properties of undefined (reading 'velocityX')
   â¯ packages/core/src/systems/__tests__/MovementOscillation.integration.test.ts > Movement Oscillation Detection > Extended Duration Tests > should not develop oscillation over 1000 ticks with full agent
     â†’ SteeringSystem failed for entity 1a606722-5958-42c6-800a-18e1a51010ee: Error: Steering component missing
 âœ“ packages/core/src/__tests__/CreativeParadigms.integration.test.ts  (93 tests) 15ms
 âœ“ packages/core/src/__tests__/MetricsAnalysis.test.ts  (34 tests) 11ms
 âœ“ packages/core/src/__tests__/MagicSystemTimingExploits.test.ts  (23 tests) 7ms
 â¯ packages/core/src/systems/__tests__/EquipmentCombat.integration.test.ts  (10 tests | 3 failed) 14ms
   â¯ packages/core/src/systems/__tests__/EquipmentCombat.integration.test.ts > Equipment + Combat Integration > Iron Armor Set vs Unarmored > should give significant advantage to fully armored fighter
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/systems/__tests__/EquipmentCombat.integration.test.ts > Equipment + Combat Integration > Steel Armor Set vs Iron Armor Set > should give advantage to better armor material
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/systems/__tests__/EquipmentCombat.integration.test.ts > Equipment + Combat Integration > Statistical Combat Outcomes > should show consistent advantage for superior equipment over many battles
     â†’ Cannot read properties of undefined (reading 'combatSkill')
 âœ“ packages/world/src/research-papers/__tests__/research-sets.integration.test.ts  (41 tests) 15ms
 âœ“ packages/core/src/__tests__/AnimalHousingCleanliness.test.ts  (24 tests) 7ms
 â¯ packages/core/src/divinity/__tests__/DeityEmergence.test.ts  (22 tests | 6 failed) 16ms
   â¯ packages/core/src/divinity/__tests__/DeityEmergence.test.ts > Deity Emergence > should allow belief to shape nascent deity
     â†’ actual value must be number or bigint, received "undefined"
   â¯ packages/core/src/divinity/__tests__/DeityEmergence.test.ts > Alignment Calculation > should calculate alignment from actions
     â†’ expected 0 to be greater than 0
   â¯ packages/core/src/divinity/__tests__/DeityEmergence.test.ts > Alignment Calculation > should detect chaotic neutral deity
     â†’ expected 0 to be less than 0
   â¯ packages/core/src/divinity/__tests__/DeityEmergence.test.ts > Alignment Calculation > should detect lawful evil deity
     â†’ expected 0 to be greater than 0
   â¯ packages/core/src/divinity/__tests__/DeityEmergence.test.ts > Divine Form Development > should develop forms from believer visions
     â†’ expected [ 'height', 'aura', 'presence' ] to include 'golden'
   â¯ packages/core/src/divinity/__tests__/DeityEmergence.test.ts > Divine Form Development > should prefer consistent forms for nascent deities
     â†’ existing.features.includes is not a function
 âœ“ packages/core/src/components/__tests__/BehaviorQueue.test.ts  (38 tests) 11ms
 âœ“ packages/renderer/src/__tests__/PanelAdapter.test.ts  (28 tests) 153ms
 â¯ packages/core/src/buildings/__tests__/BuildingDefinitions.test.ts  (44 tests | 1 failed) 31ms
   â¯ packages/core/src/buildings/__tests__/BuildingDefinitions.test.ts > Building Functionality Tracking > Acceptance Criterion 4: BuildingFunction Types on Definitions > should have actual buildings for all 8 function types including research and automation
     â†’ Blueprint with id "forge" already registered
 âœ“ packages/core/src/__tests__/MagicDivinityEdgeCases.test.ts  (23 tests) 6ms
 â¯ packages/divinity/src/__tests__/DeityEmergence.test.ts  (22 tests | 6 failed) 14ms
   â¯ packages/divinity/src/__tests__/DeityEmergence.test.ts > Deity Emergence > should allow belief to shape nascent deity
     â†’ actual value must be number or bigint, received "undefined"
   â¯ packages/divinity/src/__tests__/DeityEmergence.test.ts > Alignment Calculation > should calculate alignment from actions
     â†’ expected 0 to be greater than 0
   â¯ packages/divinity/src/__tests__/DeityEmergence.test.ts > Alignment Calculation > should detect chaotic neutral deity
     â†’ expected 0 to be less than 0
   â¯ packages/divinity/src/__tests__/DeityEmergence.test.ts > Alignment Calculation > should detect lawful evil deity
     â†’ expected 0 to be greater than 0
   â¯ packages/divinity/src/__tests__/DeityEmergence.test.ts > Divine Form Development > should develop forms from believer visions
     â†’ expected [ 'height', 'aura', 'presence' ] to include 'golden'
   â¯ packages/divinity/src/__tests__/DeityEmergence.test.ts > Divine Form Development > should prefer consistent forms for nascent deities
     â†’ existing.features.includes is not a function
 âœ“ packages/core/src/targeting/__tests__/Targeting.test.ts  (24 tests) 9ms
stderr | packages/core/src/__tests__/Dashboard.test.ts > ViewRegistry > register > should register a valid view
[ViewRegistry] View 'test-view' has no textFormatter or canvasRenderer

stderr | packages/core/src/__tests__/Dashboard.test.ts > ViewRegistry > register > should throw on duplicate registration
[ViewRegistry] View 'duplicate' has no textFormatter or canvasRenderer

stderr | packages/core/src/__tests__/Dashboard.test.ts > ViewRegistry > get > should return registered view
[ViewRegistry] View 'get-test' has no textFormatter or canvasRenderer

stderr | packages/core/src/__tests__/Dashboard.test.ts > ViewRegistry > get > should list available views in error message
[ViewRegistry] View 'available-view' has no textFormatter or canvasRenderer

stderr | packages/core/src/__tests__/Dashboard.test.ts > ViewRegistry > tryGet > should return view if exists
[ViewRegistry] View 'try-get' has no textFormatter or canvasRenderer

stderr | packages/core/src/__tests__/Dashboard.test.ts > ViewRegistry > unregister > should remove a registered view
[ViewRegistry] View 'to-remove' has no textFormatter or canvasRenderer

stderr | packages/core/src/__tests__/Dashboard.test.ts > ViewRegistry > clear > should remove all views
[ViewRegistry] View 'view1' has no textFormatter or canvasRenderer
[ViewRegistry] View 'view2' has no textFormatter or canvasRenderer

stderr | packages/core/src/__tests__/Dashboard.test.ts > ViewRegistry > getByCategory > should return views in specified category
[ViewRegistry] View 'economy1' has no textFormatter or canvasRenderer
[ViewRegistry] View 'economy2' has no textFormatter or canvasRenderer
[ViewRegistry] View 'info1' has no textFormatter or canvasRenderer

stderr | packages/core/src/__tests__/Dashboard.test.ts > ViewRegistry > getByCategory > should return empty array for empty category
[ViewRegistry] View 'economy1' has no textFormatter or canvasRenderer
[ViewRegistry] View 'economy2' has no textFormatter or canvasRenderer
[ViewRegistry] View 'info1' has no textFormatter or canvasRenderer

stderr | packages/core/src/__tests__/Dashboard.test.ts > ViewRegistry > subscribe > should notify listeners on registration
[ViewRegistry] View 'notify-test' has no textFormatter or canvasRenderer

stderr | packages/core/src/__tests__/Dashboard.test.ts > ViewRegistry > subscribe > should notify listeners on unregister
[ViewRegistry] View 'unregister-notify' has no textFormatter or canvasRenderer

stderr | packages/core/src/__tests__/Dashboard.test.ts > ViewRegistry > subscribe > should allow unsubscribing
[ViewRegistry] View 'no-notify' has no textFormatter or canvasRenderer

 â¯ packages/core/src/__tests__/Dashboard.test.ts  (66 tests | 1 failed) 31ms
   â¯ packages/core/src/__tests__/Dashboard.test.ts > Built-in Views > ResourcesView > should format resources in text output
     â†’ expected 'VILLAGE STOCKPILE\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â€¦' to contain 'wood: 50'
 âœ“ packages/core/src/systems/__tests__/HarvestQuality.test.ts  (12 tests) 23ms
 âœ“ packages/core/src/__tests__/AnimalHousing.test.ts  (27 tests | 5 skipped) 8ms
 â†“ packages/renderer/src/__tests__/CombatUIIntegration.test.ts  (22 tests | 22 skipped)
 âœ“ packages/core/src/__tests__/MagicSystemEdgeCases.integration.test.ts  (26 tests) 11ms
 âœ“ packages/core/src/systems/__tests__/GovernanceDataSystem.integration.test.ts  (17 tests) 13ms
 â¯ packages/core/src/systems/__tests__/EpisodicMemory.integration.test.ts  (17 tests | 2 failed) 15ms
   â¯ packages/core/src/systems/__tests__/EpisodicMemory.integration.test.ts > Episodic Memory Integration > Memory Formation from Events > should handle multiple events in sequence
     â†’ expected 1 to be 3 // Object.is equality
   â¯ packages/core/src/systems/__tests__/EpisodicMemory.integration.test.ts > Episodic Memory Integration > Full Memory Lifecycle > should handle multiple agents with independent memory systems
     â†’ expected +0 to be 1 // Object.is equality
stderr | packages/core/src/systems/__tests__/TillingAction.test.ts > Tilling Action > Acceptance Criterion 4: Tilling Validation - Invalid Terrain > should throw error when attempting to till stone terrain
[SoilSystem] âŒ ERROR: Cannot till stone terrain at (5,5). Only grass and dirt can be tilled.

stderr | packages/core/src/systems/__tests__/TillingAction.test.ts > Tilling Action > Acceptance Criterion 4: Tilling Validation - Invalid Terrain > should throw error when attempting to till water terrain
[SoilSystem] âŒ ERROR: Cannot till water terrain at (5,5). Only grass and dirt can be tilled.

stderr | packages/core/src/systems/__tests__/TillingAction.test.ts > Tilling Action > Acceptance Criterion 4: Tilling Validation - Invalid Terrain > should throw error when attempting to till sand terrain
[SoilSystem] âŒ ERROR: Cannot till sand terrain at (5,5). Only grass and dirt can be tilled.

stderr | packages/core/src/systems/__tests__/TillingAction.test.ts > Tilling Action > Acceptance Criterion 4: Tilling Validation - Invalid Terrain > should NOT modify tile state when validation fails
[SoilSystem] âŒ ERROR: Cannot till stone terrain at (5,5). Only grass and dirt can be tilled.

stderr | packages/core/src/systems/__tests__/TillingAction.test.ts > Tilling Action > Acceptance Criterion 4: Tilling Validation - Invalid Terrain > should NOT emit tilling event when validation fails
[SoilSystem] âŒ ERROR: Cannot till water terrain at (5,5). Only grass and dirt can be tilled.

stderr | packages/core/src/systems/__tests__/TillingAction.test.ts > Tilling Action > Acceptance Criterion 11: CLAUDE.md Compliance - No Silent Fallbacks > should throw when tile is null/undefined
[SoilSystem] âŒ ERROR: tillTile requires a valid tile object

stderr | packages/core/src/systems/__tests__/TillingAction.test.ts > Tilling Action > Acceptance Criterion 11: CLAUDE.md Compliance - No Silent Fallbacks > should throw when position is invalid
[SoilSystem] âŒ ERROR: tillTile requires valid position coordinates, got (NaN,5)

stderr | packages/core/src/systems/__tests__/TillingAction.test.ts > Tilling Action > Acceptance Criterion 11: CLAUDE.md Compliance - No Silent Fallbacks > should throw clear error message for invalid terrain
[SoilSystem] âŒ ERROR: Cannot till stone terrain at (5,5). Only grass and dirt can be tilled.

stderr | packages/core/src/systems/__tests__/TillingAction.test.ts > Tilling Action > Acceptance Criterion 11: CLAUDE.md Compliance - No Silent Fallbacks > should NOT catch and swallow errors
[SoilSystem] âŒ ERROR: Cannot till water terrain at (5,5). Only grass and dirt can be tilled.

stderr | packages/core/src/systems/__tests__/TillingAction.test.ts > Tilling Action > Edge Cases > should throw error when tilling tile without biome (CLAUDE.md)
[SoilSystem] âŒ CRITICAL ERROR: Tile at (5,5) has no biome data. Terrain generation failed or chunk not generated. Cannot determine fertility for farming.
[SoilSystem] Tile state: {
  "terrain": "grass",
  "moisture": 50,
  "fertility": 50,
  "tilled": false,
  "plantability": 0,
  "nutrients": {
    "nitrogen": 0,
    "phosphorus": 0,
    "potassium": 0
  },
  "fertilized": false,
  "fertilizerDuration": 0,
  "lastWatered": 0,
  "lastTilled": 0,
  "composted": false
}

 âœ“ packages/core/src/systems/__tests__/TillingAction.test.ts  (55 tests) 14ms
 âœ“ packages/core/src/__tests__/FakeImplementationsCleanup.test.ts  (19 tests | 1 skipped) 10ms
 âœ“ packages/core/src/__tests__/MagicSystemStateExploits.test.ts  (32 tests) 79ms
 âœ“ packages/core/src/systems/magic/__tests__/SkillTreeManager.integration.test.ts  (11 tests) 10ms
 â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts  (17 tests | 14 failed) 21ms
   â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Unlock Flow Integration > should complete full unlock flow when player clicks available node
     â†’ expected 0 to be greater than 0
   â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Unlock Flow Integration > should apply node effects when unlocked
     â†’ expected "spy" to be called with arguments: [ â€¦(3) ]

Received: 



Number of calls: 0

   â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Unlock Flow Integration > should show error notification when unlock fails
     â†’ expected "spy" to be called with arguments: [ 'ui:notification', { â€¦(2) } ]

Received: 



Number of calls: 0

   â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Backend Sync Integration > should update UI when backend unlocks node
     â†’ expected 0 to be greater than 0
   â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Backend Sync Integration > should listen to magic:skill_node_unlocked events
     â†’ expected "spy" to be called with arguments: [ 'magic:skill_node_unlocked', â€¦(1) ]

Received: 



Number of calls: 0

   â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Backend Sync Integration > should refresh UI when receiving backend unlock event
     â†’ expected "refresh" to be called at least once
   â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > XP Gain Integration > should update XP counter when XP gained
     â†’ expected undefined not to be undefined
   â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > XP Gain Integration > should highlight newly available nodes after XP gain
     â†’ expected 0 to be greater than 0
   â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Discovery Integration > should reveal hidden node when discovery condition met
     â†’ expected 0 to be greater than 0
   â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Discovery Integration > should show discovery notification when hidden node reveals
     â†’ expected "spy" to be called with arguments: [ 'ui:notification', { â€¦(2) } ]

Received: 



Number of calls: 0

   â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Discovery Integration > should track which nodes were recently discovered
     â†’ expected [] to include 'shinto_river_blessing'
   â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Multi-Paradigm XP Isolation > should not affect other paradigms XP when unlocking node
     â†’ expected 500 to be 400 // Object.is equality
   â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Multi-Paradigm XP Isolation > should maintain separate unlocked nodes per paradigm
     â†’ expected [] to not deeply equal []
   â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Error Recovery > should show error notification if unlock fails
     â†’ expected "spy" to be called with arguments: [ 'ui:notification', { â€¦(2) } ]

Received: 



Number of calls: 0

 â¯ packages/core/src/__tests__/TreeFellingPhysics.test.ts  (25 tests | 3 failed) 15ms
   â¯ packages/core/src/__tests__/TreeFellingPhysics.test.ts > Tree Felling Physics - Integration > Voxel Resource Stability > should handle different material hardness
     â†’ expected 40 to be greater than 60
   â¯ packages/core/src/__tests__/TreeFellingPhysics.test.ts > Tree Felling Physics - Integration > Bottom-Up Harvesting (Cutting Base) > should emit resource:felled event when tree falls
     â†’ expected +0 to be 1 // Object.is equality
   â¯ packages/core/src/__tests__/TreeFellingPhysics.test.ts > Tree Felling Physics - Integration > Top-Down Harvesting (Safe Method) > should allow safe top-down harvesting without falling
     â†’ expected 0 to be greater than 30
 â¯ packages/core/src/__tests__/NeedsSystem.test.ts  (28 tests | 2 failed) 22ms
   â¯ packages/core/src/__tests__/NeedsSystem.test.ts > NeedsSystem > critical needs events > should emit need:critical event when hunger drops below 20
     â†’ expected 0 to be greater than 0
   â¯ packages/core/src/__tests__/NeedsSystem.test.ts > NeedsSystem > starvation > should emit agent:starved event when both hunger and energy reach zero
     â†’ expected "spy" to be called at least once
stderr | packages/world/src/chunks/__tests__/ChunkSerializerEdgeCases.test.ts > ChunkSerializer Edge Cases > Malformed Data > should throw on delta with incorrect base + diffs count
[ChunkSerializer] Skipping out-of-bounds diff index: 2000 (valid range: 0-1023)

stdout | packages/world/src/chunks/__tests__/ChunkSerializerEdgeCases.test.ts > ChunkSerializer Edge Cases > Large Terrain Snapshots > should handle many chunks efficiently
[ChunkSerializer] Serializing 100 generated chunks (100 total loaded)
[ChunkSerializer] Terrain snapshot created

stdout | packages/world/src/chunks/__tests__/ChunkSerializerEdgeCases.test.ts > ChunkSerializer Edge Cases > Large Terrain Snapshots > should calculate correct checksums for large snapshots
[ChunkSerializer] Serializing 50 generated chunks (50 total loaded)
[ChunkSerializer] Terrain snapshot created

stdout | packages/world/src/chunks/__tests__/ChunkSerializerEdgeCases.test.ts > ChunkSerializer Edge Cases > Schema Version Handling > should include schema version in snapshot
[ChunkSerializer] Serializing 1 generated chunks (1 total loaded)
[ChunkSerializer] Terrain snapshot created

stdout | packages/world/src/chunks/__tests__/ChunkSerializerEdgeCases.test.ts > ChunkSerializer Edge Cases > Schema Version Handling > should accept snapshots with correct schema
[ChunkSerializer] Serializing 1 generated chunks (1 total loaded)
[ChunkSerializer] Terrain snapshot created
[ChunkSerializer] Deserializing 1 chunks
[ChunkSerializer] Loaded 1 chunks

 â¯ packages/world/src/chunks/__tests__/ChunkSerializerEdgeCases.test.ts  (26 tests | 1 failed) 2815ms
   â¯ packages/world/src/chunks/__tests__/ChunkSerializerEdgeCases.test.ts > ChunkSerializer Edge Cases > Large Terrain Snapshots > should handle many chunks efficiently
     â†’ expected 1903.0218329999989 to be less than 1000
 â¯ packages/core/src/__tests__/DivinityComplete.integration.test.ts  (15 tests | 2 failed) 26ms
   â¯ packages/core/src/__tests__/DivinityComplete.integration.test.ts > Divinity System - Complete Integration > Phase 4: Emergent Gods > should manage AI god behavior
     â†’ entities is not iterable
   â¯ packages/core/src/__tests__/DivinityComplete.integration.test.ts > Divinity System - Complete Integration > Cross-Phase Integration > should integrate all phases in a complete simulation
     â†’ entities is not iterable
 âœ“ packages/divinity/src/__tests__/DivinePowerTypes.test.ts  (89 tests) 12ms
 âœ“ packages/core/src/__tests__/MetricsDashboard.integration.test.ts  (33 tests) 515ms
 âœ“ packages/core/src/divinity/__tests__/DivinePowerTypes.test.ts  (89 tests) 12ms
 âœ“ packages/renderer/src/__tests__/WindowLRU.integration.test.ts  (17 tests) 18ms
 â¯ packages/core/src/__tests__/DivinityBodyIntegration.integration.test.ts  (21 tests | 3 failed) 16ms
   â¯ packages/core/src/__tests__/DivinityBodyIntegration.integration.test.ts > Divinity + Body Parts Integration > Divine Power Tracking > should track all modifications by a deity
     â†’ expected 2 to be 3 // Object.is equality
   â¯ packages/core/src/__tests__/DivinityBodyIntegration.integration.test.ts > Divinity + Body Parts Integration > Divine Power Tracking > should get modifications on a specific target
     â†’ expected 1 to be 2 // Object.is equality
   â¯ packages/core/src/__tests__/DivinityBodyIntegration.integration.test.ts > Divinity + Body Parts Integration > Purpose Tracking > should track divine purpose for each modification
     â†’ expected undefined not to be undefined
 â¯ packages/core/src/systems/__tests__/AgentBuildingOrchestration.test.ts  (28 tests | 4 failed) 22ms
   â¯ packages/core/src/systems/__tests__/AgentBuildingOrchestration.test.ts > Agent Building Orchestration - Phase 7 > Criterion 1: Construction Progress Automation > should automatically increment progress each tick for buildings < 100%
     â†’ Unknown building type: undefined. Cannot determine construction time.
   â¯ packages/core/src/systems/__tests__/AgentBuildingOrchestration.test.ts > Agent Building Orchestration - Phase 7 > Criterion 1: Construction Progress Automation > should calculate progress based on buildTime
     â†’ Unknown building type: undefined. Cannot determine construction time.
   â¯ packages/core/src/systems/__tests__/AgentBuildingOrchestration.test.ts > Agent Building Orchestration - Phase 7 > Criterion 3: Building Completion > should emit building:complete event when progress reaches 100%
     â†’ Unknown building type: undefined. Cannot determine construction time.
   â¯ packages/core/src/systems/__tests__/AgentBuildingOrchestration.test.ts > Agent Building Orchestration - Phase 7 > Criterion 3: Building Completion > should mark building as complete when progress reaches 100%
     â†’ Unknown building type: undefined. Cannot determine construction time.
 â¯ packages/core/src/__tests__/MiningMetalworking.integration.test.ts  (34 tests | 3 failed) 18ms
   â¯ packages/core/src/__tests__/MiningMetalworking.integration.test.ts > Mining & Metalworking System Integration Tests > Metal Tools and Weapons (Uses Ingots) > should have iron_sword craftable from iron_ingot
     â†’ expected undefined not to be undefined
   â¯ packages/core/src/__tests__/MiningMetalworking.integration.test.ts > Mining & Metalworking System Integration Tests > Metal Tools and Weapons (Uses Ingots) > should have steel_sword craftable from steel_ingot
     â†’ expected undefined not to be undefined
   â¯ packages/core/src/__tests__/MiningMetalworking.integration.test.ts > Mining & Metalworking System Integration Tests > Complete Mining â†’ Smelting â†’ Crafting Chain Verification > should verify steel chain: iron_ingot + coal â†’ steel_ingot â†’ weapon
     â†’ Cannot read properties of undefined (reading 'find')
 âœ“ packages/core/src/systems/__tests__/EquipmentSystem.test.ts  (19 tests) 6ms
 â¯ packages/core/src/magic/__tests__/SpellEffectAppliers.test.ts  (19 tests | 6 failed) 14ms
   â¯ packages/core/src/magic/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Protection > should apply protection effect
     â†’ expected false to be true // Object.is equality
   â¯ packages/core/src/magic/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Protection > should stack protection effects additively
     â†’ expected false to be true // Object.is equality
   â¯ packages/core/src/magic/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Protection > should expire protection after duration
     â†’ expected false to be true // Object.is equality
   â¯ packages/core/src/magic/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Control > should apply stun effect
     â†’ Cannot read properties of undefined (reading 'isStunned')
   â¯ packages/core/src/magic/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Control > should apply fear effect
     â†’ Cannot read properties of undefined (reading 'currentBehavior')
   â¯ packages/core/src/magic/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Transform > should transform entity form
     â†’ expected false to be true // Object.is equality
 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.integration.test.ts  (10 tests | 10 failed) 7ms
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.integration.test.ts > SkillTreePanel Backend Integration > Node unlocking via backend > should unlock node through SkillTreeManager and emit event
     â†’ Cannot read properties of undefined (reading 'resetInstance')
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.integration.test.ts > SkillTreePanel Backend Integration > Node unlocking via backend > should handle spell unlock when unlocking skill tree node
     â†’ Cannot read properties of undefined (reading 'resetInstance')
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.integration.test.ts > SkillTreePanel Backend Integration > XP accumulation and availability > should track XP changes from backend
     â†’ Cannot read properties of undefined (reading 'resetInstance')
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.integration.test.ts > SkillTreePanel Backend Integration > XP accumulation and availability > should reflect XP deduction after unlock
     â†’ Cannot read properties of undefined (reading 'resetInstance')
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.integration.test.ts > SkillTreePanel Backend Integration > Multi-paradigm handling > should handle multiple paradigms with independent XP pools
     â†’ Cannot read properties of undefined (reading 'resetInstance')
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.integration.test.ts > SkillTreePanel Backend Integration > Prerequisite chain unlocking > should enforce prerequisites across multiple unlocks
     â†’ Cannot read properties of undefined (reading 'resetInstance')
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.integration.test.ts > SkillTreePanel Backend Integration > Event-driven UI updates > should respond to magic:skill_node_unlocked events from backend
     â†’ Cannot read properties of undefined (reading 'resetInstance')
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.integration.test.ts > SkillTreePanel Backend Integration > Edge cases > should handle entity with no magic component gracefully
     â†’ Cannot read properties of undefined (reading 'resetInstance')
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.integration.test.ts > SkillTreePanel Backend Integration > Edge cases > should handle paradigm with no registered tree
     â†’ Cannot read properties of undefined (reading 'resetInstance')
   â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.integration.test.ts > SkillTreePanel Backend Integration > Edge cases > should handle unlocking with exact XP amount
     â†’ Cannot read properties of undefined (reading 'resetInstance')
 âœ“ packages/core/src/magic/__tests__/ParadigmSkillTrees.test.ts  (54 tests) 14ms
 â¯ packages/core/src/systems/__tests__/PerformanceOptimizations.integration.test.ts  (10 tests | 2 failed) 26ms
   â¯ packages/core/src/systems/__tests__/PerformanceOptimizations.integration.test.ts > Performance Optimizations Integration > Acceptance Criterion 3: Cached Collision Data > should MovementSystem cache building positions and reuse
     â†’ Cannot read properties of undefined (reading 'velocityX')
   â¯ packages/core/src/systems/__tests__/PerformanceOptimizations.integration.test.ts > Performance Optimizations Integration > Acceptance Criterion 3: Cached Collision Data > should MovementSystem invalidate cache on building change events
     â†’ Cannot read properties of undefined (reading 'velocityX')
 â¯ packages/magic/src/__tests__/SpellEffectAppliers.test.ts  (19 tests | 6 failed) 14ms
   â¯ packages/magic/src/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Protection > should apply protection effect
     â†’ expected false to be true // Object.is equality
   â¯ packages/magic/src/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Protection > should stack protection effects additively
     â†’ expected false to be true // Object.is equality
   â¯ packages/magic/src/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Protection > should expire protection after duration
     â†’ expected false to be true // Object.is equality
   â¯ packages/magic/src/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Control > should apply stun effect
     â†’ Cannot read properties of undefined (reading 'isStunned')
   â¯ packages/magic/src/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Control > should apply fear effect
     â†’ Cannot read properties of undefined (reading 'currentBehavior')
   â¯ packages/magic/src/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Transform > should transform entity form
     â†’ expected false to be true // Object.is equality
 âœ“ packages/core/src/reproduction/__tests__/CourtshipCompatibility.test.ts  (22 tests) 14ms
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts  (54 tests | 54 failed) 32ms
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > AllomancySkillTree > tree structure > should have correct paradigm ID
     â†’ Cannot read properties of undefined (reading 'paradigmId')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > AllomancySkillTree > tree structure > should have snapped as entry node
     â†’ Cannot read properties of undefined (reading 'entryNodes')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > AllomancySkillTree > tree structure > should require bloodline for tree access
     â†’ Cannot read properties of undefined (reading 'rules')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > AllomancySkillTree > tree structure > should have metal discovery nodes
     â†’ Cannot read properties of undefined (reading 'nodes')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > AllomancySkillTree > tree structure > should have Misting specialization nodes
     â†’ Cannot read properties of undefined (reading 'nodes')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > AllomancySkillTree > tree structure > should have Mistborn awakening node
     â†’ Cannot read properties of undefined (reading 'nodes')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > AllomancySkillTree > helper functions > getMistingMetals returns all metals for full Mistborn
     â†’ getMistingMetals is not a function
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > AllomancySkillTree > helper functions > getMistingMetals returns basic metals for lower strength
     â†’ getMistingMetals is not a function
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > AllomancySkillTree > helper functions > getMistingMetals returns empty for no bloodline
     â†’ getMistingMetals is not a function
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > AllomancySkillTree > helper functions > isMetalAvailable checks bloodline strength
     â†’ isMetalAvailable is not a function
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > AllomancySkillTree > tree access > should require Allomancer bloodline
     â†’ Cannot read properties of undefined (reading 'rules')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > ShintoSkillTree > tree structure > should have correct paradigm ID
     â†’ Cannot read properties of undefined (reading 'paradigmId')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > ShintoSkillTree > tree structure > should not require innate ability
     â†’ Cannot read properties of undefined (reading 'rules')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > ShintoSkillTree > tree structure > should have kami relationship nodes
     â†’ Cannot read properties of undefined (reading 'nodes')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > ShintoSkillTree > tree structure > should have ritual nodes
     â†’ Cannot read properties of undefined (reading 'nodes')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > ShintoSkillTree > tree structure > should have foundation nodes for purity
     â†’ Cannot read properties of undefined (reading 'nodes')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > ShintoSkillTree > helper functions > getAvailableKamiTypes returns types based on unlocked nodes
     â†’ getAvailableKamiTypes is not a function
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > ShintoSkillTree > helper functions > isPuritySufficient checks purity against ritual tier
     â†’ isPuritySufficient is not a function
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > ShintoSkillTree > tree access > should be accessible to anyone
     â†’ Cannot read properties of undefined (reading 'rules')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > SympathySkillTree > tree structure > should have correct paradigm ID
     â†’ Cannot read properties of undefined (reading 'paradigmId')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > SympathySkillTree > tree structure > should not require innate ability
     â†’ Cannot read properties of undefined (reading 'rules')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > SympathySkillTree > tree structure > should have alar foundation nodes
     â†’ Cannot read properties of undefined (reading 'nodes')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > SympathySkillTree > tree structure > should have link type nodes
     â†’ Cannot read properties of undefined (reading 'nodes')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > SympathySkillTree > tree structure > should have advanced binding nodes
     â†’ Cannot read properties of undefined (reading 'nodes')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > SympathySkillTree > tree structure > should have split-focus mastery nodes
     â†’ Cannot read properties of undefined (reading 'nodes')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > SympathySkillTree > constants > LINK_TYPES should be in order of difficulty
     â†’ Cannot read properties of undefined (reading '0')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > SympathySkillTree > constants > BINDING_PRINCIPLES should have core transfer types
     â†’ the given combination of arguments (undefined and string) is invalid for this assertion. You can use an array, a map, an object, a set, a string, or a weakset instead of a string
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > SympathySkillTree > helper functions > getMaxBindings returns correct count based on nodes
     â†’ getMaxBindings is not a function
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > SympathySkillTree > helper functions > calculateLinkEfficiency returns higher values for better links
     â†’ calculateLinkEfficiency is not a function
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > SympathySkillTree > helper functions > calculateSlippage returns energy loss percentage
     â†’ calculateSlippage is not a function
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > tree structure > should have correct paradigm ID
     â†’ Cannot read properties of undefined (reading 'paradigmId')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > tree structure > should not require innate ability (everyone has a daemon)
     â†’ Cannot read properties of undefined (reading 'rules')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > tree structure > should have daemon-bond as entry node
     â†’ Cannot read properties of undefined (reading 'entryNodes')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > tree structure > should have settling node
     â†’ Cannot read properties of undefined (reading 'nodes')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > tree structure > should have dust category nodes
     â†’ Cannot read properties of undefined (reading 'nodes')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > tree structure > should have separation category nodes
     â†’ Cannot read properties of undefined (reading 'nodes')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > tree structure > should have witch blood node with bloodline requirement
     â†’ Cannot read properties of undefined (reading 'nodes')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > constants > DAEMON_FORM_CATEGORIES should have form types
     â†’ Cannot read properties of undefined (reading 'predator')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > constants > each form category should have animal forms
     â†’ Cannot read properties of undefined (reading 'predator')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > helper functions > getFormBonuses returns bonuses for form category
     â†’ getFormBonuses is not a function
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > helper functions > isFormInCategory checks form membership
     â†’ isFormInCategory is not a function
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > helper functions > getFormCategory returns category for a form
     â†’ getFormCategory is not a function
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > helper functions > getSeparationDistance calculates based on nodes
     â†’ getSeparationDistance is not a function
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > helper functions > canSeparate checks for basic separation node
     â†’ canSeparate is not a function
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > helper functions > hasSettled checks for settling node
     â†’ hasSettled is not a function
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > tree access > should be accessible to anyone (everyone has a daemon)
     â†’ Cannot read properties of undefined (reading 'rules')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > condition evaluators > should evaluate age_range condition
     â†’ Cannot read properties of undefined (reading 'nodes')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > condition evaluators > should evaluate form_category condition
     â†’ Cannot read properties of undefined (reading 'nodes')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > Cross-tree consistency > all trees should have unique IDs
     â†’ Cannot read properties of undefined (reading 'id')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > Cross-tree consistency > all trees should have unique paradigm IDs
     â†’ Cannot read properties of undefined (reading 'paradigmId')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > Cross-tree consistency > all trees should have entry nodes
     â†’ Cannot read properties of undefined (reading 'entryNodes')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > Cross-tree consistency > all trees should have XP sources
     â†’ Cannot read properties of undefined (reading 'xpSources')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > Cross-tree consistency > all trees should have mostly valid node prerequisites
     â†’ Cannot read properties of undefined (reading 'nodes')
   â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > Cross-tree consistency > all trees should have version numbers
     â†’ Cannot read properties of undefined (reading 'version')
 â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts  (11 tests | 11 failed) 10ms
   â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts > Role Specialization Integration > Skill Diversity at Spawn (80%+ have skill > 0) > should spawn agents with diverse starting skills
     â†’ Cannot find module '../components/SkillsComponent.js'
Require stack:
- /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts
   â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts > Role Specialization Integration > Skill Diversity at Spawn (80%+ have skill > 0) > should distribute skills across multiple domains
     â†’ Cannot find module '../components/SkillsComponent.js'
Require stack:
- /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts
   â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts > Role Specialization Integration > Builders do 60%+ of construction > should route building tasks to skilled builders
     â†’ Unknown component type: identity. Add it to the component registry in World.ts
   â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts > Role Specialization Integration > Cooks manage food supplies > should route food tasks to cooks and farmers
     â†’ Unknown component type: identity. Add it to the component registry in World.ts
   â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts > Role Specialization Integration > Reduced building duplicates (<10% overlapping starts) > should prevent unskilled agents from seeing complex buildings
     â†’ Cannot find module '../components/SkillsComponent.js'
Require stack:
- /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts
   â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts > Role Specialization Integration > Appropriate suggestions (90% go to skilled agents) > should send strategic suggestions to skilled agents
     â†’ Unknown component type: identity. Add it to the component registry in World.ts
   â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts > Role Specialization Integration > Entity visibility based on skill and distance > should only show entities within perception radius
     â†’ Cannot find module '../components/SkillsComponent.js'
Require stack:
- /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts
   â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts > Role Specialization Integration > Entity visibility based on skill and distance > should filter rare entities by skill level
     â†’ Cannot find module '../components/SkillsComponent.js'
Require stack:
- /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts
   â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts > Role Specialization Integration > Information depth scales with skill > should provide increasingly detailed food information
     â†’ Cannot find module '../components/SkillsComponent.js'
Require stack:
- /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts
   â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts > Role Specialization Integration > Social skill gates perception of other agents > should reveal more about others as social skill increases
     â†’ Cannot find module '../llm/StructuredPromptBuilder.js'
Require stack:
- /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts
   â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts > Role Specialization Integration > Relationships unlock affordances > should show different affordances based on relationship level
     â†’ Cannot find module '../llm/StructuredPromptBuilder.js'
Require stack:
- /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts
 âœ“ packages/core/src/systems/__tests__/BehaviorCompletionSignaling.test.ts  (34 tests) 8ms
 â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts  (22 tests | 22 failed) 8ms
   â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Sexual compatibility > should check attraction between agents
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Sexual compatibility > should return high score if both mutually attracted
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Sexual compatibility > should check attraction conditions
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Sexual compatibility > should return partial score if potential but not active attraction
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Sexual compatibility > should check relationship style compatibility
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Personality mesh > should score higher for complementary traits
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Personality mesh > should score higher for shared values
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Personality mesh > should score lower for conflicting traits
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Personality mesh > should return neutral score when personality data missing
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Personality mesh > should weigh multiple factors together
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Shared interests > should return 0 when no shared interests
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Shared interests > should return high score when many shared interests
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Shared interests > should return neutral when priority data missing
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Shared interests > should count only high-priority shared activities
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Relationship strength > should return 0 when no relationship exists
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Relationship strength > should return high score for strong existing relationship
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Relationship strength > should weigh affinity highest
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Relationship strength > should handle negative affinity
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Overall compatibility > should combine all factors with weights
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Overall compatibility > should handle low sexual compatibility
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Overall compatibility > should work with minimal components
     â†’ World is not a constructor
   â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Overall compatibility > should cap at 1.0
     â†’ World is not a constructor
 â¯ packages/core/src/__tests__/MagicSystemAdversarial.test.ts  (33 tests | 1 failed) 282ms
   â¯ packages/core/src/__tests__/MagicSystemAdversarial.test.ts > Adversarial - Paradigm Validation Gaps > should expose: no validation of required channels
     â†’ expected 0 to be greater than 0
 âœ“ packages/core/src/__tests__/TamingSystem.test.ts  (17 tests) 9ms
stderr | packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Message Sending > should send message from deity
[ChatRoomSystem] Room not found: divine_chat

stderr | packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Message Sending > should send multiple messages and maintain order
[ChatRoomSystem] Room not found: divine_chat
[ChatRoomSystem] Room not found: divine_chat
[ChatRoomSystem] Room not found: divine_chat

stderr | packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Message Sending > should update lastMessageTick when message sent
[ChatRoomSystem] Room not found: divine_chat

stderr | packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Message Sending > should handle sending message from non-existent sender gracefully
[ChatRoomSystem] Room not found: divine_chat

 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts  (30 tests | 23 failed) 19ms
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Chat Room Creation > should create chat room singleton on first update
     â†’ expected null not to be null
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Member Entry Notifications > should generate entry notification when first god appears
     â†’ the given combination of arguments (undefined and string) is invalid for this assertion. You can use an array, a map, an object, a set, a string, or a weakset instead of a string
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Member Entry Notifications > should generate entry notifications for multiple gods
     â†’ Target cannot be null or undefined.
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Member Exit Notifications > should generate exit notification when god is removed
     â†’ the given combination of arguments (undefined and string) is invalid for this assertion. You can use an array, a map, an object, a set, a string, or a weakset instead of a string
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Member Exit Notifications > should handle all gods leaving
     â†’ Target cannot be null or undefined.
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Chat Activation > should be inactive with 0 gods
     â†’ expected undefined to be false // Object.is equality
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Chat Activation > should be inactive with 1 god
     â†’ expected undefined to be false // Object.is equality
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Chat Activation > should activate with 2 gods
     â†’ expected undefined to be true // Object.is equality
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Chat Activation > should activate with 3+ gods
     â†’ expected undefined to be true // Object.is equality
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Chat Activation > should deactivate when god count drops below 2
     â†’ expected undefined to be true // Object.is equality
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Message Sending > should send message from deity
     â†’ Target cannot be null or undefined.
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Message Sending > should send multiple messages and maintain order
     â†’ Target cannot be null or undefined.
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Message Sending > should update lastMessageTick when message sent
     â†’ expected +0 to be 100 // Object.is equality
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Message Sending > should handle sending message from non-existent sender gracefully
     â†’ actual value must be number or bigint, received "undefined"
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Public API Methods > isInRoom > should return true for member in room
     â†’ expected false to be true // Object.is equality
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Public API Methods > isInRoom > should return false after member leaves
     â†’ expected false to be true // Object.is equality
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Public API Methods > getRoomMembers > should return info of all present members
     â†’ expected [] to have a length of 3 but got +0
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Public API Methods > getRoomMembers > should update when members leave
     â†’ expected [] to have a length of 2 but got +0
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Public API Methods > getRoom > should return chat component after initialization
     â†’ expected null not to be null
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Complete Chat Flow > should handle complete god interaction scenario
     â†’ expected undefined to be false // Object.is equality
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Tick Tracking > should update lastActivityTick on each update
     â†’ expected undefined to be +0 // Object.is equality
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Edge Cases > should handle rapid member creation and deletion
     â†’ Target cannot be null or undefined.
   â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Edge Cases > should preserve messages when members join/leave
     â†’ Target cannot be null or undefined.
stderr | packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Edge Cases > should preserve messages when members join/leave
[ChatRoomSystem] Room not found: divine_chat

stderr | packages/core/src/__tests__/EmergentSocialDynamics.test.ts > Phase 6: Emergent Social Dynamics > RelationshipConversationSystem > creates new relationship from conversation
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:112:22
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)

stderr | packages/core/src/__tests__/EmergentSocialDynamics.test.ts > Phase 6: Emergent Social Dynamics > RelationshipConversationSystem > increases familiarity after conversation
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:135:22
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)

stderr | packages/core/src/__tests__/EmergentSocialDynamics.test.ts > Phase 6: Emergent Social Dynamics > RelationshipConversationSystem > increases affinity for good conversations
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:157:22
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)

stderr | packages/core/src/__tests__/EmergentSocialDynamics.test.ts > Phase 6: Emergent Social Dynamics > RelationshipConversationSystem > does not increase affinity for poor conversations
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:179:22
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)

stderr | packages/core/src/__tests__/EmergentSocialDynamics.test.ts > Phase 6: Emergent Social Dynamics > RelationshipConversationSystem > increases trust with emotional connection
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:200:22
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)

stderr | packages/core/src/__tests__/EmergentSocialDynamics.test.ts > Phase 6: Emergent Social Dynamics > RelationshipConversationSystem > records known enthusiasts for discussed topics
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:221:22
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)

stderr | packages/core/src/__tests__/EmergentSocialDynamics.test.ts > Phase 6: Emergent Social Dynamics > RelationshipConversationSystem > does not record enthusiasts for low quality conversations
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:242:22
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)

stderr | packages/core/src/__tests__/EmergentSocialDynamics.test.ts > Phase 6: Emergent Social Dynamics > RelationshipConversationSystem > learns about partner interests through conversation
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:262:22
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)

stderr | packages/core/src/__tests__/EmergentSocialDynamics.test.ts > Phase 6: Emergent Social Dynamics > RelationshipConversationSystem > reinforces existing interest knowledge
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:289:22
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:303:22
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)

stderr | packages/core/src/__tests__/EmergentSocialDynamics.test.ts > Phase 6: Emergent Social Dynamics > RelationshipConversationSystem > updates relationships bidirectionally
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:324:22
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)

stderr | packages/core/src/__tests__/EmergentSocialDynamics.test.ts > Phase 6: Emergent Social Dynamics > Integration: Relationship â†’ Friendship > multiple quality conversations lead to friendship
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:553:24
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:553:24
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:553:24
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:553:24
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:553:24
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:553:24
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:553:24
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:553:24
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:553:24
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:553:24
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:553:24
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:553:24
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:553:24
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:553:24
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:553:24
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
Error in event handler for conversation:ended: TypeError: Cannot read properties of undefined (reading 'get')
    at RelationshipConversationSystem.learnInterests (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:188:56)
    at RelationshipConversationSystem.handleConversationEnded (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:96:10)
    at Object.handler (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/systems/RelationshipConversationSystem.ts:53:12)
    at EventBusImpl.dispatchEvent (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:257:13)
    at EventBusImpl.flush (/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/events/EventBus.ts:222:12)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/EmergentSocialDynamics.test.ts:553:24
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)

 â¯ packages/core/src/__tests__/EmergentSocialDynamics.test.ts  (17 tests | 2 failed) 19ms
   â¯ packages/core/src/__tests__/EmergentSocialDynamics.test.ts > Phase 6: Emergent Social Dynamics > RelationshipConversationSystem > learns about partner interests through conversation
     â†’ expected undefined not to be undefined
   â¯ packages/core/src/__tests__/EmergentSocialDynamics.test.ts > Phase 6: Emergent Social Dynamics > RelationshipConversationSystem > reinforces existing interest knowledge
     â†’ Cannot read properties of undefined (reading 'knownFacts')
 âœ“ packages/core/src/systems/__tests__/DurabilitySystem.test.ts  (26 tests) 11ms
 â†“ packages/renderer/src/__tests__/StanceControls.test.ts  (32 tests | 32 skipped)
 âœ“ packages/core/src/systems/__tests__/GovernanceData.integration.test.ts  (23 tests) 14ms
 âœ“ packages/core/src/systems/__tests__/JournalingSystem.test.ts  (22 tests | 17 skipped) 5ms
 â¯ packages/core/src/divinity/__tests__/DivinePowers.test.ts  (21 tests | 1 failed) 12ms
   â¯ packages/core/src/divinity/__tests__/DivinePowers.test.ts > Divine Power - Blessings and Curses > should lift curse when condition met
     â†’ expected false to be true // Object.is equality
 â¯ packages/divinity/src/__tests__/DivinePowers.test.ts  (21 tests | 1 failed) 10ms
   â¯ packages/divinity/src/__tests__/DivinePowers.test.ts > Divine Power - Blessings and Curses > should lift curse when condition met
     â†’ expected false to be true // Object.is equality
 âœ“ packages/core/src/items/__tests__/TraitComposition.integration.test.ts  (16 tests) 18ms
 âœ“ packages/core/src/components/__tests__/EpisodicMemoryComponent.test.ts  (29 tests) 9ms
 âœ“ packages/renderer/src/__tests__/WindowDragging.integration.test.ts  (23 tests) 11ms
 âœ“ packages/core/src/__tests__/ProgressiveSkillReveal.integration.test.ts  (15 tests) 11ms
 âœ“ packages/core/src/__tests__/IdleBehaviors.integration.test.ts  (13 tests | 6 skipped) 7ms
 âœ“ packages/core/src/__tests__/MagicDivinityIntegration.test.ts  (18 tests) 7ms
 â¯ packages/core/src/__tests__/AutomationIntegration.test.ts  (12 tests | 12 failed) 10ms
   â¯ packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Power Grid System > should distribute power from generator to consumer
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Power Grid System > should handle insufficient power
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Power Grid System > should not connect different power types
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Belt System > should transfer items along belt chain
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Belt System > should enforce single resource type per belt
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Belt System > should respect capacity limits
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Direct Connection System > should transfer items directly between adjacent machines
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Assembly Machine System > should craft items when powered and ingredients available
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Assembly Machine System > should halt when output is full
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Assembly Machine System > should respect power efficiency
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Assembly Machine System > should not craft without power
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Full Factory Integration > should run a complete powered belt â†’ assembly workflow
     â†’ Recipe missing required field: description
 âœ“ packages/renderer/src/__tests__/DragDropSystem.test.ts  (29 tests) 11ms
 â¯ packages/core/src/__tests__/PowerConsumption.test.ts  (15 tests | 12 failed | 1 skipped) 14ms
   â¯ packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Criterion 1: Power Consumers Drain Power > should reduce available power by consumer consumption when connected to network
     â†’ expected +0 to be 1 // Object.is equality
   â¯ packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Criterion 1: Power Consumers Drain Power > should set isPowered=true when sufficient power available
     â†’ expected false to be true // Object.is equality
   â¯ packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Criterion 1: Power Consumers Drain Power > should handle multiple consumers draining total power
     â†’ Cannot read properties of undefined (reading 'totalConsumption')
   â¯ packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Criterion 2: Power Producers Generate Power > should add generation value to network available power
     â†’ expected +0 to be 1 // Object.is equality
   â¯ packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Criterion 2: Power Producers Generate Power > should respect producer efficiency modifier
     â†’ Cannot read properties of undefined (reading 'totalGeneration')
   â¯ packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Criterion 2: Power Producers Generate Power > should combine multiple producers in same network
     â†’ Cannot read properties of undefined (reading 'totalGeneration')
   â¯ packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Criterion 3: Insufficient Power Causes Brownout > should reduce efficiency based on availability when underpowered
     â†’ expected 1 to be 0.5 // Object.is equality
   â¯ packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Criterion 3: Insufficient Power Causes Brownout > should handle zero power generation gracefully
     â†’ expected 1 to be +0 // Object.is equality
   â¯ packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Error Handling > should handle negative power values as zero
     â†’ Cannot read properties of undefined (reading 'totalGeneration')
   â¯ packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Network Isolation > should create separate networks for different power types
     â†’ expected +0 to be 2 // Object.is equality
   â¯ packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Network Isolation > should not power consumer if no network connection exists
     â†’ expected +0 to be 2 // Object.is equality
   â¯ packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Power Pole Connections > should connect generator to consumer via power pole
     â†’ expected +0 to be 1 // Object.is equality
 âœ“ packages/core/src/metrics/events/__tests__/MetricEvents.test.ts  (26 tests) 8ms
 âœ“ packages/metrics/src/events/__tests__/MetricEvents.test.ts  (26 tests) 8ms
 âœ“ packages/core/src/__tests__/ConversationStyle.test.ts  (55 tests) 10ms
 âœ“ packages/renderer/src/__tests__/InventoryUI.integration.test.ts  (43 tests) 131ms
 âœ“ packages/core/src/__tests__/DominanceChallengeSystem.test.ts  (10 tests) 7ms
 â¯ packages/core/src/__tests__/AutomationEdgeCases.test.ts  (20 tests | 20 failed) 15ms
   â¯ packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Power Grid Edge Cases > should handle zero power generation
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Power Grid Edge Cases > should handle zero power consumption
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Power Grid Edge Cases > should handle disconnected power networks
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Power Grid Edge Cases > should handle power network with no generators
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Belt Edge Cases > should handle removing more items than available
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Belt Edge Cases > should handle adding zero items
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Belt Edge Cases > should handle removing zero items
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Belt Edge Cases > should not accept items when belt type differs
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Belt Edge Cases > should accept same item type when space available
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Belt Edge Cases > should reject items exceeding capacity
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Belt Edge Cases > should handle belt transfer to non-existent target
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Assembly Machine Edge Cases > should handle missing recipe gracefully
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Assembly Machine Edge Cases > should handle incomplete ingredients
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Assembly Machine Edge Cases > should handle partial ingredients
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Assembly Machine Edge Cases > should resume production when output space becomes available
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Assembly Machine Edge Cases > should handle machine with no power component
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Assembly Machine Edge Cases > should handle very long crafting times
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > System Integration Edge Cases > should handle empty entity list
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > System Integration Edge Cases > should handle very small deltaTime
     â†’ Recipe missing required field: description
   â¯ packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > System Integration Edge Cases > should handle very large deltaTime
     â†’ Recipe missing required field: description
 âœ“ packages/core/src/items/__tests__/ItemRegistry.test.ts  (37 tests) 11ms
 âœ“ packages/magic/src/__tests__/MagicSourceGenerator.test.ts  (46 tests) 10ms
 âœ“ packages/core/src/magic/__tests__/MagicSourceGenerator.test.ts  (46 tests) 9ms
 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts  (24 tests | 22 failed) 16ms
   â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Tree Layout > should position foundation nodes at top
     â†’ Tree layout requires a tree with at least one node
   â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Tree Layout > should position mastery nodes at bottom
     â†’ Tree layout requires a tree with at least one node
   â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Tree Layout > should spread nodes horizontally within category
     â†’ Tree layout requires a tree with at least one node
   â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Tree Layout > should avoid node overlap
     â†’ Tree layout requires a tree with at least one node
   â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Tree Layout > should recalculate layout when tree changes
     â†’ Tree layout requires a tree with at least one node
   â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Dependency Lines > should draw line from prerequisite to dependent node
     â†’ ParadigmTreeView.render requires ctx, tree, progress, and evaluationContext
   â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Dependency Lines > should use arrow style for dependency lines
     â†’ ParadigmTreeView.render requires ctx, tree, progress, and evaluationContext
   â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Dependency Lines > should highlight dependency line when node hovered
     â†’ ParadigmTreeView.render requires ctx, tree, progress, and evaluationContext
   â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Dependency Lines > should draw dotted line for optional prerequisites
     â†’ ParadigmTreeView.render requires ctx, tree, progress, and evaluationContext
   â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Node Rendering > should render unlocked nodes with green background
     â†’ ParadigmTreeView.render requires ctx, tree, progress, and evaluationContext
   â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Node Rendering > should render available nodes with yellow glow
     â†’ ParadigmTreeView.render requires ctx, tree, progress, and evaluationContext
   â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Node Rendering > should render locked nodes with gray background
     â†’ ParadigmTreeView.render requires ctx, tree, progress, and evaluationContext
   â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Node Rendering > should render hidden nodes as "???"
     â†’ ParadigmTreeView.render requires ctx, tree, progress, and evaluationContext
   â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Scroll and Zoom > should offset node positions when scrolled
     â†’ ParadigmTreeView.render requires ctx, tree, progress, and evaluationContext
   â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Scroll and Zoom > should scale node sizes when zoomed
     â†’ ParadigmTreeView.render requires ctx, tree, progress, and evaluationContext
   â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Scroll and Zoom > should handle mouse wheel zoom
     â†’ expected 1 to be greater than 1
   â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Interaction Handling > should detect click on node
     â†’ Tree layout requires a tree with at least one node
   â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Interaction Handling > should detect hover on node
     â†’ Tree layout requires a tree with at least one node
   â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Interaction Handling > should clear hover when mouse leaves node
     â†’ Tree layout requires a tree with at least one node
   â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Error Handling > should throw when tree is null
     â†’ expected [Function] to throw an error
   â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Error Handling > should throw when rendering without evaluation results
     â†’ expected [Function] to throw error including 'Evaluation results not set' but got 'ParadigmTreeView.render requires ctx,â€¦'
   â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Error Handling > should throw when node layout fails
     â†’ expected [Function] to throw an error
 â¯ packages/core/src/buildings/__tests__/CraftingStations.integration.test.ts  (17 tests | 2 failed) 19ms
   â¯ packages/core/src/buildings/__tests__/CraftingStations.integration.test.ts > CraftingStations Integration Tests > Building Placement Integration > should create Workshop entity with correct initial state
     â†’ expected undefined not to be undefined
   â¯ packages/core/src/buildings/__tests__/CraftingStations.integration.test.ts > CraftingStations Integration Tests > Error Handling (CLAUDE.md compliance) > should handle completion event for deleted entity gracefully
     â†’ expected undefined to be null
stderr | packages/renderer/src/__tests__/WindowPersistence.integration.test.ts > Window Persistence (localStorage) > R4: Position Persistence > should fallback to default positions if localStorage is corrupted
Failed to load window layout, using defaults: SyntaxError: Unexpected token 'i', "invalid json {{{" is not valid JSON
    at JSON.parse (<anonymous>)
    at WindowManager.loadLayout (/Users/annhoward/src/ai_village/custom_game_engine/packages/renderer/src/WindowManager.ts:854:40)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/renderer/src/__tests__/WindowPersistence.integration.test.ts:229:34
    at Proxy.assertThrows (/Users/annhoward/src/ai_village/custom_game_engine/node_modules/chai/lib/chai/core/assertions.js:2644:7)
    at Proxy.methodWrapper (/Users/annhoward/src/ai_village/custom_game_engine/node_modules/chai/lib/chai/utils/addMethod.js:57:25)
    at Proxy.<anonymous> (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/expect/dist/index.js:850:16)
    at Proxy.overwritingMethodWrapper (/Users/annhoward/src/ai_village/custom_game_engine/node_modules/chai/lib/chai/utils/overwriteMethod.js:78:33)
    at Proxy.<anonymous> (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/expect/dist/index.js:1324:19)
    at Proxy.<anonymous> (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/expect/dist/index.js:800:17)
    at Proxy.methodWrapper (/Users/annhoward/src/ai_village/custom_game_engine/node_modules/chai/lib/chai/utils/addMethod.js:57:25)

stderr | packages/renderer/src/__tests__/WindowPersistence.integration.test.ts > Window Persistence (localStorage) > R4: Position Persistence > should handle version mismatch gracefully
Window layout version mismatch: expected 1, got 999

 âœ“ packages/renderer/src/__tests__/WindowPersistence.integration.test.ts  (18 tests) 20ms
stderr | packages/renderer/src/__tests__/WindowPersistence.integration.test.ts > Window Persistence (localStorage) > Error Handling - No Silent Fallbacks > should not use default values when required fields are missing in saved data
Saved window "invalid-window" missing required field, using defaults

 â†“ packages/renderer/src/__tests__/CombatUnitPanel.test.ts  (28 tests | 28 skipped)
 âœ“ packages/renderer/src/__tests__/ContextActionRegistry.test.ts  (42 tests) 16ms
 â†“ packages/renderer/src/__tests__/CombatLogPanel.test.ts  (31 tests | 31 skipped)
 â¯ packages/core/src/__tests__/AnimalProduction.test.ts  (15 tests | 1 failed) 14ms
   â¯ packages/core/src/__tests__/AnimalProduction.test.ts > Animal Production System > Error Handling > should throw when processing animal with missing health field in update
     â†’ expected [Function] to throw error including 'missing required \'health\' field' but got 'Animal invalid-chicken missing requirâ€¦'
 â¯ packages/core/src/divinity/__tests__/BeliefSystem.test.ts  (22 tests | 3 failed) 12ms
   â¯ packages/core/src/divinity/__tests__/BeliefSystem.test.ts > Belief Generation > should generate massive belief from witnessing miracles
     â†’ expected 80.7 to be greater than 100
   â¯ packages/core/src/divinity/__tests__/BeliefSystem.test.ts > Belief Decay > should decay belief over time without maintenance
     â†’ expected 132.61955589475295 to be close to 366, received difference is 233.38044410524705, but expected 0.5
   â¯ packages/core/src/divinity/__tests__/BeliefSystem.test.ts > Belief Quality and Growth > should detect belief plateau
     â†’ expected false to be true // Object.is equality
 â¯ packages/divinity/src/__tests__/BeliefSystem.test.ts  (22 tests | 3 failed) 13ms
   â¯ packages/divinity/src/__tests__/BeliefSystem.test.ts > Belief Generation > should generate massive belief from witnessing miracles
     â†’ expected 80.7 to be greater than 100
   â¯ packages/divinity/src/__tests__/BeliefSystem.test.ts > Belief Decay > should decay belief over time without maintenance
     â†’ expected 132.61955589475295 to be close to 366, received difference is 233.38044410524705, but expected 0.5
   â¯ packages/divinity/src/__tests__/BeliefSystem.test.ts > Belief Quality and Growth > should detect belief plateau
     â†’ expected false to be true // Object.is equality
 â¯ packages/core/src/__tests__/ConflictIntegration.test.ts  (11 tests | 4 failed | 2 skipped) 14ms
   â¯ packages/core/src/__tests__/ConflictIntegration.test.ts > ConflictIntegration > Full conflict flow > should complete full combat flow with all integrations
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/__tests__/ConflictIntegration.test.ts > ConflictIntegration > Edge cases > should handle simultaneous death
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/__tests__/ConflictIntegration.test.ts > ConflictIntegration > Edge cases > should handle injury affecting combat performance
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/__tests__/ConflictIntegration.test.ts > ConflictIntegration > Error propagation > should propagate errors from injury application
     â†’ Invalid injury type: invalid
 â¯ packages/core/src/magic/__tests__/CostSystemIntegration.test.ts  (16 tests | 3 failed) 14ms
   â¯ packages/core/src/magic/__tests__/CostSystemIntegration.test.ts > Cost System Integration > MagicLawEnforcer Integration > should use cost calculator to calculate costs
     â†’ Cannot read properties of undefined (reading 'academic')
   â¯ packages/core/src/magic/__tests__/CostSystemIntegration.test.ts > Cost System Integration > MagicLawEnforcer Integration > should pass validation when caster has enough resources
     â†’ Cannot read properties of undefined (reading 'academic')
   â¯ packages/core/src/magic/__tests__/CostSystemIntegration.test.ts > Cost System Integration > MagicLawEnforcer Integration > should fail validation when caster lacks resources
     â†’ Cannot read properties of undefined (reading 'academic')
 â¯ packages/magic/src/__tests__/CostSystemIntegration.test.ts  (16 tests | 16 failed) 11ms
   â¯ packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Initialization > should register all cost calculators during initialization
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Initialization > should allow getting registered calculators
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Initialization > should return all registered paradigm IDs
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > MagicLawEnforcer Integration > should use cost calculator to calculate costs
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > MagicLawEnforcer Integration > should pass validation when caster has enough resources
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > MagicLawEnforcer Integration > should fail validation when caster lacks resources
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > MagicLawEnforcer Integration > should warn about terminal effects
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > MagicLawEnforcer Integration > should fail with clear error when calculator not registered
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > SpellCastingService Integration > should throw when checking costs without calculator
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > SpellCastingService Integration > should throw when deducting costs without calculator
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Cost Calculation > should calculate mana and stamina costs for academic spells
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Cost Calculation > should reduce mana cost with ambient power
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Affordability Checking > should correctly identify when caster can afford spell
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Affordability Checking > should correctly identify insufficient resources
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Error Messages > should have actionable error message for missing calculator
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Error Messages > should have clear error for missing paradigm
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
 â¯ packages/core/src/__tests__/MagicBodyIntegration.integration.test.ts  (15 tests | 3 failed) 14ms
   â¯ packages/core/src/__tests__/MagicBodyIntegration.integration.test.ts > Magic + Body Integration Tests > Body Healing Integration > should heal specific injured body part
     â†’ expected 30 to be less than 30
   â¯ packages/core/src/__tests__/MagicBodyIntegration.integration.test.ts > Magic + Body Integration Tests > Body Healing Integration > should mend fractures instantly
     â†’ expected undefined not to be undefined
   â¯ packages/core/src/__tests__/MagicBodyIntegration.integration.test.ts > Magic + Body Integration Tests > Complex Transformation Scenarios > should handle stacking transformations
     â†’ expected 2 to be greater than or equal to 3
 âœ“ packages/core/src/research/__tests__/ResearchFlow.integration.test.ts  (19 tests) 7ms
 âœ“ packages/core/src/systems/__tests__/ReflectionSystem.test.ts  (22 tests | 4 skipped) 12ms
 âœ“ packages/magic/src/__tests__/AnimistParadigms.test.ts  (135 tests) 17ms
 âœ“ packages/core/src/systems/__tests__/AfterlifeNeedsSystem.test.ts  (15 tests) 9ms
 âœ“ packages/core/src/magic/__tests__/AnimistParadigms.test.ts  (135 tests) 19ms
stderr | packages/core/src/systems/__tests__/BehaviorQueueProcessing.test.ts > Behavior Queue Processing in AISystem > Timeout Safety > should timeout behavior after 5 minutes (300000ms)
Behavior wander timed out after 5 minutes

stderr | packages/core/src/systems/__tests__/BehaviorQueueProcessing.test.ts > Behavior Queue Processing in AISystem > Timeout Safety > should log warning when behavior times out
Behavior wander timed out after 5 minutes

 âœ“ packages/core/src/systems/__tests__/BehaviorQueueProcessing.test.ts  (18 tests) 9ms
 â¯ packages/core/src/uplift/__tests__/ProtoSapienceObservationSystem.test.ts  (17 tests | 3 failed) 14ms
   â¯ packages/core/src/uplift/__tests__/ProtoSapienceObservationSystem.test.ts > ProtoSapienceObservationSystem - Communication Patterns > should track communication pattern development
     â†’ expected 0 to be greater than 0
   â¯ packages/core/src/uplift/__tests__/ProtoSapienceObservationSystem.test.ts > ProtoSapienceObservationSystem - Milestone Events > should emit milestone event for first tool use
     â†’ expected false to be true // Object.is equality
   â¯ packages/core/src/uplift/__tests__/ProtoSapienceObservationSystem.test.ts > ProtoSapienceObservationSystem - Milestone Events > should emit milestone event for proto-language emergence
     â†’ expected false to be true // Object.is equality
 â¯ packages/core/src/buildings/__tests__/CraftingStations.test.ts  (30 tests | 2 failed) 23ms
   â¯ packages/core/src/buildings/__tests__/CraftingStations.test.ts > Crafting Stations - Tier 2 > Criterion 2: Crafting Functionality > should configure Forge with crafting functionality and speed bonus
     â†’ expected [ { type: 'crafting', â€¦(2) }, â€¦(1) ] to have a length of 1 but got 2
   â¯ packages/core/src/buildings/__tests__/CraftingStations.test.ts > Crafting Stations - Tier 2 > Criterion 2: Crafting Functionality > should configure Windmill with crafting functionality
     â†’ expected [ { type: 'crafting', â€¦(2) }, â€¦(1) ] to have a length of 1 but got 2
 âœ“ packages/introspection/src/__tests__/mutation.test.ts  (26 tests) 10ms
stderr | packages/introspection/src/__tests__/mutation.test.ts > Phase 2B: Mutation Layer > MutationService > should reject invalid type mutations
[MutationService] Mutation failed: {
  entityId: 'test-entity',
  componentType: 'identity',
  fieldName: 'name',
  attemptedValue: 123,
  reason: 'Expected string, got number',
  timestamp: 1767698217985,
  source: 'system'
}

stderr | packages/introspection/src/__tests__/mutation.test.ts > Phase 2B: Mutation Layer > MutationService > should reject out-of-range mutations
[MutationService] Mutation failed: {
  entityId: 'test-entity',
  componentType: 'identity',
  fieldName: 'age',
  attemptedValue: -5,
  reason: "Field 'age' must be between 0 and 10000, got -5",
  timestamp: 1767698217985,
  source: 'system'
}

stderr | packages/introspection/src/__tests__/mutation.test.ts > Phase 2B: Mutation Layer > MutationService > should reject immutable field mutations
[MutationService] Mutation failed: {
  entityId: 'test-entity',
  componentType: 'identity',
  fieldName: 'species',
  attemptedValue: 'elf',
  reason: "Field 'species' is not mutable",
  timestamp: 1767698217985,
  source: 'system'
}

stderr | packages/introspection/src/__tests__/mutation.test.ts > Phase 2B: Mutation Layer > MutationService > should reject mutations to missing components
[MutationService] Mutation failed: {
  entityId: 'test-entity',
  componentType: 'identity',
  fieldName: 'name',
  attemptedValue: 'George',
  reason: "Entity test-entity does not have component 'identity'",
  timestamp: 1767698217987,
  source: 'system'
}

stderr | packages/introspection/src/__tests__/mutation.test.ts > Phase 2B: Mutation Layer > MutationService > should reject mutations to unregistered schemas
[MutationService] Mutation failed: {
  entityId: 'test-entity',
  componentType: 'unknown',
  fieldName: 'field',
  attemptedValue: 'value',
  reason: "No schema registered for component type 'unknown'",
  timestamp: 1767698217987,
  source: 'system'
}

 â¯ packages/core/src/__tests__/MetricsStorage.test.ts  (38 tests | 15 failed) 80ms
   â¯ packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Initialization > should create storage directory if it does not exist
     â†’ ENOENT: no such file or directory, stat '/Users/annhoward/src/ai_village/custom_game_engine/packages/core/test-metrics-storage'
   â¯ packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Warm Storage (Session) > should persist session metrics to disk
     â†’ saveSession is not available in browser mode
   â¯ packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Warm Storage (Session) > should load session metrics from disk
     â†’ saveSession is not available in browser mode
   â¯ packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Warm Storage (Session) > should throw when loading non-existent session
     â†’ expected [Function] to throw error including 'Session not found: nonexistent' but got 'loadSession is not available in browsâ€¦'
   â¯ packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Warm Storage (Session) > should list all available sessions
     â†’ saveSession is not available in browser mode
   â¯ packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Warm Storage (Session) > should delete old sessions
     â†’ saveSession is not available in browser mode
   â¯ packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Cold Storage (Archive) > should compress and archive old metrics
     â†’ archiveMetrics is not available in browser mode
   â¯ packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Cold Storage (Archive) > should decompress archived metrics
     â†’ archiveMetrics is not available in browser mode
   â¯ packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Cold Storage (Archive) > should list all available archives
     â†’ archiveMetrics is not available in browser mode
   â¯ packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Cold Storage (Archive) > should calculate archive size
     â†’ archiveMetrics is not available in browser mode
   â¯ packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Cold Storage (Archive) > should delete old archives
     â†’ archiveMetrics is not available in browser mode
   â¯ packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Data Integrity > should validate session data before saving
     â†’ expected [Function] to throw error including 'Session must have a valid sessionId' but got 'saveSession is not available in browsâ€¦'
   â¯ packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Data Integrity > should detect corrupted archive files
     â†’ expected [Function] to throw error including 'Failed to load archive' but got 'loadArchive is not available in browsâ€¦'
   â¯ packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Data Integrity > should verify checksums for archived data
     â†’ archiveMetrics is not available in browser mode
   â¯ packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Error Handling > should handle permission errors
     â†’ promise resolved "undefined" instead of rejecting
 âœ“ packages/core/src/perception/__tests__/Perception.test.ts  (24 tests) 9ms
stdout | packages/world/src/chunks/__tests__/ChunkSerializer.test.ts > ChunkSerializer > ChunkManager Integration > should serialize all generated chunks
[ChunkSerializer] Serializing 2 generated chunks (3 total loaded)
[ChunkSerializer] Terrain snapshot created

stdout | packages/world/src/chunks/__tests__/ChunkSerializer.test.ts > ChunkSerializer > ChunkManager Integration > should create chunk index with correct metadata
[ChunkSerializer] Serializing 1 generated chunks (1 total loaded)
[ChunkSerializer] Terrain snapshot created

stdout | packages/world/src/chunks/__tests__/ChunkSerializer.test.ts > ChunkSerializer > ChunkManager Integration > should compute checksums correctly
[ChunkSerializer] Serializing 1 generated chunks (1 total loaded)
[ChunkSerializer] Terrain snapshot created

stdout | packages/world/src/chunks/__tests__/ChunkSerializer.test.ts > ChunkSerializer > Deserialization > should restore chunk manager from snapshot
[ChunkSerializer] Serializing 2 generated chunks (2 total loaded)
[ChunkSerializer] Terrain snapshot created
[ChunkSerializer] Deserializing 2 chunks
[ChunkSerializer] Loaded 2 chunks

stdout | packages/world/src/chunks/__tests__/ChunkSerializer.test.ts > ChunkSerializer > Deserialization > should restore entity references
[ChunkSerializer] Serializing 1 generated chunks (1 total loaded)
[ChunkSerializer] Terrain snapshot created
[ChunkSerializer] Deserializing 1 chunks
[ChunkSerializer] Loaded 1 chunks

stdout | packages/world/src/chunks/__tests__/ChunkSerializer.test.ts > ChunkSerializer > Corruption Handling > should create corrupted chunk marker on deserialization error
[ChunkSerializer] Deserializing 1 chunks
[ChunkSerializer] Loaded 1 chunks

stderr | packages/world/src/chunks/__tests__/ChunkSerializer.test.ts > ChunkSerializer > Corruption Handling > should create corrupted chunk marker on deserialization error
[ChunkSerializer] Terrain checksum mismatch! Expected fake, got 7b395adb. Terrain data may be corrupted.
[ChunkSerializer] Chunk 0,0 checksum mismatch! Chunk may be corrupted. Attempting to load anyway...
[ChunkSerializer] Failed to deserialize chunk 0,0: Error: Unknown encoding: invalid_encoding
    at ChunkSerializer.deserializeChunk (/Users/annhoward/src/ai_village/custom_game_engine/packages/world/src/chunks/ChunkSerializer.ts:388:15)
    at ChunkSerializer.deserializeChunks (/Users/annhoward/src/ai_village/custom_game_engine/packages/world/src/chunks/ChunkSerializer.ts:341:28)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/world/src/chunks/__tests__/ChunkSerializer.test.ts:373:24
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runFiles (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:958:5)
[ChunkSerializer] Created corrupted chunk marker at (0, 0): Unknown encoding: invalid_encoding

stdout | packages/world/src/chunks/__tests__/ChunkSerializer.test.ts > ChunkSerializer > Corruption Handling > should log checksum mismatches but continue loading
[ChunkSerializer] Serializing 1 generated chunks (1 total loaded)
[ChunkSerializer] Terrain snapshot created
[ChunkSerializer] Deserializing 1 chunks
[ChunkSerializer] Loaded 1 chunks

stderr | packages/world/src/chunks/__tests__/ChunkSerializer.test.ts > ChunkSerializer > Corruption Handling > should log checksum mismatches but continue loading
[ChunkSerializer] Terrain checksum mismatch! Expected corrupted_checksum, got 372ae576. Terrain data may be corrupted.

stdout | packages/world/src/chunks/__tests__/ChunkSerializer.test.ts > ChunkSerializer > Round-Trip Tests > should preserve chunk data through serialize/deserialize cycle
[ChunkSerializer] Serializing 1 generated chunks (1 total loaded)
[ChunkSerializer] Terrain snapshot created
[ChunkSerializer] Deserializing 1 chunks
[ChunkSerializer] Loaded 1 chunks

 âœ“ packages/world/src/chunks/__tests__/ChunkSerializer.test.ts  (20 tests) 224ms
 â¯ packages/core/src/systems/__tests__/RealityAnchorSystem.integration.test.ts  (11 tests | 3 failed) 15ms
   â¯ packages/core/src/systems/__tests__/RealityAnchorSystem.integration.test.ts > RealityAnchorSystem Integration > should emit reality_anchor:field_collapse when field collapses
     â†’ expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ]

Received: 



Number of calls: 0

   â¯ packages/core/src/systems/__tests__/RealityAnchorSystem.integration.test.ts > RealityAnchorSystem Integration > should emit charging_interrupted event when power lost mid-charge
     â†’ expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ]

Received: 



Number of calls: 0

   â¯ packages/core/src/systems/__tests__/RealityAnchorSystem.integration.test.ts > RealityAnchorSystem Integration > should handle partial power scenarios correctly
     â†’ expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ]

Received: 



Number of calls: 0

 âœ“ packages/divinity/src/__tests__/BeliefTypes.test.ts  (54 tests) 10ms
 âœ“ packages/core/src/divinity/__tests__/BeliefTypes.test.ts  (54 tests) 9ms
 â¯ packages/core/src/__tests__/AgentCombat.test.ts  (21 tests | 21 failed) 17ms
   â¯ packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should support various combat causes
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should compare combat skills and equipment
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should apply surprise modifier
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should apply terrain modifier
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should apply injury modifier to injured combatant
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should roll outcome with skill-weighted probability
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should determine injury severity based on power difference
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should call LLM to generate fight narrative
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should include witnesses in narrative context
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should apply social consequences - witness opinions
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should apply social consequences - relationship changes
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should apply social consequences - reputation
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should check for legal consequences if laws exist
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should skip legal consequences for self-defense
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should handle mutual injury outcome
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should handle stalemate outcome
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > error handling > should throw when combat target does not exist
     â†’ expected [Function] to throw an error
   â¯ packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > error handling > should throw when combat target is not an agent
     â†’ expected [Function] to throw error including 'Combat target is not an agent' but got 'Cannot read properties of undefined (â€¦'
   â¯ packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > error handling > should throw when attacker lacks required combat_stats component
     â†’ expected [Function] to throw error including 'Attacker missing required component: â€¦' but got 'Cannot read properties of undefined (â€¦'
   â¯ packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > error handling > should throw when defender lacks required combat_stats component
     â†’ expected [Function] to throw error including 'Defender missing required component: â€¦' but got 'Cannot read properties of undefined (â€¦'
   â¯ packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > error handling > should throw when cause is not provided
     â†’ expected [Function] to throw error including 'Combat cause is required' but got 'Cannot read properties of undefined (â€¦'
 â¯ packages/core/src/perception/__tests__/Perception.integration.test.ts  (9 tests | 1 failed) 14ms
   â¯ packages/core/src/perception/__tests__/Perception.integration.test.ts > Perception Integration Tests > Vision and Memory Integration > agent detects plants and remembers their state
     â†’ expected undefined to be true // Object.is equality
 âœ“ packages/core/src/systems/__tests__/GoalGenerationSystem.integration.test.ts  (9 tests) 8ms
 âœ“ packages/core/src/__tests__/AnimalSystem.test.ts  (18 tests) 10ms
 â¯ packages/core/src/__tests__/MagicNumbersExtraction.test.ts  (45 tests | 1 failed) 18ms
   â¯ packages/core/src/__tests__/MagicNumbersExtraction.test.ts > Magic Numbers Extraction > NeedsConstants > should define temperature constants
     â†’ expected 18 to be 20 // Object.is equality
 âœ“ packages/core/src/__tests__/BodySystem.test.ts  (24 tests) 11ms
 â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts  (18 tests | 13 failed) 21ms
   â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Tile-Based Blueprint System > should register blueprints with layout strings
     â†’ Tile-based blueprint "tile_small_house" not found
   â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Tile-Based Blueprint System > should parse blueprint layout to tile positions
     â†’ Tile-based blueprint "tile_small_house" not found
   â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Tile-Based Blueprint System > should calculate resource requirements from layout
     â†’ Tile-based blueprint "tile_small_house" not found
   â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Construction Task System > should create construction tasks for blueprint
     â†’ Tile-based blueprint "tile_small_house" not found
   â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Construction Task System > should track material pool for construction
     â†’ Tile-based blueprint "tile_small_house" not found
   â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Construction Task System > should track workers involved in construction
     â†’ Tile-based blueprint "tile_small_house" not found
   â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Construction Task System > should transition status when materials are delivered
     â†’ Tile-based blueprint "tile_small_house" not found
   â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Tile Placement Integration > should place wall tile when construction progresses
     â†’ Tile-based blueprint "tile_small_house" not found
   â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Tile Placement Integration > should handle multiple tiles in blueprint
     â†’ Tile-based blueprint "tile_small_house" not found
   â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Complete Building Workflow > should complete full workflow: blueprint â†’ tasks â†’ materials â†’ construction
     â†’ Tile-based blueprint "tile_small_house" not found
   â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Complete Building Workflow > should handle collaborative building with multiple workers
     â†’ Tile-based blueprint "tile_small_house" not found
   â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Blueprint Variations > should support different blueprint sizes
     â†’ Tile-based blueprint "tile_small_house" not found
   â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Blueprint Variations > should support blueprint rotation
     â†’ Tile-based blueprint "tile_small_house" not found
 â¯ packages/core/src/systems/__tests__/ConstructionProgress.test.ts  (27 tests | 10 failed) 20ms
   â¯ packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Construction Progress Advancement > should advance construction progress based on time elapsed
     â†’ Unknown building type: undefined. Cannot determine construction time.
   â¯ packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Construction Progress Advancement > should advance different buildings at different rates based on buildTime
     â†’ Unknown building type: undefined. Cannot determine construction time.
   â¯ packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Construction Progress Advancement > should clamp progress to 100% maximum
     â†’ Unknown building type: undefined. Cannot determine construction time.
   â¯ packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Construction Progress Advancement > should handle multiple simultaneous constructions
     â†’ Unknown building type: undefined. Cannot determine construction time.
   â¯ packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Construction Completion > should mark building as complete when progress reaches 100%
     â†’ Unknown building type: undefined. Cannot determine construction time.
   â¯ packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Construction Completion > should emit "building:complete" event on completion
     â†’ Unknown building type: undefined. Cannot determine construction time.
   â¯ packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Construction Completion > should only emit event once when crossing 100% threshold
     â†’ Unknown building type: undefined. Cannot determine construction time.
   â¯ packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Edge Cases > should handle progress from 99% to 101% (clamped to 100%)
     â†’ Unknown building type: undefined. Cannot determine construction time.
   â¯ packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Edge Cases > should handle zero deltaTime
     â†’ Unknown building type: undefined. Cannot determine construction time.
   â¯ packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > BuildingComponent Properties > should set correct properties for shelters
     â†’ expected +0 to be 0.5 // Object.is equality
 âœ“ packages/core/src/systems/__tests__/CraftingStations.integration.test.ts  (19 tests) 12ms
 âœ“ packages/core/src/systems/__tests__/ReflectionSystem.integration.test.ts  (12 tests) 8ms
 âœ“ packages/core/src/systems/__tests__/ReincarnationSystem.integration.test.ts  (8 tests) 13ms
stderr | packages/core/src/systems/__tests__/ReincarnationSystem.integration.test.ts > ReincarnationSystem Integration > full reincarnation lifecycle > should complete full death to rebirth cycle
[ReincarnationSystem] âš ï¸ Destroying entity 84422213-7d0a-4a8c-9e6d-ca07b64e8dfe for reincarnation. This should be refactored to preserve soul entity and only create new body.

stderr | packages/core/src/systems/__tests__/ReincarnationSystem.integration.test.ts > ReincarnationSystem Integration > memory retention across lives > should transfer memories with full retention
[ReincarnationSystem] âš ï¸ Destroying entity 6f70218f-770a-4e13-8d8b-6a6752621920 for reincarnation. This should be refactored to preserve soul entity and only create new body.

stderr | packages/core/src/systems/__tests__/ReincarnationSystem.integration.test.ts > ReincarnationSystem Integration > memory retention across lives > should preserve only significant memories with fragments retention
[ReincarnationSystem] âš ï¸ Destroying entity e757142f-2c2d-41d6-962a-087d8922f751 for reincarnation. This should be refactored to preserve soul entity and only create new body.

stderr | packages/core/src/systems/__tests__/ReincarnationSystem.integration.test.ts > ReincarnationSystem Integration > memory retention across lives > should preserve no memories with none retention
[ReincarnationSystem] âš ï¸ Destroying entity af0d9d31-580f-4a57-bddf-3f7cc7da1296 for reincarnation. This should be refactored to preserve soul entity and only create new body.

stderr | packages/core/src/systems/__tests__/ReincarnationSystem.integration.test.ts > ReincarnationSystem Integration > spawn location > should spawn near death location for same_world target
[ReincarnationSystem] âš ï¸ Destroying entity 19d8daaf-8b56-43f8-a933-010399c13a77 for reincarnation. This should be refactored to preserve soul entity and only create new body.

stderr | packages/core/src/systems/__tests__/ReincarnationSystem.integration.test.ts > ReincarnationSystem Integration > deity connection > should set believed deity on reincarnated entity
[ReincarnationSystem] âš ï¸ Destroying entity e6fcbef0-e741-466e-be20-8674d34fa9ae for reincarnation. This should be refactored to preserve soul entity and only create new body.

stderr | packages/core/src/systems/__tests__/ReincarnationSystem.integration.test.ts > ReincarnationSystem Integration > concurrent reincarnations > should handle multiple souls being reincarnated simultaneously
[ReincarnationSystem] âš ï¸ Destroying entity soul-1 for reincarnation. This should be refactored to preserve soul entity and only create new body.
[ReincarnationSystem] âš ï¸ Destroying entity soul-2 for reincarnation. This should be refactored to preserve soul entity and only create new body.
[ReincarnationSystem] âš ï¸ Destroying entity soul-3 for reincarnation. This should be refactored to preserve soul entity and only create new body.

stderr | packages/core/src/systems/__tests__/ReincarnationSystem.integration.test.ts > ReincarnationSystem Integration > original entity cleanup > should remove original entity after reincarnation
[ReincarnationSystem] âš ï¸ Destroying entity cff5572f-0b61-4931-92b6-a9931d67674a for reincarnation. This should be refactored to preserve soul entity and only create new body.

 âœ“ packages/magic/src/__tests__/WhimsicalParadigms.test.ts  (61 tests) 12ms
 âœ“ packages/core/src/systems/__tests__/BehaviorQueue.integration.test.ts  (12 tests) 10ms
stderr | ComponentRegistry.register (/Users/annhoward/src/ai_village/custom_game_engine/packages/introspection/src/registry/ComponentRegistry.ts:45:15)
[ComponentRegistry] Schema 'interests' is already registered. Overwriting.

 âœ“ packages/core/src/magic/__tests__/WhimsicalParadigms.test.ts  (61 tests) 12ms
 â†“ packages/renderer/src/__tests__/AgentInfoPanel-thought-speech.test.ts  (19 tests | 19 skipped)
 â†“ packages/renderer/src/__tests__/MenuContext.test.ts  (34 tests | 34 skipped)
 âœ“ packages/core/src/magic/__tests__/CostSystemNoFallbacks.test.ts  (12 tests) 6ms
 â¯ packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts  (12 tests | 12 failed) 9ms
   â¯ packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > MagicLawEnforcer: No Fallbacks > should FAIL validation when calculator not registered
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > MagicLawEnforcer: No Fallbacks > should NOT use basic mana cost as fallback
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > MagicLawEnforcer: No Fallbacks > should return early when calculator missing
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > SpellCastingService: No Fallbacks > should THROW when checking costs without calculator
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > SpellCastingService: No Fallbacks > should THROW when deducting costs without calculator
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > SpellCastingService: No Fallbacks > should THROW when paradigm not found
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > SpellCastingService: No Fallbacks > should NOT silently use basic mana pools
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > Error Message Quality > should include paradigm ID in error message
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > Error Message Quality > should tell user how to fix the problem
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > Error Message Quality > should have different error for each failure type
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > Behavior After Error > should not modify caster state when throwing
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
   â¯ packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > Behavior After Error > should allow retrying after registering calculators
     â†’ Cannot read properties of undefined (reading 'clear')
     â†’ Cannot read properties of undefined (reading 'clear')
 â†“ packages/renderer/src/__tests__/ContextMenuRenderer.test.ts  (28 tests | 28 skipped)
 â†“ packages/renderer/src/__tests__/HealthBarRenderer.test.ts  (27 tests | 27 skipped)
 âœ“ packages/core/src/research/__tests__/ResearchStateComponent.test.ts  (33 tests) 14ms
 â†“ packages/core/src/systems/__tests__/QualityEconomy.test.ts  (15 tests | 15 skipped)
 â¯ packages/core/src/__tests__/ComponentFormatUnification.test.ts  (35 tests | 2 failed) 15ms
   â¯ packages/core/src/__tests__/ComponentFormatUnification.test.ts > Component Format Unification > Criterion 2: Helper Functions Use Single Type > NeedsComponent helper functions > isHungry should accept only NeedsComponent, not union type
     â†’ expected true not to be true // Object.is equality
   â¯ packages/core/src/__tests__/ComponentFormatUnification.test.ts > Component Format Unification > Criterion 2: Helper Functions Use Single Type > PersonalityComponent helper functions > getPersonalityDescription should accept only PersonalityComponent
     â†’ expected 'curious and adventurous' to contain 'outgoing'
 âœ“ packages/renderer/src/__tests__/ViewAdapter.test.ts  (25 tests) 12ms
 â¯ packages/core/src/uplift/__tests__/UpliftIntegration.test.ts  (9 tests | 8 failed) 16ms
   â¯ packages/core/src/uplift/__tests__/UpliftIntegration.test.ts > Uplift Integration - Full Wolf Uplift Flow > should complete full uplift from Gen 0 to awakening
     â†’ expected 0 to be greater than 0
   â¯ packages/core/src/uplift/__tests__/UpliftIntegration.test.ts > Uplift Integration - Full Wolf Uplift Flow > should track generation results throughout uplift
     â†’ expected +0 to be 5 // Object.is equality
   â¯ packages/core/src/uplift/__tests__/UpliftIntegration.test.ts > Uplift Integration - Full Wolf Uplift Flow > should emit events during uplift process
     â†’ expected [] to include 'generation_advanced'
   â¯ packages/core/src/uplift/__tests__/UpliftIntegration.test.ts > Uplift Integration - Technology Effects > should accelerate with genetic engineering tech
     â†’ expected 0 to be greater than 0
   â¯ packages/core/src/uplift/__tests__/UpliftIntegration.test.ts > Uplift Integration - Edge Cases > should handle population extinction
     â†’ expected false to be true // Object.is equality
   â¯ packages/core/src/uplift/__tests__/UpliftIntegration.test.ts > Uplift Integration - Edge Cases > should handle very low initial intelligence
     â†’ expected 0.3 to be greater than 0.3
   â¯ packages/core/src/uplift/__tests__/UpliftIntegration.test.ts > Uplift Integration - Edge Cases > should handle concurrent uplift programs
     â†’ expected +0 to be 1 // Object.is equality
   â¯ packages/core/src/uplift/__tests__/UpliftIntegration.test.ts > Uplift Integration - Proto-Sapience to Sapience Transition > should transition from proto-sapient to sapient
     â†’ expected false to be true // Object.is equality
 âœ“ packages/divinity/src/__tests__/DeityTypes.test.ts  (51 tests) 10ms
 â†“ packages/renderer/src/__tests__/ThreatIndicatorRenderer.test.ts  (27 tests | 27 skipped)
 âœ“ packages/core/src/divinity/__tests__/DeityTypes.test.ts  (51 tests) 10ms
 âœ“ packages/core/src/research/__tests__/ResearchRegistry.test.ts  (33 tests) 11ms
 â¯ packages/core/src/uplift/__tests__/ConsciousnessEmergenceSystem.test.ts  (20 tests | 1 failed) 16ms
   â¯ packages/core/src/uplift/__tests__/ConsciousnessEmergenceSystem.test.ts > ConsciousnessEmergenceSystem - Event Emission > should emit consciousness_awakened event
     â†’ expected false to be true // Object.is equality
 âœ“ packages/core/src/__tests__/GuardDutySystem.test.ts  (13 tests) 8ms
 âœ“ packages/core/src/__tests__/InterestsComponent.test.ts  (34 tests) 9ms
 âœ“ packages/renderer/src/__tests__/ResearchUnlockFiltering.test.ts  (13 tests) 7ms
 âœ“ packages/core/src/magic/__tests__/ValidationFixes.test.ts  (25 tests) 7ms
 âœ“ packages/magic/src/__tests__/ValidationFixes.test.ts  (25 tests) 7ms
 â¯ packages/renderer/src/__tests__/CraftingPanelUI.test.ts  (46 tests | 7 failed) 122ms
   â¯ packages/renderer/src/__tests__/CraftingPanelUI.test.ts > CraftingPanelUI (REQ-CRAFT-001) > Mouse Interaction > should handle click on close button
     â†’ expected true to be false // Object.is equality
   â¯ packages/renderer/src/__tests__/CraftingPanelUI.test.ts > CraftingPanelUI (REQ-CRAFT-001) > Mouse Interaction > should handle clicks outside panel bounds (close panel)
     â†’ expected true to be false // Object.is equality
   â¯ packages/renderer/src/__tests__/CraftingPanelUI.test.ts > CraftingPanelUI (REQ-CRAFT-001) > Recipe Selection (REQ-CRAFT-003) > should select recipe when clicked
     â†’ Recipe not found: stone_axe
   â¯ packages/renderer/src/__tests__/CraftingPanelUI.test.ts > CraftingPanelUI (REQ-CRAFT-001) > Recipe Selection (REQ-CRAFT-003) > should update details section when recipe is selected
     â†’ Recipe not found: stone_axe
   â¯ packages/renderer/src/__tests__/CraftingPanelUI.test.ts > CraftingPanelUI (REQ-CRAFT-001) > Recipe Selection (REQ-CRAFT-003) > should update ingredient panel when recipe is selected
     â†’ Recipe not found: stone_axe
   â¯ packages/renderer/src/__tests__/CraftingPanelUI.test.ts > CraftingPanelUI (REQ-CRAFT-001) > Recipe Selection (REQ-CRAFT-003) > should clear selection when null is passed
     â†’ Recipe not found: stone_axe
   â¯ packages/renderer/src/__tests__/CraftingPanelUI.test.ts > CraftingPanelUI (REQ-CRAFT-001) > Error Handling (CLAUDE.md) > should throw when rendering without active agent
     â†’ expected [Function] to throw an error
 âœ“ packages/core/src/buildings/__tests__/PlacementValidator.test.ts  (22 tests) 9ms
 â¯ packages/core/src/uplift/__tests__/UpliftBreedingProgramSystem.test.ts  (14 tests | 1 failed) 14ms
   â¯ packages/core/src/uplift/__tests__/UpliftBreedingProgramSystem.test.ts > UpliftBreedingProgramSystem - Population Management > should handle population extinction
     â†’ expected false to be true // Object.is equality
 â†“ packages/renderer/src/__tests__/FloatingNumberRenderer.test.ts  (36 tests | 36 skipped)
 âœ“ packages/core/src/systems/__tests__/SeedDispersal.integration.test.ts  (5 tests) 6ms
 â¯ packages/core/src/__tests__/ComboDetector.test.ts  (38 tests | 1 failed) 16ms
   â¯ packages/core/src/__tests__/ComboDetector.test.ts > ComboDetector - Combo Coverage > should detect all immortality loops
     â†’ expected false to be true // Object.is equality
 âœ“ packages/core/src/magic/__tests__/NullParadigms.test.ts  (96 tests) 12ms
 âœ“ packages/magic/src/__tests__/NullParadigms.test.ts  (96 tests) 12ms
 â¯ packages/core/src/multiverse/__tests__/MultiverseNetworkManager.test.ts  (21 tests | 2 failed) 5158ms
   â¯ packages/core/src/multiverse/__tests__/MultiverseNetworkManager.test.ts > MultiverseNetworkManager > Peer Connection > should handle connection timeout
     â†’ promise resolved "'peer-1767698218249-qhwrox'" instead of rejecting
   â¯ packages/core/src/multiverse/__tests__/MultiverseNetworkManager.test.ts > MultiverseNetworkManager > Remote Passage Creation > should fail if local universe not found
     â†’ Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 â¯ packages/core/src/navigation/__tests__/KnowledgeTransmission.test.ts  (31 tests | 2 failed) 20ms
   â¯ packages/core/src/navigation/__tests__/KnowledgeTransmission.test.ts > KnowledgeTransmission > recordMovement > records traversal in map knowledge
     â†’ expected 0.5 to be 1 // Object.is equality
   â¯ packages/core/src/navigation/__tests__/KnowledgeTransmission.test.ts > KnowledgeTransmission > recordMovement > accumulates traffic on repeated movements
     â†’ expected 1 to be 5 // Object.is equality
stderr | ComponentRegistry.register (/Users/annhoward/src/ai_village/custom_game_engine/packages/introspection/src/registry/ComponentRegistry.ts:45:15)
[ComponentRegistry] Schema 'interests' is already registered. Overwriting.

 â¯ packages/core/src/__tests__/BeliefAttribution.integration.test.ts  (12 tests | 7 failed | 1 skipped) 8ms
   â¯ packages/core/src/__tests__/BeliefAttribution.integration.test.ts > Belief Attribution System - E2E Integration > Domain Belief Accumulation > should accumulate domain-specific belief from perceived powers
     â†’ createInitialPerceivedIdentity is not a function
   â¯ packages/core/src/__tests__/BeliefAttribution.integration.test.ts > Belief Attribution System - E2E Integration > Domain Belief Accumulation > should split belief contribution based on perceived domains
     â†’ calculateBeliefContribution is not a function
   â¯ packages/core/src/__tests__/BeliefAttribution.integration.test.ts > Belief Attribution System - E2E Integration > Miracle and Prayer Bonuses > should give larger bonus for first witnessed miracle in a domain
     â†’ createInitialPerceivedIdentity is not a function
   â¯ packages/core/src/__tests__/BeliefAttribution.integration.test.ts > Belief Attribution System - E2E Integration > Miracle and Prayer Bonuses > should give exact match bonus for answered prayers
     â†’ createInitialPerceivedIdentity is not a function
   â¯ packages/core/src/__tests__/BeliefAttribution.integration.test.ts > Belief Attribution System - E2E Integration > Misattribution System > should create new domain perception from misattributed event
     â†’ createInitialPerceivedIdentity is not a function
   â¯ packages/core/src/__tests__/BeliefAttribution.integration.test.ts > Belief Attribution System - E2E Integration > Misattribution System > should reinforce existing domain from repeated misattribution
     â†’ createInitialPerceivedIdentity is not a function
   â¯ packages/core/src/__tests__/BeliefAttribution.integration.test.ts > Belief Attribution System - E2E Integration > Full Attribution Flow > should complete full cycle: event -> attribution -> domain belief
     â†’ createInitialPerceivedIdentity is not a function
 â¯ packages/core/src/systems/__tests__/UniversityResearch.integration.test.ts  (9 tests | 1 failed) 17ms
   â¯ packages/core/src/systems/__tests__/UniversityResearch.integration.test.ts > University Research Integration > Technology unlock integration > should enable university collaboration multiplier (1.5x) when first university built
     â†’ Cannot read properties of undefined (reading 'enable')
stdout | packages/core/src/systems/__tests__/UniversityResearch.integration.test.ts > University Research Integration > Technology unlock integration > should enable university collaboration multiplier (1.5x) when first university built
[TechnologyUnlock] Enabling Plot & Narrative systems (storytelling unlocked)

 âœ“ packages/core/src/systems/__tests__/MetricsCollection.integration.test.ts  (19 tests) 9ms
 â¯ packages/core/src/magic/__tests__/MagicLawEnforcerIntegration.test.ts  (13 tests | 7 failed) 16ms
   â¯ packages/core/src/magic/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Cost Calculator Integration > should reject spell if caster cannot afford costs
     â†’ expected [ 'Insufficient mana: need 30 more' ] to include StringContaining "Insufficient mana"
   â¯ packages/core/src/magic/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Cost Calculator Integration > should detect law violations
     â†’ expected false to be true // Object.is equality
   â¯ packages/core/src/magic/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Cross-Paradigm Validation > should validate multi-paradigm casters
     â†’ Cannot read properties of undefined (reading 'find')
   â¯ packages/core/src/magic/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Risk Assessment > should assess mishap risks based on proficiency
     â†’ Cannot read properties of undefined (reading 'find')
   â¯ packages/core/src/magic/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Risk Assessment > should assess corruption risks for dark magic
     â†’ expected undefined not to be undefined
   â¯ packages/core/src/magic/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Spell Modification > should calculate bonuses from favorable conditions
     â†’ Cannot read properties of undefined (reading 'find')
   â¯ packages/core/src/magic/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Spell Modification > should calculate penalties from unfavorable conditions
     â†’ Cannot read properties of undefined (reading 'find')
 âœ“ packages/core/src/divinity/__tests__/RaceTemplates.test.ts  (52 tests) 13ms
 âœ“ packages/divinity/src/__tests__/RaceTemplates.test.ts  (52 tests) 12ms
 âœ“ packages/core/src/__tests__/WildAnimalSpawning.test.ts  (19 tests) 11ms
 âœ“ packages/core/src/systems/__tests__/Hunting.integration.test.ts  (5 tests) 5ms
 â¯ packages/magic/src/__tests__/MagicLawEnforcerIntegration.test.ts  (13 tests | 5 failed) 13ms
   â¯ packages/magic/src/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Cost Calculator Integration > should reject spell if caster cannot afford costs
     â†’ expected [ 'Insufficient mana: need 30 more' ] to include StringContaining "Insufficient mana"
   â¯ packages/magic/src/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Cost Calculator Integration > should detect law violations
     â†’ expected false to be true // Object.is equality
   â¯ packages/magic/src/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Risk Assessment > should assess mishap risks based on proficiency
     â†’ expected undefined not to be undefined
   â¯ packages/magic/src/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Risk Assessment > should assess corruption risks for dark magic
     â†’ expected undefined not to be undefined
   â¯ packages/magic/src/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Spell Modification > should calculate bonuses from favorable conditions
     â†’ expected 0 to be greater than 0
 âœ“ packages/core/src/systems/__tests__/MemoryFormationSystem.test.ts  (25 tests) 10ms
 âœ“ packages/core/src/systems/__tests__/Phase9-SoilWeatherIntegration.test.ts  (39 tests) 11ms
 â†“ packages/core/src/__tests__/DominanceChallenge.test.ts  (18 tests | 18 skipped)
 âœ“ packages/core/src/__tests__/SilentFallbackViolations.test.ts  (13 tests) 7ms
 â¯ packages/core/src/__tests__/ComponentFormatUnification.integration.test.ts  (22 tests | 1 failed) 17ms
   â¯ packages/core/src/__tests__/ComponentFormatUnification.integration.test.ts > Component Format Unification - Integration Tests > Error Handling in Systems (CLAUDE.md compliance) > should throw when helper function receives invalid data
     â†’ expected [Function] to throw an error
 âœ“ packages/core/src/components/__tests__/SocialMemoryComponent.test.ts  (22 tests) 8ms
 âœ“ packages/core/src/systems/__tests__/MemoryConsolidationSystem.test.ts  (21 tests) 11ms
 âœ“ packages/renderer/src/__tests__/WindowCollision.integration.test.ts  (11 tests) 7ms
 âœ“ packages/core/src/systems/__tests__/Phase8-WeatherTemperature.test.ts  (19 tests) 12ms
 â¯ packages/metrics-dashboard/src/__tests__/integration/api.test.ts  (0 test)
 âœ“ packages/core/src/uplift/__tests__/UpliftHelpers.test.ts  (39 tests) 8ms
 âœ“ packages/core/src/systems/__tests__/HarvestQuality.integration.test.ts  (11 tests) 13ms
 âœ“ packages/core/src/__tests__/InjurySystem.test.ts  (22 tests | 9 skipped) 7ms
 âœ“ packages/core/src/research/__tests__/UnlockQueryService.test.ts  (40 tests) 10ms
 âœ“ packages/core/src/systems/__tests__/ExplorationSystem.test.ts  (16 tests | 2 skipped) 12ms
 â†“ packages/core/src/__tests__/MemoryLeakFixes.test.ts  (20 tests | 20 skipped)
 âœ“ packages/core/src/systems/__tests__/Injury.integration.test.ts  (8 tests) 5ms
 â¯ packages/renderer/src/panels/magic/__tests__/SkillNodeRenderer.test.ts  (19 tests | 6 failed) 29ms
   â¯ packages/renderer/src/panels/magic/__tests__/SkillNodeRenderer.test.ts > SkillNodeRenderer > Node State Rendering > should render unlocked node with green background
     â†’ expected '#ffffff' to match /green|#0f0|#00ff00/i
   â¯ packages/renderer/src/panels/magic/__tests__/SkillNodeRenderer.test.ts > SkillNodeRenderer > Node State Rendering > should render locked node with gray background
     â†’ expected '#ffffff' to match /gray|#888|#999/i
   â¯ packages/renderer/src/panels/magic/__tests__/SkillNodeRenderer.test.ts > SkillNodeRenderer > Node State Rendering > should add pulsing animation to available nodes
     â†’ expected 1 not to be 1 // Object.is equality
   â¯ packages/renderer/src/panels/magic/__tests__/SkillNodeRenderer.test.ts > SkillNodeRenderer > Node Content > should truncate long node names
     â†’ expected undefined not to be undefined
   â¯ packages/renderer/src/panels/magic/__tests__/SkillNodeRenderer.test.ts > SkillNodeRenderer > Hover State > should highlight node border when hovered
     â†’ '#ffffff' is not a spy or a call to a spy!
   â¯ packages/renderer/src/panels/magic/__tests__/SkillNodeRenderer.test.ts > SkillNodeRenderer > Category-Specific Rendering > should render forbidden nodes with red tint
     â†’ expected '#ffffff' to match /red|#f00|#ff0000/i
 âœ“ packages/core/src/items/__tests__/migration.test.ts  (9 tests) 5ms
 âœ“ packages/core/src/components/__tests__/SpatialMemoryFiltering.integration.test.ts  (6 tests) 6ms
 âœ“ packages/core/src/crafting/__tests__/CraftingSystem.test.ts  (22 tests) 14ms
stderr | packages/core/src/systems/__tests__/ReincarnationSystem.test.ts > ReincarnationSystem > reincarnation timing > should spawn entity after delay expires
[ReincarnationSystem] âš ï¸ Destroying entity test-entity-5 for reincarnation. This should be refactored to preserve soul entity and only create new body.

stderr | packages/core/src/systems/__tests__/ReincarnationSystem.test.ts > ReincarnationSystem > deity tracking > should associate deity with queued soul
[ReincarnationSystem] âš ï¸ Destroying entity test-entity-8 for reincarnation. This should be refactored to preserve soul entity and only create new body.

 âœ“ packages/core/src/systems/__tests__/ReincarnationSystem.test.ts  (12 tests) 13ms
 âœ“ packages/core/src/systems/__tests__/AfterlifeIntegration.test.ts  (11 tests) 7ms
 âœ“ packages/hierarchy-simulator/src/renormalization/__tests__/RenormalizationEngine.test.ts  (31 tests) 9ms
stdout | packages/core/src/systems/__tests__/UniversityFullSystem.end-to-end.test.ts > University Research System - Full E2E > should complete full university research flow with technology unlocks

=== PHASE 1: World Initialization ===
âœ“ Technology unlock system initialized
âœ“ Player city created at (100, 100)
  City ID: player-city-1

=== PHASE 2: Building First University ===
âœ“ University building created: 25460b04-1939-4e37-83a6-d284cb336b92
[TechnologyUnlock] Enabling Plot & Narrative systems (storytelling unlocked)

 â¯ packages/core/src/systems/__tests__/UniversityFullSystem.end-to-end.test.ts  (1 test | 1 failed) 8ms
   â¯ packages/core/src/systems/__tests__/UniversityFullSystem.end-to-end.test.ts > University Research System - Full E2E > should complete full university research flow with technology unlocks
     â†’ Cannot read properties of undefined (reading 'enable')
 â¯ packages/core/src/systems/__tests__/DeityEmergence.integration.test.ts  (9 tests | 9 failed) 8ms
   â¯ packages/core/src/systems/__tests__/DeityEmergence.integration.test.ts > Phase 4: Deity Emergence Integration > Emergence Detection > should detect when enough agents share belief pattern
     â†’ World is not a constructor
   â¯ packages/core/src/systems/__tests__/DeityEmergence.integration.test.ts > Phase 4: Deity Emergence Integration > Emergence Detection > should not emerge with insufficient believers
     â†’ World is not a constructor
   â¯ packages/core/src/systems/__tests__/DeityEmergence.integration.test.ts > Phase 4: Deity Emergence Integration > Emergence Detection > should assign believers to newly emerged deity
     â†’ World is not a constructor
   â¯ packages/core/src/systems/__tests__/DeityEmergence.integration.test.ts > Phase 4: Deity Emergence Integration > AI God Behavior > should answer prayers when deity has enough belief
     â†’ World is not a constructor
   â¯ packages/core/src/systems/__tests__/DeityEmergence.integration.test.ts > Phase 4: Deity Emergence Integration > AI God Behavior > should not act when belief is too low
     â†’ World is not a constructor
   â¯ packages/core/src/systems/__tests__/DeityEmergence.integration.test.ts > Phase 4: Deity Emergence Integration > Deity Relationships > should create hostile relationship when domains overlap
     â†’ World is not a constructor
   â¯ packages/core/src/systems/__tests__/DeityEmergence.integration.test.ts > Phase 4: Deity Emergence Integration > Deity Relationships > should create friendly relationship when domains are synergistic
     â†’ World is not a constructor
   â¯ packages/core/src/systems/__tests__/DeityEmergence.integration.test.ts > Phase 4: Deity Emergence Integration > Deity Relationships > should calculate domain synergy correctly
     â†’ World is not a constructor
   â¯ packages/core/src/systems/__tests__/DeityEmergence.integration.test.ts > Phase 4: Deity Emergence Integration > Complete Emergence Flow > should go from shared beliefs -> emergence -> AI behavior -> relationships
     â†’ World is not a constructor
 â†“ packages/core/src/__tests__/GuardDuty.test.ts  (19 tests | 19 skipped)
 âœ“ packages/core/src/navigation/__tests__/SpeechParser.test.ts  (41 tests) 11ms
 âœ“ packages/core/src/items/__tests__/ItemInstance.test.ts  (14 tests) 4ms
stdout | packages/core/src/systems/__tests__/UniversityPaperPublishing.integration.test.ts > University Paper Publishing Integration > should publish academic papers when research completes

âœ“ Research proposed: "Music and Cultural Expression"
âœ“ Research completed after 1000 ticks

=== Paper Publishing Verification ===
Paper ID: paper_1767698227464_vihid6oi2
Research Complete: false
âœ“ Paper published: "Breakthrough in Music and Cultural Expression Understanding"
  Research ID: university_music_and_cultural_expression
  Field: experimental
  Tier: 2
  Authors: 8e17c82b-533e-486f-96bb-ae67c06e92ce, 891e41aa-069c-4899-a824-4757825bc497, 7aba3157-ca19-4cd0-a751-34dc7e1de7ca
âœ“ First author tracked: 8e17c82b-533e-486f-96bb-ae67c06e92ce (1 papers)
âœ“ Research registered: "Music and Cultural Expression" (tier 2)

=== Integration Test Complete ===
âœ“ University research completes
âœ“ Academic paper published
âœ“ Authors tracked with metrics
âœ“ Research registered in ResearchRegistry
âœ“ Events emitted with correct data

stdout | packages/core/src/systems/__tests__/UniversityPaperPublishing.integration.test.ts > University Paper Publishing Integration > should track multiple papers for the same research

=== Multiple Papers Test ===
Research: university_advanced_agriculture_techniques
Papers published: 3
Papers required: 3
Research complete: true
âœ“ Multiple papers tracked correctly

 âœ“ packages/core/src/systems/__tests__/UniversityPaperPublishing.integration.test.ts  (2 tests) 10ms
 âœ“ packages/core/src/systems/__tests__/TimeWeatherTemperature.integration.test.ts  (7 tests) 7ms
 âœ“ packages/core/src/systems/__tests__/AnimalComplete.integration.test.ts  (10 tests) 7ms
 âœ“ packages/core/src/behavior/animal-behaviors/__tests__/AnimalBehavior.test.ts  (31 tests) 10ms
 âœ“ packages/core/src/__tests__/PredatorAttackSystem.test.ts  (7 tests) 7ms
 âœ“ packages/core/src/buildings/__tests__/BuildingPlacement.integration.test.ts  (14 tests) 13ms
 âœ“ packages/renderer/src/__tests__/RemoteUniverseView.test.ts  (25 tests) 88ms
 âœ“ packages/core/src/components/__tests__/UniversityComponent.test.ts  (17 tests) 6ms
 â¯ packages/core/src/systems/__tests__/AgentCombat.integration.test.ts  (4 tests | 4 failed) 9ms
   â¯ packages/core/src/systems/__tests__/AgentCombat.integration.test.ts > AgentCombatSystem Integration > should resolve agent vs agent combat with skill-based outcome
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/systems/__tests__/AgentCombat.integration.test.ts > AgentCombatSystem Integration > should apply injuries when combat causes damage
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/systems/__tests__/AgentCombat.integration.test.ts > AgentCombatSystem Integration > should emit combat events through EventBus
     â†’ Cannot read properties of undefined (reading 'combatSkill')
   â¯ packages/core/src/systems/__tests__/AgentCombat.integration.test.ts > AgentCombatSystem Integration > should update relationships after combat
     â†’ Cannot read properties of undefined (reading 'combatSkill')
 âœ“ packages/core/src/systems/__tests__/BuildingConstruction.integration.test.ts  (9 tests) 7ms
 â¯ packages/core/src/__tests__/MagicalSkillBonuses.test.ts  (5 tests | 5 failed) 6ms
   â¯ packages/core/src/__tests__/MagicalSkillBonuses.test.ts > MagicalSkillBonuses > single magical item provides skill bonus
     â†’ World is not a constructor
   â¯ packages/core/src/__tests__/MagicalSkillBonuses.test.ts > MagicalSkillBonuses > multiple items stack their bonuses
     â†’ World is not a constructor
   â¯ packages/core/src/__tests__/MagicalSkillBonuses.test.ts > MagicalSkillBonuses > negative bonuses (curses) work correctly
     â†’ World is not a constructor
   â¯ packages/core/src/__tests__/MagicalSkillBonuses.test.ts > MagicalSkillBonuses > bonuses are cleared when equipment is removed
     â†’ World is not a constructor
   â¯ packages/core/src/__tests__/MagicalSkillBonuses.test.ts > MagicalSkillBonuses > complex stacking with positive and negative bonuses
     â†’ World is not a constructor
 âœ“ packages/core/src/actions/__tests__/ActionQueueSpeedMultiplier.test.ts  (7 tests) 7ms
 âœ“ packages/core/src/systems/__tests__/IdleBehaviorSystem.integration.test.ts  (7 tests) 5ms
 âœ“ packages/core/src/systems/__tests__/TradingQuality.integration.test.ts  (8 tests) 8ms
 âœ“ packages/core/src/systems/__tests__/AnimalHusbandryCycle.integration.test.ts  (12 tests) 11ms
 âœ“ packages/divinity/src/__tests__/RiddleGenerator.test.ts  (15 tests | 2 skipped) 8ms
 âœ“ packages/core/src/systems/__tests__/NeedsSleepHealth.integration.test.ts  (7 tests) 7ms
 âœ“ packages/core/src/divinity/__tests__/RiddleGenerator.test.ts  (15 tests | 2 skipped) 9ms
 âœ“ packages/renderer/src/__tests__/WindowManager.test.ts  (21 tests) 10ms
 âœ“ packages/core/src/actions/__tests__/ActionQueueTimeSpeed.integration.test.ts  (11 tests) 7ms
stderr | packages/core/src/systems/__tests__/DeathBargainSystem.test.ts > DeathBargainSystem > offerDeathBargain > should create death bargain component
[DeathBargainSystem] Thanatos manifested at (100, 200)

stderr | packages/core/src/systems/__tests__/DeathBargainSystem.test.ts > DeathBargainSystem > offerDeathBargain > should emit death:bargain_offered event
[DeathBargainSystem] Catrina manifested at (0, 0)

stderr | packages/core/src/systems/__tests__/DeathBargainSystem.test.ts > DeathBargainSystem > Core functionality smoke test > should handle full death bargain flow
[DeathBargainSystem] Valraven manifested at (100, 200)

 â†“ packages/core/src/__tests__/DeathHandling.test.ts  (17 tests | 17 skipped)
 â¯ packages/core/src/systems/__tests__/DeathBargainSystem.test.ts  (10 tests | 5 failed) 14ms
   â¯ packages/core/src/systems/__tests__/DeathBargainSystem.test.ts > DeathBargainSystem > offerDeathBargain > should create death bargain component
     â†’ expected undefined not to be undefined
   â¯ packages/core/src/systems/__tests__/DeathBargainSystem.test.ts > DeathBargainSystem > offerDeathBargain > should emit death:bargain_offered event
     â†’ expected 0 to be greater than 0
   â¯ packages/core/src/systems/__tests__/DeathBargainSystem.test.ts > DeathBargainSystem > Sphinx Riddle - Direct Component Manipulation > should reject wrong answer and allow retry
     â†’ expected 'a dog' to be undefined
   â¯ packages/core/src/systems/__tests__/DeathBargainSystem.test.ts > DeathBargainSystem > Sphinx Riddle - Direct Component Manipulation > should fail after max attempts
     â†’ expected 'in_progress' to be 'failed' // Object.is equality
   â¯ packages/core/src/systems/__tests__/DeathBargainSystem.test.ts > DeathBargainSystem > Core functionality smoke test > should handle full death bargain flow
     â†’ Cannot read properties of undefined (reading 'status')
 âœ“ packages/core/src/systems/__tests__/MemoryComplete.integration.test.ts  (10 tests) 7ms
 âœ“ packages/core/src/systems/__tests__/Performance.integration.test.ts  (10 tests) 13ms
 âœ“ packages/core/src/__tests__/IdleBehaviorSystem.test.ts  (11 tests) 8ms
 â¯ packages/core/src/systems/__tests__/CraftingQuality.integration.test.ts  (4 tests | 1 failed) 11ms
   â¯ packages/core/src/systems/__tests__/CraftingQuality.integration.test.ts > CraftingSystem Quality Integration > should include task familiarity bonus in quality over repeated crafts
     â†’ Cannot add crafted wheat_bread to inventory: Inventory full. Cannot add legendary wheat_bread.
 â¯ packages/metrics-dashboard/src/__tests__/utils/dataTransformers.test.ts  (0 test)
 â¯ packages/core/src/systems/__tests__/SteeringSystem.test.ts  (13 tests | 2 failed) 27ms
   â¯ packages/core/src/systems/__tests__/SteeringSystem.test.ts > SteeringSystem > AC2: Navigation Reaches Targets > should avoid obstacles using ray-casting
     â†’ SteeringSystem failed for entity f78e658f-8595-42f8-a6f8-8695ec0af961: Error: Steering component missing
   â¯ packages/core/src/systems/__tests__/SteeringSystem.test.ts > SteeringSystem > combined behaviors > should blend seek and obstacle avoidance
     â†’ SteeringSystem failed for entity 962e937f-5df7-4c01-ad06-5cad74e9a03e: Error: Steering component missing
 â¯ packages/core/src/systems/__tests__/MovementSteering.integration.test.ts  (7 tests | 2 failed) 12ms
   â¯ packages/core/src/systems/__tests__/MovementSteering.integration.test.ts > MovementSystem + SteeringSystem Integration > should handle obstacle avoidance with buildings
     â†’ Cannot read properties of undefined (reading 'velocityX')
   â¯ packages/core/src/systems/__tests__/MovementSteering.integration.test.ts > MovementSystem + SteeringSystem Integration > should combined steering behavior use obstacle avoidance
     â†’ SteeringSystem failed for entity 752227e6-512f-4741-ac37-205d989db599: Error: Steering component missing
 âœ“ packages/core/src/systems/__tests__/TamingComplete.integration.test.ts  (9 tests) 8ms
 âœ“ packages/core/src/buildings/__tests__/BuildingBlueprintRegistry.test.ts  (16 tests) 8ms
 â¯ packages/core/src/navigation/__tests__/MapKnowledge.test.ts  (26 tests | 5 failed) 16ms
   â¯ packages/core/src/navigation/__tests__/MapKnowledge.test.ts > MapKnowledge > worn paths (traffic tracking) > records traversal between sectors
     â†’ expected 0.5 to be 1 // Object.is equality
   â¯ packages/core/src/navigation/__tests__/MapKnowledge.test.ts > MapKnowledge > worn paths (traffic tracking) > accumulates traffic on repeated traversals
     â†’ expected 1 to be 5 // Object.is equality
   â¯ packages/core/src/navigation/__tests__/MapKnowledge.test.ts > MapKnowledge > worn paths (traffic tracking) > records bidirectional traffic
     â†’ expected 0.5 to be 1 // Object.is equality
   â¯ packages/core/src/navigation/__tests__/MapKnowledge.test.ts > MapKnowledge > decay > removes very low traffic
     â†’ expected 0.18384771238548175 to be undefined
   â¯ packages/core/src/navigation/__tests__/MapKnowledge.test.ts > MapKnowledge > serialization > serializes and deserializes correctly
     â†’ expected 0.5 to be 1 // Object.is equality
 âœ“ packages/core/src/systems/__tests__/AnimalHousing.integration.test.ts  (9 tests) 9ms
 â¯ packages/core/src/decision/__tests__/Decision.integration.test.ts  (8 tests | 1 failed) 11ms
   â¯ packages/core/src/decision/__tests__/Decision.integration.test.ts > Decision Integration Tests > AutonomicSystem with Entity > prioritizes sleep over food when energy is critical
     â†’ expected 'seek_food' to be 'seek_sleep' // Object.is equality
 âœ“ packages/core/src/systems/__tests__/GameDayCycle.integration.test.ts  (11 tests | 2 skipped) 7ms
 âœ“ packages/core/src/systems/__tests__/PowerGridSystem.integration.test.ts  (8 tests) 6ms
 âœ“ packages/renderer/src/__tests__/ResearchLibraryPanel.test.ts  (15 tests) 8ms
 â¯ packages/metrics-dashboard/src/__tests__/components/TimeSeriesView.test.tsx  (0 test)
 âœ“ packages/core/src/__tests__/EventBusPropagation.integration.test.ts  (9 tests) 8ms
 âœ“ packages/llm/src/__tests__/OllamaProvider.test.ts  (14 tests) 16ms
stderr | packages/llm/src/__tests__/OllamaProvider.test.ts > OllamaProvider > Tool Definition > should define tools with appropriate parameters
[OllamaProvider] Empty response from Ollama: { message: { content: '', tool_calls: [] } }

stderr | packages/llm/src/__tests__/OllamaProvider.test.ts > OllamaProvider > API Configuration > should use /api/chat endpoint
[OllamaProvider] Empty response from Ollama: { message: { content: '', tool_calls: [] } }

stderr | packages/llm/src/__tests__/OllamaProvider.test.ts > OllamaProvider > API Configuration > should send correct request format
[OllamaProvider] Empty response from Ollama: { message: { content: '', tool_calls: [] } }

stderr | packages/llm/src/__tests__/OllamaProvider.test.ts > OllamaProvider > API Configuration > should use default values when not specified
[OllamaProvider] Empty response from Ollama: { message: { content: '', tool_calls: [] } }

stderr | packages/llm/src/__tests__/OllamaProvider.test.ts > OllamaProvider > Error Handling > should throw on HTTP error
[OllamaProvider] Ollama generate error: Error: Ollama API error: 500 Internal Server Error
    at OllamaProvider.generate (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/OllamaProvider.ts:259:15)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/OllamaProvider.test.ts:269:7
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:11)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runFiles (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:958:5)
    at startTests (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:967:3)
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7
    at withEnv (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:83:5)
[OllamaProvider] Error details: {
  message: 'Ollama API error: 500 Internal Server Error',
  model: 'qwen3:4b',
  url: 'http://localhost:11434/api/generate'
}

stderr | packages/llm/src/__tests__/OllamaProvider.test.ts > OllamaProvider > Error Handling > should throw on network error
[OllamaProvider] Ollama generate error: Error: Network error
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/OllamaProvider.test.ts:274:51
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runFiles (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:958:5)
    at startTests (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:967:3)
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7
[OllamaProvider] Error details: {
  message: 'Network error',
  model: 'qwen3:4b',
  url: 'http://localhost:11434/api/generate'
}

 âœ“ packages/core/src/systems/__tests__/TimeSpeedControls.test.ts  (20 tests) 6ms
 â¯ packages/metrics-dashboard/src/__tests__/integration/websocket.test.ts  (0 test)
 âœ“ packages/core/src/__tests__/GoalGeneration.test.ts  (15 tests) 12ms
 â¯ packages/renderer/src/__tests__/DevPanel.test.ts  (330 tests | 8 failed) 51ms
   â¯ packages/renderer/src/__tests__/DevPanel.test.ts > DevPanel Divine Resource Generation > Power Tier Thresholds > should have all power tiers defined
     â†’ Cannot read properties of undefined (reading 'dormant')
   â¯ packages/renderer/src/__tests__/DevPanel.test.ts > DevPanel Divine Resource Generation > Power Tier Thresholds > should have ascending thresholds
     â†’ Cannot read properties of undefined (reading 'dormant')
   â¯ packages/renderer/src/__tests__/DevPanel.test.ts > DevPanel Divine Resource Generation > Power Tier Thresholds > should have dormant at 0
     â†’ Cannot read properties of undefined (reading 'dormant')
   â¯ packages/renderer/src/__tests__/DevPanel.test.ts > DevPanel Divine Resource Generation > Power Tier Thresholds > should have world_shaping at 5000+
     â†’ Cannot read properties of undefined (reading 'world_shaping')
   â¯ packages/renderer/src/__tests__/DevPanel.test.ts > DevPanel Divine Resource Generation > Belief Generation Rates > should have all belief activities defined
     â†’ Cannot read properties of undefined (reading 'passive_faith')
   â¯ packages/renderer/src/__tests__/DevPanel.test.ts > DevPanel Divine Resource Generation > Belief Generation Rates > should have ascending rates from passive to miracle
     â†’ Cannot read properties of undefined (reading 'passive_faith')
   â¯ packages/renderer/src/__tests__/DevPanel.test.ts > DevPanel Divine Resource Generation > Belief Generation Rates > should have miracle_witness as highest rate
     â†’ Cannot convert undefined or null to object
   â¯ packages/renderer/src/__tests__/DevPanel.test.ts > DevPanel Divine Resource Generation > Belief Generation Rates > should have passive_faith as lowest rate
     â†’ Cannot convert undefined or null to object
stderr | packages/core/src/systems/__tests__/FarmingComplete.integration.test.ts > SoilSystem + PlantSystem + WeatherSystem Integration > should tilling require grass or dirt terrain
[SoilSystem] âŒ ERROR: Cannot till water terrain at (10,10). Only grass and dirt can be tilled.

stderr | packages/core/src/systems/__tests__/FarmingComplete.integration.test.ts > SoilSystem + PlantSystem + WeatherSystem Integration > should prevent re-tilling already tilled soil with plantability remaining
[SoilSystem] âŒ ERROR: Tile at (10,10) is already tilled. Plantability: 2/3 uses remaining. Wait until depleted to re-till.

stderr | packages/core/src/systems/__tests__/FarmingComplete.integration.test.ts > SoilSystem + PlantSystem + WeatherSystem Integration > should require biome data for tilling
[SoilSystem] âŒ CRITICAL ERROR: Tile at (10,10) has no biome data. Terrain generation failed or chunk not generated. Cannot determine fertility for farming.
[SoilSystem] Tile state: {
  "terrain": "grass",
  "moisture": 50,
  "fertility": 80,
  "tilled": false,
  "plantability": 0,
  "nutrients": {
    "nitrogen": 50,
    "phosphorus": 50,
    "potassium": 50
  },
  "fertilized": false,
  "fertilizerDuration": 0,
  "lastWatered": 0,
  "lastTilled": 0,
  "composted": false
}

 âœ“ packages/core/src/systems/__tests__/FarmingComplete.integration.test.ts  (13 tests) 7ms
 âœ“ packages/core/src/navigation/__tests__/HearsayMemory.test.ts  (25 tests) 6ms
 â¯ packages/core/src/decision/__tests__/Decision.test.ts  (36 tests | 1 failed) 11ms
   â¯ packages/core/src/decision/__tests__/Decision.test.ts > AutonomicSystem > checkNeeds > returns seek_sleep when energy is below 0.3 (30%)
     â†’ expected null not to be null
 âœ“ packages/core/src/crafting/__tests__/RecipeRegistry.test.ts  (15 tests) 9ms
 âœ“ packages/core/src/systems/__tests__/UniversityNPCResearch.integration.test.ts  (2 tests) 8ms
stdout | packages/core/src/systems/__tests__/UniversityNPCResearch.integration.test.ts > University NPC Research Integration > should autonomously propose research in an NPC city with a university
âœ“ Created NPC city: Test NPC City
âœ“ University building created: University
âœ“ Created 5 agents in the city

=== Running Systems ===
Initial research projects: 0

=== Verification ===
âœ“ Research projects created: 1
  Title: Astronomy and Timekeeping
  Status: active
  PI: 671a8aab-d3c3-450f-b9ef-662d33b4055f
  Researchers: c95881e6-ab25-434c-9cb2-43a92246658a, 42f863b5-136e-413b-a016-230a299aa040
âœ“ Research started event emitted
âœ“ All researchers are from the city

=== Testing Research Progress ===
Progress after 100 ticks: 10.00%
âœ“ Research is progressing

=== Testing Research Capacity ===
Active projects after second proposal: 2
Active projects after third proposal: 3
âœ“ Respects max concurrent projects limit (3)

=== NPC Research System Test Complete ===
âœ“ NPC cities can autonomously produce research
âœ“ Researchers are selected from city agents
âœ“ Research progresses over time
âœ“ Capacity limits are enforced

stdout | packages/core/src/systems/__tests__/UniversityNPCResearch.integration.test.ts > University NPC Research Integration > should not propose research if no agents available in city
âœ“ No research proposed when no agents available

 âœ“ packages/core/src/behavior/animal-behaviors/__tests__/AnimalBehavior.integration.test.ts  (10 tests) 10ms
 âœ“ packages/magic/src/__tests__/ParadigmComposition.test.ts  (37 tests) 8ms
 âœ“ packages/core/src/magic/__tests__/ParadigmComposition.test.ts  (37 tests) 8ms
stderr | ComponentRegistry.register (/Users/annhoward/src/ai_village/custom_game_engine/packages/introspection/src/registry/ComponentRegistry.ts:45:15)
[ComponentRegistry] Schema 'interests' is already registered. Overwriting.

 â¯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts  (15 tests | 8 failed) 15ms
   â¯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > buildPrompt > should describe energy levels correctly
     â†’ expected 'you are testagent, a villager in thisâ€¦' to contain 'exhaust'
   â¯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > hearing system integration > should show agents present even if silent
     â†’ expected 'You are TestAgent, a villager in thisâ€¦' to contain 'You see nearby:'
   â¯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > context collapse > should show memories when present
     â†’ expected 'You are TestAgent, a villager in thisâ€¦' to contain 'Recent Memories:'
   â¯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > instruction clarity > should include "don't overthink" instruction
     â†’ expected 'You are TestAgent, a villager in thisâ€¦' to contain 'Don\'t overthink'
   â¯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > instruction clarity > should end with response prompt
     â†’ expected 'You are TestAgent, a villager in thisâ€¦' to match /Your response \(JSON only\):\s*$/
   â¯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > resource type descriptions > should describe trees when wood resources are visible
     â†’ expected 'You are TestAgent, a villager in thisâ€¦' to contain '2 trees'
   â¯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > resource type descriptions > should describe rocks when stone resources are visible
     â†’ expected 'You are TestAgent, a villager in thisâ€¦' to contain '1 rock'
   â¯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > resource type descriptions > should describe mixed resources correctly
     â†’ expected 'You are TestAgent, a villager in thisâ€¦' to contain '1 tree'
 âœ“ packages/core/src/parsers/__tests__/GradientParser.test.ts  (31 tests) 8ms
 â¯ packages/metrics-dashboard/src/__tests__/components/CulturalDiffusionView.test.tsx  (0 test)
 âœ“ packages/core/src/systems/__tests__/DurabilityIntegration.test.ts  (9 tests | 1 skipped) 7ms
 â¯ packages/core/src/components/__tests__/BuildingComponent.test.ts  (35 tests | 10 failed) 14ms
   â¯ packages/core/src/components/__tests__/BuildingComponent.test.ts > BuildingComponent - Phase 8 Breaking Changes > Acceptance Criterion 10: Building Heat Properties > should HAVE insulation field for buildings after Phase 8
     â†’ expected +0 to be 0.3 // Object.is equality
   â¯ packages/core/src/components/__tests__/BuildingComponent.test.ts > BuildingComponent - Phase 8 Breaking Changes > Acceptance Criterion 10: Building Heat Properties > should HAVE baseTemperature field for buildings after Phase 8
     â†’ expected +0 to be 5 // Object.is equality
   â¯ packages/core/src/components/__tests__/BuildingComponent.test.ts > BuildingComponent - Phase 8 Breaking Changes > Acceptance Criterion 10: Building Heat Properties > should HAVE weatherProtection field for buildings after Phase 8
     â†’ expected +0 to be 0.5 // Object.is equality
   â¯ packages/core/src/components/__tests__/BuildingComponent.test.ts > BuildingComponent - Phase 8 Breaking Changes > Acceptance Criterion 10: Building Heat Properties > should HAVE interior field for buildings after Phase 8
     â†’ expected false to be true // Object.is equality
   â¯ packages/core/src/components/__tests__/BuildingComponent.test.ts > BuildingComponent - Phase 8 Breaking Changes > Acceptance Criterion 10: Building Heat Properties > should HAVE interiorRadius field for interior buildings after Phase 8
     â†’ expected +0 to be 2 // Object.is equality
   â¯ packages/core/src/components/__tests__/BuildingComponent.test.ts > BuildingComponent - Phase 8 Breaking Changes > lean-to building type > should set insulation=0.3 for lean-to
     â†’ expected +0 to be 0.3 // Object.is equality
   â¯ packages/core/src/components/__tests__/BuildingComponent.test.ts > BuildingComponent - Phase 8 Breaking Changes > lean-to building type > should set baseTemperature=5 for lean-to
     â†’ expected +0 to be 5 // Object.is equality
   â¯ packages/core/src/components/__tests__/BuildingComponent.test.ts > BuildingComponent - Phase 8 Breaking Changes > lean-to building type > should set weatherProtection=0.5 for lean-to
     â†’ expected +0 to be 0.5 // Object.is equality
   â¯ packages/core/src/components/__tests__/BuildingComponent.test.ts > BuildingComponent - Phase 8 Breaking Changes > lean-to building type > should set interior=true for lean-to
     â†’ expected false to be true // Object.is equality
   â¯ packages/core/src/components/__tests__/BuildingComponent.test.ts > BuildingComponent - Phase 8 Breaking Changes > tent building type > should have temperature properties for tent
     â†’ expected 0 to be greater than 0.3
 âœ“ packages/core/src/systems/__tests__/QualityStacking.test.ts  (15 tests) 12ms
 âœ“ packages/core/src/vr/__tests__/VRSystem.integration.test.ts  (14 tests) 8ms
 âœ“ packages/metrics/src/__tests__/RingBuffer.test.ts  (36 tests) 9ms
 â¯ packages/core/src/__tests__/HeroProtection.test.ts  (7 tests | 7 failed) 7ms
   â¯ packages/core/src/__tests__/HeroProtection.test.ts > HeroProtection > blessed hero gets positive luck modifier
     â†’ World is not a constructor
   â¯ packages/core/src/__tests__/HeroProtection.test.ts > HeroProtection > cursed hero gets negative luck modifier (anti-luck)
     â†’ World is not a constructor
   â¯ packages/core/src/__tests__/HeroProtection.test.ts > HeroProtection > neutral hero gets zero luck modifier
     â†’ World is not a constructor
   â¯ packages/core/src/__tests__/HeroProtection.test.ts > HeroProtection > agent without destiny gets no luck
     â†’ World is not a constructor
   â¯ packages/core/src/__tests__/HeroProtection.test.ts > HeroProtection > realized destiny provides no luck
     â†’ World is not a constructor
   â¯ packages/core/src/__tests__/HeroProtection.test.ts > HeroProtection > luck modifiers affect combat win rates
     â†’ World is not a constructor
   â¯ packages/core/src/__tests__/HeroProtection.test.ts > HeroProtection > cursed hero loses more often due to anti-luck
     â†’ World is not a constructor
 âœ“ packages/core/src/metrics/__tests__/RingBuffer.test.ts  (36 tests) 8ms
 âœ“ packages/core/src/systems/__tests__/SoilSystem.test.ts  (27 tests) 10ms
 âœ“ packages/core/src/systems/__tests__/FarmingCycle.integration.test.ts  (12 tests) 5ms
 â†“ packages/renderer/src/__tests__/CombatHUDPanel.test.ts  (18 tests | 18 skipped)
 âœ“ packages/core/src/components/__tests__/SemanticMemoryComponent.test.ts  (18 tests) 9ms
 âœ“ packages/core/src/__tests__/HuntingSystem.test.ts  (12 tests) 13ms
 âœ“ packages/core/src/systems/__tests__/FertilizerAction.test.ts  (26 tests) 10ms
 âœ“ packages/core/src/systems/__tests__/CraftingComplete.integration.test.ts  (10 tests) 9ms
 â¯ packages/core/src/help/__tests__/HelpSystem.demo.test.ts  (5 tests | 1 failed) 11ms
   â¯ packages/core/src/help/__tests__/HelpSystem.demo.test.ts > Help System Demo > demonstrates search capabilities
     â†’ expected [ { id: 'sword', â€¦(5) }, â€¦(1) ] to have a length of 1 but got 2
stderr | ComponentRegistry.register (/Users/annhoward/src/ai_village/custom_game_engine/packages/introspection/src/registry/ComponentRegistry.ts:45:15)
[ComponentRegistry] Schema 'interests' is already registered. Overwriting.

 âœ“ packages/llm/src/__tests__/GoalPromptIntegration.test.ts  (11 tests) 7ms
 âœ“ packages/core/src/systems/__tests__/SaveLoad.integration.test.ts  (16 tests) 7ms
 âœ“ packages/llm/src/__tests__/MemoryBuilder.test.ts  (8 tests) 7ms
 âœ“ packages/llm/src/__tests__/ResponseParser.test.ts  (23 tests) 7ms
 âœ“ packages/core/src/components/__tests__/BeliefComponent.test.ts  (17 tests) 7ms
 â†“ packages/core/src/__tests__/CombatNarration.test.ts  (14 tests | 14 skipped)
 âœ“ packages/core/src/components/__tests__/SocialGradientComponent.test.ts  (17 tests) 7ms
stdout | packages/core/src/persistence/__tests__/WorldSerializer.terrain.test.ts > WorldSerializer terrain integration > should serialize terrain when ChunkManager is present
[ChunkSerializer] Serializing 3 generated chunks (3 total loaded)
[ChunkSerializer] Terrain snapshot created

stdout | packages/core/src/persistence/__tests__/WorldSerializer.terrain.test.ts > WorldSerializer terrain integration > should restore terrain through full save/load cycle
[ChunkSerializer] Serializing 5 generated chunks (5 total loaded)
[ChunkSerializer] Terrain snapshot created
[ChunkSerializer] Deserializing 5 chunks
[ChunkSerializer] Loaded 5 chunks

stdout | packages/core/src/persistence/__tests__/WorldSerializer.terrain.test.ts > WorldSerializer terrain integration > should preserve all tile properties through save/load
[ChunkSerializer] Serializing 1 generated chunks (1 total loaded)
[ChunkSerializer] Terrain snapshot created
[ChunkSerializer] Deserializing 1 chunks
[ChunkSerializer] Loaded 1 chunks

stdout | packages/core/src/persistence/__tests__/WorldSerializer.terrain.test.ts > WorldSerializer terrain integration > should preserve chunk count and indices
[ChunkSerializer] Serializing 7 generated chunks (7 total loaded)
[ChunkSerializer] Terrain snapshot created

stdout | packages/core/src/persistence/__tests__/WorldSerializer.terrain.test.ts > WorldSerializer terrain integration > should handle empty ChunkManager gracefully
[ChunkSerializer] Serializing 0 generated chunks (0 total loaded)
[ChunkSerializer] Terrain snapshot created

stdout | packages/core/src/persistence/__tests__/WorldSerializer.terrain.test.ts > WorldSerializer terrain integration > should not interfere with entity serialization
[ChunkSerializer] Serializing 2 generated chunks (2 total loaded)
[ChunkSerializer] Terrain snapshot created

stdout | packages/core/src/persistence/__tests__/WorldSerializer.terrain.test.ts > WorldSerializer terrain integration > should include terrain checksums in snapshot
[ChunkSerializer] Serializing 3 generated chunks (3 total loaded)
[ChunkSerializer] Terrain snapshot created

 âœ“ packages/core/src/persistence/__tests__/WorldSerializer.terrain.test.ts  (8 tests) 605ms
 âœ“ packages/persistence/src/__tests__/WorldSerializer.terrain.test.ts  (8 tests) 585ms
stdout | packages/persistence/src/__tests__/WorldSerializer.terrain.test.ts > WorldSerializer terrain integration > should serialize terrain when ChunkManager is present
[ChunkSerializer] Serializing 3 generated chunks (3 total loaded)
[ChunkSerializer] Terrain snapshot created

stdout | packages/persistence/src/__tests__/WorldSerializer.terrain.test.ts > WorldSerializer terrain integration > should restore terrain through full save/load cycle
[ChunkSerializer] Serializing 5 generated chunks (5 total loaded)
[ChunkSerializer] Terrain snapshot created
[ChunkSerializer] Deserializing 5 chunks
[ChunkSerializer] Loaded 5 chunks

stdout | packages/persistence/src/__tests__/WorldSerializer.terrain.test.ts > WorldSerializer terrain integration > should preserve all tile properties through save/load
[ChunkSerializer] Serializing 1 generated chunks (1 total loaded)
[ChunkSerializer] Terrain snapshot created
[ChunkSerializer] Deserializing 1 chunks
[ChunkSerializer] Loaded 1 chunks

stdout | packages/persistence/src/__tests__/WorldSerializer.terrain.test.ts > WorldSerializer terrain integration > should preserve chunk count and indices
[ChunkSerializer] Serializing 7 generated chunks (7 total loaded)
[ChunkSerializer] Terrain snapshot created

stdout | packages/persistence/src/__tests__/WorldSerializer.terrain.test.ts > WorldSerializer terrain integration > should handle empty ChunkManager gracefully
[ChunkSerializer] Serializing 0 generated chunks (0 total loaded)
[ChunkSerializer] Terrain snapshot created

stdout | packages/persistence/src/__tests__/WorldSerializer.terrain.test.ts > WorldSerializer terrain integration > should not interfere with entity serialization
[ChunkSerializer] Serializing 2 generated chunks (2 total loaded)
[ChunkSerializer] Terrain snapshot created

stdout | packages/persistence/src/__tests__/WorldSerializer.terrain.test.ts > WorldSerializer terrain integration > should include terrain checksums in snapshot
[ChunkSerializer] Serializing 3 generated chunks (3 total loaded)
[ChunkSerializer] Terrain snapshot created

 âœ“ packages/core/src/__tests__/AnimalComponent.test.ts  (8 tests) 9ms
 âœ“ packages/core/src/items/__tests__/ItemTraits.test.ts  (18 tests) 6ms
 â¯ packages/core/src/systems/__tests__/AgentBrainSystem.test.ts  (12 tests | 2 failed) 16ms
   â¯ packages/core/src/systems/__tests__/AgentBrainSystem.test.ts > AgentBrainSystem > autonomic override > switches to seek_sleep when energy is critical
     â†’ expected 'wander' to be 'seek_sleep' // Object.is equality
   â¯ packages/core/src/systems/__tests__/AgentBrainSystem.test.ts > AgentBrainSystem > behavior queue > emits queue:interrupted when autonomic overrides
     â†’ expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ]

Received: 



Number of calls: 0

 âœ“ packages/core/src/__tests__/GoalsComponent.test.ts  (17 tests) 8ms
 âœ“ packages/core/src/components/__tests__/ExplorationStateComponent.test.ts  (23 tests) 7ms
 â†“ packages/core/src/__tests__/PredatorAttack.test.ts  (14 tests | 14 skipped)
 âœ“ packages/core/src/systems/__tests__/QualityEconomy.integration.test.ts  (22 tests) 6ms
stdout | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > constructor > should initialize with correct providers
[ProviderPoolManager] Initialized with 2 providers: groq, cerebras

stdout | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > execute > should execute request on primary provider
[ProviderPoolManager] Initialized with 2 providers: groq, cerebras

stdout | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > execute > should throw error for unknown provider
[ProviderPoolManager] Initialized with 2 providers: groq, cerebras

stdout | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > fallback chain > should fallback to cerebras on groq rate limit
[ProviderPoolManager] Initialized with 2 providers: groq, cerebras
[ProviderQueue:groq] Rate limited until 2026-01-06T11:17:17.568Z (1000ms)
[ProviderQueue:groq] Re-queued request for agent agent1 (retry 1)
[ProviderQueue:groq] Rate limited, waiting 1000ms

stderr | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > fallback chain > should fallback to cerebras on groq rate limit
[ProviderQueue:groq] Rate limit detected for agent agent1

 â¯ packages/metrics-dashboard/src/__tests__/components/InequalityView.test.tsx  (0 test)
 âœ“ packages/magic/src/__tests__/ArtifactCreation.test.ts  (80 tests) 11ms
 âœ“ packages/core/src/magic/__tests__/ArtifactCreation.test.ts  (80 tests) 11ms
 âœ“ packages/renderer/src/__tests__/IngredientPanel.test.ts  (4 tests) 7ms
 â¯ packages/metrics-dashboard/src/__tests__/utils/apiClient.test.ts  (0 test)
 â¯ packages/metrics-dashboard/src/__tests__/components/NetworkView.test.tsx  (0 test)
 âœ“ packages/renderer/src/__tests__/GhostPreview.test.ts  (19 tests) 11ms
 â¯ packages/metrics-dashboard/src/__tests__/components/SpatialView.test.tsx  (0 test)
stdout | packages/llm/src/__tests__/ProviderQueue.test.ts > ProviderQueue > rate limit detection > should detect 429 status code
[ProviderQueue:test-provider] Rate limited until 2026-01-06T11:17:18.053Z (1000ms)
[ProviderQueue:test-provider] Re-queued request for agent agent1 (retry 1)
[ProviderQueue:test-provider] Rate limited, waiting 999ms

stderr | packages/llm/src/__tests__/ProviderQueue.test.ts > ProviderQueue > rate limit detection > should detect 429 status code
[ProviderQueue:test-provider] Rate limit detected for agent agent1

 âœ“ packages/magic/src/__tests__/CoreParadigms.test.ts  (77 tests) 17ms
stderr | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > fallback chain > should fallback to cerebras on groq rate limit
<empty line>
stdout | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > fallback chain > should fallback to cerebras on groq rate limit
[ProviderQueue:groq] Rate limit expired, resuming

stdout | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > fallback chain > should not fallback on non-rate-limit errors
[ProviderPoolManager] Initialized with 2 providers: groq, cerebras

stdout | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > fallback chain > should skip rate-limited fallback providers
[ProviderPoolManager] Initialized with 2 providers: groq, cerebras
[ProviderQueue:groq] Rate limited until 2026-01-06T11:17:18.574Z (1000ms)
[ProviderQueue:groq] Re-queued request for agent agent1 (retry 1)
[ProviderQueue:groq] Rate limited, waiting 1000ms

stderr | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > fallback chain > should skip rate-limited fallback providers
[ProviderQueue:groq] Rate limit detected for agent agent1

 âœ“ packages/core/src/behavior/behaviors/__tests__/TradeBehavior.test.ts  (9 tests) 4ms
 âœ“ packages/core/src/items/__tests__/ItemQuality.test.ts  (28 tests) 7ms
 âœ“ packages/core/src/magic/__tests__/CoreParadigms.test.ts  (77 tests) 14ms
 â¯ packages/core/src/__tests__/PlantSeedProduction.test.ts  (3 tests | 3 failed) 9ms
   â¯ packages/core/src/__tests__/PlantSeedProduction.test.ts > PlantSeedProduction Integration > should produce seeds when transitioning vegetative â†’ mature
     â†’ expected 'vegetative' to be 'mature' // Object.is equality
   â¯ packages/core/src/__tests__/PlantSeedProduction.test.ts > PlantSeedProduction Integration > should produce MORE seeds when transitioning mature â†’ seeding
     â†’ expected 'mature' to be 'seeding' // Object.is equality
   â¯ packages/core/src/__tests__/PlantSeedProduction.test.ts > PlantSeedProduction Integration > should produce seeds correctly through full lifecycle vegetative â†’ mature â†’ seeding
     â†’ expected 'vegetative' to be 'mature' // Object.is equality
 âœ“ packages/core/src/items/__tests__/ItemLoader.test.ts  (16 tests) 6ms
 âœ“ packages/core/src/systems/__tests__/SleepSystem.integration.test.ts  (5 tests) 4ms
 âœ“ packages/core/src/systems/__tests__/VerificationTrust.integration.test.ts  (8 tests) 7ms
stderr | packages/llm/src/__tests__/ProviderQueue.test.ts > ProviderQueue > rate limit detection > should detect 429 status code
<empty line>
stdout | packages/llm/src/__tests__/ProviderQueue.test.ts > ProviderQueue > rate limit detection > should detect 429 status code
[ProviderQueue:test-provider] Rate limit expired, resuming

stdout | packages/llm/src/__tests__/ProviderQueue.test.ts > ProviderQueue > rate limit detection > should detect rate_limit_exceeded code
[ProviderQueue:test-provider] Rate limited until 2026-01-06T11:17:19.054Z (1000ms)
[ProviderQueue:test-provider] Re-queued request for agent agent1 (retry 1)
[ProviderQueue:test-provider] Rate limited, waiting 1000ms

stderr | packages/llm/src/__tests__/ProviderQueue.test.ts > ProviderQueue > rate limit detection > should detect rate_limit_exceeded code
[ProviderQueue:test-provider] Rate limit detected for agent agent1

 âœ“ packages/core/src/systems/__tests__/AnimalSpawning.integration.test.ts  (10 tests) 5ms
 â¯ packages/metrics-dashboard/src/__tests__/components/TimelineView.test.tsx  (0 test)
 âœ“ packages/core/src/systems/__tests__/CommunicationSocial.integration.test.ts  (7 tests) 5ms
 âœ“ packages/core/src/components/__tests__/InventoryComponent.test.ts  (16 tests) 6ms
stderr | ComponentRegistry.register (/Users/annhoward/src/ai_village/custom_game_engine/packages/introspection/src/registry/ComponentRegistry.ts:45:15)
[ComponentRegistry] Schema 'interests' is already registered. Overwriting.

 âœ“ packages/introspection/src/__tests__/types.test.ts  (14 tests) 4ms
 âœ“ packages/hierarchy-simulator/src/renormalization/__tests__/TierConstants.test.ts  (28 tests) 8ms
stderr | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > fallback chain > should skip rate-limited fallback providers
<empty line>
stdout | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > fallback chain > should skip rate-limited fallback providers
[ProviderQueue:groq] Rate limit expired, resuming

stdout | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > retry logic > should retry after all providers rate limited
[ProviderPoolManager] Initialized with 2 providers: groq, cerebras
[ProviderQueue:groq] Rate limited until 2026-01-06T11:17:19.577Z (1000ms)
[ProviderQueue:groq] Re-queued request for agent agent1 (retry 1)
[ProviderQueue:groq] Rate limited, waiting 1000ms

stderr | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > retry logic > should retry after all providers rate limited
[ProviderQueue:groq] Rate limit detected for agent agent1

 â¯ packages/core/src/navigation/__tests__/EmotionalNavigationSystem.integration.test.ts  (9 tests | 1 failed) 11ms
   â¯ packages/core/src/navigation/__tests__/EmotionalNavigationSystem.integration.test.ts > EmotionalNavigationSystem Integration Tests > Crew Coherence > calculates zero coherence for ships with no crew
     â†’ expected 0.5 to be +0 // Object.is equality
 âœ“ packages/magic/src/__tests__/MagicParadigm.test.ts  (15 tests) 6ms
stderr | packages/core/src/behavior/__tests__/BehaviorRegistry.test.ts > BehaviorRegistry > execute > returns false for unknown behavior
[BehaviorRegistry] Unknown behavior: unknown

 âœ“ packages/core/src/magic/__tests__/MagicParadigm.test.ts  (15 tests) 7ms
 âœ“ packages/core/src/behavior/__tests__/BehaviorRegistry.test.ts  (15 tests) 9ms
stderr | packages/llm/src/__tests__/ProviderQueue.test.ts > ProviderQueue > rate limit detection > should detect rate_limit_exceeded code
<empty line>
stdout | packages/llm/src/__tests__/ProviderQueue.test.ts > ProviderQueue > rate limit detection > should detect rate_limit_exceeded code
[ProviderQueue:test-provider] Rate limit expired, resuming

stdout | packages/llm/src/__tests__/ProviderQueue.test.ts > ProviderQueue > rate limit detection > should extract retry-after from headers
[ProviderQueue:test-provider] Rate limited until 2026-01-06T11:17:21.057Z (2000ms)
[ProviderQueue:test-provider] Re-queued request for agent agent1 (retry 1)
[ProviderQueue:test-provider] Rate limited, waiting 2000ms

stderr | packages/llm/src/__tests__/ProviderQueue.test.ts > ProviderQueue > rate limit detection > should extract retry-after from headers
[ProviderQueue:test-provider] Rate limit detected for agent agent1

 âœ“ packages/magic/src/__tests__/MagicLawEnforcer.test.ts  (10 tests) 4ms
 âœ“ packages/core/src/systems/__tests__/SoilDepletion.test.ts  (14 tests) 7ms
 âœ“ packages/core/src/magic/__tests__/MagicLawEnforcer.test.ts  (10 tests) 5ms
 âœ“ packages/world/src/chunks/__tests__/Tile.test.ts  (10 tests) 4ms
 â¯ packages/core/src/navigation/__tests__/SpaceshipComponent.test.ts  (17 tests | 2 failed) 13ms
   â¯ packages/core/src/navigation/__tests__/SpaceshipComponent.test.ts > SpaceshipComponent > createSpaceshipComponent > initializes crew with empty emotional state
     â†’ expected 0.7 to be +0 // Object.is equality
   â¯ packages/core/src/navigation/__tests__/SpaceshipComponent.test.ts > SpaceshipComponent > createSpaceshipComponent > initializes personality with empty arrays
     â†’ expected [ 'exploration', 'trade', 'research' ] to have a length of +0 but got 3
 âœ“ packages/renderer/src/__tests__/RendererCleanup.test.ts  (9 tests) 190ms
stderr | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > retry logic > should retry after all providers rate limited
<empty line>
stdout | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > retry logic > should retry after all providers rate limited
[ProviderQueue:groq] Rate limit expired, resuming

stdout | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > retry logic > should fail after max retries
[ProviderPoolManager] Initialized with 2 providers: groq, cerebras
[ProviderQueue:groq] Rate limited until 2026-01-06T11:17:20.578Z (1000ms)
[ProviderQueue:groq] Re-queued request for agent agent1 (retry 1)
[ProviderQueue:groq] Rate limited, waiting 1000ms

stderr | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > retry logic > should fail after max retries
[ProviderQueue:groq] Rate limit detected for agent agent1

 âœ“ packages/core/src/components/__tests__/TrustNetworkComponent.test.ts  (18 tests) 5ms
 âœ“ packages/core/src/vr/__tests__/VRSystemComponent.test.ts  (18 tests) 8ms
 âœ“ packages/core/src/systems/__tests__/HearingSystem.test.ts  (5 tests) 6ms
 âœ“ packages/core/src/materials/__tests__/MaterialRegistry.test.ts  (9 tests) 5ms
 âœ“ packages/world/src/chunks/__tests__/Chunk.test.ts  (16 tests) 7ms
stdout | packages/llm/src/__tests__/SessionManagement.test.ts > GameSessionManager > should register and track sessions
[GameSessionManager] Registered session: session1 (total: 1)

stdout | packages/llm/src/__tests__/SessionManagement.test.ts > GameSessionManager > should update heartbeat
[GameSessionManager] Registered session: session1 (total: 1)

 âœ“ packages/core/src/systems/__tests__/VerificationSystem.test.ts  (9 tests) 6ms
stdout | packages/llm/src/__tests__/SessionManagement.test.ts > GameSessionManager > should record requests
[GameSessionManager] Registered session: session1 (total: 1)

stdout | packages/llm/src/__tests__/SessionManagement.test.ts > GameSessionManager > should cleanup stale sessions
[GameSessionManager] Registered session: session1 (total: 1)

stdout | packages/llm/src/__tests__/SessionManagement.test.ts > GameSessionManager > should get stats
[GameSessionManager] Registered session: session1 (total: 1)
[GameSessionManager] Registered session: session2 (total: 2)

stdout | packages/llm/src/__tests__/SessionManagement.test.ts > CooldownCalculator > should calculate cooldown based on active games
[GameSessionManager] Registered session: session1 (total: 1)
[CooldownCalculator] groq: 1000 RPM, 1 games â†’ 60ms cooldown per game

stdout | packages/llm/src/__tests__/SessionManagement.test.ts > CooldownCalculator > should calculate next allowed time
[GameSessionManager] Registered session: session1 (total: 1)
[CooldownCalculator] groq: 1000 RPM, 1 games â†’ 60ms cooldown per game
[CooldownCalculator] groq: 1000 RPM, 1 games â†’ 60ms cooldown per game

stdout | packages/llm/src/__tests__/SessionManagement.test.ts > CooldownCalculator > should check if can request now
[GameSessionManager] Registered session: session1 (total: 1)
[CooldownCalculator] groq: 1000 RPM, 1 games â†’ 60ms cooldown per game
[CooldownCalculator] groq: 1000 RPM, 1 games â†’ 60ms cooldown per game

stdout | packages/llm/src/__tests__/SessionManagement.test.ts > CooldownCalculator > should get cooldown status
[GameSessionManager] Registered session: session1 (total: 1)
[CooldownCalculator] groq: 1000 RPM, 1 games â†’ 60ms cooldown per game

stdout | packages/llm/src/__tests__/SessionManagement.test.ts > CooldownCalculator > should support custom API key rate limits
[CooldownCalculator] Set custom rate limit for key custom-key-123: 60 RPM
[GameSessionManager] Registered session: session1 (total: 1)
[CooldownCalculator] groq: 1000 RPM, 1 games â†’ 60ms cooldown per game
[CooldownCalculator] groq: 60 RPM, 1 games â†’ 1000ms cooldown per game

 â¯ packages/llm/src/__tests__/SessionManagement.test.ts  (11 tests | 3 failed) 26ms
   â¯ packages/llm/src/__tests__/SessionManagement.test.ts > GameSessionManager > should get stats
     â†’ expected 0 to be greater than 0
   â¯ packages/llm/src/__tests__/SessionManagement.test.ts > CooldownCalculator > should calculate cooldown based on active games
     â†’ expected 60 to be 2000 // Object.is equality
   â¯ packages/llm/src/__tests__/SessionManagement.test.ts > CooldownCalculator > should support custom API key rate limits
     â†’ expected 1000 to be less than 60
 âœ“ packages/core/src/systems/__tests__/SleepSystem.test.ts  (17 tests) 5ms
 âœ“ packages/world/src/terrain/__tests__/PerlinNoise.test.ts  (10 tests) 8ms
stdout | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > retry logic > should fail after max retries
[ProviderQueue:groq] Rate limit expired, resuming
[ProviderQueue:groq] Rate limited until 2026-01-06T11:17:21.579Z (1000ms)
[ProviderQueue:groq] Re-queued request for agent agent1 (retry 2)
[ProviderQueue:groq] Rate limited, waiting 1000ms

stderr | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > retry logic > should fail after max retries
[ProviderQueue:groq] Rate limit detected for agent agent1

 âœ“ packages/core/src/systems/__tests__/MemoryConsolidation.integration.test.ts  (3 tests) 6ms
 âœ“ packages/core/src/systems/__tests__/WateringAction.test.ts  (10 tests) 8ms
 âœ“ packages/renderer/src/__tests__/InputHandlerCleanup.test.ts  (8 tests) 11ms
 âœ“ packages/core/src/events/__tests__/EventBus.test.ts  (10 tests) 8ms
 âœ“ packages/llm/src/__tests__/Semaphore.test.ts  (13 tests) 59ms
 âœ“ packages/core/src/ecs/__tests__/ComponentRegistry.test.ts  (9 tests) 5ms
stderr | packages/llm/src/__tests__/ProviderQueue.test.ts > ProviderQueue > rate limit detection > should extract retry-after from headers
<empty line>
stdout | packages/llm/src/__tests__/ProviderQueue.test.ts > ProviderQueue > rate limit detection > should extract retry-after from headers
[ProviderQueue:test-provider] Rate limited, waiting 1ms

stderr | packages/llm/src/__tests__/ProviderQueue.test.ts > ProviderQueue > rate limit detection > should extract retry-after from headers
<empty line>
stdout | packages/llm/src/__tests__/ProviderQueue.test.ts > ProviderQueue > rate limit detection > should extract retry-after from headers
[ProviderQueue:test-provider] Rate limit expired, resuming

stdout | packages/llm/src/__tests__/ProviderQueue.test.ts > ProviderQueue > rate limit detection > should use default 1s wait if no retry-after header
[ProviderQueue:test-provider] Rate limited until 2026-01-06T11:17:22.058Z (1000ms)
[ProviderQueue:test-provider] Re-queued request for agent agent1 (retry 1)
[ProviderQueue:test-provider] Rate limited, waiting 1000ms

stderr | packages/llm/src/__tests__/ProviderQueue.test.ts > ProviderQueue > rate limit detection > should use default 1s wait if no retry-after header
[ProviderQueue:test-provider] Rate limit detected for agent agent1

 âœ“ packages/core/src/systems/__tests__/SpatialMemory.integration.test.ts  (2 tests) 3ms
 âœ“ packages/world/src/chunks/__tests__/ChunkManager.test.ts  (9 tests) 8ms
 âœ“ packages/core/src/actions/__tests__/AgentAction.test.ts  (13 tests) 3ms
 âœ“ packages/core/src/ecs/__tests__/Entity.test.ts  (10 tests) 4ms
 âœ“ agents/autonomous-dev/work-orders/conflict-combat-ui/tests/CombatHUDPanel.test.ts  (9 tests) 4ms
stdout | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > retry logic > should fail after max retries
[ProviderQueue:groq] Rate limit expired, resuming
[ProviderQueue:groq] Rate limited until 2026-01-06T11:17:22.580Z (1000ms)
[ProviderQueue:groq] Re-queued request for agent agent1 (retry 3)
[ProviderQueue:groq] Rate limited, waiting 1000ms

stderr | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > retry logic > should fail after max retries
[ProviderQueue:groq] Rate limit detected for agent agent1

 âœ“ packages/core/src/systems/__tests__/BehaviorQueueIntegration.test.ts  (5 tests) 2ms
 âœ“ packages/core/src/systems/__tests__/VerificationSystem.debug.test.ts  (1 test) 2ms
 â†“ packages/renderer/src/__tests__/BuildingPlacementUI.test.ts  (1 test | 1 skipped)
stderr | packages/llm/src/__tests__/ProviderQueue.test.ts > ProviderQueue > rate limit detection > should use default 1s wait if no retry-after header
<empty line>
stdout | packages/llm/src/__tests__/ProviderQueue.test.ts > ProviderQueue > rate limit detection > should use default 1s wait if no retry-after header
[ProviderQueue:test-provider] Rate limit expired, resuming

stdout | packages/llm/src/__tests__/ProviderQueue.test.ts > ProviderQueue > rate limit detection > should re-queue request on rate limit
[ProviderQueue:test-provider] Rate limited until 2026-01-06T11:17:23.059Z (1000ms)
[ProviderQueue:test-provider] Re-queued request for agent agent1 (retry 1)
[ProviderQueue:test-provider] Rate limited, waiting 1000ms

stderr | packages/llm/src/__tests__/ProviderQueue.test.ts > ProviderQueue > rate limit detection > should re-queue request on rate limit
[ProviderQueue:test-provider] Rate limit detected for agent agent1

stdout | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > retry logic > should fail after max retries
[ProviderQueue:groq] Rate limit expired, resuming
[ProviderQueue:groq] Rate limited until 2026-01-06T11:17:23.581Z (1000ms)
[ProviderQueue:groq] Re-queued request for agent agent1 (retry 4)
[ProviderQueue:groq] Rate limited, waiting 1000ms

stderr | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > retry logic > should fail after max retries
[ProviderQueue:groq] Rate limit detected for agent agent1

stderr | packages/llm/src/__tests__/ProviderQueue.test.ts > ProviderQueue > rate limit detection > should re-queue request on rate limit
<empty line>
stdout | packages/llm/src/__tests__/ProviderQueue.test.ts > ProviderQueue > rate limit detection > should re-queue request on rate limit
[ProviderQueue:test-provider] Rate limit expired, resuming

 âœ“ packages/llm/src/__tests__/ProviderQueue.test.ts  (12 tests) 6521ms
stdout | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > retry logic > should fail after max retries
[ProviderQueue:groq] Rate limit expired, resuming
[ProviderQueue:groq] Rate limited until 2026-01-06T11:17:24.582Z (1000ms)
[ProviderQueue:groq] Re-queued request for agent agent1 (retry 5)
[ProviderQueue:groq] Rate limited, waiting 1000ms

stderr | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > retry logic > should fail after max retries
[ProviderQueue:groq] Rate limit detected for agent agent1

 âœ“ packages/core/src/__tests__/ConversationQuality.test.ts  (45 tests) 11ms
stdout | _log (/Users/annhoward/src/ai_village/custom_game_engine/node_modules/dotenv/lib/main.js:142:11)
[dotenv@17.2.3] injecting env (10) from .env -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

stderr | packages/llm/src/__tests__/ConversationSimulation.test.ts > ConversationSimulation > interest-based conversation depth > should have deeper conversation when agents share philosophical interests
[OpenAICompatProvider] Generate error: Error: API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}

    at OpenAICompatProvider.generate (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/OpenAICompatProvider.ts:380:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at simulateConversation (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:230:22)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:344:22
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:11)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runFiles (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:958:5)
    at startTests (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:967:3)
[OpenAICompatProvider] Error details: {
  message: 'API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}\n',
  stack: 'Error: API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}\n' +
    '\n' +
    '    at OpenAICompatProvider.generate (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/OpenAICompatProvider.ts:380:15)\n' +
    '    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n' +
    '    at simulateConversation (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:230:22)\n' +
    '    at /Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:344:22\n' +
    '    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:11)\n' +
    '    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)\n' +
    '    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)\n' +
    '    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)\n' +
    '    at runFiles (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:958:5)\n' +
    '    at startTests (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:967:3)',
  model: 'qwen-3-30b',
  url: 'https://api.groq.com/openai/v1/chat/completions',
  hasApiKey: true
}

stderr | packages/llm/src/__tests__/ConversationSimulation.test.ts > ConversationSimulation > interest-based conversation depth > should have shallower conversation without interest context
[OpenAICompatProvider] Generate error: Error: API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}

    at OpenAICompatProvider.generate (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/OpenAICompatProvider.ts:380:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at simulateConversation (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:230:22)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:370:22
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:11)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runFiles (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:958:5)
    at startTests (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:967:3)
[OpenAICompatProvider] Error details: {
  message: 'API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}\n',
  stack: 'Error: API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}\n' +
    '\n' +
    '    at OpenAICompatProvider.generate (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/OpenAICompatProvider.ts:380:15)\n' +
    '    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n' +
    '    at simulateConversation (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:230:22)\n' +
    '    at /Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:370:22\n' +
    '    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:11)\n' +
    '    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)\n' +
    '    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)\n' +
    '    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)\n' +
    '    at runFiles (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:958:5)\n' +
    '    at startTests (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:967:3)',
  model: 'qwen-3-30b',
  url: 'https://api.groq.com/openai/v1/chat/completions',
  hasApiKey: true
}

stderr | packages/llm/src/__tests__/ConversationSimulation.test.ts > ConversationSimulation > child-elder knowledge transfer > should show child asking questions and elder answering
[OpenAICompatProvider] Generate error: Error: API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}

    at OpenAICompatProvider.generate (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/OpenAICompatProvider.ts:380:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at simulateConversation (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:230:22)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:392:22
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:11)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runFiles (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:958:5)
    at startTests (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:967:3)
[OpenAICompatProvider] Error details: {
  message: 'API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}\n',
  stack: 'Error: API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}\n' +
    '\n' +
    '    at OpenAICompatProvider.generate (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/OpenAICompatProvider.ts:380:15)\n' +
    '    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n' +
    '    at simulateConversation (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:230:22)\n' +
    '    at /Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:392:22\n' +
    '    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:11)\n' +
    '    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)\n' +
    '    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)\n' +
    '    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)\n' +
    '    at runFiles (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:958:5)\n' +
    '    at startTests (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:967:3)',
  model: 'qwen-3-30b',
  url: 'https://api.groq.com/openai/v1/chat/completions',
  hasApiKey: true
}

stderr | packages/llm/src/__tests__/ConversationSimulation.test.ts > ConversationSimulation > craft-based conversation > should discuss woodworking when both agents share that interest
[OpenAICompatProvider] Generate error: Error: API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}

    at OpenAICompatProvider.generate (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/OpenAICompatProvider.ts:380:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at simulateConversation (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:230:22)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:434:22
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:11)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runFiles (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:958:5)
    at startTests (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:967:3)
[OpenAICompatProvider] Error details: {
  message: 'API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}\n',
  stack: 'Error: API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}\n' +
    '\n' +
    '    at OpenAICompatProvider.generate (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/OpenAICompatProvider.ts:380:15)\n' +
    '    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n' +
    '    at simulateConversation (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:230:22)\n' +
    '    at /Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:434:22\n' +
    '    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:11)\n' +
    '    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)\n' +
    '    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)\n' +
    '    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)\n' +
    '    at runFiles (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:958:5)\n' +
    '    at startTests (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:967:3)',
  model: 'qwen-3-30b',
  url: 'https://api.groq.com/openai/v1/chat/completions',
  hasApiKey: true
}

stderr | packages/llm/src/__tests__/ConversationSimulation.test.ts > ConversationSimulation > depth hunger effect > should show more meaningful exchange when depth hunger is high
[OpenAICompatProvider] Generate error: Error: API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}

    at OpenAICompatProvider.generate (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/OpenAICompatProvider.ts:380:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at simulateConversation (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:230:22)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:466:22
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:11)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runFiles (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:958:5)
    at startTests (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:967:3)
[OpenAICompatProvider] Error details: {
  message: 'API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}\n',
  stack: 'Error: API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}\n' +
    '\n' +
    '    at OpenAICompatProvider.generate (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/OpenAICompatProvider.ts:380:15)\n' +
    '    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n' +
    '    at simulateConversation (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:230:22)\n' +
    '    at /Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:466:22\n' +
    '    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:11)\n' +
    '    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)\n' +
    '    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)\n' +
    '    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)\n' +
    '    at runFiles (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:958:5)\n' +
    '    at startTests (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:967:3)',
  model: 'qwen-3-30b',
  url: 'https://api.groq.com/openai/v1/chat/completions',
  hasApiKey: true
}

 â¯ packages/llm/src/__tests__/ConversationSimulation.test.ts  (15 tests | 6 failed) 430ms
   â¯ packages/llm/src/__tests__/ConversationSimulation.test.ts > ConversationSimulation > interest-based conversation depth > should have deeper conversation when agents share philosophical interests
     â†’ API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}

   â¯ packages/llm/src/__tests__/ConversationSimulation.test.ts > ConversationSimulation > interest-based conversation depth > should have shallower conversation without interest context
     â†’ API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}

   â¯ packages/llm/src/__tests__/ConversationSimulation.test.ts > ConversationSimulation > child-elder knowledge transfer > should show child asking questions and elder answering
     â†’ API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}

   â¯ packages/llm/src/__tests__/ConversationSimulation.test.ts > ConversationSimulation > craft-based conversation > should discuss woodworking when both agents share that interest
     â†’ API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}

   â¯ packages/llm/src/__tests__/ConversationSimulation.test.ts > ConversationSimulation > depth hunger effect > should show more meaningful exchange when depth hunger is high
     â†’ API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}

   â¯ packages/llm/src/__tests__/ConversationSimulation.test.ts > ConversationSimulation > conversation quality comparison > should produce measurably different conversations with vs without interests
     â†’ API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}

stderr | packages/llm/src/__tests__/ConversationSimulation.test.ts > ConversationSimulation > conversation quality comparison > should produce measurably different conversations with vs without interests
[OpenAICompatProvider] Generate error: Error: API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}

    at OpenAICompatProvider.generate (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/OpenAICompatProvider.ts:380:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at simulateConversation (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:230:22)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:491:29
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:11)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runFiles (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:958:5)
    at startTests (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:967:3)
[OpenAICompatProvider] Error details: {
  message: 'API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}\n',
  stack: 'Error: API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}\n' +
    '\n' +
    '    at OpenAICompatProvider.generate (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/OpenAICompatProvider.ts:380:15)\n' +
    '    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n' +
    '    at simulateConversation (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:230:22)\n' +
    '    at /Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/ConversationSimulation.test.ts:491:29\n' +
    '    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:11)\n' +
    '    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)\n' +
    '    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)\n' +
    '    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)\n' +
    '    at runFiles (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:958:5)\n' +
    '    at startTests (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:967:3)',
  model: 'qwen-3-30b',
  url: 'https://api.groq.com/openai/v1/chat/completions',
  hasApiKey: true
}

stdout | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > getQueueStats > should return stats for all queues
[ProviderPoolManager] Initialized with 2 providers: groq, cerebras

stdout | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > helper methods > should detect when all providers are rate limited
[ProviderPoolManager] Initialized with 2 providers: groq, cerebras
[ProviderQueue:groq] Rate limited until 2026-01-06T11:17:25.580Z (1000ms)
[ProviderQueue:groq] Re-queued request for agent agent1 (retry 1)
[ProviderQueue:groq] Rate limited, waiting 1000ms
[ProviderQueue:cerebras] Rate limited until 2026-01-06T11:17:25.580Z (1000ms)
[ProviderQueue:cerebras] Re-queued request for agent agent2 (retry 1)
[ProviderQueue:cerebras] Rate limited, waiting 1000ms
[ProviderQueue:groq] Rate limit expired, resuming
[ProviderQueue:groq] Rate limited until 2026-01-06T11:17:25.582Z (1000ms)
[ProviderQueue:groq] Re-queued request for agent agent1 (retry 6)
[ProviderQueue:groq] Rate limited, waiting 1000ms

stderr | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > helper methods > should detect when all providers are rate limited
[ProviderQueue:groq] Rate limit detected for agent agent1
[ProviderQueue:cerebras] Rate limit detected for agent agent2
[ProviderQueue:groq] Rate limit detected for agent agent1

 â¯ packages/llm/src/__tests__/ProviderPoolManager.test.ts  (13 tests | 2 failed) 9021ms
   â¯ packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > fallback chain > should fallback to cerebras on groq rate limit
     â†’ expected 'groq response' to be 'cerebras response' // Object.is equality
   â¯ packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > retry logic > should fail after max retries
     â†’ Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
stderr | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > helper methods > should detect when all providers are rate limited
<empty line>
stdout | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > helper methods > should detect when all providers are rate limited
[ProviderQueue:groq] Rate limit expired, resuming
[ProviderQueue:cerebras] Rate limit expired, resuming

stdout | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > helper methods > should get next available provider
[ProviderPoolManager] Initialized with 2 providers: groq, cerebras

stdout | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > maxRetries configuration > should allow setting max retries
[ProviderPoolManager] Initialized with 2 providers: groq, cerebras

stdout | packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > maxRetries configuration > should throw error for negative max retries
[ProviderPoolManager] Initialized with 2 providers: groq, cerebras

stdout | packages/llm/src/__tests__/ProviderPoolManager.test.ts
[ProviderQueue:groq] Rate limit expired, resuming
[ProviderQueue:groq] Rate limited until 2026-01-06T11:17:26.582Z (1000ms)
[ProviderQueue:groq] Re-queued request for agent agent1 (retry 7)
[ProviderQueue:groq] Rate limited, waiting 1000ms

stderr | packages/llm/src/__tests__/ProviderPoolManager.test.ts
[ProviderQueue:groq] Rate limit detected for agent agent1


âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Failed Suites 10 âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯

 FAIL  packages/metrics-dashboard/src/__tests__/components/CulturalDiffusionView.test.tsx [ packages/metrics-dashboard/src/__tests__/components/CulturalDiffusionView.test.tsx ]
Error: Failed to resolve import "@/components/CulturalDiffusionView" from "packages/metrics-dashboard/src/__tests__/components/CulturalDiffusionView.test.tsx". Does the file exist?
 â¯ TransformPluginContext._formatError node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 â¯ TransformPluginContext.error node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 â¯ normalizeUrl node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 â¯ async file:/Users/annhoward/src/ai_village/custom_game_engine/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 â¯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 â¯ PluginContainer.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 â¯ loadAndTransform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/746]âŽ¯

 FAIL  packages/metrics-dashboard/src/__tests__/components/InequalityView.test.tsx [ packages/metrics-dashboard/src/__tests__/components/InequalityView.test.tsx ]
Error: Failed to resolve import "@/components/InequalityView" from "packages/metrics-dashboard/src/__tests__/components/InequalityView.test.tsx". Does the file exist?
 â¯ TransformPluginContext._formatError node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 â¯ TransformPluginContext.error node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 â¯ normalizeUrl node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 â¯ async file:/Users/annhoward/src/ai_village/custom_game_engine/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 â¯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 â¯ PluginContainer.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 â¯ loadAndTransform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/746]âŽ¯

 FAIL  packages/metrics-dashboard/src/__tests__/components/NetworkView.test.tsx [ packages/metrics-dashboard/src/__tests__/components/NetworkView.test.tsx ]
Error: Failed to resolve import "@/components/NetworkView" from "packages/metrics-dashboard/src/__tests__/components/NetworkView.test.tsx". Does the file exist?
 â¯ TransformPluginContext._formatError node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 â¯ TransformPluginContext.error node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 â¯ normalizeUrl node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 â¯ async file:/Users/annhoward/src/ai_village/custom_game_engine/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 â¯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 â¯ PluginContainer.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 â¯ loadAndTransform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/746]âŽ¯

 FAIL  packages/metrics-dashboard/src/__tests__/components/SpatialView.test.tsx [ packages/metrics-dashboard/src/__tests__/components/SpatialView.test.tsx ]
Error: Failed to resolve import "@/components/SpatialView" from "packages/metrics-dashboard/src/__tests__/components/SpatialView.test.tsx". Does the file exist?
 â¯ TransformPluginContext._formatError node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 â¯ TransformPluginContext.error node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 â¯ normalizeUrl node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 â¯ async file:/Users/annhoward/src/ai_village/custom_game_engine/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 â¯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 â¯ PluginContainer.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 â¯ loadAndTransform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[4/746]âŽ¯

 FAIL  packages/metrics-dashboard/src/__tests__/components/TimeSeriesView.test.tsx [ packages/metrics-dashboard/src/__tests__/components/TimeSeriesView.test.tsx ]
Error: Failed to resolve import "@/components/TimeSeriesView" from "packages/metrics-dashboard/src/__tests__/components/TimeSeriesView.test.tsx". Does the file exist?
 â¯ TransformPluginContext._formatError node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 â¯ TransformPluginContext.error node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 â¯ normalizeUrl node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 â¯ async file:/Users/annhoward/src/ai_village/custom_game_engine/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 â¯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 â¯ PluginContainer.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 â¯ loadAndTransform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[5/746]âŽ¯

 FAIL  packages/metrics-dashboard/src/__tests__/components/TimelineView.test.tsx [ packages/metrics-dashboard/src/__tests__/components/TimelineView.test.tsx ]
Error: Failed to resolve import "@/components/TimelineView" from "packages/metrics-dashboard/src/__tests__/components/TimelineView.test.tsx". Does the file exist?
 â¯ TransformPluginContext._formatError node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 â¯ TransformPluginContext.error node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 â¯ normalizeUrl node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 â¯ async file:/Users/annhoward/src/ai_village/custom_game_engine/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 â¯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 â¯ PluginContainer.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 â¯ loadAndTransform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[6/746]âŽ¯

 FAIL  packages/metrics-dashboard/src/__tests__/utils/apiClient.test.ts [ packages/metrics-dashboard/src/__tests__/utils/apiClient.test.ts ]
Error: Failed to resolve import "@/utils/apiClient" from "packages/metrics-dashboard/src/__tests__/utils/apiClient.test.ts". Does the file exist?
 â¯ TransformPluginContext._formatError node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 â¯ TransformPluginContext.error node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 â¯ normalizeUrl node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 â¯ async file:/Users/annhoward/src/ai_village/custom_game_engine/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 â¯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 â¯ PluginContainer.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 â¯ loadAndTransform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[7/746]âŽ¯

 FAIL  packages/metrics-dashboard/src/__tests__/utils/dataTransformers.test.ts [ packages/metrics-dashboard/src/__tests__/utils/dataTransformers.test.ts ]
Error: Failed to resolve import "@/utils/dataTransformers" from "packages/metrics-dashboard/src/__tests__/utils/dataTransformers.test.ts". Does the file exist?
 â¯ TransformPluginContext._formatError node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 â¯ TransformPluginContext.error node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 â¯ normalizeUrl node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 â¯ async file:/Users/annhoward/src/ai_village/custom_game_engine/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 â¯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 â¯ PluginContainer.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 â¯ loadAndTransform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[8/746]âŽ¯

 FAIL  packages/metrics-dashboard/src/__tests__/integration/api.test.ts [ packages/metrics-dashboard/src/__tests__/integration/api.test.ts ]
Error: Failed to resolve import "@/utils/apiClient" from "packages/metrics-dashboard/src/__tests__/integration/api.test.ts". Does the file exist?
 â¯ TransformPluginContext._formatError node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 â¯ TransformPluginContext.error node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 â¯ normalizeUrl node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 â¯ async file:/Users/annhoward/src/ai_village/custom_game_engine/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 â¯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 â¯ PluginContainer.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 â¯ loadAndTransform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[9/746]âŽ¯

 FAIL  packages/metrics-dashboard/src/__tests__/integration/websocket.test.ts [ packages/metrics-dashboard/src/__tests__/integration/websocket.test.ts ]
Error: Failed to resolve import "@/services/MetricsWebSocketClient" from "packages/metrics-dashboard/src/__tests__/integration/websocket.test.ts". Does the file exist?
 â¯ TransformPluginContext._formatError node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 â¯ TransformPluginContext.error node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 â¯ normalizeUrl node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 â¯ async file:/Users/annhoward/src/ai_village/custom_game_engine/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 â¯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 â¯ PluginContainer.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 â¯ loadAndTransform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[10/746]âŽ¯

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Failed Tests 708 âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯

 FAIL  packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should support various combat causes
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/__tests__/AgentCombat.test.ts:91:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[11/746]âŽ¯

 FAIL  packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should compare combat skills and equipment
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/__tests__/AgentCombat.test.ts:109:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[12/746]âŽ¯

 FAIL  packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should apply surprise modifier
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/__tests__/AgentCombat.test.ts:131:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[13/746]âŽ¯

 FAIL  packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should apply terrain modifier
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/__tests__/AgentCombat.test.ts:153:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[14/746]âŽ¯

 FAIL  packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should apply injury modifier to injured combatant
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/__tests__/AgentCombat.test.ts:177:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[15/746]âŽ¯

 FAIL  packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should roll outcome with skill-weighted probability
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/__tests__/AgentCombat.test.ts:194:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[16/746]âŽ¯

 FAIL  packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should determine injury severity based on power difference
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/__tests__/AgentCombat.test.ts:217:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[17/746]âŽ¯

 FAIL  packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should call LLM to generate fight narrative
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/__tests__/AgentCombat.test.ts:241:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[18/746]âŽ¯

 FAIL  packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should include witnesses in narrative context
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/__tests__/AgentCombat.test.ts:263:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[19/746]âŽ¯

 FAIL  packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should apply social consequences - witness opinions
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/__tests__/AgentCombat.test.ts:281:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[20/746]âŽ¯

 FAIL  packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should apply social consequences - relationship changes
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/__tests__/AgentCombat.test.ts:306:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[21/746]âŽ¯

 FAIL  packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should apply social consequences - reputation
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/__tests__/AgentCombat.test.ts:329:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22/746]âŽ¯

 FAIL  packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should check for legal consequences if laws exist
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/__tests__/AgentCombat.test.ts:359:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[23/746]âŽ¯

 FAIL  packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should skip legal consequences for self-defense
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/__tests__/AgentCombat.test.ts:383:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[24/746]âŽ¯

 FAIL  packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should handle mutual injury outcome
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/__tests__/AgentCombat.test.ts:404:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[25/746]âŽ¯

 FAIL  packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > REQ-CON-003: Agent Combat > should handle stalemate outcome
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/__tests__/AgentCombat.test.ts:422:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[26/746]âŽ¯

 FAIL  packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > error handling > should throw when combat target does not exist
AssertionError: expected [Function] to throw an error

- Expected: 
null

+ Received: 
undefined

 â¯ packages/core/src/__tests__/AgentCombat.test.ts:443:82
    441|       });
    442| 
    443|       expect(() => system.update(world, Array.from(world.entities.valuâ€¦
       |                                                                                  ^
    444|     });
    445| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[27/746]âŽ¯

 FAIL  packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > error handling > should throw when combat target is not an agent
AssertionError: expected [Function] to throw error including 'Combat target is not an agent' but got 'Cannot read properties of undefined (â€¦'

- Expected
+ Received

- Combat target is not an agent
+ Cannot read properties of undefined (reading 'combatSkill')

 â¯ packages/core/src/__tests__/AgentCombat.test.ts:458:82
    456|       });
    457| 
    458|       expect(() => system.update(world, Array.from(world.entities.valuâ€¦
       |                                                                                  ^
    459|     });
    460| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[28/746]âŽ¯

 FAIL  packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > error handling > should throw when attacker lacks required combat_stats component
AssertionError: expected [Function] to throw error including 'Attacker missing required component: â€¦' but got 'Cannot read properties of undefined (â€¦'

- Expected
+ Received

- Attacker missing required component: combat_stats
+ Cannot read properties of undefined (reading 'combatSkill')

 â¯ packages/core/src/__tests__/AgentCombat.test.ts:472:82
    470|       });
    471| 
    472|       expect(() => system.update(world, Array.from(world.entities.valuâ€¦
       |                                                                                  ^
    473|         'Attacker missing required component: combat_stats'
    474|       );

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[29/746]âŽ¯

 FAIL  packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > error handling > should throw when defender lacks required combat_stats component
AssertionError: expected [Function] to throw error including 'Defender missing required component: â€¦' but got 'Cannot read properties of undefined (â€¦'

- Expected
+ Received

- Defender missing required component: combat_stats
+ Cannot read properties of undefined (reading 'combatSkill')

 â¯ packages/core/src/__tests__/AgentCombat.test.ts:488:82
    486|       });
    487| 
    488|       expect(() => system.update(world, Array.from(world.entities.valuâ€¦
       |                                                                                  ^
    489|         'Defender missing required component: combat_stats'
    490|       );

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[30/746]âŽ¯

 FAIL  packages/core/src/__tests__/AgentCombat.test.ts > AgentCombatSystem > error handling > should throw when cause is not provided
AssertionError: expected [Function] to throw error including 'Combat cause is required' but got 'Cannot read properties of undefined (â€¦'

- Expected
+ Received

- Combat cause is required
+ Cannot read properties of undefined (reading 'combatSkill')

 â¯ packages/core/src/__tests__/AgentCombat.test.ts:501:82
    499|       } as any);
    500| 
    501|       expect(() => system.update(world, Array.from(world.entities.valuâ€¦
       |                                                                                  ^
    502|     });
    503|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[31/746]âŽ¯

 FAIL  packages/core/src/__tests__/AnimalProduction.test.ts > Animal Production System > Error Handling > should throw when processing animal with missing health field in update
AssertionError: expected [Function] to throw error including 'missing required \'health\' field' but got 'Animal invalid-chicken missing requirâ€¦'

- Expected
+ Received

- missing required 'health' field
+ Animal invalid-chicken missing required CT.Health field

 â¯ packages/core/src/__tests__/AnimalProduction.test.ts:532:10
    530|         const entities = world.query().with(ComponentType.Animal).execâ€¦
    531|         productionSystem.update(world, entities, 86400);
    532|       }).toThrow('missing required \'health\' field');
       |          ^
    533|     });
    534|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[32/746]âŽ¯

 FAIL  packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Lifecycle > initializes romantic tracking
TypeError: initializeRomantic is not a function
 â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts:409:17
    407| 
    408|     it('initializes romantic tracking', () => {
    409|       relComp = initializeRomantic(relComp, entity2, 30);
       |                 ^
    410| 
    411|       const rel = relComp.relationships.get(entity2);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[33/746]âŽ¯

 FAIL  packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Lifecycle > updates attraction levels
TypeError: initializeRomantic is not a function
 â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts:418:17
    416| 
    417|     it('updates attraction levels', () => {
    418|       relComp = initializeRomantic(relComp, entity2, 20);
       |                 ^
    419|       relComp = updateAttraction(relComp, entity2, 30);
    420| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[34/746]âŽ¯

 FAIL  packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Lifecycle > starts courtship
TypeError: initializeRomantic is not a function
 â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts:426:17
    424| 
    425|     it('starts courtship', () => {
    426|       relComp = initializeRomantic(relComp, entity2, 50);
       |                 ^
    427|       relComp = startCourtship(relComp, entity2, entity1, 200);
    428| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[35/746]âŽ¯

 FAIL  packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Lifecycle > progresses courtship through gifts/displays
TypeError: initializeRomantic is not a function
 â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts:437:17
    435| 
    436|     it('progresses courtship through gifts/displays', () => {
    437|       relComp = initializeRomantic(relComp, entity2, 50);
       |                 ^
    438|       relComp = startCourtship(relComp, entity2, entity1, 200);
    439|       relComp = progressCourtship(relComp, entity2, 25);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[36/746]âŽ¯

 FAIL  packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Lifecycle > accepts courtship - transitions to dating
TypeError: initializeRomantic is not a function
 â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts:448:17
    446| 
    447|     it('accepts courtship - transitions to dating', () => {
    448|       relComp = initializeRomantic(relComp, entity2, 50);
       |                 ^
    449|       relComp = startCourtship(relComp, entity2, entity1, 200);
    450|       relComp = progressCourtship(relComp, entity2, 100);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[37/746]âŽ¯

 FAIL  packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Lifecycle > rejects courtship - emotional milestone recorded
TypeError: initializeRomantic is not a function
 â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts:461:17
    459| 
    460|     it('rejects courtship - emotional milestone recorded', () => {
    461|       relComp = initializeRomantic(relComp, entity2, 50);
       |                 ^
    462|       relComp = startCourtship(relComp, entity2, entity1, 200);
    463|       relComp = rejectCourtship(relComp, entity2, 300);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[38/746]âŽ¯

 FAIL  packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Lifecycle > forms bonds of increasing strength
TypeError: initializeRomantic is not a function
 â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts:472:17
    470| 
    471|     it('forms bonds of increasing strength', () => {
    472|       relComp = initializeRomantic(relComp, entity2, 50);
       |                 ^
    473| 
    474|       // Casual

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39/746]âŽ¯

 FAIL  packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Lifecycle > tracks intimacy encounters
TypeError: initializeRomantic is not a function
 â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts:505:17
    503| 
    504|     it('tracks intimacy encounters', () => {
    505|       relComp = initializeRomantic(relComp, entity2, 50);
       |                 ^
    506|       relComp = formBond(relComp, entity2, 'dating', 100, false);
    507| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[40/746]âŽ¯

 FAIL  packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Lifecycle > records offspring from relationship
TypeError: initializeRomantic is not a function
 â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts:520:17
    518| 
    519|     it('records offspring from relationship', () => {
    520|       relComp = initializeRomantic(relComp, entity2, 50);
       |                 ^
    521|       relComp = formBond(relComp, entity2, 'married', 100, true);
    522| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[41/746]âŽ¯

 FAIL  packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Lifecycle > ends relationships with appropriate reason tracking
TypeError: initializeRomantic is not a function
 â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts:532:17
    530| 
    531|     it('ends relationships with appropriate reason tracking', () => {
    532|       relComp = initializeRomantic(relComp, entity2, 80);
       |                 ^
    533|       relComp = formBond(relComp, entity2, 'married', 100, true);
    534|       relComp = recordIntimacy(relComp, entity2, 200, 50, 50);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[42/746]âŽ¯

 FAIL  packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Queries > gets all romantic relationships
 FAIL  packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Queries > gets current partners
 FAIL  packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Queries > gets primary partner
 FAIL  packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Queries > checks exclusive relationship status
 FAIL  packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Romantic Relationship Queries > gets attraction level
TypeError: initializeRomantic is not a function
 â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts:559:17
    557|       relComp = updateRelationship(relComp, 'charlie', 100, 40, 10);
    558| 
    559|       relComp = initializeRomantic(relComp, 'alice', 80);
       |                 ^
    560|       relComp = initializeRomantic(relComp, 'bob', 60);
    561|       relComp = initializeRomantic(relComp, 'charlie', 30);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[43/746]âŽ¯

 FAIL  packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Full Lifecycle: Human Romance > simulates meeting to marriage to children
TypeError: initializeRomantic is not a function
 â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts:1157:29
    1155| 
    1156|       // Attraction develops (tick 300)
    1157|       alice.relationships = initializeRomantic(alice.relationships, 'bâ€¦
       |                             ^
    1158|       bob.relationships = initializeRomantic(bob.relationships, 'aliceâ€¦
    1159| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[44/746]âŽ¯

 FAIL  packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Full Lifecycle: Kemmer Partners > simulates kemmer cycle and conception
TypeError: initializeRomantic is not a function
 â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts:1245:32
    1243|       genly.relationships = updateRelationship(genly.relationships, 'eâ€¦
    1244| 
    1245|       estraven.relationships = initializeRomantic(estraven.relationshiâ€¦
       |                                ^
    1246|       genly.relationships = initializeRomantic(genly.relationships, 'eâ€¦
    1247| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[45/746]âŽ¯

 FAIL  packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Full Lifecycle: Mystif Union Magic > simulates union magic reproduction
TypeError: formBond is not a function
 â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts:1357:30
    1355| 
    1356|       // Soul bond forms instantly (mystif paradigm)
    1357|       mystif.relationships = formBond(mystif.relationships, 'partner',â€¦
       |                              ^
    1358|       partner.relationships = formBond(partner.relationships, 'mystif'â€¦
    1359| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[46/746]âŽ¯

 FAIL  packages/core/src/__tests__/AutomatedLove.integration.test.ts > AutomatedLove Integration Tests > Edge Cases > handles empty relationship romantic operations
TypeError: updateAttraction is not a function
 â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts:1422:17
    1420| 
    1421|       // Operations on non-existent relationships should be no-ops
    1422|       relComp = updateAttraction(relComp, 'nonexistent', 50);
       |                 ^
    1423|       relComp = startCourtship(relComp, 'nonexistent', 'initiator', 10â€¦
    1424| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[47/746]âŽ¯

 FAIL  packages/core/src/__tests__/AutomatedLove.integration.test.ts > The Grand Multiverse Romance > simulates cross-paradigm love story
TypeError: initializeRomantic is not a function
 â¯ packages/core/src/__tests__/AutomatedLove.integration.test.ts:1529:28
    1527|     human.relationships = updateRelationship(human.relationships, 'pieâ€¦
    1528| 
    1529|     mystif.relationships = initializeRomantic(mystif.relationships, 'gâ€¦
       |                            ^
    1530|     human.relationships = initializeRomantic(human.relationships, 'pieâ€¦
    1531| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[48/746]âŽ¯

 FAIL  packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Power Grid Edge Cases > should handle zero power generation
 FAIL  packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Power Grid Edge Cases > should handle zero power consumption
 FAIL  packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Power Grid Edge Cases > should handle disconnected power networks
 FAIL  packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Power Grid Edge Cases > should handle power network with no generators
 FAIL  packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Belt Edge Cases > should handle removing more items than available
 FAIL  packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Belt Edge Cases > should handle adding zero items
 FAIL  packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Belt Edge Cases > should handle removing zero items
 FAIL  packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Belt Edge Cases > should not accept items when belt type differs
 FAIL  packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Belt Edge Cases > should accept same item type when space available
 FAIL  packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Belt Edge Cases > should reject items exceeding capacity
 FAIL  packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Belt Edge Cases > should handle belt transfer to non-existent target
 FAIL  packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Assembly Machine Edge Cases > should handle missing recipe gracefully
 FAIL  packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Assembly Machine Edge Cases > should handle incomplete ingredients
 FAIL  packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Assembly Machine Edge Cases > should handle partial ingredients
 FAIL  packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Assembly Machine Edge Cases > should resume production when output space becomes available
 FAIL  packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Assembly Machine Edge Cases > should handle machine with no power component
 FAIL  packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > Assembly Machine Edge Cases > should handle very long crafting times
 FAIL  packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > System Integration Edge Cases > should handle empty entity list
 FAIL  packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > System Integration Edge Cases > should handle very small deltaTime
 FAIL  packages/core/src/__tests__/AutomationEdgeCases.test.ts > Automation Edge Cases > System Integration Edge Cases > should handle very large deltaTime
Error: Recipe missing required field: description
 â¯ RecipeRegistry.registerRecipe packages/core/src/crafting/RecipeRegistry.ts:27:13
     25|     }
     26|     if (!recipe.description) {
     27|       throw new Error('Recipe missing required field: description');
       |             ^
     28|     }
     29|     if (!recipe.ingredients || recipe.ingredients.length === 0) {
 â¯ packages/core/src/__tests__/AutomationEdgeCases.test.ts:50:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[49/746]âŽ¯

 FAIL  packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Power Grid System > should distribute power from generator to consumer
 FAIL  packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Power Grid System > should handle insufficient power
 FAIL  packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Power Grid System > should not connect different power types
 FAIL  packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Belt System > should transfer items along belt chain
 FAIL  packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Belt System > should enforce single resource type per belt
 FAIL  packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Belt System > should respect capacity limits
 FAIL  packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Direct Connection System > should transfer items directly between adjacent machines
 FAIL  packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Assembly Machine System > should craft items when powered and ingredients available
 FAIL  packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Assembly Machine System > should halt when output is full
 FAIL  packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Assembly Machine System > should respect power efficiency
 FAIL  packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Assembly Machine System > should not craft without power
 FAIL  packages/core/src/__tests__/AutomationIntegration.test.ts > Automation Integration Tests > Full Factory Integration > should run a complete powered belt â†’ assembly workflow
Error: Recipe missing required field: description
 â¯ RecipeRegistry.registerRecipe packages/core/src/crafting/RecipeRegistry.ts:27:13
     25|     }
     26|     if (!recipe.description) {
     27|       throw new Error('Recipe missing required field: description');
       |             ^
     28|     }
     29|     if (!recipe.ingredients || recipe.ingredients.length === 0) {
 â¯ packages/core/src/__tests__/AutomationIntegration.test.ts:67:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[50/746]âŽ¯

 FAIL  packages/core/src/__tests__/BehaviorEndToEnd.integration.test.ts > Behavior End-to-End Integration Tests > Resource Gathering Behaviors > Gather Behavior - Resources > should harvest resources when adjacent
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/__tests__/BehaviorEndToEnd.integration.test.ts:287:54
    285|         // Either inventory has resources OR resource was depleted
    286|         const resourceComp = resource.getComponent(ComponentType.Resouâ€¦
    287|         expect(hasStone || resourceComp.amount < 50).toBe(true);
       |                                                      ^
    288|       });
    289| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[51/746]âŽ¯

 FAIL  packages/core/src/__tests__/BehaviorEndToEnd.integration.test.ts > Behavior End-to-End Integration Tests > Resource Gathering Behaviors > Gather Behavior - Resources > should emit resource:gathered event when harvesting
AssertionError: expected 0 to be greater than 0
 â¯ packages/core/src/__tests__/BehaviorEndToEnd.integration.test.ts:306:39
    304| 
    305|         const gatheredEvents = harness.getEmittedEvents('resource:gathâ€¦
    306|         expect(gatheredEvents.length).toBeGreaterThan(0);
       |                                       ^
    307| 
    308|         if (gatheredEvents.length > 0) {

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[52/746]âŽ¯

 FAIL  packages/core/src/__tests__/BeliefAttribution.integration.test.ts > Belief Attribution System - E2E Integration > Domain Belief Accumulation > should accumulate domain-specific belief from perceived powers
TypeError: createInitialPerceivedIdentity is not a function
 â¯ packages/core/src/__tests__/BeliefAttribution.integration.test.ts:76:24
     74| 
     75|       // Create perceived identity - believers think this god controlsâ€¦
     76|       const identity = createInitialPerceivedIdentity();
       |                        ^
     77| 
     78|       // Process a witnessed miracle - god summoned lightning

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[53/746]âŽ¯

 FAIL  packages/core/src/__tests__/BeliefAttribution.integration.test.ts > Belief Attribution System - E2E Integration > Domain Belief Accumulation > should split belief contribution based on perceived domains
TypeError: calculateBeliefContribution is not a function
 â¯ packages/core/src/__tests__/BeliefAttribution.integration.test.ts:106:28
    104|       };
    105| 
    106|       const contribution = calculateBeliefContribution(
       |                            ^
    107|         10.0, // Total belief
    108|         perceivedDomains,

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[54/746]âŽ¯

 FAIL  packages/core/src/__tests__/BeliefAttribution.integration.test.ts > Belief Attribution System - E2E Integration > Miracle and Prayer Bonuses > should give larger bonus for first witnessed miracle in a domain
TypeError: createInitialPerceivedIdentity is not a function
 â¯ packages/core/src/__tests__/BeliefAttribution.integration.test.ts:131:24
    129|   describe('Miracle and Prayer Bonuses', () => {
    130|     it('should give larger bonus for first witnessed miracle in a domaâ€¦
    131|       const identity = createInitialPerceivedIdentity();
       |                        ^
    132| 
    133|       // First miracle

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[55/746]âŽ¯

 FAIL  packages/core/src/__tests__/BeliefAttribution.integration.test.ts > Belief Attribution System - E2E Integration > Miracle and Prayer Bonuses > should give exact match bonus for answered prayers
TypeError: createInitialPerceivedIdentity is not a function
 â¯ packages/core/src/__tests__/BeliefAttribution.integration.test.ts:146:24
    144| 
    145|     it('should give exact match bonus for answered prayers', () => {
    146|       const identity = createInitialPerceivedIdentity();
       |                        ^
    147| 
    148|       // Prayer was exactly answered

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[56/746]âŽ¯

 FAIL  packages/core/src/__tests__/BeliefAttribution.integration.test.ts > Belief Attribution System - E2E Integration > Misattribution System > should create new domain perception from misattributed event
TypeError: createInitialPerceivedIdentity is not a function
 â¯ packages/core/src/__tests__/BeliefAttribution.integration.test.ts:209:24
    207|     it('should create new domain perception from misattributed event',â€¦
    208|       // A god gets blamed for something they didn't do
    209|       const identity = createInitialPerceivedIdentity();
       |                        ^
    210| 
    211|       // Event: Strange weather happens, blamed on the local deity

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[57/746]âŽ¯

 FAIL  packages/core/src/__tests__/BeliefAttribution.integration.test.ts > Belief Attribution System - E2E Integration > Misattribution System > should reinforce existing domain from repeated misattribution
TypeError: createInitialPerceivedIdentity is not a function
 â¯ packages/core/src/__tests__/BeliefAttribution.integration.test.ts:231:24
    229| 
    230|     it('should reinforce existing domain from repeated misattribution'â€¦
    231|       const identity = createInitialPerceivedIdentity();
       |                        ^
    232| 
    233|       // First misattribution

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[58/746]âŽ¯

 FAIL  packages/core/src/__tests__/BeliefAttribution.integration.test.ts > Belief Attribution System - E2E Integration > Full Attribution Flow > should complete full cycle: event -> attribution -> domain belief
TypeError: createInitialPerceivedIdentity is not a function
 â¯ packages/core/src/__tests__/BeliefAttribution.integration.test.ts:287:24
    285| 
    286|       // 2. Create perceived identity (initially empty)
    287|       const identity = createInitialPerceivedIdentity();
       |                        ^
    288| 
    289|       // 3. Supreme Creator does something

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[59/746]âŽ¯

 FAIL  packages/core/src/__tests__/BuildingSystem.test.ts > BuildingSystem > governance buildings > should add town hall component on completion
AssertionError: expected undefined not to be undefined
 â¯ packages/core/src/__tests__/BuildingSystem.test.ts:557:24
    555| 
    556|       const townHall = entity.getComponent(ComponentType.TownHall);
    557|       expect(townHall).toBeDefined();
       |                        ^
    558|     });
    559| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[60/746]âŽ¯

 FAIL  packages/core/src/__tests__/BuildingSystem.test.ts > BuildingSystem > governance buildings > should add census bureau component on completion
AssertionError: expected undefined not to be undefined
 â¯ packages/core/src/__tests__/BuildingSystem.test.ts:578:22
    576| 
    577|       const census = entity.getComponent(ComponentType.CensusBureau);
    578|       expect(census).toBeDefined();
       |                      ^
    579|     });
    580| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[61/746]âŽ¯

 FAIL  packages/core/src/__tests__/BuildingSystem.test.ts > BuildingSystem > governance buildings > should add weather station component on completion
AssertionError: expected undefined not to be undefined
 â¯ packages/core/src/__tests__/BuildingSystem.test.ts:599:23
    597| 
    598|       const weather = entity.getComponent(ComponentType.WeatherStationâ€¦
    599|       expect(weather).toBeDefined();
       |                       ^
    600|     });
    601| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[62/746]âŽ¯

 FAIL  packages/core/src/__tests__/BuildingSystem.test.ts > BuildingSystem > governance buildings > should add health clinic component on completion
AssertionError: expected undefined not to be undefined
 â¯ packages/core/src/__tests__/BuildingSystem.test.ts:620:22
    618| 
    619|       const clinic = entity.getComponent(ComponentType.HealthClinic);
    620|       expect(clinic).toBeDefined();
       |                      ^
    621|     });
    622|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[63/746]âŽ¯

 FAIL  packages/core/src/__tests__/ComboDetector.test.ts > ComboDetector - Combo Coverage > should detect all immortality loops
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/__tests__/ComboDetector.test.ts:400:117
    398|       const analysis = analyzeCombo(mage);
    399| 
    400|       expect(analysis.threats.some(t => t.exploitation.includes('immorâ€¦
       |                                                                                                                     ^
    401|     }
    402|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[64/746]âŽ¯

 FAIL  packages/core/src/__tests__/ComponentFormatUnification.integration.test.ts > Component Format Unification - Integration Tests > Error Handling in Systems (CLAUDE.md compliance) > should throw when helper function receives invalid data
AssertionError: expected [Function] to throw an error
 â¯ packages/core/src/__tests__/ComponentFormatUnification.integration.test.ts:334:10
    332|         // @ts-expect-error - Testing runtime error
    333|         isHungry({ hunger: 'invalid' });
    334|       }).toThrow();
       |          ^
    335|     });
    336| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[65/746]âŽ¯

 FAIL  packages/core/src/__tests__/ComponentFormatUnification.test.ts > Component Format Unification > Criterion 2: Helper Functions Use Single Type > NeedsComponent helper functions > isHungry should accept only NeedsComponent, not union type
AssertionError: expected true not to be true // Object.is equality
 â¯ packages/core/src/__tests__/ComponentFormatUnification.test.ts:92:28
     90|         expect(result).toBe(true);
     91|         // Should NOT handle legacy 0-100 scale with || logic
     92|         expect(result).not.toBe(needs.hunger < 40 || needs.hunger < 0.â€¦
       |                            ^
     93|       });
     94| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[66/746]âŽ¯

 FAIL  packages/core/src/__tests__/ComponentFormatUnification.test.ts > Component Format Unification > Criterion 2: Helper Functions Use Single Type > PersonalityComponent helper functions > getPersonalityDescription should accept only PersonalityComponent
AssertionError: expected 'curious and adventurous' to contain 'outgoing'

- Expected
+ Received

- outgoing
+ curious and adventurous

 â¯ packages/core/src/__tests__/ComponentFormatUnification.test.ts:156:29
    154| 
    155|         expect(description).toContain('curious'); // openness > 0.7
    156|         expect(description).toContain('outgoing'); // extraversion > 0â€¦
       |                             ^
    157|       });
    158| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[67/746]âŽ¯

 FAIL  packages/core/src/__tests__/ConflictIntegration.test.ts > ConflictIntegration > Full conflict flow > should complete full combat flow with all integrations
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/__tests__/ConflictIntegration.test.ts:148:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[68/746]âŽ¯

 FAIL  packages/core/src/__tests__/ConflictIntegration.test.ts > ConflictIntegration > Edge cases > should handle simultaneous death
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/__tests__/ConflictIntegration.test.ts:234:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[69/746]âŽ¯

 FAIL  packages/core/src/__tests__/ConflictIntegration.test.ts > ConflictIntegration > Edge cases > should handle injury affecting combat performance
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/__tests__/ConflictIntegration.test.ts:343:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[70/746]âŽ¯

 FAIL  packages/core/src/__tests__/ConflictIntegration.test.ts > ConflictIntegration > Error propagation > should propagate errors from injury application
Error: Invalid injury type: invalid
 â¯ Module.createInjuryComponent packages/core/src/components/InjuryComponent.ts:75:11
     73|   }
     74|   if (!VALID_INJURY_TYPES.includes(data.injuryType)) {
     75|     throw new Error(`Invalid injury type: ${data.injuryType}`);
       |           ^
     76|   }
     77|   if (!data.severity) {
 â¯ injury packages/core/src/World.ts:114:28
 â¯ EntityImpl.entity.addComponent packages/core/src/World.ts:260:27
 â¯ packages/core/src/__tests__/ConflictIntegration.test.ts:425:13

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[71/746]âŽ¯

 FAIL  packages/core/src/__tests__/Dashboard.test.ts > Built-in Views > ResourcesView > should format resources in text output
AssertionError: expected 'VILLAGE STOCKPILE\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â€¦' to contain 'wood: 50'

- Expected
+ Received

- wood: 50
+ VILLAGE STOCKPILE
+ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
+
+ The village has 80 items across 2 resource types:
+
+   ðŸª¨ 30 stone
+   ðŸªµ 50 wood
+
+ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
+ Storage: 1 building with 10 total slots
+ Plenty of space available: 8 of 10 slots free.
+ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘

 â¯ packages/core/src/__tests__/Dashboard.test.ts:442:20
    440|       const text = ResourcesView.textFormatter!(data);
    441| 
    442|       expect(text).toContain('wood: 50');
       |                    ^
    443|       expect(text).toContain('stone: 30');
    444|       expect(text).toContain('1 building(s)');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[72/746]âŽ¯

 FAIL  packages/core/src/__tests__/DivinityBodyIntegration.integration.test.ts > Divinity + Body Parts Integration > Divine Power Tracking > should track all modifications by a deity
AssertionError: expected 2 to be 3 // Object.is equality

- Expected
+ Received

- 3
+ 2

 â¯ packages/core/src/__tests__/DivinityBodyIntegration.integration.test.ts:450:36
    448| 
    449|       const modifications = divineBodySystem.getModificationsByDeity(dâ€¦
    450|       expect(modifications.length).toBe(3);
       |                                    ^
    451| 
    452|       // Check categories

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[73/746]âŽ¯

 FAIL  packages/core/src/__tests__/DivinityBodyIntegration.integration.test.ts > Divinity + Body Parts Integration > Divine Power Tracking > should get modifications on a specific target
AssertionError: expected 1 to be 2 // Object.is equality

- Expected
+ Received

- 2
+ 1

 â¯ packages/core/src/__tests__/DivinityBodyIntegration.integration.test.ts:489:36
    487|       // Check believer 1 has 2 modifications
    488|       const believer1Mods = divineBodySystem.getModificationsOnTarget(â€¦
    489|       expect(believer1Mods.length).toBe(2);
       |                                    ^
    490| 
    491|       // Check believer 2 has 1 modification

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[74/746]âŽ¯

 FAIL  packages/core/src/__tests__/DivinityBodyIntegration.integration.test.ts > Divinity + Body Parts Integration > Purpose Tracking > should track divine purpose for each modification
AssertionError: expected undefined not to be undefined
 â¯ packages/core/src/__tests__/DivinityBodyIntegration.integration.test.ts:580:24
    578|       const miracle = mods.find(m => m.purpose === 'miracle');
    579| 
    580|       expect(blessing).toBeDefined();
       |                        ^
    581|       expect(champion).toBeDefined();
    582|       expect(miracle).toBeDefined();

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[75/746]âŽ¯

 FAIL  packages/core/src/__tests__/DivinityComplete.integration.test.ts > Divinity System - Complete Integration > Phase 4: Emergent Gods > should manage AI god behavior
TypeError: entities is not iterable
 â¯ AIGodBehaviorSystem.update packages/core/src/systems/AIGodBehaviorSystem.ts:104:26
    102| 
    103|     // Process deity entities (already filtered by requiredComponents)
    104|     for (const entity of entities) {
       |                          ^
    105|       const deity = entity.components.get(CT.Deity) as DeityComponent;
    106| 
 â¯ packages/core/src/__tests__/DivinityComplete.integration.test.ts:212:27

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[76/746]âŽ¯

 FAIL  packages/core/src/__tests__/DivinityComplete.integration.test.ts > Divinity System - Complete Integration > Cross-Phase Integration > should integrate all phases in a complete simulation
TypeError: entities is not iterable
 â¯ AIGodBehaviorSystem.update packages/core/src/systems/AIGodBehaviorSystem.ts:104:26
    102| 
    103|     // Process deity entities (already filtered by requiredComponents)
    104|     for (const entity of entities) {
       |                          ^
    105|       const deity = entity.components.get(CT.Deity) as DeityComponent;
    106| 
 â¯ packages/core/src/__tests__/DivinityComplete.integration.test.ts:511:29

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[77/746]âŽ¯

 FAIL  packages/core/src/__tests__/EmergentSocialDynamics.test.ts > Phase 6: Emergent Social Dynamics > RelationshipConversationSystem > learns about partner interests through conversation
AssertionError: expected undefined not to be undefined
 â¯ packages/core/src/__tests__/EmergentSocialDynamics.test.ts:267:22
    265|       const memory = socialMemory!.memories.get(agent2.id);
    266| 
    267|       expect(memory).toBeDefined();
       |                      ^
    268|       expect(memory!.knownFacts.length).toBeGreaterThan(0);
    269| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[78/746]âŽ¯

 FAIL  packages/core/src/__tests__/EmergentSocialDynamics.test.ts > Phase 6: Emergent Social Dynamics > RelationshipConversationSystem > reinforces existing interest knowledge
TypeError: Cannot read properties of undefined (reading 'knownFacts')
 â¯ packages/core/src/__tests__/EmergentSocialDynamics.test.ts:308:32
    306|       const memory = socialMemory!.memories.get(agent2.id);
    307| 
    308|       const godsFact = memory!.knownFacts.find(f => f.value === 'the_gâ€¦
       |                                ^
    309|       expect(godsFact!.confidence).toBeGreaterThan(0.7); // 0.7 + 0.1 â€¦
    310|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[79/746]âŽ¯

 FAIL  packages/core/src/__tests__/HeroProtection.test.ts > HeroProtection > blessed hero gets positive luck modifier
 FAIL  packages/core/src/__tests__/HeroProtection.test.ts > HeroProtection > cursed hero gets negative luck modifier (anti-luck)
 FAIL  packages/core/src/__tests__/HeroProtection.test.ts > HeroProtection > neutral hero gets zero luck modifier
 FAIL  packages/core/src/__tests__/HeroProtection.test.ts > HeroProtection > agent without destiny gets no luck
 FAIL  packages/core/src/__tests__/HeroProtection.test.ts > HeroProtection > realized destiny provides no luck
 FAIL  packages/core/src/__tests__/HeroProtection.test.ts > HeroProtection > luck modifiers affect combat win rates
 FAIL  packages/core/src/__tests__/HeroProtection.test.ts > HeroProtection > cursed hero loses more often due to anti-luck
TypeError: World is not a constructor
 â¯ packages/core/src/__tests__/HeroProtection.test.ts:29:13
     27| 
     28|   beforeEach(() => {
     29|     world = new World();
       |             ^
     30|     combatSystem = new AgentCombatSystem();
     31|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[80/746]âŽ¯

 FAIL  packages/core/src/__tests__/MagicBodyIntegration.integration.test.ts > Magic + Body Integration Tests > Body Healing Integration > should heal specific injured body part
AssertionError: expected 30 to be less than 30
 â¯ packages/core/src/__tests__/MagicBodyIntegration.integration.test.ts:129:40
    127|       expect(arm.health).toBeGreaterThan(initialHealth);
    128|       expect(arm.injuries.some(i => i.bleedRate === 0)).toBe(true); //â€¦
    129|       expect(calculateTotalPain(body)).toBeLessThan(initialPain);
       |                                        ^
    130|     });
    131| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[81/746]âŽ¯

 FAIL  packages/core/src/__tests__/MagicBodyIntegration.integration.test.ts > Magic + Body Integration Tests > Body Healing Integration > should mend fractures instantly
AssertionError: expected undefined not to be undefined
 â¯ packages/core/src/__tests__/MagicBodyIntegration.integration.test.ts:183:29
    181|       expect(result.success).toBe(true);
    182|       const fractureAfter = arm.injuries.find(i => i.type === 'fracturâ€¦
    183|       expect(fractureAfter).toBeDefined();
       |                             ^
    184|       expect(fractureAfter?.healingProgress).toBe(100);
    185|       expect(arm.splinted).toBe(true);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[82/746]âŽ¯

 FAIL  packages/core/src/__tests__/MagicBodyIntegration.integration.test.ts > Magic + Body Integration Tests > Complex Transformation Scenarios > should handle stacking transformations
AssertionError: expected 2 to be greater than or equal to 3
 â¯ packages/core/src/__tests__/MagicBodyIntegration.integration.test.ts:471:41
    469|       });
    470| 
    471|       expect(body.modifications.length).toBeGreaterThanOrEqual(3);
       |                                         ^
    472|     });
    473| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[83/746]âŽ¯

 FAIL  packages/core/src/__tests__/MagicNumbersExtraction.test.ts > Magic Numbers Extraction > NeedsConstants > should define temperature constants
AssertionError: expected 18 to be 20 // Object.is equality

- Expected
+ Received

- 20
+ 18

 â¯ packages/core/src/__tests__/MagicNumbersExtraction.test.ts:311:31
    309| 
    310|       expect(BODY_TEMP_NORMAL).toBe(37);
    311|       expect(WORLD_TEMP_BASE).toBe(20);
       |                               ^
    312|       expect(TEMP_DAILY_VARIATION).toBe(8);
    313|       expect(THERMAL_CHANGE_RATE).toBe(0.15);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[84/746]âŽ¯

 FAIL  packages/core/src/__tests__/MagicSystemAdversarial.test.ts > Adversarial - Paradigm Validation Gaps > should expose: no validation of required channels
AssertionError: expected 0 to be greater than 0
 â¯ packages/core/src/__tests__/MagicSystemAdversarial.test.ts:335:48
    333| 
    334|     // Validation returns required channels
    335|     expect(validation.requiredChannels.length).toBeGreaterThan(0);
       |                                                ^
    336| 
    337|     // But nothing checks if caster HAS those channels

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[85/746]âŽ¯

 FAIL  packages/core/src/__tests__/MagicSystemBreaking.test.ts > Magic System Breaking - Cross-Paradigm Chaos > should handle paradox magic breaking other paradigms
AssertionError: expected 0 to be greater than 0
 â¯ packages/core/src/__tests__/MagicSystemBreaking.test.ts:478:38
    476|     // Paradox magic should have catastrophic risks
    477|     const catastrophicRisks = validation.risks.filter((r) => r.risk.seâ€¦
    478|     expect(catastrophicRisks.length).toBeGreaterThan(0);
       |                                      ^
    479| 
    480|     // Check if reality_tear risk exists

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[86/746]âŽ¯

 FAIL  packages/core/src/__tests__/MagicalSkillBonuses.test.ts > MagicalSkillBonuses > single magical item provides skill bonus
 FAIL  packages/core/src/__tests__/MagicalSkillBonuses.test.ts > MagicalSkillBonuses > multiple items stack their bonuses
 FAIL  packages/core/src/__tests__/MagicalSkillBonuses.test.ts > MagicalSkillBonuses > negative bonuses (curses) work correctly
 FAIL  packages/core/src/__tests__/MagicalSkillBonuses.test.ts > MagicalSkillBonuses > bonuses are cleared when equipment is removed
 FAIL  packages/core/src/__tests__/MagicalSkillBonuses.test.ts > MagicalSkillBonuses > complex stacking with positive and negative bonuses
TypeError: World is not a constructor
 â¯ packages/core/src/__tests__/MagicalSkillBonuses.test.ts:27:13
     25| 
     26|   beforeEach(() => {
     27|     world = new World();
       |             ^
     28|     equipmentSystem = new EquipmentSystem();
     29| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[87/746]âŽ¯

 FAIL  packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Initialization > should create storage directory if it does not exist
Error: ENOENT: no such file or directory, stat '/Users/annhoward/src/ai_village/custom_game_engine/packages/core/test-metrics-storage'
 â¯ packages/core/src/__tests__/MetricsStorage.test.ts:28:21
     26|     it('should create storage directory if it does not exist', async (â€¦
     27|       await storage.initialize();
     28|       const stats = await fs.stat(tempDir);
       |                     ^
     29|       expect(stats.isDirectory()).toBe(true);
     30|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { errno: -2, code: 'ENOENT', syscall: 'stat', path: '/Users/annhoward/src/ai_village/custom_game_engine/packages/core/test-metrics-storage' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[88/746]âŽ¯

 FAIL  packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Warm Storage (Session) > should persist session metrics to disk
Error: saveSession is not available in browser mode
 â¯ MetricsStorage.saveSession packages/core/src/metrics/MetricsStorage.ts:248:13
    246|   async saveSession(sessionData: SessionData): Promise<void> {
    247|     if (isBrowser) {
    248|       throw new Error('saveSession is not available in browser mode');
       |             ^
    249|     }
    250| 
 â¯ packages/core/src/__tests__/MetricsStorage.test.ts:130:21

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[89/746]âŽ¯

 FAIL  packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Warm Storage (Session) > should load session metrics from disk
Error: saveSession is not available in browser mode
 â¯ MetricsStorage.saveSession packages/core/src/metrics/MetricsStorage.ts:248:13
    246|   async saveSession(sessionData: SessionData): Promise<void> {
    247|     if (isBrowser) {
    248|       throw new Error('saveSession is not available in browser mode');
       |             ^
    249|     }
    250| 
 â¯ packages/core/src/__tests__/MetricsStorage.test.ts:146:21

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[90/746]âŽ¯

 FAIL  packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Warm Storage (Session) > should throw when loading non-existent session
AssertionError: expected [Function] to throw error including 'Session not found: nonexistent' but got 'loadSession is not available in browsâ€¦'

- Expected
+ Received

- Session not found: nonexistent
+ loadSession is not available in browser mode

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[91/746]âŽ¯

 FAIL  packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Warm Storage (Session) > should list all available sessions
Error: saveSession is not available in browser mode
 â¯ MetricsStorage.saveSession packages/core/src/metrics/MetricsStorage.ts:248:13
    246|   async saveSession(sessionData: SessionData): Promise<void> {
    247|     if (isBrowser) {
    248|       throw new Error('saveSession is not available in browser mode');
       |             ^
    249|     }
    250| 
 â¯ packages/core/src/__tests__/MetricsStorage.test.ts:158:21

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[92/746]âŽ¯

 FAIL  packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Warm Storage (Session) > should delete old sessions
Error: saveSession is not available in browser mode
 â¯ MetricsStorage.saveSession packages/core/src/metrics/MetricsStorage.ts:248:13
    246|   async saveSession(sessionData: SessionData): Promise<void> {
    247|     if (isBrowser) {
    248|       throw new Error('saveSession is not available in browser mode');
       |             ^
    249|     }
    250| 
 â¯ packages/core/src/__tests__/MetricsStorage.test.ts:179:21

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[93/746]âŽ¯

 FAIL  packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Cold Storage (Archive) > should compress and archive old metrics
Error: archiveMetrics is not available in browser mode
 â¯ MetricsStorage.archiveMetrics packages/core/src/metrics/MetricsStorage.ts:329:13
    327|   async archiveMetrics(metrics: StoredMetric[], archiveName: string): â€¦
    328|     if (isBrowser) {
    329|       throw new Error('archiveMetrics is not available in browser modeâ€¦
       |             ^
    330|     }
    331| 
 â¯ packages/core/src/__tests__/MetricsStorage.test.ts:210:21

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[94/746]âŽ¯

 FAIL  packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Cold Storage (Archive) > should decompress archived metrics
Error: archiveMetrics is not available in browser mode
 â¯ MetricsStorage.archiveMetrics packages/core/src/metrics/MetricsStorage.ts:329:13
    327|   async archiveMetrics(metrics: StoredMetric[], archiveName: string): â€¦
    328|     if (isBrowser) {
    329|       throw new Error('archiveMetrics is not available in browser modeâ€¦
       |             ^
    330|     }
    331| 
 â¯ packages/core/src/__tests__/MetricsStorage.test.ts:227:21

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[95/746]âŽ¯

 FAIL  packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Cold Storage (Archive) > should list all available archives
Error: archiveMetrics is not available in browser mode
 â¯ MetricsStorage.archiveMetrics packages/core/src/metrics/MetricsStorage.ts:329:13
    327|   async archiveMetrics(metrics: StoredMetric[], archiveName: string): â€¦
    328|     if (isBrowser) {
    329|       throw new Error('archiveMetrics is not available in browser modeâ€¦
       |             ^
    330|     }
    331| 
 â¯ packages/core/src/__tests__/MetricsStorage.test.ts:235:21

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[96/746]âŽ¯

 FAIL  packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Cold Storage (Archive) > should calculate archive size
Error: archiveMetrics is not available in browser mode
 â¯ MetricsStorage.archiveMetrics packages/core/src/metrics/MetricsStorage.ts:329:13
    327|   async archiveMetrics(metrics: StoredMetric[], archiveName: string): â€¦
    328|     if (isBrowser) {
    329|       throw new Error('archiveMetrics is not available in browser modeâ€¦
       |             ^
    330|     }
    331| 
 â¯ packages/core/src/__tests__/MetricsStorage.test.ts:252:21

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[97/746]âŽ¯

 FAIL  packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Cold Storage (Archive) > should delete old archives
Error: archiveMetrics is not available in browser mode
 â¯ MetricsStorage.archiveMetrics packages/core/src/metrics/MetricsStorage.ts:329:13
    327|   async archiveMetrics(metrics: StoredMetric[], archiveName: string): â€¦
    328|     if (isBrowser) {
    329|       throw new Error('archiveMetrics is not available in browser modeâ€¦
       |             ^
    330|     }
    331| 
 â¯ packages/core/src/__tests__/MetricsStorage.test.ts:259:21

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[98/746]âŽ¯

 FAIL  packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Data Integrity > should validate session data before saving
AssertionError: expected [Function] to throw error including 'Session must have a valid sessionId' but got 'saveSession is not available in browsâ€¦'

- Expected
+ Received

- Session must have a valid sessionId
+ saveSession is not available in browser mode

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[99/746]âŽ¯

 FAIL  packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Data Integrity > should detect corrupted archive files
AssertionError: expected [Function] to throw error including 'Failed to load archive' but got 'loadArchive is not available in browsâ€¦'

- Expected
+ Received

- Failed to load archive
+ loadArchive is not available in browser mode

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[100/746]âŽ¯

 FAIL  packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Data Integrity > should verify checksums for archived data
Error: archiveMetrics is not available in browser mode
 â¯ MetricsStorage.archiveMetrics packages/core/src/metrics/MetricsStorage.ts:329:13
    327|   async archiveMetrics(metrics: StoredMetric[], archiveName: string): â€¦
    328|     if (isBrowser) {
    329|       throw new Error('archiveMetrics is not available in browser modeâ€¦
       |             ^
    330|     }
    331| 
 â¯ packages/core/src/__tests__/MetricsStorage.test.ts:435:21

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[101/746]âŽ¯

 FAIL  packages/core/src/__tests__/MetricsStorage.test.ts > MetricsStorage > Error Handling > should handle permission errors
AssertionError: promise resolved "undefined" instead of rejecting

- Expected: 
[Error: rejected promise]

+ Received: 
undefined

 â¯ packages/core/src/__tests__/MetricsStorage.test.ts:461:48
    459|       const readOnlyStorage = new MetricsStorage('/read-only-path');
    460| 
    461|       await expect(readOnlyStorage.initialize()).rejects.toThrow();
       |                                                ^
    462|     });
    463| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[102/746]âŽ¯

 FAIL  packages/core/src/__tests__/MiningMetalworking.integration.test.ts > Mining & Metalworking System Integration Tests > Metal Tools and Weapons (Uses Ingots) > should have iron_sword craftable from iron_ingot
AssertionError: expected undefined not to be undefined
 â¯ packages/core/src/__tests__/MiningMetalworking.integration.test.ts:227:25
    225|       const ironSword = WEAPON_ITEMS.find((i) => i.id === 'iron_sword'â€¦
    226| 
    227|       expect(ironSword).toBeDefined();
       |                         ^
    228|       expect(ironSword!.category).toBe('equipment');
    229| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[103/746]âŽ¯

 FAIL  packages/core/src/__tests__/MiningMetalworking.integration.test.ts > Mining & Metalworking System Integration Tests > Metal Tools and Weapons (Uses Ingots) > should have steel_sword craftable from steel_ingot
AssertionError: expected undefined not to be undefined
 â¯ packages/core/src/__tests__/MiningMetalworking.integration.test.ts:238:26
    236|       const steelSword = WEAPON_ITEMS.find((i) => i.id === 'steel_sworâ€¦
    237| 
    238|       expect(steelSword).toBeDefined();
       |                          ^
    239|       expect(steelSword!.rarity).toBe('rare');
    240| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[104/746]âŽ¯

 FAIL  packages/core/src/__tests__/MiningMetalworking.integration.test.ts > Mining & Metalworking System Integration Tests > Complete Mining â†’ Smelting â†’ Crafting Chain Verification > should verify steel chain: iron_ingot + coal â†’ steel_ingot â†’ weapon
TypeError: Cannot read properties of undefined (reading 'find')
 â¯ packages/core/src/__tests__/MiningMetalworking.integration.test.ts:400:49
    398| 
    399|       // Verify steel sword requires steel ingot
    400|       const steelReq = steelSword!.craftedFrom!.find((c) => c.itemId =â€¦
       |                                                 ^
    401|       expect(steelReq).toBeDefined();
    402|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[105/746]âŽ¯

 FAIL  packages/core/src/__tests__/NeedsSystem.test.ts > NeedsSystem > critical needs events > should emit need:critical event when hunger drops below 20
AssertionError: expected 0 to be greater than 0
 â¯ packages/core/src/__tests__/NeedsSystem.test.ts:396:42
    394|         call => call[0].data.needType === 'hunger'
    395|       );
    396|       expect(hungerCriticalCalls.length).toBeGreaterThan(0);
       |                                          ^
    397|     });
    398| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[106/746]âŽ¯

 FAIL  packages/core/src/__tests__/NeedsSystem.test.ts > NeedsSystem > starvation > should emit agent:starved event when both hunger and energy reach zero
AssertionError: expected "spy" to be called at least once
 â¯ packages/core/src/__tests__/NeedsSystem.test.ts:483:30
    481| 
    482|       world.eventBus.flush();
    483|       expect(starvedHandler).toHaveBeenCalled();
       |                              ^
    484|     });
    485| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[107/746]âŽ¯

 FAIL  packages/core/src/__tests__/PlantSeedProduction.test.ts > PlantSeedProduction Integration > should produce seeds when transitioning vegetative â†’ mature
AssertionError: expected 'vegetative' to be 'mature' // Object.is equality

- Expected
+ Received

- mature
+ vegetative

 â¯ packages/core/src/__tests__/PlantSeedProduction.test.ts:119:25
    117| 
    118|     // Plant should have transitioned to mature
    119|     expect(plant.stage).toBe('mature');
       |                         ^
    120| 
    121|     // Plant should have produced seeds

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[108/746]âŽ¯

 FAIL  packages/core/src/__tests__/PlantSeedProduction.test.ts > PlantSeedProduction Integration > should produce MORE seeds when transitioning mature â†’ seeding
AssertionError: expected 'mature' to be 'seeding' // Object.is equality

- Expected
+ Received

- seeding
+ mature

 â¯ packages/core/src/__tests__/PlantSeedProduction.test.ts:157:25
    155| 
    156|     // Plant should have transitioned to seeding
    157|     expect(plant.stage).toBe('seeding');
       |                         ^
    158| 
    159|     // Plant should have produced MORE seeds (10 from before + 10 fromâ€¦

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[109/746]âŽ¯

 FAIL  packages/core/src/__tests__/PlantSeedProduction.test.ts > PlantSeedProduction Integration > should produce seeds correctly through full lifecycle vegetative â†’ mature â†’ seeding
AssertionError: expected 'vegetative' to be 'mature' // Object.is equality

- Expected
+ Received

- mature
+ vegetative

 â¯ packages/core/src/__tests__/PlantSeedProduction.test.ts:192:25
    190|     plantSystem.update(world, entities, 0.1);
    191| 
    192|     expect(plant.stage).toBe('mature');
       |                         ^
    193|     expect(plant.seedsProduced).toBe(10);
    194| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[110/746]âŽ¯

 FAIL  packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > update - plant lifecycle > should throw when plant missing position field
AssertionError: expected [Function] to throw an error

- Expected: 
null

+ Received: 
undefined

 â¯ packages/core/src/__tests__/PlantSystem.test.ts:144:57
    142|       const entities = world.query().with(ComponentType.Plant).executeâ€¦
    143| 
    144|       expect(() => system.update(world, entities, 1.0)).toThrow(/missiâ€¦
       |                                                         ^
    145|     });
    146| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[111/746]âŽ¯

 FAIL  packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > update - plant lifecycle > should decrease hydration over time
AssertionError: expected 80 to be less than 80
 â¯ packages/core/src/__tests__/PlantSystem.test.ts:194:36
    192| 
    193|       const plantAfter = entity.getComponent(ComponentType.Plant) as Pâ€¦
    194|       expect(plantAfter.hydration).toBeLessThan(initialHydration);
       |                                    ^
    195|     });
    196|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[112/746]âŽ¯

 FAIL  packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > error handling - validation > should throw when plant missing health field
AssertionError: expected [Function] to throw an error

- Expected: 
null

+ Received: 
undefined

 â¯ packages/core/src/__tests__/PlantSystem.test.ts:215:57
    213|       const entities = world.query().with(ComponentType.Plant).executeâ€¦
    214| 
    215|       expect(() => system.update(world, entities, 1.0)).toThrow(/Plantâ€¦
       |                                                         ^
    216|     });
    217| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[113/746]âŽ¯

 FAIL  packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > error handling - validation > should throw when plant missing hydration field
AssertionError: expected [Function] to throw an error

- Expected: 
null

+ Received: 
undefined

 â¯ packages/core/src/__tests__/PlantSystem.test.ts:234:57
    232|       const entities = world.query().with(ComponentType.Plant).executeâ€¦
    233| 
    234|       expect(() => system.update(world, entities, 1.0)).toThrow(/Plantâ€¦
       |                                                         ^
    235|     });
    236| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[114/746]âŽ¯

 FAIL  packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > error handling - validation > should throw when plant missing nutrition field
AssertionError: expected [Function] to throw an error

- Expected: 
null

+ Received: 
undefined

 â¯ packages/core/src/__tests__/PlantSystem.test.ts:253:57
    251|       const entities = world.query().with(ComponentType.Plant).executeâ€¦
    252| 
    253|       expect(() => system.update(world, entities, 1.0)).toThrow(/Plantâ€¦
       |                                                         ^
    254|     });
    255|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[115/746]âŽ¯

 FAIL  packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > plant health and damage > should damage plant when hydration is low
AssertionError: expected 100 to be less than 100
 â¯ packages/core/src/__tests__/PlantSystem.test.ts:278:33
    276| 
    277|       const plantAfter = entity.getComponent(ComponentType.Plant) as Pâ€¦
    278|       expect(plantAfter.health).toBeLessThan(100);
       |                                 ^
    279|     });
    280| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[116/746]âŽ¯

 FAIL  packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > plant health and damage > should damage plant when nutrition is low
AssertionError: expected 100 to be less than 100
 â¯ packages/core/src/__tests__/PlantSystem.test.ts:301:33
    299| 
    300|       const plantAfter = entity.getComponent(ComponentType.Plant) as Pâ€¦
    301|       expect(plantAfter.health).toBeLessThan(100);
       |                                 ^
    302|     });
    303| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[117/746]âŽ¯

 FAIL  packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > plant health and damage > should set stage to dead when health reaches zero
AssertionError: expected 'vegetative' to be 'dead' // Object.is equality

- Expected
+ Received

- dead
+ vegetative

 â¯ packages/core/src/__tests__/PlantSystem.test.ts:353:32
    351| 
    352|       const plantAfter = entity.getComponent(ComponentType.Plant) as Pâ€¦
    353|       expect(plantAfter.stage).toBe('dead');
       |                                ^
    354|     });
    355| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[118/746]âŽ¯

 FAIL  packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > weather effects > should increase hydration when rain event occurs
AssertionError: expected 50 to be greater than 50
 â¯ packages/core/src/__tests__/PlantSystem.test.ts:405:36
    403|       const plantAfter = entity.getComponent(ComponentType.Plant) as Pâ€¦
    404|       // Heavy rain should add 30 to hydration, minus natural decay
    405|       expect(plantAfter.hydration).toBeGreaterThan(50);
       |                                    ^
    406|     });
    407| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[119/746]âŽ¯

 FAIL  packages/core/src/__tests__/PlantSystem.test.ts > PlantSystem > stage transitions > should advance stageProgress over time
AssertionError: expected 0 to be greater than 0
 â¯ packages/core/src/__tests__/PlantSystem.test.ts:495:40
    493| 
    494|       const plantAfter = entity.getComponent(ComponentType.Plant) as Pâ€¦
    495|       expect(plantAfter.stageProgress).toBeGreaterThan(0);
       |                                        ^
    496|     });
    497| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[120/746]âŽ¯

 FAIL  packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Criterion 1: Power Consumers Drain Power > should reduce available power by consumer consumption when connected to network
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 â¯ packages/core/src/__tests__/PowerConsumption.test.ts:40:31
     38|       // Assert: Network should show 100 kW generation, 50 kW consumptâ€¦
     39|       const networks = powerGridSystem.getNetworks();
     40|       expect(networks.length).toBe(1);
       |                               ^
     41|       expect(networks[0].totalGeneration).toBe(100);
     42|       expect(networks[0].totalConsumption).toBe(50);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[121/746]âŽ¯

 FAIL  packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Criterion 1: Power Consumers Drain Power > should set isPowered=true when sufficient power available
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/__tests__/PowerConsumption.test.ts:62:39
     60| 
     61|       // Assert: Consumer should be powered
     62|       expect(consumerPower.isPowered).toBe(true);
       |                                       ^
     63|       expect(consumerPower.efficiency).toBe(1.0);
     64|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[122/746]âŽ¯

 FAIL  packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Criterion 1: Power Consumers Drain Power > should handle multiple consumers draining total power
TypeError: Cannot read properties of undefined (reading 'totalConsumption')
 â¯ packages/core/src/__tests__/PowerConsumption.test.ts:88:26
     86|       // Assert: Both consumers should be powered, total consumption =â€¦
     87|       const networks = powerGridSystem.getNetworks();
     88|       expect(networks[0].totalConsumption).toBe(60);
       |                          ^
     89|       expect(consumer1Power.isPowered).toBe(true);
     90|       expect(consumer2Power.isPowered).toBe(true);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[123/746]âŽ¯

 FAIL  packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Criterion 2: Power Producers Generate Power > should add generation value to network available power
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 â¯ packages/core/src/__tests__/PowerConsumption.test.ts:107:31
    105|       // Assert: Network should show 100 kW generation
    106|       const networks = powerGridSystem.getNetworks();
    107|       expect(networks.length).toBe(1);
       |                               ^
    108|       expect(networks[0].totalGeneration).toBe(100);
    109|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[124/746]âŽ¯

 FAIL  packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Criterion 2: Power Producers Generate Power > should respect producer efficiency modifier
TypeError: Cannot read properties of undefined (reading 'totalGeneration')
 â¯ packages/core/src/__tests__/PowerConsumption.test.ts:125:26
    123|       // Assert: Network should show 50 kW generation (100 * 0.5)
    124|       const networks = powerGridSystem.getNetworks();
    125|       expect(networks[0].totalGeneration).toBe(50);
       |                          ^
    126|     });
    127| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[125/746]âŽ¯

 FAIL  packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Criterion 2: Power Producers Generate Power > should combine multiple producers in same network
TypeError: Cannot read properties of undefined (reading 'totalGeneration')
 â¯ packages/core/src/__tests__/PowerConsumption.test.ts:144:26
    142|       // Assert: Network should show 100 kW total generation
    143|       const networks = powerGridSystem.getNetworks();
    144|       expect(networks[0].totalGeneration).toBe(100);
       |                          ^
    145|     });
    146|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[126/746]âŽ¯

 FAIL  packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Criterion 3: Insufficient Power Causes Brownout > should reduce efficiency based on availability when underpowered
AssertionError: expected 1 to be 0.5 // Object.is equality

- Expected
+ Received

- 0.5
+ 1

 â¯ packages/core/src/__tests__/PowerConsumption.test.ts:184:40
    182| 
    183|       // Assert: Efficiency should be 0.5 (50 kW / 100 kW)
    184|       expect(consumerPower.efficiency).toBe(0.5);
       |                                        ^
    185|     });
    186| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[127/746]âŽ¯

 FAIL  packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Criterion 3: Insufficient Power Causes Brownout > should handle zero power generation gracefully
AssertionError: expected 1 to be +0 // Object.is equality

- Expected
+ Received

- 0
+ 1

 â¯ packages/core/src/__tests__/PowerConsumption.test.ts:200:40
    198|       // Assert: Consumer should not be powered, efficiency = 0
    199|       expect(consumerPower.isPowered).toBe(false);
    200|       expect(consumerPower.efficiency).toBe(0);
       |                                        ^
    201|     });
    202|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[128/746]âŽ¯

 FAIL  packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Error Handling > should handle negative power values as zero
TypeError: Cannot read properties of undefined (reading 'totalGeneration')
 â¯ packages/core/src/__tests__/PowerConsumption.test.ts:267:26
    265|       // 2. Throw on negative values: expect(() => ...).toThrow();
    266|       // For now, we document the behavior
    267|       expect(networks[0].totalGeneration).toBeLessThan(0); // Current â€¦
       |                          ^
    268|     });
    269|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[129/746]âŽ¯

 FAIL  packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Network Isolation > should create separate networks for different power types
AssertionError: expected +0 to be 2 // Object.is equality

- Expected
+ Received

- 2
+ 0

 â¯ packages/core/src/__tests__/PowerConsumption.test.ts:288:31
    286|       // Assert: Should have 2 separate networks
    287|       const networks = powerGridSystem.getNetworks();
    288|       expect(networks.length).toBe(2);
       |                               ^
    289| 
    290|       const electricalNetwork = networks.find(n => n.powerType === 'elâ€¦

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[130/746]âŽ¯

 FAIL  packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Network Isolation > should not power consumer if no network connection exists
AssertionError: expected +0 to be 2 // Object.is equality

- Expected
+ Received

- 2
+ 0

 â¯ packages/core/src/__tests__/PowerConsumption.test.ts:314:31
    312|       // Assert: Should have 2 separate networks, consumer not powered
    313|       const networks = powerGridSystem.getNetworks();
    314|       expect(networks.length).toBe(2);
       |                               ^
    315|       expect(consumerPower.isPowered).toBe(false);
    316|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[131/746]âŽ¯

 FAIL  packages/core/src/__tests__/PowerConsumption.test.ts > Power Consumption System > Power Pole Connections > should connect generator to consumer via power pole
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 â¯ packages/core/src/__tests__/PowerConsumption.test.ts:354:31
    352|       // Assert: All should be in same network, consumer powered
    353|       const networks = powerGridSystem.getNetworks();
    354|       expect(networks.length).toBe(1);
       |                               ^
    355|       expect(networks[0].entities.size).toBe(3);
    356|       expect(consumerPower.isPowered).toBe(true);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[132/746]âŽ¯

 FAIL  packages/core/src/__tests__/ProgressiveSkillReveal.test.ts > Random Starting Skills > generateRandomStartingSkills > should favor skills that match personality affinities (statistical)
AssertionError: expected 52 to be greater than or equal to 60
 â¯ packages/core/src/__tests__/ProgressiveSkillReveal.test.ts:120:33
    118| 
    119|       // At least 60% should have high-affinity skills (weighted randoâ€¦
    120|       expect(highAffinityCount).toBeGreaterThanOrEqual(60);
       |                                 ^
    121|     });
    122| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[133/746]âŽ¯

 FAIL  packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Criterion 4: Reality Anchor Charging Consumes Power > should drain 5,000,000 kW during charging phase
TypeError: Cannot read properties of undefined (reading 'totalGeneration')
 â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts:53:26
     51|       // Assert: Network should show 5 GW generation and consumption
     52|       const networks = powerGridSystem.getNetworks();
     53|       expect(networks[0].totalGeneration).toBe(5_000_000);
       |                          ^
     54|       expect(networks[0].totalConsumption).toBe(5_000_000);
     55|       expect(networks[0].availability).toBe(1.0); // Exact match

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[134/746]âŽ¯

 FAIL  packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Criterion 4: Reality Anchor Charging Consumes Power > should NOT charge when isPowered=false (insufficient power)
TypeError: Cannot set property tick of #<WorldImpl> which has only a getter
 â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts:85:15
     83|       // Simulate 20 ticks (1 second at 20 TPS)
     84|       for (let i = 0; i < 20; i++) {
     85|         world.tick++;
       |               ^
     86|         realityAnchorSystem.update(world);
     87|       }

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[135/746]âŽ¯

 FAIL  packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Criterion 4: Reality Anchor Charging Consumes Power > should charge normally when isPowered=true
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts:117:37
    115|       powerGridSystem.update(world, powerEntities, 1);
    116| 
    117|       expect(anchorPower.isPowered).toBe(true);
       |                                     ^
    118| 
    119|       // Simulate 20 ticks (1 second at 20 TPS)

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[136/746]âŽ¯

 FAIL  packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Criterion 4: Reality Anchor Charging Consumes Power > should emit event when charging interrupted by power loss
TypeError: Cannot set property tick of #<WorldImpl> which has only a getter
 â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts:146:13
    144| 
    145|       // Act: Run Reality Anchor system
    146|       world.tick = 20;
       |             ^
    147|       realityAnchorSystem.update(world);
    148| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[137/746]âŽ¯

 FAIL  packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Criterion 5: Reality Anchor Active Field Consumes Power > should drain 50,000,000 kW when field is active
TypeError: Cannot read properties of undefined (reading 'totalGeneration')
 â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts:187:26
    185|       // Assert: Network should show 50 GW generation and consumption
    186|       const networks = powerGridSystem.getNetworks();
    187|       expect(networks[0].totalGeneration).toBe(50_000_000);
       |                          ^
    188|       expect(networks[0].totalConsumption).toBe(50_000_000);
    189|       expect(anchorPower.isPowered).toBe(true);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[138/746]âŽ¯

 FAIL  packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Criterion 5: Reality Anchor Active Field Consumes Power > should collapse field when isPowered=false during active state
TypeError: Cannot set property tick of #<WorldImpl> which has only a getter
 â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts:207:13
    205| 
    206|       // Act: Run Reality Anchor system
    207|       world.tick = 20;
       |             ^
    208|       realityAnchorSystem.update(world);
    209| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[139/746]âŽ¯

 FAIL  packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Criterion 5: Reality Anchor Active Field Consumes Power > should emit reality_anchor:power_loss event when power fails during active field
TypeError: Cannot set property tick of #<WorldImpl> which has only a getter
 â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts:232:13
    230| 
    231|       // Act: Run Reality Anchor system
    232|       world.tick = 20;
       |             ^
    233|       realityAnchorSystem.update(world);
    234| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[140/746]âŽ¯

 FAIL  packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Criterion 5: Reality Anchor Active Field Consumes Power > should emit reality_anchor:field_collapse event when field collapses from power loss
TypeError: Cannot set property tick of #<WorldImpl> which has only a getter
 â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts:263:13
    261| 
    262|       // Act: Run Reality Anchor system
    263|       world.tick = 20;
       |             ^
    264|       realityAnchorSystem.update(world);
    265| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[141/746]âŽ¯

 FAIL  packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Criterion 5: Reality Anchor Active Field Consumes Power > should maintain field when power is sufficient
TypeError: Cannot set property tick of #<WorldImpl> which has only a getter
 â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts:298:13
    296|       powerGridSystem.update(world, powerEntities, 1);
    297| 
    298|       world.tick = 20;
       |             ^
    299|       realityAnchorSystem.update(world);
    300| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[142/746]âŽ¯

 FAIL  packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Power Network Isolation Edge Cases > should fail gracefully when Reality Anchor has no power network connection
TypeError: Cannot set property tick of #<WorldImpl> which has only a getter
 â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts:365:13
    363|       powerGridSystem.update(world, powerEntities, 1);
    364| 
    365|       world.tick = 20;
       |             ^
    366|       realityAnchorSystem.update(world);
    367| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[143/746]âŽ¯

 FAIL  packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Power Network Isolation Edge Cases > should handle Reality Anchor with wrong power type gracefully
AssertionError: expected +0 to be 2 // Object.is equality

- Expected
+ Received

- 2
+ 0

 â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts:397:31
    395|       // Assert: Separate networks, anchor not powered
    396|       const networks = powerGridSystem.getNetworks();
    397|       expect(networks.length).toBe(2);
       |                               ^
    398|       expect(anchorPower.isPowered).toBe(false);
    399|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[144/746]âŽ¯

 FAIL  packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Partial Power Scenarios > should emit reality_anchor:power_insufficient when receiving 25-50% power
TypeError: Cannot set property tick of #<WorldImpl> which has only a getter
 â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts:427:13
    425|       powerGridSystem.update(world, powerEntities, 1);
    426| 
    427|       world.tick = 20;
       |             ^
    428|       realityAnchorSystem.update(world);
    429| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[145/746]âŽ¯

 FAIL  packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Mid-Battle Power Loss Scenario > should restore god divinity when field collapses from power loss
TypeError: Cannot set property tick of #<WorldImpl> which has only a getter
 â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts:479:13
    477| 
    478|       // Run Reality Anchor system
    479|       world.tick = 20;
       |             ^
    480|       realityAnchorSystem.update(world);
    481| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[146/746]âŽ¯

 FAIL  packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Error Handling > should handle Reality Anchor without PowerComponent gracefully
TypeError: Cannot set property tick of #<WorldImpl> which has only a getter
 â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts:500:13
    498| 
    499|       // Act: Should not crash
    500|       world.tick = 20;
       |             ^
    501|       expect(() => realityAnchorSystem.update(world)).not.toThrow();
    502| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[147/746]âŽ¯

 FAIL  packages/core/src/__tests__/RealityAnchorPower.test.ts > Reality Anchor Power Integration > Error Handling > should handle destroyed Reality Anchor gracefully
TypeError: Cannot set property tick of #<WorldImpl> which has only a getter
 â¯ packages/core/src/__tests__/RealityAnchorPower.test.ts:522:13
    520| 
    521|       // Act: Should not attempt to charge or drain power
    522|       world.tick = 20;
       |             ^
    523|       realityAnchorSystem.update(world);
    524| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[148/746]âŽ¯

 FAIL  packages/core/src/__tests__/RoleSpecialization.integration.test.ts > Role Specialization Integration > Skill Diversity at Spawn (80%+ have skill > 0) > should spawn agents with diverse starting skills
Error: Cannot find module '../components/SkillsComponent.js'
Require stack:
- /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts
 â¯ TracingChannel.traceSync node:diagnostics_channel:328:14
 â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts:31:48
     29|   describe('Skill Diversity at Spawn (80%+ have skill > 0)', () => {
     30|     it('should spawn agents with diverse starting skills', () => {
     31|       const { generateRandomStartingSkills } = require('../components/â€¦
       |                                                ^
     32|       const { createPersonalityComponent } = require('../components/Peâ€¦
     33| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'MODULE_NOT_FOUND', requireStack: [ '/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts' ] }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[149/746]âŽ¯

 FAIL  packages/core/src/__tests__/RoleSpecialization.integration.test.ts > Role Specialization Integration > Skill Diversity at Spawn (80%+ have skill > 0) > should distribute skills across multiple domains
Error: Cannot find module '../components/SkillsComponent.js'
Require stack:
- /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts
 â¯ TracingChannel.traceSync node:diagnostics_channel:328:14
 â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts:62:48
     60| 
     61|     it('should distribute skills across multiple domains', () => {
     62|       const { generateRandomStartingSkills } = require('../components/â€¦
       |                                                ^
     63|       const { createPersonalityComponent } = require('../components/Peâ€¦
     64| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'MODULE_NOT_FOUND', requireStack: [ '/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts' ] }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[150/746]âŽ¯

 FAIL  packages/core/src/__tests__/RoleSpecialization.integration.test.ts > Role Specialization Integration > Builders do 60%+ of construction > should route building tasks to skilled builders
Error: Unknown component type: identity. Add it to the component registry in World.ts
 â¯ EntityImpl.entity.addComponent packages/core/src/World.ts:258:17
    256|         const factory = componentRegistry[ComponentClassOrInstance];
    257|         if (!factory) {
    258|           throw new Error(`Unknown component type: ${ComponentClassOrIâ€¦
       |                 ^
    259|         }
    260|         const component = factory(data || {});
 â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts:143:25

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[151/746]âŽ¯

 FAIL  packages/core/src/__tests__/RoleSpecialization.integration.test.ts > Role Specialization Integration > Cooks manage food supplies > should route food tasks to cooks and farmers
Error: Unknown component type: identity. Add it to the component registry in World.ts
 â¯ EntityImpl.entity.addComponent packages/core/src/World.ts:258:17
    256|         const factory = componentRegistry[ComponentClassOrInstance];
    257|         if (!factory) {
    258|           throw new Error(`Unknown component type: ${ComponentClassOrIâ€¦
       |                 ^
    259|         }
    260|         const component = factory(data || {});
 â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts:219:25

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[152/746]âŽ¯

 FAIL  packages/core/src/__tests__/RoleSpecialization.integration.test.ts > Role Specialization Integration > Reduced building duplicates (<10% overlapping starts) > should prevent unskilled agents from seeing complex buildings
Error: Cannot find module '../components/SkillsComponent.js'
Require stack:
- /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts
 â¯ TracingChannel.traceSync node:diagnostics_channel:328:14
 â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts:267:41
    265|   describe('Reduced building duplicates (<10% overlapping starts)', ()â€¦
    266|     it('should prevent unskilled agents from seeing complex buildings'â€¦
    267|       const { getAvailableBuildings } = require('../components/SkillsCâ€¦
       |                                         ^
    268|       const { BuildingBlueprintRegistry } = require('../buildings/Builâ€¦
    269| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'MODULE_NOT_FOUND', requireStack: [ '/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts' ] }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[153/746]âŽ¯

 FAIL  packages/core/src/__tests__/RoleSpecialization.integration.test.ts > Role Specialization Integration > Appropriate suggestions (90% go to skilled agents) > should send strategic suggestions to skilled agents
Error: Unknown component type: identity. Add it to the component registry in World.ts
 â¯ EntityImpl.entity.addComponent packages/core/src/World.ts:258:17
    256|         const factory = componentRegistry[ComponentClassOrInstance];
    257|         if (!factory) {
    258|           throw new Error(`Unknown component type: ${ComponentClassOrIâ€¦
       |                 ^
    259|         }
    260|         const component = factory(data || {});
 â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts:330:25

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[154/746]âŽ¯

 FAIL  packages/core/src/__tests__/RoleSpecialization.integration.test.ts > Role Specialization Integration > Entity visibility based on skill and distance > should only show entities within perception radius
Error: Cannot find module '../components/SkillsComponent.js'
Require stack:
- /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts
 â¯ TracingChannel.traceSync node:diagnostics_channel:328:14
 â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts:383:41
    381|   describe('Entity visibility based on skill and distance', () => {
    382|     it('should only show entities within perception radius', () => {
    383|       const { filterVisibleEntities } = require('../components/SkillsCâ€¦
       |                                         ^
    384| 
    385|       const entities = [

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'MODULE_NOT_FOUND', requireStack: [ '/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts' ] }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[155/746]âŽ¯

 FAIL  packages/core/src/__tests__/RoleSpecialization.integration.test.ts > Role Specialization Integration > Entity visibility based on skill and distance > should filter rare entities by skill level
Error: Cannot find module '../components/SkillsComponent.js'
Require stack:
- /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts
 â¯ TracingChannel.traceSync node:diagnostics_channel:328:14
 â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts:420:41
    418| 
    419|     it('should filter rare entities by skill level', () => {
    420|       const { filterVisibleEntities } = require('../components/SkillsCâ€¦
       |                                         ^
    421| 
    422|       const entities = [

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'MODULE_NOT_FOUND', requireStack: [ '/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts' ] }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[156/746]âŽ¯

 FAIL  packages/core/src/__tests__/RoleSpecialization.integration.test.ts > Role Specialization Integration > Information depth scales with skill > should provide increasingly detailed food information
Error: Cannot find module '../components/SkillsComponent.js'
Require stack:
- /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts
 â¯ TracingChannel.traceSync node:diagnostics_channel:328:14
 â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts:450:38
    448|   describe('Information depth scales with skill', () => {
    449|     it('should provide increasingly detailed food information', () => {
    450|       const { getFoodStorageInfo } = require('../components/SkillsCompâ€¦
       |                                      ^
    451| 
    452|       const storage = {

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'MODULE_NOT_FOUND', requireStack: [ '/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts' ] }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[157/746]âŽ¯

 FAIL  packages/core/src/__tests__/RoleSpecialization.integration.test.ts > Role Specialization Integration > Social skill gates perception of other agents > should reveal more about others as social skill increases
Error: Cannot find module '../llm/StructuredPromptBuilder.js'
Require stack:
- /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts
 â¯ TracingChannel.traceSync node:diagnostics_channel:328:14
 â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts:483:43
    481|   describe('Social skill gates perception of other agents', () => {
    482|     it('should reveal more about others as social skill increases', ()â€¦
    483|       const { getPerceivedAgentSkills } = require('../llm/StructuredPrâ€¦
       |                                           ^
    484| 
    485|       const target = {

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'MODULE_NOT_FOUND', requireStack: [ '/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts' ] }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[158/746]âŽ¯

 FAIL  packages/core/src/__tests__/RoleSpecialization.integration.test.ts > Role Specialization Integration > Relationships unlock affordances > should show different affordances based on relationship level
Error: Cannot find module '../llm/StructuredPromptBuilder.js'
Require stack:
- /Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts
 â¯ TracingChannel.traceSync node:diagnostics_channel:328:14
 â¯ packages/core/src/__tests__/RoleSpecialization.integration.test.ts:519:54
    517|   describe('Relationships unlock affordances', () => {
    518|     it('should show different affordances based on relationship level'â€¦
    519|       const { getAffordancesThroughRelationships } = require('../llm/Sâ€¦
       |                                                      ^
    520| 
    521|       const otherAgents = [

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'MODULE_NOT_FOUND', requireStack: [ '/Users/annhoward/src/ai_village/custom_game_engine/packages/core/src/__tests__/RoleSpecialization.integration.test.ts' ] }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[159/746]âŽ¯

 FAIL  packages/core/src/__tests__/SpeciesGeneticsBody.integration.test.ts > Species + Genetics + Body - Complete Integration > Mutation System > should apply mutations at the configured rate
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/__tests__/SpeciesGeneticsBody.integration.test.ts:271:40
    269| 
    270|       // With 100% mutation rate, child should have a mutation
    271|       expect(childSpecies.hasMutation).toBe(true);
       |                                        ^
    272|       expect(childSpecies.mutations.length).toBeGreaterThan(0);
    273| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[160/746]âŽ¯

 FAIL  packages/core/src/__tests__/SpeciesGeneticsBody.integration.test.ts > Species + Genetics + Body - Complete Integration > Mutation System > should create extra limb mutations
AssertionError: expected 0 to be greater than 0
 â¯ packages/core/src/__tests__/SpeciesGeneticsBody.integration.test.ts:324:32
    322| 
    323|           // Should have at least one limb of this type
    324|           expect(limbs.length).toBeGreaterThan(0);
       |                                ^
    325|         }
    326|       }

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[161/746]âŽ¯

 FAIL  packages/core/src/__tests__/TreeFellingPhysics.test.ts > Tree Felling Physics - Integration > Voxel Resource Stability > should handle different material hardness
AssertionError: expected 40 to be greater than 60
 â¯ packages/core/src/__tests__/TreeFellingPhysics.test.ts:104:28
    102|       // Harder materials should have higher hardness values
    103|       expect(hardStone).toBeGreaterThan(softWood);
    104|       expect(veryHardIron).toBeGreaterThan(hardStone);
       |                            ^
    105|     });
    106|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[162/746]âŽ¯

 FAIL  packages/core/src/__tests__/TreeFellingPhysics.test.ts > Tree Felling Physics - Integration > Bottom-Up Harvesting (Cutting Base) > should emit resource:felled event when tree falls
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 â¯ packages/core/src/__tests__/TreeFellingPhysics.test.ts:190:35
    188|       }
    189| 
    190|       expect(felledEvents.length).toBe(1);
       |                                   ^
    191|       expect(felledEvents[0].type).toBe('resource:felled');
    192|       expect(felledEvents[0].data.blocksDropped).toBe(16); // 4 levelsâ€¦

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[163/746]âŽ¯

 FAIL  packages/core/src/__tests__/TreeFellingPhysics.test.ts > Tree Felling Physics - Integration > Top-Down Harvesting (Safe Method) > should allow safe top-down harvesting without falling
AssertionError: expected 0 to be greater than 30
 â¯ packages/core/src/__tests__/TreeFellingPhysics.test.ts:225:35
    223| 
    224|       // After top-down harvesting, should still have reasonable stabiâ€¦
    225|       expect(voxelComp.stability).toBeGreaterThan(30);
       |                                   ^
    226|     });
    227| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[164/746]âŽ¯

 FAIL  packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Tile-Based Blueprint System > should register blueprints with layout strings
Error: Tile-based blueprint "tile_small_house" not found
 â¯ TileBasedBlueprintRegistry.get packages/core/src/buildings/TileBasedBlueprintRegistry.ts:469:13
    467|     const blueprint = this.blueprints.get(id);
    468|     if (!blueprint) {
    469|       throw new Error(`Tile-based blueprint "${id}" not found`);
       |             ^
    470|     }
    471|     return blueprint;
 â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts:96:34

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[165/746]âŽ¯

 FAIL  packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Tile-Based Blueprint System > should parse blueprint layout to tile positions
Error: Tile-based blueprint "tile_small_house" not found
 â¯ TileBasedBlueprintRegistry.get packages/core/src/buildings/TileBasedBlueprintRegistry.ts:469:13
    467|     const blueprint = this.blueprints.get(id);
    468|     if (!blueprint) {
    469|       throw new Error(`Tile-based blueprint "${id}" not found`);
       |             ^
    470|     }
    471|     return blueprint;
 â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts:106:34

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[166/746]âŽ¯

 FAIL  packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Tile-Based Blueprint System > should calculate resource requirements from layout
Error: Tile-based blueprint "tile_small_house" not found
 â¯ TileBasedBlueprintRegistry.get packages/core/src/buildings/TileBasedBlueprintRegistry.ts:469:13
    467|     const blueprint = this.blueprints.get(id);
    468|     if (!blueprint) {
    469|       throw new Error(`Tile-based blueprint "${id}" not found`);
       |             ^
    470|     }
    471|     return blueprint;
 â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts:120:34

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[167/746]âŽ¯

 FAIL  packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Construction Task System > should create construction tasks for blueprint
Error: Tile-based blueprint "tile_small_house" not found
 â¯ TileBasedBlueprintRegistry.get packages/core/src/buildings/TileBasedBlueprintRegistry.ts:469:13
    467|     const blueprint = this.blueprints.get(id);
    468|     if (!blueprint) {
    469|       throw new Error(`Tile-based blueprint "${id}" not found`);
       |             ^
    470|     }
    471|     return blueprint;
 â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts:137:34

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[168/746]âŽ¯

 FAIL  packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Construction Task System > should track material pool for construction
Error: Tile-based blueprint "tile_small_house" not found
 â¯ TileBasedBlueprintRegistry.get packages/core/src/buildings/TileBasedBlueprintRegistry.ts:469:13
    467|     const blueprint = this.blueprints.get(id);
    468|     if (!blueprint) {
    469|       throw new Error(`Tile-based blueprint "${id}" not found`);
       |             ^
    470|     }
    471|     return blueprint;
 â¯ TileConstructionSystem.createTask packages/core/src/systems/TileConstructionSystem.ts:158:30
 â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts:159:39

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[169/746]âŽ¯

 FAIL  packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Construction Task System > should track workers involved in construction
Error: Tile-based blueprint "tile_small_house" not found
 â¯ TileBasedBlueprintRegistry.get packages/core/src/buildings/TileBasedBlueprintRegistry.ts:469:13
    467|     const blueprint = this.blueprints.get(id);
    468|     if (!blueprint) {
    469|       throw new Error(`Tile-based blueprint "${id}" not found`);
       |             ^
    470|     }
    471|     return blueprint;
 â¯ TileConstructionSystem.createTask packages/core/src/systems/TileConstructionSystem.ts:158:30
 â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts:180:39

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[170/746]âŽ¯

 FAIL  packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Construction Task System > should transition status when materials are delivered
Error: Tile-based blueprint "tile_small_house" not found
 â¯ TileBasedBlueprintRegistry.get packages/core/src/buildings/TileBasedBlueprintRegistry.ts:469:13
    467|     const blueprint = this.blueprints.get(id);
    468|     if (!blueprint) {
    469|       throw new Error(`Tile-based blueprint "${id}" not found`);
       |             ^
    470|     }
    471|     return blueprint;
 â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts:205:34

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[171/746]âŽ¯

 FAIL  packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Tile Placement Integration > should place wall tile when construction progresses
Error: Tile-based blueprint "tile_small_house" not found
 â¯ TileBasedBlueprintRegistry.get packages/core/src/buildings/TileBasedBlueprintRegistry.ts:469:13
    467|     const blueprint = this.blueprints.get(id);
    468|     if (!blueprint) {
    469|       throw new Error(`Tile-based blueprint "${id}" not found`);
       |             ^
    470|     }
    471|     return blueprint;
 â¯ TileConstructionSystem.createTask packages/core/src/systems/TileConstructionSystem.ts:158:30
 â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts:241:39

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[172/746]âŽ¯

 FAIL  packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Tile Placement Integration > should handle multiple tiles in blueprint
Error: Tile-based blueprint "tile_small_house" not found
 â¯ TileBasedBlueprintRegistry.get packages/core/src/buildings/TileBasedBlueprintRegistry.ts:469:13
    467|     const blueprint = this.blueprints.get(id);
    468|     if (!blueprint) {
    469|       throw new Error(`Tile-based blueprint "${id}" not found`);
       |             ^
    470|     }
    471|     return blueprint;
 â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts:268:34

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[173/746]âŽ¯

 FAIL  packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Complete Building Workflow > should complete full workflow: blueprint â†’ tasks â†’ materials â†’ construction
Error: Tile-based blueprint "tile_small_house" not found
 â¯ TileBasedBlueprintRegistry.get packages/core/src/buildings/TileBasedBlueprintRegistry.ts:469:13
    467|     const blueprint = this.blueprints.get(id);
    468|     if (!blueprint) {
    469|       throw new Error(`Tile-based blueprint "${id}" not found`);
       |             ^
    470|     }
    471|     return blueprint;
 â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts:300:34

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[174/746]âŽ¯

 FAIL  packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Complete Building Workflow > should handle collaborative building with multiple workers
Error: Tile-based blueprint "tile_small_house" not found
 â¯ TileBasedBlueprintRegistry.get packages/core/src/buildings/TileBasedBlueprintRegistry.ts:469:13
    467|     const blueprint = this.blueprints.get(id);
    468|     if (!blueprint) {
    469|       throw new Error(`Tile-based blueprint "${id}" not found`);
       |             ^
    470|     }
    471|     return blueprint;
 â¯ TileConstructionSystem.createTask packages/core/src/systems/TileConstructionSystem.ts:158:30
 â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts:343:39

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[175/746]âŽ¯

 FAIL  packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Blueprint Variations > should support different blueprint sizes
Error: Tile-based blueprint "tile_small_house" not found
 â¯ TileBasedBlueprintRegistry.get packages/core/src/buildings/TileBasedBlueprintRegistry.ts:469:13
    467|     const blueprint = this.blueprints.get(id);
    468|     if (!blueprint) {
    469|       throw new Error(`Tile-based blueprint "${id}" not found`);
       |             ^
    470|     }
    471|     return blueprint;
 â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts:380:36
 â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts:379:18

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[176/746]âŽ¯

 FAIL  packages/core/src/__tests__/VoxelBuildingIntegration.test.ts > Voxel Building System - End-to-End Integration > Blueprint Variations > should support blueprint rotation
Error: Tile-based blueprint "tile_small_house" not found
 â¯ TileBasedBlueprintRegistry.get packages/core/src/buildings/TileBasedBlueprintRegistry.ts:469:13
    467|     const blueprint = this.blueprints.get(id);
    468|     if (!blueprint) {
    469|       throw new Error(`Tile-based blueprint "${id}" not found`);
       |             ^
    470|     }
    471|     return blueprint;
 â¯ TileConstructionSystem.createTask packages/core/src/systems/TileConstructionSystem.ts:158:30
 â¯ packages/core/src/__tests__/VoxelBuildingIntegration.test.ts:407:40

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[177/746]âŽ¯

 FAIL  packages/divinity/src/__tests__/BeliefSystem.test.ts > Belief Generation > should generate massive belief from witnessing miracles
AssertionError: expected 80.7 to be greater than 100
 â¯ packages/divinity/src/__tests__/BeliefSystem.test.ts:135:30
    133|     const generated = calculateBeliefGeneration(believer, miracleActivâ€¦
    134| 
    135|     expect(generated.amount).toBeGreaterThan(100); // Miracles generatâ€¦
       |                              ^
    136|     expect(generated.quality).toBeGreaterThan(0.8);
    137|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[178/746]âŽ¯

 FAIL  packages/divinity/src/__tests__/BeliefSystem.test.ts > Belief Decay > should decay belief over time without maintenance
AssertionError: expected 132.61955589475295 to be close to 366, received difference is 233.38044410524705, but expected 0.5
 â¯ packages/divinity/src/__tests__/BeliefSystem.test.ts:185:33
    183|     expect(decayed.totalBelief).toBeLessThan(1000);
    184|     // After 100 ticks at 1% decay: 1000 * (0.99)^100 â‰ˆ 366
    185|     expect(decayed.totalBelief).toBeCloseTo(366, 0);
       |                                 ^
    186|   });
    187| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[179/746]âŽ¯

 FAIL  packages/divinity/src/__tests__/BeliefSystem.test.ts > Belief Quality and Growth > should detect belief plateau
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/divinity/src/__tests__/BeliefSystem.test.ts:375:23
    373|     const isPlateau = Math.abs(growthRate) < 0.01; // Nearly flat
    374| 
    375|     expect(isPlateau).toBe(true);
       |                       ^
    376|   });
    377| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[180/746]âŽ¯

 FAIL  packages/divinity/src/__tests__/DeityEmergence.test.ts > Deity Emergence > should allow belief to shape nascent deity
TypeError: actual value must be number or bigint, received "undefined"
 â¯ packages/divinity/src/__tests__/DeityEmergence.test.ts:134:49
    132|     // Nascent deity should be flexible
    133|     expect(updated.identity.domains.war).toBeGreaterThan(0);
    134|     expect(updated.identity.personality.fierce).toBeGreaterThan(0);
       |                                                 ^
    135|   });
    136| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[181/746]âŽ¯

 FAIL  packages/divinity/src/__tests__/DeityEmergence.test.ts > Alignment Calculation > should calculate alignment from actions
AssertionError: expected 0 to be greater than 0
 â¯ packages/divinity/src/__tests__/DeityEmergence.test.ts:317:33
    315| 
    316|     expect(alignment.good_evil).toBeGreaterThan(0); // More good actioâ€¦
    317|     expect(alignment.law_chaos).toBeGreaterThan(0); // Consistent rewaâ€¦
       |                                 ^
    318|   });
    319| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[182/746]âŽ¯

 FAIL  packages/divinity/src/__tests__/DeityEmergence.test.ts > Alignment Calculation > should detect chaotic neutral deity
AssertionError: expected 0 to be less than 0
 â¯ packages/divinity/src/__tests__/DeityEmergence.test.ts:333:33
    331| 
    332|     expect(Math.abs(alignment.good_evil)).toBeLessThan(0.3); // Neutral
    333|     expect(alignment.law_chaos).toBeLessThan(0); // Chaotic
       |                                 ^
    334|   });
    335| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[183/746]âŽ¯

 FAIL  packages/divinity/src/__tests__/DeityEmergence.test.ts > Alignment Calculation > should detect lawful evil deity
AssertionError: expected 0 to be greater than 0
 â¯ packages/divinity/src/__tests__/DeityEmergence.test.ts:349:33
    347| 
    348|     expect(alignment.good_evil).toBeLessThan(0); // Evil
    349|     expect(alignment.law_chaos).toBeGreaterThan(0); // Lawful
       |                                 ^
    350|   });
    351| });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[184/746]âŽ¯

 FAIL  packages/divinity/src/__tests__/DeityEmergence.test.ts > Divine Form Development > should develop forms from believer visions
AssertionError: expected [ 'height', 'aura', 'presence' ] to include 'golden'
 â¯ packages/divinity/src/__tests__/DeityEmergence.test.ts:379:31
    377| 
    378|     expect(forms.length).toBeGreaterThan(0);
    379|     expect(forms[0].features).toContain('golden'); // Common feature
       |                               ^
    380|   });
    381| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[185/746]âŽ¯

 FAIL  packages/divinity/src/__tests__/DeityEmergence.test.ts > Divine Form Development > should prefer consistent forms for nascent deities
TypeError: existing.features.includes is not a function
 â¯ addFormFromVision packages/divinity/src/__tests__/DeityEmergence.test.ts:617:32
    615|       const existing = updated.identity.forms[0];
    616|       for (const [feature, value] of Object.entries(vision.features)) {
    617|         if (!existing.features.includes(feature)) {
       |                                ^
    618|           existing.features.push(feature);
    619|         }
 â¯ packages/divinity/src/__tests__/DeityEmergence.test.ts:413:21

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[186/746]âŽ¯

 FAIL  packages/divinity/src/__tests__/DivinePowers.test.ts > Divine Power - Blessings and Curses > should lift curse when condition met
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/divinity/src/__tests__/DivinePowers.test.ts:445:23
    443|     const satisfied = checkCurseLiftCondition(curse, 'sacrifice_perforâ€¦
    444| 
    445|     expect(satisfied).toBe(true);
       |                       ^
    446| 
    447|     const lifted = liftCurse(curse, mockWorld);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[187/746]âŽ¯

 FAIL  packages/divinity/src/__tests__/DivinitySystemEdgeCases.test.ts > Pantheon Relationship Deadlocks > should detect circular dependency in pantheon hierarchy
RangeError: Invalid array length
 â¯ detectCircularHierarchy packages/divinity/src/__tests__/DivinitySystemEdgeCases.test.ts:801:12
    799|         return { detected: true, cycle: [...path, (current as any).supâ€¦
    800|       }
    801|       path.push((current as any).superior);
       |            ^
    802|       current = deities.find((d) => d.id === (current as any).superiorâ€¦
    803|     }
 â¯ packages/divinity/src/__tests__/DivinitySystemEdgeCases.test.ts:364:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[188/746]âŽ¯

 FAIL  packages/llm/src/__tests__/ConversationSimulation.test.ts > ConversationSimulation > interest-based conversation depth > should have deeper conversation when agents share philosophical interests
Error: API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}

 â¯ OpenAICompatProvider.generate packages/llm/src/OpenAICompatProvider.ts:380:15
    378|         }
    379| 
    380|         throw new Error(`API error: ${response.status} ${response.statâ€¦
       |               ^
    381|       }
    382| 
 â¯ simulateConversation packages/llm/src/__tests__/ConversationSimulation.test.ts:230:22
 â¯ packages/llm/src/__tests__/ConversationSimulation.test.ts:344:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[189/746]âŽ¯

 FAIL  packages/llm/src/__tests__/ConversationSimulation.test.ts > ConversationSimulation > interest-based conversation depth > should have shallower conversation without interest context
Error: API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}

 â¯ OpenAICompatProvider.generate packages/llm/src/OpenAICompatProvider.ts:380:15
    378|         }
    379| 
    380|         throw new Error(`API error: ${response.status} ${response.statâ€¦
       |               ^
    381|       }
    382| 
 â¯ simulateConversation packages/llm/src/__tests__/ConversationSimulation.test.ts:230:22
 â¯ packages/llm/src/__tests__/ConversationSimulation.test.ts:370:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[190/746]âŽ¯

 FAIL  packages/llm/src/__tests__/ConversationSimulation.test.ts > ConversationSimulation > child-elder knowledge transfer > should show child asking questions and elder answering
Error: API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}

 â¯ OpenAICompatProvider.generate packages/llm/src/OpenAICompatProvider.ts:380:15
    378|         }
    379| 
    380|         throw new Error(`API error: ${response.status} ${response.statâ€¦
       |               ^
    381|       }
    382| 
 â¯ simulateConversation packages/llm/src/__tests__/ConversationSimulation.test.ts:230:22
 â¯ packages/llm/src/__tests__/ConversationSimulation.test.ts:392:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[191/746]âŽ¯

 FAIL  packages/llm/src/__tests__/ConversationSimulation.test.ts > ConversationSimulation > craft-based conversation > should discuss woodworking when both agents share that interest
Error: API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}

 â¯ OpenAICompatProvider.generate packages/llm/src/OpenAICompatProvider.ts:380:15
    378|         }
    379| 
    380|         throw new Error(`API error: ${response.status} ${response.statâ€¦
       |               ^
    381|       }
    382| 
 â¯ simulateConversation packages/llm/src/__tests__/ConversationSimulation.test.ts:230:22
 â¯ packages/llm/src/__tests__/ConversationSimulation.test.ts:434:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[192/746]âŽ¯

 FAIL  packages/llm/src/__tests__/ConversationSimulation.test.ts > ConversationSimulation > depth hunger effect > should show more meaningful exchange when depth hunger is high
Error: API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}

 â¯ OpenAICompatProvider.generate packages/llm/src/OpenAICompatProvider.ts:380:15
    378|         }
    379| 
    380|         throw new Error(`API error: ${response.status} ${response.statâ€¦
       |               ^
    381|       }
    382| 
 â¯ simulateConversation packages/llm/src/__tests__/ConversationSimulation.test.ts:230:22
 â¯ packages/llm/src/__tests__/ConversationSimulation.test.ts:466:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[193/746]âŽ¯

 FAIL  packages/llm/src/__tests__/ConversationSimulation.test.ts > ConversationSimulation > conversation quality comparison > should produce measurably different conversations with vs without interests
Error: API error: 404 Not Found - {"error":{"message":"The model `qwen-3-30b` does not exist or you do not have access to it.","type":"invalid_request_error","code":"model_not_found"}}

 â¯ OpenAICompatProvider.generate packages/llm/src/OpenAICompatProvider.ts:380:15
    378|         }
    379| 
    380|         throw new Error(`API error: ${response.status} ${response.statâ€¦
       |               ^
    381|       }
    382| 
 â¯ simulateConversation packages/llm/src/__tests__/ConversationSimulation.test.ts:230:22
 â¯ packages/llm/src/__tests__/ConversationSimulation.test.ts:491:29

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[194/746]âŽ¯

 FAIL  packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > fallback chain > should fallback to cerebras on groq rate limit
AssertionError: expected 'groq response' to be 'cerebras response' // Object.is equality

- Expected
+ Received

- cerebras response
+ groq response

 â¯ packages/llm/src/__tests__/ProviderPoolManager.test.ts:120:29
    118|       const response = await pool.execute('groq', request, 'agent1');
    119| 
    120|       expect(response.text).toBe('cerebras response');
       |                             ^
    121|       expect(groqProvider.callCount).toBe(1);
    122|       expect(cerebrasProvider.callCount).toBe(1);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[195/746]âŽ¯

 FAIL  packages/llm/src/__tests__/ProviderPoolManager.test.ts > ProviderPoolManager > retry logic > should fail after max retries
 FAIL  packages/core/src/multiverse/__tests__/MultiverseNetworkManager.test.ts > MultiverseNetworkManager > Remote Passage Creation > should fail if local universe not found
Error: Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[196/746]âŽ¯

 FAIL  packages/llm/src/__tests__/SessionManagement.test.ts > GameSessionManager > should get stats
AssertionError: expected 0 to be greater than 0
 â¯ packages/llm/src/__tests__/SessionManagement.test.ts:62:36
     60|     expect(stats.totalSessions).toBe(2);
     61|     expect(stats.averageRequestsPerSession).toBe(1.5);
     62|     expect(stats.oldestSessionAge).toBeGreaterThan(0);
       |                                    ^
     63|   });
     64| });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[197/746]âŽ¯

 FAIL  packages/llm/src/__tests__/SessionManagement.test.ts > CooldownCalculator > should calculate cooldown based on active games
AssertionError: expected 60 to be 2000 // Object.is equality

- Expected
+ Received

- 2000
+ 60

 â¯ packages/llm/src/__tests__/SessionManagement.test.ts:79:23
     77|     sessionManager.registerSession('session1');
     78|     const cooldown1 = calculator.calculateCooldown('groq');
     79|     expect(cooldown1).toBe(2000);
       |                       ^
     80| 
     81|     // 4 games: 30 RPM / 4 = 8000ms per request per game

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[198/746]âŽ¯

 FAIL  packages/llm/src/__tests__/SessionManagement.test.ts > CooldownCalculator > should support custom API key rate limits
AssertionError: expected 1000 to be less than 60
 â¯ packages/llm/src/__tests__/SessionManagement.test.ts:148:28
    146|     const customCooldown = calculator.calculateCooldown('groq', customâ€¦
    147| 
    148|     expect(customCooldown).toBeLessThan(groqCooldown);
       |                            ^
    149|   });
    150| });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[199/746]âŽ¯

 FAIL  packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > buildPrompt > should describe energy levels correctly
AssertionError: expected 'you are testagent, a villager in thisâ€¦' to contain 'exhaust'

- Expected
+ Received

- exhaust
+ you are testagent, a villager in this improbable forest settlement.
+
+ your personality:
+ - your mind collects questions the way some people collect stamps: obsessively, categorically, with a filing system that makes sense only to you. the phrase "i wonder..." precedes approximately 60% of your decisions, which explains both your greatest discoveries and your most regrettable incidents.
+ - social energy radiates from you with the intensity of a small, friendly sun. people are drawn to you, or perhaps caught in your gravitational fieldâ€”the distinction isn't always clear. you collect acquaintances the way some people collect mushrooms: abundantly, indiscriminately, with genuine enthusiasm for each new specimen.
+ - compassion arrives in you unbidden, unwanted (sometimes), unavoidable. you can't not help the way some people can't not correct grammar. it's a compulsion, possibly a design flaw, definitely inconvenient, absolutely who you are.
+ - you are hardworking in the concerning way of people who've confused "busy" with "valuable." if you're not actively doing something, you're planning the next thing, and if you're not planning, you're feeling vaguely guilty about it. relaxation is theoretical concept you understand intellectually but can't actually implement.
+
+
+
+ --- schema-driven component info ---
+ ## needs
+ tired
+
+
+ ## personality
+ curious and adventurous, outgoing and social, helpful and cooperative, hardworking and dedicated
+
+
+ ## perception
+ seen agents: none
+ seen resources: none
+ heard speech: none
+
+
+ ## identity
+ name: testagent
+ species: none
+ age: none
+
+
+ ## memory
+ no memories yet.
+
+
+
+
+ current situation:
+ - hunger: 50% (could eat)
+ - energy: 25% (tired)
+ - the area around you is empty
+
+
+
+ village status:
+ - missing critical buildings: campfire (warmth), storage (items), shelter (sleep)
+
+
+ what you can do:
+ - urgent:
+ -   ðŸ—ï¸ you need rest! use plan_build for bed or bedroll!
+ - 
+ - gathering & resources:
+ -   pick - grab a single item nearby (say "pick wood" or "pick berries")
+ -   gather - stockpile resources: collect a specified amount and automatically store in a chest (say "gather 20 wood" or "gather 50 stone")
+ - 
+ - building & crafting:
+ -   plan_build - plan a building project: queues the build and you'll automatically gather resources then construct it. just say what building you want! (examples: "plan_build storage-chest", "plan_build campfire", "plan_build tent")
+ - 
+ - exploration & navigation:
+ -   explore - systematically explore unknown areas to find new resources
+ -   navigate - go to specific coordinates (say "navigate to x,y" or "go to 10,20")
+
+ as a new villager, you can: help gather materials for storage. what will you do?
+
+ respond in json only. use this exact format:
+ {
+   "speaking": "what you say out loud (or empty string if silent)",
+   "action": {
+     "type": "action_name",
+     "target": "optional target like 'wood' or agent name",
+     "amount": optional_number,
+     "building": "building type for plan_build"
+   }
+ }
+
+ example responses:
+ {"speaking": "", "action": {"type": "gather", "target": "wood", "amount": 20}}
+ {"speaking": "hey haven!", "action": {"type": "talk", "target": "haven"}}
+ {"speaking": "", "action": {"type": "explore"}}
+ {"speaking": "i'm going to build us a storage chest!", "action": {"type": "plan_build", "building": "storage-chest"}}
+ {"speaking": "", "action": {"type": "plan_build", "building": "campfire"}}

 â¯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts:109:45
    107| 
    108|       expect(exhaustedPrompt).toContain('Energy:');
    109|       expect(exhaustedPrompt.toLowerCase()).toContain('exhaust'); // mâ€¦
       |                                             ^
    110|       expect(restedPrompt).toContain('Energy:');
    111|       expect(restedPrompt.toLowerCase()).toContain('rest'); // matchesâ€¦

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[200/746]âŽ¯

 FAIL  packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > hearing system integration > should show agents present even if silent
AssertionError: expected 'You are TestAgent, a villager in thisâ€¦' to contain 'You see nearby:'

- Expected
+ Received

- You see nearby:
+ You are TestAgent, a villager in this improbable forest settlement.
+
+ Your Personality:
+ - You treat the unknown like an old friend who owes you explanations. Mysteries don't intimidate you; they recruit you. You're the person who sees a locked door and immediately starts wondering about hinges, keys, and whether anyone's actually checked if it's locked or just sticky.
+ - You are aggressively friendly in a way that would be alarming if it weren't so sincere. Strangers become friends, friends become family, and family becomes this extensive network of people who've learned that declining your invitations only delays the inevitable. You will befriend that tree if given half a chance.
+ - You are kind in the specific way of people who've decided that if the universe is going to be harsh, someone has to compensate. That someone, apparently, is you. You didn't volunteer for this role but you've accepted it with the resignation of someone who knows their nature and has stopped fighting it.
+ - Dedication drives you with the force of a runaway cart on a steep hillâ€”fast, focused, probably going to crash if you don't figure out how to stop, but stopping doesn't occur to you as an option. You'll rest when you're done. You're never done.
+
+
+
+ --- Schema-Driven Component Info ---
+ ## needs
+ Healthy and content
+
+
+ ## personality
+ curious and adventurous, outgoing and social, helpful and cooperative, hardworking and dedicated
+
+
+ ## Perception
+ Seen Agents: agent1, agent2
+ Seen Resources: none
+ Heard Speech: none
+
+
+ ## identity
+ Name: TestAgent
+ Species: none
+ Age: none
+
+
+ ## Memory
+ No memories yet.
+
+
+
+
+ Current Situation:
+ - Hunger: 50% (could eat)
+ - Energy: 60% (rested)
+ - You notice 2 more villagers in the distance
+ - You see 2 villagers nearby
+
+
+
+ Village Status:
+ - MISSING critical buildings: campfire (warmth), storage (items), shelter (sleep)
+
+
+ What You Can Do:
+ - 
+ - GATHERING & RESOURCES:
+ -   pick - Grab a single item nearby (say "pick wood" or "pick berries")
+ -   gather - Stockpile resources: collect a specified amount and automatically store in a chest (say "gather 20 wood" or "gather 50 stone")
+ - 
+ - BUILDING & CRAFTING:
+ -   plan_build - Plan a building project: queues the build and you'll automatically gather resources then construct it. Just say what building you want! (Examples: "plan_build storage-chest", "plan_build campfire", "plan_build tent")
+ - 
+ - SOCIAL:
+ -   talk - Have a conversation
+ -   follow_agent - Follow someone
+ - 
+ - EXPLORATION & NAVIGATION:
+ -   explore - Systematically explore unknown areas to find new resources
+ -   navigate - Go to specific coordinates (say "navigate to x,y" or "go to 10,20")
+
+ As a new villager, you can: help gather materials for storage, talk to other villagers to learn what needs doing. What will you do?
+
+ RESPOND IN JSON ONLY. Use this exact format:
+ {
+   "speaking": "what you say out loud (or empty string if silent)",
+   "action": {
+     "type": "action_name",
+     "target": "optional target like 'wood' or agent name",
+     "amount": optional_number,
+     "building": "building type for plan_build"
+   }
+ }
+
+ Example responses:
+ {"speaking": "", "action": {"type": "gather", "target": "wood", "amount": 20}}
+ {"speaking": "Hey Haven!", "action": {"type": "talk", "target": "Haven"}}
+ {"speaking": "", "action": {"type": "explore"}}
+ {"speaking": "I'm going to build us a storage chest!", "action": {"type": "plan_build", "building": "storage-chest"}}
+ {"speaking": "", "action": {"type": "plan_build", "building": "campfire"}}

 â¯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts:159:22
    157| 
    158|       // Should show the agent names in "You see nearby:"
    159|       expect(prompt).toContain('You see nearby:');
       |                      ^
    160|       expect(prompt).toContain('Agentagent1');
    161|       expect(prompt).toContain('Agentagent2');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[201/746]âŽ¯

 FAIL  packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > context collapse > should show memories when present
AssertionError: expected 'You are TestAgent, a villager in thisâ€¦' to contain 'Recent Memories:'

- Expected
+ Received

- Recent Memories:
+ You are TestAgent, a villager in this improbable forest settlement.
+
+ Your Personality:
+ - Your mind collects questions the way some people collect stamps: obsessively, categorically, with a filing system that makes sense only to you. The phrase "I wonder..." precedes approximately 60% of your decisions, which explains both your greatest discoveries and your most regrettable incidents.
+ - Social energy radiates from you with the intensity of a small, friendly sun. People are drawn to you, or perhaps caught in your gravitational fieldâ€”the distinction isn't always clear. You collect acquaintances the way some people collect mushrooms: abundantly, indiscriminately, with genuine enthusiasm for each new specimen.
+ - Compassion arrives in you unbidden, unwanted (sometimes), unavoidable. You can't not help the way some people can't not correct grammar. It's a compulsion, possibly a design flaw, definitely inconvenient, absolutely who you are.
+ - You are hardworking in the concerning way of people who've confused "busy" with "valuable." If you're not actively doing something, you're planning the next thing, and if you're not planning, you're feeling vaguely guilty about it. Relaxation is theoretical concept you understand intellectually but can't actually implement.
+
+
+
+ --- Schema-Driven Component Info ---
+ ## needs
+ Healthy and content
+
+
+ ## personality
+ curious and adventurous, outgoing and social, helpful and cooperative, hardworking and dedicated
+
+
+ ## Perception
+ Seen Agents: none
+ Seen Resources: none
+ Heard Speech: none
+
+
+ ## identity
+ Name: TestAgent
+ Species: none
+ Age: none
+
+
+ ## Memory
+ 2 memories (1 agent_seen, 1 resource_location). Recent: "undefined" (agent_seen); "undefined" (resource_location)
+
+
+
+
+ Current Situation:
+ - Hunger: 50% (could eat)
+ - Energy: 60% (rested)
+ - The area around you is empty
+
+
+
+ Village Status:
+ - MISSING critical buildings: campfire (warmth), storage (items), shelter (sleep)
+
+
+ What You Can Do:
+ - 
+ - GATHERING & RESOURCES:
+ -   pick - Grab a single item nearby (say "pick wood" or "pick berries")
+ -   gather - Stockpile resources: collect a specified amount and automatically store in a chest (say "gather 20 wood" or "gather 50 stone")
+ - 
+ - BUILDING & CRAFTING:
+ -   plan_build - Plan a building project: queues the build and you'll automatically gather resources then construct it. Just say what building you want! (Examples: "plan_build storage-chest", "plan_build campfire", "plan_build tent")
+ - 
+ - EXPLORATION & NAVIGATION:
+ -   explore - Systematically explore unknown areas to find new resources
+ -   navigate - Go to specific coordinates (say "navigate to x,y" or "go to 10,20")
+
+ As a new villager, you can: help gather materials for storage. What will you do?
+
+ RESPOND IN JSON ONLY. Use this exact format:
+ {
+   "speaking": "what you say out loud (or empty string if silent)",
+   "action": {
+     "type": "action_name",
+     "target": "optional target like 'wood' or agent name",
+     "amount": optional_number,
+     "building": "building type for plan_build"
+   }
+ }
+
+ Example responses:
+ {"speaking": "", "action": {"type": "gather", "target": "wood", "amount": 20}}
+ {"speaking": "Hey Haven!", "action": {"type": "talk", "target": "Haven"}}
+ {"speaking": "", "action": {"type": "explore"}}
+ {"speaking": "I'm going to build us a storage chest!", "action": {"type": "plan_build", "building": "storage-chest"}}
+ {"speaking": "", "action": {"type": "plan_build", "building": "campfire"}}

 â¯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts:189:22
    187|       const prompt = builder.buildPrompt(entity, createMockWorld());
    188| 
    189|       expect(prompt).toContain('Recent Memories:');
       |                      ^
    190|       expect(prompt).toContain('You saw someone');
    191|       expect(prompt).toContain('You found wood');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[202/746]âŽ¯

 FAIL  packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > instruction clarity > should include "don't overthink" instruction
AssertionError: expected 'You are TestAgent, a villager in thisâ€¦' to contain 'Don\'t overthink'

- Expected
+ Received

- Don't overthink
+ You are TestAgent, a villager in this improbable forest settlement.
+
+ Your Personality:
+ - Your mind collects questions the way some people collect stamps: obsessively, categorically, with a filing system that makes sense only to you. The phrase "I wonder..." precedes approximately 60% of your decisions, which explains both your greatest discoveries and your most regrettable incidents.
+ - Social energy radiates from you with the intensity of a small, friendly sun. People are drawn to you, or perhaps caught in your gravitational fieldâ€”the distinction isn't always clear. You collect acquaintances the way some people collect mushrooms: abundantly, indiscriminately, with genuine enthusiasm for each new specimen.
+ - Compassion arrives in you unbidden, unwanted (sometimes), unavoidable. You can't not help the way some people can't not correct grammar. It's a compulsion, possibly a design flaw, definitely inconvenient, absolutely who you are.
+ - You are hardworking in the concerning way of people who've confused "busy" with "valuable." If you're not actively doing something, you're planning the next thing, and if you're not planning, you're feeling vaguely guilty about it. Relaxation is theoretical concept you understand intellectually but can't actually implement.
+
+
+
+ --- Schema-Driven Component Info ---
+ ## needs
+ Healthy and content
+
+
+ ## personality
+ curious and adventurous, outgoing and social, helpful and cooperative, hardworking and dedicated
+
+
+ ## Perception
+ Seen Agents: none
+ Seen Resources: none
+ Heard Speech: none
+
+
+ ## identity
+ Name: TestAgent
+ Species: none
+ Age: none
+
+
+ ## Memory
+ No memories yet.
+
+
+
+
+ Current Situation:
+ - Hunger: 50% (could eat)
+ - Energy: 60% (rested)
+ - The area around you is empty
+
+
+
+ Village Status:
+ - MISSING critical buildings: campfire (warmth), storage (items), shelter (sleep)
+
+
+ What You Can Do:
+ - 
+ - GATHERING & RESOURCES:
+ -   pick - Grab a single item nearby (say "pick wood" or "pick berries")
+ -   gather - Stockpile resources: collect a specified amount and automatically store in a chest (say "gather 20 wood" or "gather 50 stone")
+ - 
+ - BUILDING & CRAFTING:
+ -   plan_build - Plan a building project: queues the build and you'll automatically gather resources then construct it. Just say what building you want! (Examples: "plan_build storage-chest", "plan_build campfire", "plan_build tent")
+ - 
+ - EXPLORATION & NAVIGATION:
+ -   explore - Systematically explore unknown areas to find new resources
+ -   navigate - Go to specific coordinates (say "navigate to x,y" or "go to 10,20")
+
+ As a new villager, you can: help gather materials for storage. What will you do?
+
+ RESPOND IN JSON ONLY. Use this exact format:
+ {
+   "speaking": "what you say out loud (or empty string if silent)",
+   "action": {
+     "type": "action_name",
+     "target": "optional target like 'wood' or agent name",
+     "amount": optional_number,
+     "building": "building type for plan_build"
+   }
+ }
+
+ Example responses:
+ {"speaking": "", "action": {"type": "gather", "target": "wood", "amount": 20}}
+ {"speaking": "Hey Haven!", "action": {"type": "talk", "target": "Haven"}}
+ {"speaking": "", "action": {"type": "explore"}}
+ {"speaking": "I'm going to build us a storage chest!", "action": {"type": "plan_build", "building": "storage-chest"}}
+ {"speaking": "", "action": {"type": "plan_build", "building": "campfire"}}

 â¯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts:214:22
    212|       const prompt = builder.buildPrompt(entity, createMockWorld());
    213| 
    214|       expect(prompt).toContain("Don't overthink");
       |                      ^
    215|       expect(prompt).toContain('gut reaction');
    216|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[203/746]âŽ¯

 FAIL  packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > instruction clarity > should end with response prompt
AssertionError: expected 'You are TestAgent, a villager in thisâ€¦' to match /Your response \(JSON only\):\s*$/

- Expected: 
/Your response \(JSON only\):\s*$/

+ Received: 
"You are TestAgent, a villager in this improbable forest settlement.

Your Personality:
- You treat the unknown like an old friend who owes you explanations. Mysteries don't intimidate you; they recruit you. You're the person who sees a locked door and immediately starts wondering about hinges, keys, and whether anyone's actually checked if it's locked or just sticky.
- You are aggressively friendly in a way that would be alarming if it weren't so sincere. Strangers become friends, friends become family, and family becomes this extensive network of people who've learned that declining your invitations only delays the inevitable. You will befriend that tree if given half a chance.
- You are kind in the specific way of people who've decided that if the universe is going to be harsh, someone has to compensate. That someone, apparently, is you. You didn't volunteer for this role but you've accepted it with the resignation of someone who knows their nature and has stopped fighting it.
- Dedication drives you with the force of a runaway cart on a steep hillâ€”fast, focused, probably going to crash if you don't figure out how to stop, but stopping doesn't occur to you as an option. You'll rest when you're done. You're never done.



--- Schema-Driven Component Info ---
## needs
Healthy and content


## personality
curious and adventurous, outgoing and social, helpful and cooperative, hardworking and dedicated


## Perception
Seen Agents: none
Seen Resources: none
Heard Speech: none


## identity
Name: TestAgent
Species: none
Age: none


## Memory
No memories yet.




Current Situation:
- Hunger: 50% (could eat)
- Energy: 60% (rested)
- The area around you is empty



Village Status:
- MISSING critical buildings: campfire (warmth), storage (items), shelter (sleep)


What You Can Do:
- 
- GATHERING & RESOURCES:
-   pick - Grab a single item nearby (say \"pick wood\" or \"pick berries\")
-   gather - Stockpile resources: collect a specified amount and automatically store in a chest (say \"gather 20 wood\" or \"gather 50 stone\")
- 
- BUILDING & CRAFTING:
-   plan_build - Plan a building project: queues the build and you'll automatically gather resources then construct it. Just say what building you want! (Examples: \"plan_build storage-chest\", \"plan_build campfire\", \"plan_build tent\")
- 
- EXPLORATION & NAVIGATION:
-   explore - Systematically explore unknown areas to find new resources
-   navigate - Go to specific coordinates (say \"navigate to x,y\" or \"go to 10,20\")

As a new villager, you can: help gather materials for storage. What will you do?

RESPOND IN JSON ONLY. Use this exact format:
{
  \"speaking\": \"what you say out loud (or empty string if silent)\",
  \"action\": {
    \"type\": \"action_name\",
    \"target\": \"optional target like 'wood' or agent name\",
    \"amount\": optional_number,
    \"building\": \"building type for plan_build\"
  }
}

Example responses:
{\"speaking\": \"\", \"action\": {\"type\": \"gather\", \"target\": \"wood\", \"amount\": 20}}
{\"speaking\": \"Hey Haven!\", \"action\": {\"type\": \"talk\", \"target\": \"Haven\"}}
{\"speaking\": \"\", \"action\": {\"type\": \"explore\"}}
{\"speaking\": \"I'm going to build us a storage chest!\", \"action\": {\"type\": \"plan_build\", \"building\": \"storage-chest\"}}
{\"speaking\": \"\", \"action\": {\"type\": \"plan_build\", \"building\": \"campfire\"}}"

 â¯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts:222:22
    220|       const prompt = builder.buildPrompt(entity, createMockWorld());
    221| 
    222|       expect(prompt).toMatch(/Your response \(JSON only\):\s*$/);
       |                      ^
    223|     });
    224|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[204/746]âŽ¯

 FAIL  packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > resource type descriptions > should describe trees when wood resources are visible
AssertionError: expected 'You are TestAgent, a villager in thisâ€¦' to contain '2 trees'

- Expected
+ Received

- 2 trees
+ You are TestAgent, a villager in this improbable forest settlement.
+
+ Your Personality:
+ - You treat the unknown like an old friend who owes you explanations. Mysteries don't intimidate you; they recruit you. You're the person who sees a locked door and immediately starts wondering about hinges, keys, and whether anyone's actually checked if it's locked or just sticky.
+ - You are aggressively friendly in a way that would be alarming if it weren't so sincere. Strangers become friends, friends become family, and family becomes this extensive network of people who've learned that declining your invitations only delays the inevitable. You will befriend that tree if given half a chance.
+ - You are kind in the specific way of people who've decided that if the universe is going to be harsh, someone has to compensate. That someone, apparently, is you. You didn't volunteer for this role but you've accepted it with the resignation of someone who knows their nature and has stopped fighting it.
+ - Dedication drives you with the force of a runaway cart on a steep hillâ€”fast, focused, probably going to crash if you don't figure out how to stop, but stopping doesn't occur to you as an option. You'll rest when you're done. You're never done.
+
+
+
+ --- Schema-Driven Component Info ---
+ ## needs
+ Healthy and content
+
+
+ ## personality
+ curious and adventurous, outgoing and social, helpful and cooperative, hardworking and dedicated
+
+
+ ## Perception
+ Seen Agents: none
+ Seen Resources: tree1, tree2
+ Heard Speech: none
+
+
+ ## identity
+ Name: TestAgent
+ Species: none
+ Age: none
+
+
+ ## Memory
+ No memories yet.
+
+
+
+
+ Current Situation:
+ - Hunger: 50% (could eat)
+ - Energy: 60% (rested)
+ - More resources visible in the area (2 sources)
+
+
+
+ Village Status:
+ - MISSING critical buildings: campfire (warmth), storage (items), shelter (sleep)
+
+
+ What You Can Do:
+ - 
+ - GATHERING & RESOURCES:
+ -   pick - Grab a single item nearby (say "pick wood" or "pick berries")
+ -   gather - Stockpile resources: collect a specified amount and automatically store in a chest (say "gather 20 wood" or "gather 50 stone")
+ - 
+ - BUILDING & CRAFTING:
+ -   plan_build - Plan a building project: queues the build and you'll automatically gather resources then construct it. Just say what building you want! (Examples: "plan_build storage-chest", "plan_build campfire", "plan_build tent")
+ - 
+ - EXPLORATION & NAVIGATION:
+ -   explore - Systematically explore unknown areas to find new resources
+ -   navigate - Go to specific coordinates (say "navigate to x,y" or "go to 10,20")
+
+ As a new villager, you can: gather wood or stone to help the village, help gather materials for storage. What will you do?
+
+ RESPOND IN JSON ONLY. Use this exact format:
+ {
+   "speaking": "what you say out loud (or empty string if silent)",
+   "action": {
+     "type": "action_name",
+     "target": "optional target like 'wood' or agent name",
+     "amount": optional_number,
+     "building": "building type for plan_build"
+   }
+ }
+
+ Example responses:
+ {"speaking": "", "action": {"type": "gather", "target": "wood", "amount": 20}}
+ {"speaking": "Hey Haven!", "action": {"type": "talk", "target": "Haven"}}
+ {"speaking": "", "action": {"type": "explore"}}
+ {"speaking": "I'm going to build us a storage chest!", "action": {"type": "plan_build", "building": "storage-chest"}}
+ {"speaking": "", "action": {"type": "plan_build", "building": "campfire"}}

 â¯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts:260:22
    258|       const prompt = builder.buildPrompt(entity, mockWorld);
    259| 
    260|       expect(prompt).toContain('2 trees');
       |                      ^
    261|       expect(prompt).not.toContain('food source');
    262|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[205/746]âŽ¯

 FAIL  packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > resource type descriptions > should describe rocks when stone resources are visible
AssertionError: expected 'You are TestAgent, a villager in thisâ€¦' to contain '1 rock'

- Expected
+ Received

- 1 rock
+ You are TestAgent, a villager in this improbable forest settlement.
+
+ Your Personality:
+ - You are the kind of person who sees "Do Not Enter" signs as interesting suggestions rather than boundaries. Curiosity drives you with the relentless force of a very polite avalancheâ€”unstoppable, apologetic about the destruction, already wondering what's on the other side of that mountain.
+ - You treat silence like a malfunctioning appliance that needs immediate fixing, preferably with conversation. Solitude makes you nervous. Crowds make you energized. You are the person who befriends the stranger at the well, the traveler on the road, the bird that landed nearby (it's a very one-sided friendship, but you're trying).
+ - You help people with the reflexive automaticity of breathing. Someone needs something? You're already moving. Someone's struggling? You're already there. You've never quite learned where you end and other people's problems begin, which makes you beloved and occasionally exhausted.
+ - You work with the relentless efficiency of someone who's accidentally made productivity their entire personality. Idle hands don't just feel restlessâ€”they feel like moral failure. Rest is something other people do. You've forgotten how.
+
+
+
+ --- Schema-Driven Component Info ---
+ ## needs
+ Healthy and content
+
+
+ ## personality
+ curious and adventurous, outgoing and social, helpful and cooperative, hardworking and dedicated
+
+
+ ## Perception
+ Seen Agents: none
+ Seen Resources: rock1
+ Heard Speech: none
+
+
+ ## identity
+ Name: TestAgent
+ Species: none
+ Age: none
+
+
+ ## Memory
+ No memories yet.
+
+
+
+
+ Current Situation:
+ - Hunger: 50% (could eat)
+ - Energy: 60% (rested)
+ - More resources visible in the area (1 sources)
+
+
+
+ Village Status:
+ - MISSING critical buildings: campfire (warmth), storage (items), shelter (sleep)
+
+
+ What You Can Do:
+ - 
+ - GATHERING & RESOURCES:
+ -   pick - Grab a single item nearby (say "pick wood" or "pick berries")
+ -   gather - Stockpile resources: collect a specified amount and automatically store in a chest (say "gather 20 wood" or "gather 50 stone")
+ - 
+ - BUILDING & CRAFTING:
+ -   plan_build - Plan a building project: queues the build and you'll automatically gather resources then construct it. Just say what building you want! (Examples: "plan_build storage-chest", "plan_build campfire", "plan_build tent")
+ - 
+ - EXPLORATION & NAVIGATION:
+ -   explore - Systematically explore unknown areas to find new resources
+ -   navigate - Go to specific coordinates (say "navigate to x,y" or "go to 10,20")
+
+ As a new villager, you can: gather wood or stone to help the village, help gather materials for storage. What will you do?
+
+ RESPOND IN JSON ONLY. Use this exact format:
+ {
+   "speaking": "what you say out loud (or empty string if silent)",
+   "action": {
+     "type": "action_name",
+     "target": "optional target like 'wood' or agent name",
+     "amount": optional_number,
+     "building": "building type for plan_build"
+   }
+ }
+
+ Example responses:
+ {"speaking": "", "action": {"type": "gather", "target": "wood", "amount": 20}}
+ {"speaking": "Hey Haven!", "action": {"type": "talk", "target": "Haven"}}
+ {"speaking": "", "action": {"type": "explore"}}
+ {"speaking": "I'm going to build us a storage chest!", "action": {"type": "plan_build", "building": "storage-chest"}}
+ {"speaking": "", "action": {"type": "plan_build", "building": "campfire"}}

 â¯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts:281:22
    279|       const prompt = builder.buildPrompt(entity, mockWorld);
    280| 
    281|       expect(prompt).toContain('1 rock');
       |                      ^
    282|       expect(prompt).not.toContain('food source');
    283|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[206/746]âŽ¯

 FAIL  packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > resource type descriptions > should describe mixed resources correctly
AssertionError: expected 'You are TestAgent, a villager in thisâ€¦' to contain '1 tree'

- Expected
+ Received

- 1 tree
+ You are TestAgent, a villager in this improbable forest settlement.
+
+ Your Personality:
+ - You are the kind of person who sees "Do Not Enter" signs as interesting suggestions rather than boundaries. Curiosity drives you with the relentless force of a very polite avalancheâ€”unstoppable, apologetic about the destruction, already wondering what's on the other side of that mountain.
+ - You treat silence like a malfunctioning appliance that needs immediate fixing, preferably with conversation. Solitude makes you nervous. Crowds make you energized. You are the person who befriends the stranger at the well, the traveler on the road, the bird that landed nearby (it's a very one-sided friendship, but you're trying).
+ - You help people with the reflexive automaticity of breathing. Someone needs something? You're already moving. Someone's struggling? You're already there. You've never quite learned where you end and other people's problems begin, which makes you beloved and occasionally exhausted.
+ - You work with the relentless efficiency of someone who's accidentally made productivity their entire personality. Idle hands don't just feel restlessâ€”they feel like moral failure. Rest is something other people do. You've forgotten how.
+
+
+
+ --- Schema-Driven Component Info ---
+ ## needs
+ Healthy and content
+
+
+ ## personality
+ curious and adventurous, outgoing and social, helpful and cooperative, hardworking and dedicated
+
+
+ ## Perception
+ Seen Agents: none
+ Seen Resources: tree1, rock1, food1
+ Heard Speech: none
+
+
+ ## identity
+ Name: TestAgent
+ Species: none
+ Age: none
+
+
+ ## Memory
+ No memories yet.
+
+
+
+
+ Current Situation:
+ - Hunger: 50% (could eat)
+ - Energy: 60% (rested)
+ - More resources visible in the area (3 sources)
+
+
+
+ Village Status:
+ - MISSING critical buildings: campfire (warmth), storage (items), shelter (sleep)
+
+
+ What You Can Do:
+ - 
+ - GATHERING & RESOURCES:
+ -   pick - Grab a single item nearby (say "pick wood" or "pick berries")
+ -   gather - Stockpile resources: collect a specified amount and automatically store in a chest (say "gather 20 wood" or "gather 50 stone")
+ - 
+ - BUILDING & CRAFTING:
+ -   plan_build - Plan a building project: queues the build and you'll automatically gather resources then construct it. Just say what building you want! (Examples: "plan_build storage-chest", "plan_build campfire", "plan_build tent")
+ - 
+ - EXPLORATION & NAVIGATION:
+ -   explore - Systematically explore unknown areas to find new resources
+ -   navigate - Go to specific coordinates (say "navigate to x,y" or "go to 10,20")
+
+ As a new villager, you can: gather wood or stone to help the village, help gather materials for storage. What will you do?
+
+ RESPOND IN JSON ONLY. Use this exact format:
+ {
+   "speaking": "what you say out loud (or empty string if silent)",
+   "action": {
+     "type": "action_name",
+     "target": "optional target like 'wood' or agent name",
+     "amount": optional_number,
+     "building": "building type for plan_build"
+   }
+ }
+
+ Example responses:
+ {"speaking": "", "action": {"type": "gather", "target": "wood", "amount": 20}}
+ {"speaking": "Hey Haven!", "action": {"type": "talk", "target": "Haven"}}
+ {"speaking": "", "action": {"type": "explore"}}
+ {"speaking": "I'm going to build us a storage chest!", "action": {"type": "plan_build", "building": "storage-chest"}}
+ {"speaking": "", "action": {"type": "plan_build", "building": "campfire"}}

 â¯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts:305:22
    303|       const prompt = builder.buildPrompt(entity, mockWorld);
    304| 
    305|       expect(prompt).toContain('1 tree');
       |                      ^
    306|       expect(prompt).toContain('1 rock');
    307|       expect(prompt).toContain('1 food source');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[207/746]âŽ¯

 FAIL  packages/magic/src/__tests__/CostCalculators.test.ts > CostCalculators - Divine Paradigm > should cost favor as primary resource
AssertionError: expected 14 to be 12 // Object.is equality

- Expected
+ Received

- 12
+ 14

 â¯ packages/magic/src/__tests__/CostCalculators.test.ts:567:31
    565| 
    566|     expect(favorCost).toBeDefined();
    567|     expect(favorCost?.amount).toBe(Math.ceil(40 * 0.3));
       |                               ^
    568|   });
    569| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[208/746]âŽ¯

 FAIL  packages/magic/src/__tests__/CostCalculators.test.ts > CostCalculators - Divine Paradigm > should reduce cost for aligned spells
AssertionError: expected 17 to be less than or equal to 15
 â¯ packages/magic/src/__tests__/CostCalculators.test.ts:588:31
    586| 
    587|     const baseCost = Math.ceil(50 * 0.3);
    588|     expect(favorCost?.amount).toBeLessThanOrEqual(baseCost);
       |                               ^
    589|   });
    590| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[209/746]âŽ¯

 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Initialization > should register all cost calculators during initialization
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Initialization > should allow getting registered calculators
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Initialization > should return all registered paradigm IDs
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > MagicLawEnforcer Integration > should use cost calculator to calculate costs
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > MagicLawEnforcer Integration > should pass validation when caster has enough resources
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > MagicLawEnforcer Integration > should fail validation when caster lacks resources
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > MagicLawEnforcer Integration > should warn about terminal effects
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > MagicLawEnforcer Integration > should fail with clear error when calculator not registered
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > SpellCastingService Integration > should throw when checking costs without calculator
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > SpellCastingService Integration > should throw when deducting costs without calculator
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Cost Calculation > should calculate mana and stamina costs for academic spells
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Cost Calculation > should reduce mana cost with ambient power
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Affordability Checking > should correctly identify when caster can afford spell
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Affordability Checking > should correctly identify insufficient resources
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Error Messages > should have actionable error message for missing calculator
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Error Messages > should have clear error for missing paradigm
TypeError: Cannot read properties of undefined (reading 'clear')
 â¯ packages/magic/src/__tests__/CostSystemIntegration.test.ts:22:28
     20|   beforeEach(() => {
     21|     // Clear and register cost calculators
     22|     costCalculatorRegistry.clear();
       |                            ^
     23|     registerAllCostCalculators();
     24|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[210/746]âŽ¯

 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Initialization > should register all cost calculators during initialization
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Initialization > should allow getting registered calculators
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Initialization > should return all registered paradigm IDs
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > MagicLawEnforcer Integration > should use cost calculator to calculate costs
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > MagicLawEnforcer Integration > should pass validation when caster has enough resources
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > MagicLawEnforcer Integration > should fail validation when caster lacks resources
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > MagicLawEnforcer Integration > should warn about terminal effects
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > MagicLawEnforcer Integration > should fail with clear error when calculator not registered
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > SpellCastingService Integration > should throw when checking costs without calculator
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > SpellCastingService Integration > should throw when deducting costs without calculator
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Cost Calculation > should calculate mana and stamina costs for academic spells
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Cost Calculation > should reduce mana cost with ambient power
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Affordability Checking > should correctly identify when caster can afford spell
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Affordability Checking > should correctly identify insufficient resources
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Error Messages > should have actionable error message for missing calculator
 FAIL  packages/magic/src/__tests__/CostSystemIntegration.test.ts > Cost System Integration > Error Messages > should have clear error for missing paradigm
TypeError: Cannot read properties of undefined (reading 'clear')
 â¯ packages/magic/src/__tests__/CostSystemIntegration.test.ts:27:28
     25| 
     26|   afterEach(() => {
     27|     costCalculatorRegistry.clear();
       |                            ^
     28|   });
     29| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[211/746]âŽ¯

 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > MagicLawEnforcer: No Fallbacks > should FAIL validation when calculator not registered
 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > MagicLawEnforcer: No Fallbacks > should NOT use basic mana cost as fallback
 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > MagicLawEnforcer: No Fallbacks > should return early when calculator missing
 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > SpellCastingService: No Fallbacks > should THROW when checking costs without calculator
 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > SpellCastingService: No Fallbacks > should THROW when deducting costs without calculator
 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > SpellCastingService: No Fallbacks > should THROW when paradigm not found
 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > SpellCastingService: No Fallbacks > should NOT silently use basic mana pools
 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > Error Message Quality > should include paradigm ID in error message
 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > Error Message Quality > should tell user how to fix the problem
 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > Error Message Quality > should have different error for each failure type
 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > Behavior After Error > should not modify caster state when throwing
 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > Behavior After Error > should allow retrying after registering calculators
TypeError: Cannot read properties of undefined (reading 'clear')
 â¯ packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts:20:28
     18|   beforeEach(() => {
     19|     // Start with NO calculators registered
     20|     costCalculatorRegistry.clear();
       |                            ^
     21|   });
     22| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[212/746]âŽ¯

 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > MagicLawEnforcer: No Fallbacks > should FAIL validation when calculator not registered
 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > MagicLawEnforcer: No Fallbacks > should NOT use basic mana cost as fallback
 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > MagicLawEnforcer: No Fallbacks > should return early when calculator missing
 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > SpellCastingService: No Fallbacks > should THROW when checking costs without calculator
 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > SpellCastingService: No Fallbacks > should THROW when deducting costs without calculator
 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > SpellCastingService: No Fallbacks > should THROW when paradigm not found
 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > SpellCastingService: No Fallbacks > should NOT silently use basic mana pools
 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > Error Message Quality > should include paradigm ID in error message
 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > Error Message Quality > should tell user how to fix the problem
 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > Error Message Quality > should have different error for each failure type
 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > Behavior After Error > should not modify caster state when throwing
 FAIL  packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts > Cost System: No Fallbacks Policy > Behavior After Error > should allow retrying after registering calculators
TypeError: Cannot read properties of undefined (reading 'clear')
 â¯ packages/magic/src/__tests__/CostSystemNoFallbacks.test.ts:24:28
     22| 
     23|   afterEach(() => {
     24|     costCalculatorRegistry.clear();
       |                            ^
     25|   });
     26| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[213/746]âŽ¯

 FAIL  packages/magic/src/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Cost Calculator Integration > should reject spell if caster cannot afford costs
AssertionError: expected [ 'Insufficient mana: need 30 more' ] to include StringContaining "Insufficient mana"
 â¯ packages/magic/src/__tests__/MagicLawEnforcerIntegration.test.ts:76:27
     74| 
     75|     expect(result.valid).toBe(false);
     76|     expect(result.errors).toContain(expect.stringContaining('Insufficiâ€¦
       |                           ^
     77|   });
     78| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[214/746]âŽ¯

 FAIL  packages/magic/src/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Cost Calculator Integration > should detect law violations
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/magic/src/__tests__/MagicLawEnforcerIntegration.test.ts:157:27
    155|     // Should have warnings or errors about law violations
    156|     const hasViolations = result.errors.length > 0 || result.warnings.â€¦
    157|     expect(hasViolations).toBe(true);
       |                           ^
    158|   });
    159| });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[215/746]âŽ¯

 FAIL  packages/magic/src/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Risk Assessment > should assess mishap risks based on proficiency
AssertionError: expected undefined not to be undefined
 â¯ packages/magic/src/__tests__/MagicLawEnforcerIntegration.test.ts:263:24
    261|     // Should have mishap risk
    262|     const mishapRisk = result.risks.find((r) => r.trigger === 'low_proâ€¦
    263|     expect(mishapRisk).toBeDefined();
       |                        ^
    264|     expect(mishapRisk?.probability).toBeGreaterThan(0);
    265|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[216/746]âŽ¯

 FAIL  packages/magic/src/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Risk Assessment > should assess corruption risks for dark magic
AssertionError: expected undefined not to be undefined
 â¯ packages/magic/src/__tests__/MagicLawEnforcerIntegration.test.ts:302:31
    300|     // Should warn about corruption threshold
    301|     const corruptionWarning = result.warnings.find((w) => w.includes('â€¦
    302|     expect(corruptionWarning).toBeDefined();
       |                               ^
    303|   });
    304| });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[217/746]âŽ¯

 FAIL  packages/magic/src/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Spell Modification > should calculate bonuses from favorable conditions
AssertionError: expected 0 to be greater than 0
 â¯ packages/magic/src/__tests__/MagicLawEnforcerIntegration.test.ts:340:35
    338| 
    339|     expect(result.bonuses).toBeDefined();
    340|     expect(result.bonuses.length).toBeGreaterThan(0);
       |                                   ^
    341|   });
    342| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[218/746]âŽ¯

 FAIL  packages/magic/src/__tests__/MagicSystemEdgeCases.test.ts > Resource Depletion Edge Cases > should handle casting when resources hit zero mid-cast
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/magic/src/__tests__/MagicSystemEdgeCases.test.ts:66:30
     64| 
     65|     // Mana should have hit zero, cast should fail
     66|     expect(castState.failed).toBe(true);
       |                              ^
     67|     expect(castState.failureReason).toBe('resource_depleted_during_casâ€¦
     68|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[219/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > AllomancySkillTree > tree structure > should have correct paradigm ID
TypeError: Cannot read properties of undefined (reading 'paradigmId')
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:78:35
     76|   describe('tree structure', () => {
     77|     it('should have correct paradigm ID', () => {
     78|       expect(ALLOMANCY_SKILL_TREE.paradigmId).toBe('allomancy');
       |                                   ^
     79|     });
     80| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[220/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > AllomancySkillTree > tree structure > should have snapped as entry node
TypeError: Cannot read properties of undefined (reading 'entryNodes')
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:82:35
     80| 
     81|     it('should have snapped as entry node', () => {
     82|       expect(ALLOMANCY_SKILL_TREE.entryNodes).toContain('snapped');
       |                                   ^
     83|     });
     84| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[221/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > AllomancySkillTree > tree structure > should require bloodline for tree access
TypeError: Cannot read properties of undefined (reading 'rules')
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:86:35
     84| 
     85|     it('should require bloodline for tree access', () => {
     86|       expect(ALLOMANCY_SKILL_TREE.rules.requiresInnateAbility).toBe(trâ€¦
       |                                   ^
     87|       expect(ALLOMANCY_SKILL_TREE.rules.innateCondition).toBeDefined();
     88|       expect(ALLOMANCY_SKILL_TREE.rules.innateCondition?.type).toBe('bâ€¦

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[222/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > AllomancySkillTree > tree structure > should have metal discovery nodes
TypeError: Cannot read properties of undefined (reading 'nodes')
 â¯ Module.getNodesByCategory packages/magic/src/MagicSkillTree.ts:746:15
    744|  */
    745| export function getNodesByCategory(tree: MagicSkillTree, category: Magâ€¦
    746|   return tree.nodes.filter(n => n.category === category);
       |               ^
    747| }
    748| 
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:92:30

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[223/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > AllomancySkillTree > tree structure > should have Misting specialization nodes
TypeError: Cannot read properties of undefined (reading 'nodes')
 â¯ Module.getNodesByCategory packages/magic/src/MagicSkillTree.ts:746:15
    744|  */
    745| export function getNodesByCategory(tree: MagicSkillTree, category: Magâ€¦
    746|   return tree.nodes.filter(n => n.category === category);
       |               ^
    747| }
    748| 
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:103:35

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[224/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > AllomancySkillTree > tree structure > should have Mistborn awakening node
TypeError: Cannot read properties of undefined (reading 'nodes')
 â¯ Module.getNodeById packages/magic/src/MagicSkillTree.ts:732:15
    730|  */
    731| export function getNodeById(tree: MagicSkillTree, nodeId: string): Magâ€¦
    732|   return tree.nodes.find(n => n.id === nodeId);
       |               ^
    733| }
    734| 
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:111:28

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[225/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > AllomancySkillTree > helper functions > getMistingMetals returns all metals for full Mistborn
TypeError: getMistingMetals is not a function
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:121:22
    119|   describe('helper functions', () => {
    120|     it('getMistingMetals returns all metals for full Mistborn', () => {
    121|       const metals = getMistingMetals(1.0);
       |                      ^
    122|       expect(metals.length).toBeGreaterThan(8);
    123|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[226/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > AllomancySkillTree > helper functions > getMistingMetals returns basic metals for lower strength
TypeError: getMistingMetals is not a function
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:126:22
    124| 
    125|     it('getMistingMetals returns basic metals for lower strength', () â€¦
    126|       const metals = getMistingMetals(0.25);
       |                      ^
    127|       expect(metals).toContain('steel');
    128|       expect(metals).toContain('iron');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[227/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > AllomancySkillTree > helper functions > getMistingMetals returns empty for no bloodline
TypeError: getMistingMetals is not a function
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:133:22
    131| 
    132|     it('getMistingMetals returns empty for no bloodline', () => {
    133|       const metals = getMistingMetals(0.1);
       |                      ^
    134|       expect(metals.length).toBe(0);
    135|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[228/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > AllomancySkillTree > helper functions > isMetalAvailable checks bloodline strength
TypeError: isMetalAvailable is not a function
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:138:14
    136| 
    137|     it('isMetalAvailable checks bloodline strength', () => {
    138|       expect(isMetalAvailable('steel', 0.25)).toBe(true);
       |              ^
    139|       expect(isMetalAvailable('zinc', 0.25)).toBe(false); // Mental meâ€¦
    140|       expect(isMetalAvailable('zinc', 0.5)).toBe(true);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[229/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > AllomancySkillTree > tree access > should require Allomancer bloodline
TypeError: Cannot read properties of undefined (reading 'rules')
 â¯ Module.canAccessTree packages/magic/src/MagicSkillTreeEvaluator.ts:1086:13
    1084|   context: EvaluationContext
    1085| ): { canAccess: boolean; reason?: string } {
    1086|   if (!tree.rules.requiresInnateAbility) {
       |             ^
    1087|     return { canAccess: true };
    1088|   }
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:152:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[230/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > ShintoSkillTree > tree structure > should have correct paradigm ID
TypeError: Cannot read properties of undefined (reading 'paradigmId')
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:170:32
    168|   describe('tree structure', () => {
    169|     it('should have correct paradigm ID', () => {
    170|       expect(SHINTO_SKILL_TREE.paradigmId).toBe('shinto');
       |                                ^
    171|     });
    172| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[231/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > ShintoSkillTree > tree structure > should not require innate ability
TypeError: Cannot read properties of undefined (reading 'rules')
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:174:32
    172| 
    173|     it('should not require innate ability', () => {
    174|       expect(SHINTO_SKILL_TREE.rules.requiresInnateAbility).toBe(falseâ€¦
       |                                ^
    175|     });
    176| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[232/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > ShintoSkillTree > tree structure > should have kami relationship nodes
TypeError: Cannot read properties of undefined (reading 'nodes')
 â¯ Module.getNodesByCategory packages/magic/src/MagicSkillTree.ts:746:15
    744|  */
    745| export function getNodesByCategory(tree: MagicSkillTree, category: Magâ€¦
    746|   return tree.nodes.filter(n => n.category === category);
       |               ^
    747| }
    748| 
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:178:33

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[233/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > ShintoSkillTree > tree structure > should have ritual nodes
TypeError: Cannot read properties of undefined (reading 'nodes')
 â¯ Module.getNodesByCategory packages/magic/src/MagicSkillTree.ts:746:15
    744|  */
    745| export function getNodesByCategory(tree: MagicSkillTree, category: Magâ€¦
    746|   return tree.nodes.filter(n => n.category === category);
       |               ^
    747| }
    748| 
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:183:27

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[234/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > ShintoSkillTree > tree structure > should have foundation nodes for purity
TypeError: Cannot read properties of undefined (reading 'nodes')
 â¯ Module.getNodeById packages/magic/src/MagicSkillTree.ts:732:15
    730|  */
    731| export function getNodeById(tree: MagicSkillTree, nodeId: string): Magâ€¦
    732|   return tree.nodes.find(n => n.id === nodeId);
       |               ^
    733| }
    734| 
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:188:27

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[235/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > ShintoSkillTree > helper functions > getAvailableKamiTypes returns types based on unlocked nodes
TypeError: getAvailableKamiTypes is not a function
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:196:14
    194|     it('getAvailableKamiTypes returns types based on unlocked nodes', â€¦
    195|       // No nodes unlocked
    196|       expect(getAvailableKamiTypes({})).toEqual([]);
       |              ^
    197| 
    198|       // With nature kami node unlocked

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[236/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > ShintoSkillTree > helper functions > isPuritySufficient checks purity against ritual tier
TypeError: isPuritySufficient is not a function
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:204:14
    202| 
    203|     it('isPuritySufficient checks purity against ritual tier', () => {
    204|       expect(isPuritySufficient(80, 1)).toBe(true);
       |              ^
    205|       expect(isPuritySufficient(40, 1)).toBe(false);
    206|       expect(isPuritySufficient(90, 3)).toBe(true);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[237/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > ShintoSkillTree > tree access > should be accessible to anyone
TypeError: Cannot read properties of undefined (reading 'rules')
 â¯ Module.canAccessTree packages/magic/src/MagicSkillTreeEvaluator.ts:1086:13
    1084|   context: EvaluationContext
    1085| ): { canAccess: boolean; reason?: string } {
    1086|   if (!tree.rules.requiresInnateAbility) {
       |             ^
    1087|     return { canAccess: true };
    1088|   }
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:215:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[238/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > SympathySkillTree > tree structure > should have correct paradigm ID
TypeError: Cannot read properties of undefined (reading 'paradigmId')
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:227:34
    225|   describe('tree structure', () => {
    226|     it('should have correct paradigm ID', () => {
    227|       expect(SYMPATHY_SKILL_TREE.paradigmId).toBe('sympathy');
       |                                  ^
    228|     });
    229| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[239/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > SympathySkillTree > tree structure > should not require innate ability
TypeError: Cannot read properties of undefined (reading 'rules')
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:231:34
    229| 
    230|     it('should not require innate ability', () => {
    231|       expect(SYMPATHY_SKILL_TREE.rules.requiresInnateAbility).toBe(falâ€¦
       |                                  ^
    232|     });
    233| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[240/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > SympathySkillTree > tree structure > should have alar foundation nodes
TypeError: Cannot read properties of undefined (reading 'nodes')
 â¯ Module.getNodeById packages/magic/src/MagicSkillTree.ts:732:15
    730|  */
    731| export function getNodeById(tree: MagicSkillTree, nodeId: string): Magâ€¦
    732|   return tree.nodes.find(n => n.id === nodeId);
       |               ^
    733| }
    734| 
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:235:25

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[241/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > SympathySkillTree > tree structure > should have link type nodes
TypeError: Cannot read properties of undefined (reading 'nodes')
 â¯ Module.getNodeById packages/magic/src/MagicSkillTree.ts:732:15
    730|  */
    731| export function getNodeById(tree: MagicSkillTree, nodeId: string): Magâ€¦
    732|   return tree.nodes.find(n => n.id === nodeId);
       |               ^
    733| }
    734| 
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:242:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[242/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > SympathySkillTree > tree structure > should have advanced binding nodes
TypeError: Cannot read properties of undefined (reading 'nodes')
 â¯ Module.getNodeById packages/magic/src/MagicSkillTree.ts:732:15
    730|  */
    731| export function getNodeById(tree: MagicSkillTree, nodeId: string): Magâ€¦
    732|   return tree.nodes.find(n => n.id === nodeId);
       |               ^
    733| }
    734| 
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:248:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[243/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > SympathySkillTree > tree structure > should have split-focus mastery nodes
TypeError: Cannot read properties of undefined (reading 'nodes')
 â¯ Module.getNodeById packages/magic/src/MagicSkillTree.ts:732:15
    730|  */
    731| export function getNodeById(tree: MagicSkillTree, nodeId: string): Magâ€¦
    732|   return tree.nodes.find(n => n.id === nodeId);
       |               ^
    733| }
    734| 
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:253:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[244/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > SympathySkillTree > constants > LINK_TYPES should be in order of difficulty
TypeError: Cannot read properties of undefined (reading '0')
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:260:14
    258|   describe('constants', () => {
    259|     it('LINK_TYPES should be in order of difficulty', () => {
    260|       expect(LINK_TYPES[0]).toBe('identical');
       |              ^
    261|       expect(LINK_TYPES[LINK_TYPES.length - 1]).toBe('antipathic');
    262|       expect(LINK_TYPES.length).toBe(6);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[245/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > SympathySkillTree > constants > BINDING_PRINCIPLES should have core transfer types
AssertionError: the given combination of arguments (undefined and string) is invalid for this assertion. You can use an array, a map, an object, a set, a string, or a weakset instead of a string
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:266:34
    264| 
    265|     it('BINDING_PRINCIPLES should have core transfer types', () => {
    266|       expect(BINDING_PRINCIPLES).toContain('heat_transfer');
       |                                  ^
    267|       expect(BINDING_PRINCIPLES).toContain('motion_transfer');
    268|       expect(BINDING_PRINCIPLES.length).toBe(5);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[246/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > SympathySkillTree > helper functions > getMaxBindings returns correct count based on nodes
TypeError: getMaxBindings is not a function
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:274:14
    272|   describe('helper functions', () => {
    273|     it('getMaxBindings returns correct count based on nodes', () => {
    274|       expect(getMaxBindings({})).toBe(1);
       |              ^
    275|       expect(getMaxBindings({ 'dual-binding': 1 })).toBe(2);
    276|       expect(getMaxBindings({ 'dual-binding': 1, 'triple-binding': 1 }â€¦

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[247/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > SympathySkillTree > helper functions > calculateLinkEfficiency returns higher values for better links
TypeError: calculateLinkEfficiency is not a function
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:281:28
    279| 
    280|     it('calculateLinkEfficiency returns higher values for better linksâ€¦
    281|       const identicalEff = calculateLinkEfficiency('identical', 1, 0);
       |                            ^
    282|       const similarEff = calculateLinkEfficiency('similar', 1, 0);
    283|       expect(identicalEff).toBeGreaterThan(similarEff);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[248/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > SympathySkillTree > helper functions > calculateSlippage returns energy loss percentage
TypeError: calculateSlippage is not a function
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:288:24
    286|     it('calculateSlippage returns energy loss percentage', () => {
    287|       // Function signature: (baseSlippage, slippageControlLevel, hasPâ€¦
    288|       const slippage = calculateSlippage(0.3, 0, false, 'similar');
       |                        ^
    289|       expect(slippage).toBeGreaterThan(0);
    290|       expect(slippage).toBeLessThan(1);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[249/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > tree structure > should have correct paradigm ID
TypeError: Cannot read properties of undefined (reading 'paradigmId')
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:302:32
    300|   describe('tree structure', () => {
    301|     it('should have correct paradigm ID', () => {
    302|       expect(DAEMON_SKILL_TREE.paradigmId).toBe('daemon');
       |                                ^
    303|     });
    304| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[250/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > tree structure > should not require innate ability (everyone has a daemon)
TypeError: Cannot read properties of undefined (reading 'rules')
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:306:32
    304| 
    305|     it('should not require innate ability (everyone has a daemon)', ()â€¦
    306|       expect(DAEMON_SKILL_TREE.rules.requiresInnateAbility).toBe(falseâ€¦
       |                                ^
    307|     });
    308| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[251/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > tree structure > should have daemon-bond as entry node
TypeError: Cannot read properties of undefined (reading 'entryNodes')
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:310:32
    308| 
    309|     it('should have daemon-bond as entry node', () => {
    310|       expect(DAEMON_SKILL_TREE.entryNodes).toContain('daemon-bond');
       |                                ^
    311|     });
    312| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[252/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > tree structure > should have settling node
TypeError: Cannot read properties of undefined (reading 'nodes')
 â¯ Module.getNodeById packages/magic/src/MagicSkillTree.ts:732:15
    730|  */
    731| export function getNodeById(tree: MagicSkillTree, nodeId: string): Magâ€¦
    732|   return tree.nodes.find(n => n.id === nodeId);
       |               ^
    733| }
    734| 
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:314:28

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[253/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > tree structure > should have dust category nodes
TypeError: Cannot read properties of undefined (reading 'nodes')
 â¯ Module.getNodesByCategory packages/magic/src/MagicSkillTree.ts:746:15
    744|  */
    745| export function getNodesByCategory(tree: MagicSkillTree, category: Magâ€¦
    746|   return tree.nodes.filter(n => n.category === category);
       |               ^
    747| }
    748| 
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:320:25

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[254/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > tree structure > should have separation category nodes
TypeError: Cannot read properties of undefined (reading 'nodes')
 â¯ Module.getNodesByCategory packages/magic/src/MagicSkillTree.ts:746:15
    744|  */
    745| export function getNodesByCategory(tree: MagicSkillTree, category: Magâ€¦
    746|   return tree.nodes.filter(n => n.category === category);
       |               ^
    747| }
    748| 
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:326:31

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[255/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > tree structure > should have witch blood node with bloodline requirement
TypeError: Cannot read properties of undefined (reading 'nodes')
 â¯ Module.getNodeById packages/magic/src/MagicSkillTree.ts:732:15
    730|  */
    731| export function getNodeById(tree: MagicSkillTree, nodeId: string): Magâ€¦
    732|   return tree.nodes.find(n => n.id === nodeId);
       |               ^
    733| }
    734| 
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:332:25

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[256/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > constants > DAEMON_FORM_CATEGORIES should have form types
TypeError: Cannot read properties of undefined (reading 'predator')
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:342:37
    340|   describe('constants', () => {
    341|     it('DAEMON_FORM_CATEGORIES should have form types', () => {
    342|       expect(DAEMON_FORM_CATEGORIES.predator).toBeDefined();
       |                                     ^
    343|       expect(DAEMON_FORM_CATEGORIES.companion).toBeDefined();
    344|       expect(DAEMON_FORM_CATEGORIES.wisdom).toBeDefined();

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[257/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > constants > each form category should have animal forms
TypeError: Cannot read properties of undefined (reading 'predator')
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:351:37
    349| 
    350|     it('each form category should have animal forms', () => {
    351|       expect(DAEMON_FORM_CATEGORIES.predator.length).toBeGreaterThan(0â€¦
       |                                     ^
    352|       expect(DAEMON_FORM_CATEGORIES.predator).toContain('wolf');
    353|       expect(DAEMON_FORM_CATEGORIES.companion).toContain('dog');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[258/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > helper functions > getFormBonuses returns bonuses for form category
TypeError: getFormBonuses is not a function
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:359:31
    357|   describe('helper functions', () => {
    358|     it('getFormBonuses returns bonuses for form category', () => {
    359|       const predatorBonuses = getFormBonuses('predator');
       |                               ^
    360|       expect(predatorBonuses.primary).toBe('combat');
    361| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[259/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > helper functions > isFormInCategory checks form membership
TypeError: isFormInCategory is not a function
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:367:14
    365| 
    366|     it('isFormInCategory checks form membership', () => {
    367|       expect(isFormInCategory('wolf', 'predator')).toBe(true);
       |              ^
    368|       expect(isFormInCategory('wolf', 'companion')).toBe(false);
    369|       expect(isFormInCategory('dog', 'companion')).toBe(true);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[260/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > helper functions > getFormCategory returns category for a form
TypeError: getFormCategory is not a function
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:373:14
    371| 
    372|     it('getFormCategory returns category for a form', () => {
    373|       expect(getFormCategory('wolf')).toBe('predator');
       |              ^
    374|       expect(getFormCategory('owl')).toBe('wisdom');
    375|       expect(getFormCategory('unknown_form')).toBeNull();

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[261/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > helper functions > getSeparationDistance calculates based on nodes
TypeError: getSeparationDistance is not a function
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:379:14
    377| 
    378|     it('getSeparationDistance calculates based on nodes', () => {
    379|       expect(getSeparationDistance({})).toBe(0);
       |              ^
    380|       expect(getSeparationDistance({ 'basic-separation': 1 })).toBe(50â€¦
    381|       expect(getSeparationDistance({ 'basic-separation': 1, 'extended-â€¦

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[262/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > helper functions > canSeparate checks for basic separation node
TypeError: canSeparate is not a function
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:386:14
    384| 
    385|     it('canSeparate checks for basic separation node', () => {
    386|       expect(canSeparate({})).toBe(false);
       |              ^
    387|       expect(canSeparate({ 'basic-separation': 1 })).toBe(true);
    388|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[263/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > helper functions > hasSettled checks for settling node
TypeError: hasSettled is not a function
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:391:14
    389| 
    390|     it('hasSettled checks for settling node', () => {
    391|       expect(hasSettled({})).toBe(false);
       |              ^
    392|       expect(hasSettled({ 'settling': 1 })).toBe(true);
    393|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[264/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > tree access > should be accessible to anyone (everyone has a daemon)
TypeError: Cannot read properties of undefined (reading 'rules')
 â¯ Module.canAccessTree packages/magic/src/MagicSkillTreeEvaluator.ts:1086:13
    1084|   context: EvaluationContext
    1085| ): { canAccess: boolean; reason?: string } {
    1086|   if (!tree.rules.requiresInnateAbility) {
       |             ^
    1087|     return { canAccess: true };
    1088|   }
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:400:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[265/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > condition evaluators > should evaluate age_range condition
TypeError: Cannot read properties of undefined (reading 'nodes')
 â¯ Module.getNodeById packages/magic/src/MagicSkillTree.ts:732:15
    730|  */
    731| export function getNodeById(tree: MagicSkillTree, nodeId: string): Magâ€¦
    732|   return tree.nodes.find(n => n.id === nodeId);
       |               ^
    733| }
    734| 
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:407:24

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[266/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > DaemonSkillTree > condition evaluators > should evaluate form_category condition
TypeError: Cannot read properties of undefined (reading 'nodes')
 â¯ Module.getNodeById packages/magic/src/MagicSkillTree.ts:732:15
    730|  */
    731| export function getNodeById(tree: MagicSkillTree, nodeId: string): Magâ€¦
    732|   return tree.nodes.find(n => n.id === nodeId);
       |               ^
    733| }
    734| 
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:429:26

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[267/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > Cross-tree consistency > all trees should have unique IDs
TypeError: Cannot read properties of undefined (reading 'id')
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:462:43
    460| 
    461|   it('all trees should have unique IDs', () => {
    462|     const ids = ALL_TREES.map(t => t.tree.id);
       |                                           ^
    463|     const uniqueIds = new Set(ids);
    464|     expect(uniqueIds.size).toBe(ids.length);
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:462:27

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[268/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > Cross-tree consistency > all trees should have unique paradigm IDs
TypeError: Cannot read properties of undefined (reading 'paradigmId')
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:468:51
    466| 
    467|   it('all trees should have unique paradigm IDs', () => {
    468|     const paradigmIds = ALL_TREES.map(t => t.tree.paradigmId);
       |                                                   ^
    469|     const uniqueIds = new Set(paradigmIds);
    470|     expect(uniqueIds.size).toBe(paradigmIds.length);
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:468:35

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[269/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > Cross-tree consistency > all trees should have entry nodes
TypeError: Cannot read properties of undefined (reading 'entryNodes')
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:475:19
    473|   it('all trees should have entry nodes', () => {
    474|     for (const { name, tree } of ALL_TREES) {
    475|       expect(tree.entryNodes.length).toBeGreaterThan(0);
       |                   ^
    476| 
    477|       // Entry nodes should exist in the tree

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[270/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > Cross-tree consistency > all trees should have XP sources
TypeError: Cannot read properties of undefined (reading 'xpSources')
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:487:19
    485|   it('all trees should have XP sources', () => {
    486|     for (const { name, tree } of ALL_TREES) {
    487|       expect(tree.xpSources.length).toBeGreaterThan(0);
       |                   ^
    488|     }
    489|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[271/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > Cross-tree consistency > all trees should have mostly valid node prerequisites
TypeError: Cannot read properties of undefined (reading 'nodes')
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:495:31
    493| 
    494|     for (const { name, tree } of ALL_TREES) {
    495|       for (const node of tree.nodes) {
       |                               ^
    496|         if (node.prerequisites && node.prerequisites.length > 0) {
    497|           for (const prereqId of node.prerequisites) {

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[272/746]âŽ¯

 FAIL  packages/magic/src/__tests__/ParadigmSkillTrees.test.ts > Cross-tree consistency > all trees should have version numbers
TypeError: Cannot read properties of undefined (reading 'version')
 â¯ packages/magic/src/__tests__/ParadigmSkillTrees.test.ts:514:19
    512|   it('all trees should have version numbers', () => {
    513|     for (const { name, tree } of ALL_TREES) {
    514|       expect(tree.version).toBeGreaterThanOrEqual(1);
       |                   ^
    515|     }
    516|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[273/746]âŽ¯

 FAIL  packages/magic/src/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Protection > should apply protection effect
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/magic/src/__tests__/SpellEffectAppliers.test.ts:230:28
    228|     const result = applier.apply(effect, mockCaster, mockTarget, mockWâ€¦
    229| 
    230|     expect(result.success).toBe(true);
       |                            ^
    231|     expect(result.appliedValues.absorption).toBe(50);
    232|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[274/746]âŽ¯

 FAIL  packages/magic/src/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Protection > should stack protection effects additively
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/magic/src/__tests__/SpellEffectAppliers.test.ts:256:29
    254|     const result2 = applier.apply(effect, mockCaster, mockTarget, mockâ€¦
    255| 
    256|     expect(result1.success).toBe(true);
       |                             ^
    257|     expect(result2.success).toBe(true);
    258|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[275/746]âŽ¯

 FAIL  packages/magic/src/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Protection > should expire protection after duration
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/magic/src/__tests__/SpellEffectAppliers.test.ts:275:28
    273|     const result = applier.apply(effect, mockCaster, mockTarget, mockWâ€¦
    274| 
    275|     expect(result.success).toBe(true);
       |                            ^
    276|     expect(result.appliedValues.absorption).toBe(40);
    277|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[276/746]âŽ¯

 FAIL  packages/magic/src/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Control > should apply stun effect
TypeError: Cannot read properties of undefined (reading 'isStunned')
 â¯ packages/magic/src/__tests__/SpellEffectAppliers.test.ts:424:26
    422|     expect(result.success).toBe(true);
    423|     const statusEffects = mockTarget.getComponent('status_effects');
    424|     expect(statusEffects.isStunned).toBe(true);
       |                          ^
    425|   });
    426| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[277/746]âŽ¯

 FAIL  packages/magic/src/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Control > should apply fear effect
TypeError: Cannot read properties of undefined (reading 'currentBehavior')
 â¯ packages/magic/src/__tests__/SpellEffectAppliers.test.ts:450:21
    448| 
    449|     const behavior = mockTarget.getComponent('behavior');
    450|     expect(behavior.currentBehavior).toBe('flee');
       |                     ^
    451|   });
    452| });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[278/746]âŽ¯

 FAIL  packages/magic/src/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Transform > should transform entity form
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/magic/src/__tests__/SpellEffectAppliers.test.ts:539:28
    537|     const result = applier.apply(effect, mockCaster, mockTarget, mockWâ€¦
    538| 
    539|     expect(result.success).toBe(true);
       |                            ^
    540|     expect(mockTarget.getComponent('appearance').form).toBe('sheep');
    541|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[279/746]âŽ¯

 FAIL  packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Sexual compatibility > should check attraction between agents
 FAIL  packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Sexual compatibility > should return high score if both mutually attracted
 FAIL  packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Sexual compatibility > should check attraction conditions
 FAIL  packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Sexual compatibility > should return partial score if potential but not active attraction
 FAIL  packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Sexual compatibility > should check relationship style compatibility
 FAIL  packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Personality mesh > should score higher for complementary traits
 FAIL  packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Personality mesh > should score higher for shared values
 FAIL  packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Personality mesh > should score lower for conflicting traits
 FAIL  packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Personality mesh > should return neutral score when personality data missing
 FAIL  packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Personality mesh > should weigh multiple factors together
 FAIL  packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Shared interests > should return 0 when no shared interests
 FAIL  packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Shared interests > should return high score when many shared interests
 FAIL  packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Shared interests > should return neutral when priority data missing
 FAIL  packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Shared interests > should count only high-priority shared activities
 FAIL  packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Relationship strength > should return 0 when no relationship exists
 FAIL  packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Relationship strength > should return high score for strong existing relationship
 FAIL  packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Relationship strength > should weigh affinity highest
 FAIL  packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Relationship strength > should handle negative affinity
 FAIL  packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Overall compatibility > should combine all factors with weights
 FAIL  packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Overall compatibility > should handle low sexual compatibility
 FAIL  packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Overall compatibility > should work with minimal components
 FAIL  packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts > Courtship Compatibility Calculations > Overall compatibility > should cap at 1.0
TypeError: World is not a constructor
 â¯ packages/reproduction/src/__tests__/CourtshipCompatibility.test.ts:25:13
     23| 
     24|   beforeEach(() => {
     25|     world = new World();
       |             ^
     26|     agent1 = world.createEntity();
     27|     agent2 = world.createEntity();

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[280/746]âŽ¯

 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > considerCourtship (idle -> interested) > should return false if on cooldown
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > considerCourtship (idle -> interested) > should return false if not actively seeking
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > considerCourtship (idle -> interested) > should return false if compatibility below threshold
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > considerCourtship (idle -> interested) > should return true and transition to interested if conditions met
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > considerCourtship (idle -> interested) > should respect per-agent rejection cooldown
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > considerCourtship (idle -> interested) > should use romantic inclination to adjust threshold
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > initiateCourtship (interested -> courting) > should transition agent to courting state
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > initiateCourtship (interested -> courting) > should create active courtship record
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > initiateCourtship (interested -> courting) > should notify target agent
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > initiateCourtship (interested -> courting) > should create received courtship record on target
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > initiateCourtship (interested -> courting) > should record start tick
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > performCourtshipTactic > should record tactic in attempted tactics
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > performCourtshipTactic > should calculate and record reception
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > performCourtshipTactic > should update target interest level
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > performCourtshipTactic > should cap interest at 1.0
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > performCourtshipTactic > should update relationship affinity and familiarity
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > performCourtshipTactic > should update success probability
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > evaluateCourtship (being_courted -> accept/reject/continue) > should return "continue" if paradigm requirements not met
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > evaluateCourtship (being_courted -> accept/reject/continue) > should return "reject" if interest too low
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > evaluateCourtship (being_courted -> accept/reject/continue) > should return "accept" if decision score exceeds threshold
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > evaluateCourtship (being_courted -> accept/reject/continue) > should set willingToConsent to true on accept
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > evaluateCourtship (being_courted -> accept/reject/continue) > should use romantic inclination to adjust threshold
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > evaluateCourtship (being_courted -> accept/reject/continue) > should check all required tactics are present
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > evaluateCourtship (being_courted -> accept/reject/continue) > should allow optional tactics to count toward minimum
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > transitionToMating (both consenting -> mating) > should set both agents to consenting state
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > transitionToMating (both consenting -> mating) > should emit courtship:consent event
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > transitionToMating (both consenting -> mating) > should include mating behavior in event
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > checkParadigmRequirements > should return false if required tactics missing
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > checkParadigmRequirements > should return false if minimum tactics not met
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > checkParadigmRequirements > should return true if all requirements met
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > checkParadigmRequirements > should fail if forbidden tactic was used
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > Error handling > should throw when agent missing CourtshipComponent
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > Error handling > should throw when agent missing SexualityComponent
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > Error handling > should handle invalid target gracefully
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > Error handling > should throw when performing tactic without active courtship
 FAIL  packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts > CourtshipStateMachine > Error handling > should NOT use fallback for missing paradigm requirements
TypeError: World is not a constructor
 â¯ packages/reproduction/src/__tests__/CourtshipStateMachine.test.ts:21:13
     19| 
     20|   beforeEach(() => {
     21|     world = new World();
       |             ^
     22|     stateMachine = new CourtshipStateMachine();
     23|     agent1 = world.createEntity();

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[281/746]âŽ¯

 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > CourtshipComponent creation > should create courtship component with default state
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > CourtshipComponent creation > should track romantic inclination between 0 and 1
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > CourtshipComponent creation > should initialize with empty courtship arrays
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > CourtshipComponent creation > should store courtship paradigm
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship state transitions > should transition from idle to interested when potential mate is near
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship state transitions > should transition from interested to courting when initiating
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship state transitions > should track being courted state
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship state transitions > should transition to consenting when both agree
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship tactics > should record attempted tactic
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship tactics > should record tactic response
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship tactics > should track tactics received by target
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship tactics > should increase interest based on preferred tactics
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship tactics > should decrease interest based on disliked tactics
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship paradigms > should define required tactics for human courtship
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship paradigms > should define forbidden tactics for human courtship
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship paradigms > should specify minimum tactics needed
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship paradigms > should define mating behavior for humans
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship paradigms > should have different paradigm for dwarves
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Courtship paradigms > should have different paradigm for bird-folk
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Compatibility calculation > should calculate compatibility between two agents
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Compatibility calculation > should factor in sexual compatibility
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Compatibility calculation > should factor in personality compatibility
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Compatibility calculation > should factor in relationship strength
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Compatibility calculation > should return 0 if not mutually attracted
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Cooldowns and rejections > should enforce courtship cooldown
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Cooldowns and rejections > should track per-agent rejection cooldown
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Cooldowns and rejections > should record past courtships
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Mating behaviors > should require private location for human mating
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Mating behaviors > should require nest location for bird-folk mating
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Mating behaviors > should allow public mating for mystif union magic
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Mating behaviors > should define post-mating effects
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Error handling > should throw when romantic inclination is out of range
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Error handling > should throw when paradigm is missing
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Error handling > should throw when state is invalid
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Error handling > should NOT use fallback for missing required fields
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Error handling > should throw when compatibility score is out of range
 FAIL  packages/reproduction/src/__tests__/CourtshipSystem.test.ts > CourtshipSystem > Error handling > should throw when interest level is out of range
TypeError: World is not a constructor
 â¯ packages/reproduction/src/__tests__/CourtshipSystem.test.ts:20:13
     18| 
     19|   beforeEach(() => {
     20|     world = new World();
       |             ^
     21|     agent1 = world.createEntity();
     22|     agent2 = world.createEntity();

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[282/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 1: Inventory Section Appears > should render inventory section below needs section when agent is selected
AssertionError: expected undefined not to be undefined
 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:133:35
    131|       );
    132| 
    133|       expect(inventoryHeaderCall).toBeDefined();
       |                                   ^
    134|     });
    135| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[283/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 2: Resource Counts Display > should display stone resources with icon and quantity
AssertionError: expected undefined not to be undefined
 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:203:29
    201|       );
    202| 
    203|       expect(stoneLineCall).toBeDefined();
       |                             ^
    204|     });
    205| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[284/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 2: Resource Counts Display > should display food resources with icon and quantity
AssertionError: expected undefined not to be undefined
 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:220:28
    218|       );
    219| 
    220|       expect(foodLineCall).toBeDefined();
       |                            ^
    221|     });
    222| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[285/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 3: Empty Inventory State > should show "(empty)" when inventory has no items
AssertionError: expected undefined not to be undefined
 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:313:30
    311|       );
    312| 
    313|       expect(emptyStateCall).toBeDefined();
       |                              ^
    314|     });
    315| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[286/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 3: Empty Inventory State > should show capacity as "Weight: 0/100 Slots: 0/8" when empty
AssertionError: expected undefined not to be undefined
 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:333:28
    331|       );
    332| 
    333|       expect(capacityCall).toBeDefined();
       |                            ^
    334|     });
    335|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[287/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 4: Capacity Display > should display current weight and max weight
AssertionError: expected undefined not to be undefined
 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:355:28
    353|       );
    354| 
    355|       expect(capacityCall).toBeDefined();
       |                            ^
    356|     });
    357| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[288/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 4: Capacity Display > should display current slots and max slots
AssertionError: expected undefined not to be undefined
 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:375:28
    373|       );
    374| 
    375|       expect(capacityCall).toBeDefined();
       |                            ^
    376|     });
    377| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[289/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 4: Capacity Display > should calculate weight correctly for mixed resources
AssertionError: expected undefined not to be undefined
 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:395:28
    393|       );
    394| 
    395|       expect(capacityCall).toBeDefined();
       |                            ^
    396|     });
    397|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[290/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 5: Capacity Warning Colors > should use white color when weight is below 80%
AssertionError: expected '#aaaaaa' to be '#ffffff' // Object.is equality

- Expected
+ Received

- #ffffff
+ #aaaaaa

 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:412:32
    410|       // Check that fillStyle was set to white (#FFFFFF) before renderâ€¦
    411|       const fillStyleChanges = mockCtx.fillStyle;
    412|       expect(fillStyleChanges).toBe('#ffffff'); // Canvas normalizes tâ€¦
       |                                ^
    413|     });
    414| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[291/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 5: Capacity Warning Colors > should use yellow color when weight exceeds 80%
AssertionError: expected -1 to be greater than -1
 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:434:29
    432| 
    433|       // The test will pass if implementation sets fillStyle to #FFFF0â€¦
    434|       expect(capacityIndex).toBeGreaterThan(-1);
       |                             ^
    435|     });
    436| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[292/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 5: Capacity Warning Colors > should use red color when weight reaches 100%
AssertionError: expected -1 to be greater than -1
 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:453:29
    451| 
    452|       // The test will pass if implementation sets fillStyle to #FF000â€¦
    453|       expect(capacityIndex).toBeGreaterThan(-1);
       |                             ^
    454|     });
    455| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[293/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 5: Capacity Warning Colors > should use yellow color when slots exceed 80%
AssertionError: expected -1 to be greater than -1
 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:482:29
    480|       );
    481| 
    482|       expect(capacityIndex).toBeGreaterThan(-1);
       |                             ^
    483|     });
    484| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[294/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 5: Capacity Warning Colors > should use red color when slots reach 100%
AssertionError: expected -1 to be greater than -1
 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:512:29
    510|       );
    511| 
    512|       expect(capacityIndex).toBeGreaterThan(-1);
       |                             ^
    513|     });
    514|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[295/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 6: Real-time Updates > should update capacity display when weight changes
AssertionError: expected undefined not to be undefined
 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:568:28
    566|         (call: any[]) => typeof call[0] === 'string' && call[0].includâ€¦
    567|       );
    568|       expect(capacityCall).toBeDefined();
       |                            ^
    569| 
    570|       // Simulate gathering more resources

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[296/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 6: Real-time Updates > should show empty state when all resources are consumed
AssertionError: expected undefined not to be undefined
 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:609:25
    607|       const fillTextCalls = (mockCtx.fillText as any).mock.calls;
    608|       const emptyCall = fillTextCalls.find((call: any[]) => call[0] ==â€¦
    609|       expect(emptyCall).toBeDefined();
       |                         ^
    610|     });
    611|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[297/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Error Handling (per CLAUDE.md) > should throw when inventory.maxWeight is missing
AssertionError: expected [Function] to throw an error

- Expected: 
null

+ Received: 
undefined

 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:631:10
    629|       expect(() => {
    630|         panel.render(mockCtx, 1024, 768, mockWorld);
    631|       }).toThrow("InventoryComponent missing required 'maxWeight' fielâ€¦
       |          ^
    632|     });
    633| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[298/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Error Handling (per CLAUDE.md) > should throw when inventory.maxWeight is undefined
AssertionError: expected [Function] to throw an error

- Expected: 
null

+ Received: 
undefined

 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:651:10
    649|       expect(() => {
    650|         panel.render(mockCtx, 1024, 768, mockWorld);
    651|       }).toThrow("InventoryComponent missing required 'maxWeight' fielâ€¦
       |          ^
    652|     });
    653| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[299/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Error Handling (per CLAUDE.md) > should throw when inventory.slots is not an array
AssertionError: expected [Function] to throw an error

- Expected: 
null

+ Received: 
undefined

 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:671:10
    669|       expect(() => {
    670|         panel.render(mockCtx, 1024, 768, mockWorld);
    671|       }).toThrow("InventoryComponent 'slots' must be an array");
       |          ^
    672|     });
    673| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[300/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Error Handling (per CLAUDE.md) > should throw when inventory.slots is null
AssertionError: expected [Function] to throw an error

- Expected: 
null

+ Received: 
undefined

 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:691:10
    689|       expect(() => {
    690|         panel.render(mockCtx, 1024, 768, mockWorld);
    691|       }).toThrow("InventoryComponent 'slots' must be an array");
       |          ^
    692|     });
    693| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[301/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Error Handling (per CLAUDE.md) > should throw when inventory.currentWeight is missing
AssertionError: expected [Function] to throw an error

- Expected: 
null

+ Received: 
undefined

 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:711:10
    709|       expect(() => {
    710|         panel.render(mockCtx, 1024, 768, mockWorld);
    711|       }).toThrow("InventoryComponent missing required 'currentWeight' â€¦
       |          ^
    712|     });
    713| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[302/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Error Handling (per CLAUDE.md) > should throw when inventory.maxSlots is missing
AssertionError: expected [Function] to throw an error

- Expected: 
null

+ Received: 
undefined

 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:731:10
    729|       expect(() => {
    730|         panel.render(mockCtx, 1024, 768, mockWorld);
    731|       }).toThrow("InventoryComponent missing required 'maxSlots' fieldâ€¦
       |          ^
    732|     });
    733|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[303/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Edge Cases > should handle inventory with only empty slots
AssertionError: expected undefined not to be undefined
 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:762:25
    760|       const fillTextCalls = (mockCtx.fillText as any).mock.calls;
    761|       const emptyCall = fillTextCalls.find((call: any[]) => call[0] ==â€¦
    762|       expect(emptyCall).toBeDefined();
       |                         ^
    763|     });
    764| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[304/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Edge Cases > should handle inventory with partial slots filled
AssertionError: expected undefined not to be undefined
 â¯ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts:794:25
    792|         (call: any[]) => typeof call[0] === 'string' && call[0].includâ€¦
    793|       );
    794|       expect(slotsCall).toBeDefined();
       |                         ^
    795|     });
    796| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[305/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/ContextMenuManager.test.ts > ContextMenuManager > Criterion 5: Selection Context Menu > should include "Formation" submenu with options
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/renderer/src/__tests__/ContextMenuManager.test.ts:509:67
    507|       expect(submenu).toBeDefined();
    508|       // Submenu items use 'id' field, not 'actionId'
    509|       expect(submenu?.some(item => item.id === 'formation_line')).toBeâ€¦
       |                                                                   ^
    510|       expect(submenu?.some(item => item.id === 'formation_column')).toâ€¦
    511|       expect(submenu?.some(item => item.id === 'formation_circle')).toâ€¦

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[306/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/ContextMenuManager.test.ts > ContextMenuManager > Criterion 7: Resource/Harvestable Actions > should include "Prioritize" submenu with priority options
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/renderer/src/__tests__/ContextMenuManager.test.ts:654:66
    652|       expect(submenu).toBeDefined();
    653|       // Submenu items use 'id' field, not 'actionId'
    654|       expect(submenu?.some(item => item.id === 'priority_high')).toBe(â€¦
       |                                                                  ^
    655|       expect(submenu?.some(item => item.id === 'priority_normal')).toBâ€¦
    656|       expect(submenu?.some(item => item.id === 'priority_low')).toBe(tâ€¦

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[307/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/CraftingPanelUI.test.ts > CraftingPanelUI (REQ-CRAFT-001) > Mouse Interaction > should handle click on close button
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 â¯ packages/renderer/src/__tests__/CraftingPanelUI.test.ts:229:31
    227|       panel.handleClick(closeButtonX, closeButtonY);
    228| 
    229|       expect(panel.isVisible).toBe(false);
       |                               ^
    230|     });
    231| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[308/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/CraftingPanelUI.test.ts > CraftingPanelUI (REQ-CRAFT-001) > Mouse Interaction > should handle clicks outside panel bounds (close panel)
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 â¯ packages/renderer/src/__tests__/CraftingPanelUI.test.ts:263:36
    261|       largePanel.handleClick(10, 10); // Click in top-left corner, outâ€¦
    262| 
    263|       expect(largePanel.isVisible).toBe(false);
       |                                    ^
    264|     });
    265|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[309/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/CraftingPanelUI.test.ts > CraftingPanelUI (REQ-CRAFT-001) > Recipe Selection (REQ-CRAFT-003) > should select recipe when clicked
Error: Recipe not found: stone_axe
 â¯ RecipeRegistry.getRecipe packages/core/src/crafting/RecipeRegistry.ts:69:13
     67|     const recipe = this.recipes.get(id);
     68|     if (!recipe) {
     69|       throw new Error(`Recipe not found: ${id}`);
       |             ^
     70|     }
     71|     return recipe;
 â¯ IngredientPanel.refresh packages/renderer/src/IngredientPanel.ts:112:41
 â¯ IngredientPanel.setRecipe packages/renderer/src/IngredientPanel.ts:98:10
 â¯ CraftingPanelUI.selectRecipe packages/renderer/src/CraftingPanelUI.ts:346:28
 â¯ packages/renderer/src/__tests__/CraftingPanelUI.test.ts:319:13

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[310/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/CraftingPanelUI.test.ts > CraftingPanelUI (REQ-CRAFT-001) > Recipe Selection (REQ-CRAFT-003) > should update details section when recipe is selected
Error: Recipe not found: stone_axe
 â¯ RecipeRegistry.getRecipe packages/core/src/crafting/RecipeRegistry.ts:69:13
     67|     const recipe = this.recipes.get(id);
     68|     if (!recipe) {
     69|       throw new Error(`Recipe not found: ${id}`);
       |             ^
     70|     }
     71|     return recipe;
 â¯ IngredientPanel.refresh packages/renderer/src/IngredientPanel.ts:112:41
 â¯ IngredientPanel.setRecipe packages/renderer/src/IngredientPanel.ts:98:10
 â¯ CraftingPanelUI.selectRecipe packages/renderer/src/CraftingPanelUI.ts:346:28
 â¯ packages/renderer/src/__tests__/CraftingPanelUI.test.ts:334:13

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[311/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/CraftingPanelUI.test.ts > CraftingPanelUI (REQ-CRAFT-001) > Recipe Selection (REQ-CRAFT-003) > should update ingredient panel when recipe is selected
Error: Recipe not found: stone_axe
 â¯ RecipeRegistry.getRecipe packages/core/src/crafting/RecipeRegistry.ts:69:13
     67|     const recipe = this.recipes.get(id);
     68|     if (!recipe) {
     69|       throw new Error(`Recipe not found: ${id}`);
       |             ^
     70|     }
     71|     return recipe;
 â¯ IngredientPanel.refresh packages/renderer/src/IngredientPanel.ts:112:41
 â¯ IngredientPanel.setRecipe packages/renderer/src/IngredientPanel.ts:98:10
 â¯ CraftingPanelUI.selectRecipe packages/renderer/src/CraftingPanelUI.ts:346:28
 â¯ packages/renderer/src/__tests__/CraftingPanelUI.test.ts:344:13

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[312/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/CraftingPanelUI.test.ts > CraftingPanelUI (REQ-CRAFT-001) > Recipe Selection (REQ-CRAFT-003) > should clear selection when null is passed
Error: Recipe not found: stone_axe
 â¯ RecipeRegistry.getRecipe packages/core/src/crafting/RecipeRegistry.ts:69:13
     67|     const recipe = this.recipes.get(id);
     68|     if (!recipe) {
     69|       throw new Error(`Recipe not found: ${id}`);
       |             ^
     70|     }
     71|     return recipe;
 â¯ IngredientPanel.refresh packages/renderer/src/IngredientPanel.ts:112:41
 â¯ IngredientPanel.setRecipe packages/renderer/src/IngredientPanel.ts:98:10
 â¯ CraftingPanelUI.selectRecipe packages/renderer/src/CraftingPanelUI.ts:346:28
 â¯ packages/renderer/src/__tests__/CraftingPanelUI.test.ts:351:13

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[313/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/CraftingPanelUI.test.ts > CraftingPanelUI (REQ-CRAFT-001) > Error Handling (CLAUDE.md) > should throw when rendering without active agent
AssertionError: expected [Function] to throw an error

- Expected: 
null

+ Received: 
undefined

 â¯ packages/renderer/src/__tests__/CraftingPanelUI.test.ts:413:39
    411|       panel.show();
    412|       // No agent set
    413|       expect(() => panel.render(ctx)).toThrow('No active agent');
       |                                       ^
    414|     });
    415| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[314/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/DevPanel.test.ts > DevPanel Divine Resource Generation > Power Tier Thresholds > should have all power tiers defined
TypeError: Cannot read properties of undefined (reading 'dormant')
 â¯ packages/renderer/src/__tests__/DevPanel.test.ts:229:16
    227|       const expectedTiers: PowerTier[] = ['dormant', 'minor', 'moderatâ€¦
    228|       for (const tier of expectedTiers) {
    229|         expect(POWER_TIER_THRESHOLDS[tier]).toBeDefined();
       |                ^
    230|         expect(typeof POWER_TIER_THRESHOLDS[tier]).toBe('number');
    231|       }

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[315/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/DevPanel.test.ts > DevPanel Divine Resource Generation > Power Tier Thresholds > should have ascending thresholds
TypeError: Cannot read properties of undefined (reading 'dormant')
 â¯ packages/renderer/src/__tests__/DevPanel.test.ts:235:36
    233| 
    234|     it('should have ascending thresholds', () => {
    235|       expect(POWER_TIER_THRESHOLDS.dormant).toBeLessThan(POWER_TIER_THâ€¦
       |                                    ^
    236|       expect(POWER_TIER_THRESHOLDS.minor).toBeLessThan(POWER_TIER_THREâ€¦
    237|       expect(POWER_TIER_THRESHOLDS.moderate).toBeLessThan(POWER_TIER_Tâ€¦

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[316/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/DevPanel.test.ts > DevPanel Divine Resource Generation > Power Tier Thresholds > should have dormant at 0
TypeError: Cannot read properties of undefined (reading 'dormant')
 â¯ packages/renderer/src/__tests__/DevPanel.test.ts:243:36
    241| 
    242|     it('should have dormant at 0', () => {
    243|       expect(POWER_TIER_THRESHOLDS.dormant).toBe(0);
       |                                    ^
    244|     });
    245| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[317/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/DevPanel.test.ts > DevPanel Divine Resource Generation > Power Tier Thresholds > should have world_shaping at 5000+
TypeError: Cannot read properties of undefined (reading 'world_shaping')
 â¯ packages/renderer/src/__tests__/DevPanel.test.ts:247:36
    245| 
    246|     it('should have world_shaping at 5000+', () => {
    247|       expect(POWER_TIER_THRESHOLDS.world_shaping).toBeGreaterThanOrEquâ€¦
       |                                    ^
    248|     });
    249|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[318/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/DevPanel.test.ts > DevPanel Divine Resource Generation > Belief Generation Rates > should have all belief activities defined
TypeError: Cannot read properties of undefined (reading 'passive_faith')
 â¯ packages/renderer/src/__tests__/DevPanel.test.ts:266:16
    264| 
    265|       for (const activity of expectedActivities) {
    266|         expect(BELIEF_GENERATION_RATES[activity as keyof typeof BELIEFâ€¦
       |                ^
    267|         expect(typeof BELIEF_GENERATION_RATES[activity as keyof typeofâ€¦
    268|       }

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[319/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/DevPanel.test.ts > DevPanel Divine Resource Generation > Belief Generation Rates > should have ascending rates from passive to miracle
TypeError: Cannot read properties of undefined (reading 'passive_faith')
 â¯ packages/renderer/src/__tests__/DevPanel.test.ts:272:38
    270| 
    271|     it('should have ascending rates from passive to miracle', () => {
    272|       expect(BELIEF_GENERATION_RATES.passive_faith).toBeLessThan(BELIEâ€¦
       |                                      ^
    273|       expect(BELIEF_GENERATION_RATES.prayer).toBeLessThan(BELIEF_GENERâ€¦
    274|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[320/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/DevPanel.test.ts > DevPanel Divine Resource Generation > Belief Generation Rates > should have miracle_witness as highest rate
TypeError: Cannot convert undefined or null to object
 â¯ packages/renderer/src/__tests__/DevPanel.test.ts:277:42
    275| 
    276|     it('should have miracle_witness as highest rate', () => {
    277|       const maxRate = Math.max(...Object.values(BELIEF_GENERATION_RATEâ€¦
       |                                          ^
    278|       expect(BELIEF_GENERATION_RATES.miracle_witness).toBe(maxRate);
    279|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[321/746]âŽ¯

 FAIL  packages/renderer/src/__tests__/DevPanel.test.ts > DevPanel Divine Resource Generation > Belief Generation Rates > should have passive_faith as lowest rate
TypeError: Cannot convert undefined or null to object
 â¯ packages/renderer/src/__tests__/DevPanel.test.ts:282:42
    280| 
    281|     it('should have passive_faith as lowest rate', () => {
    282|       const minRate = Math.min(...Object.values(BELIEF_GENERATION_RATEâ€¦
       |                                          ^
    283|       expect(BELIEF_GENERATION_RATES.passive_faith).toBe(minRate);
    284|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[322/746]âŽ¯

 FAIL  packages/core/src/buildings/__tests__/BuildingDefinitions.test.ts > Building Functionality Tracking > Acceptance Criterion 4: BuildingFunction Types on Definitions > should have actual buildings for all 8 function types including research and automation
Error: Blueprint with id "forge" already registered
 â¯ BuildingBlueprintRegistry.register packages/core/src/buildings/BuildingBlueprintRegistry.ts:146:13
    144| 
    145|     if (this.blueprints.has(blueprint.id)) {
    146|       throw new Error(`Blueprint with id "${blueprint.id}" already regâ€¦
       |             ^
    147|     }
    148| 
 â¯ BuildingBlueprintRegistry.registerTier2Stations packages/core/src/buildings/BuildingBlueprintRegistry.ts:516:10
 â¯ packages/core/src/buildings/__tests__/BuildingDefinitions.test.ts:487:16

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[323/746]âŽ¯

 FAIL  packages/core/src/buildings/__tests__/CraftingStations.integration.test.ts > CraftingStations Integration Tests > Building Placement Integration > should create Workshop entity with correct initial state
AssertionError: expected undefined not to be undefined
 â¯ packages/core/src/buildings/__tests__/CraftingStations.integration.test.ts:257:30
    255|       );
    256| 
    257|       expect(workshopEntity).toBeDefined();
       |                              ^
    258| 
    259|       if (workshopEntity) {

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[324/746]âŽ¯

 FAIL  packages/core/src/buildings/__tests__/CraftingStations.integration.test.ts > CraftingStations Integration Tests > Error Handling (CLAUDE.md compliance) > should handle completion event for deleted entity gracefully
AssertionError: expected undefined to be null
 â¯ packages/core/src/buildings/__tests__/CraftingStations.integration.test.ts:381:51
    379| 
    380|       // Verify entity is still deleted (not re-created by error)
    381|       expect(harness.world.getEntity(buildingId)).toBeNull();
       |                                                   ^
    382|     });
    383| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[325/746]âŽ¯

 FAIL  packages/core/src/buildings/__tests__/CraftingStations.test.ts > Crafting Stations - Tier 2 > Criterion 2: Crafting Functionality > should configure Forge with crafting functionality and speed bonus
AssertionError: expected [ { type: 'crafting', â€¦(2) }, â€¦(1) ] to have a length of 1 but got 2

- Expected
+ Received

- 1
+ 2

 â¯ packages/core/src/buildings/__tests__/CraftingStations.test.ts:118:35
    116| 
    117|       expect(forge.functionality).toBeDefined();
    118|       expect(forge.functionality).toHaveLength(1);
       |                                   ^
    119| 
    120|       const craftingFunc = forge.functionality[0];

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[326/746]âŽ¯

 FAIL  packages/core/src/buildings/__tests__/CraftingStations.test.ts > Crafting Stations - Tier 2 > Criterion 2: Crafting Functionality > should configure Windmill with crafting functionality
AssertionError: expected [ { type: 'crafting', â€¦(2) }, â€¦(1) ] to have a length of 1 but got 2

- Expected
+ Received

- 1
+ 2

 â¯ packages/core/src/buildings/__tests__/CraftingStations.test.ts:172:38
    170| 
    171|       expect(windmill.functionality).toBeDefined();
    172|       expect(windmill.functionality).toHaveLength(1);
       |                                      ^
    173| 
    174|       const craftingFunc = windmill.functionality[0];

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[327/746]âŽ¯

 FAIL  packages/core/src/decision/__tests__/Decision.integration.test.ts > Decision Integration Tests > AutonomicSystem with Entity > prioritizes sleep over food when energy is critical
AssertionError: expected 'seek_food' to be 'seek_sleep' // Object.is equality

- Expected
+ Received

- seek_sleep
+ seek_food

 â¯ packages/core/src/decision/__tests__/Decision.integration.test.ts:82:32
     80|       // Energy takes priority over hunger
     81|       expect(result).not.toBeNull();
     82|       expect(result!.behavior).toBe('seek_sleep');
       |                                ^
     83|     });
     84| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[328/746]âŽ¯

 FAIL  packages/core/src/decision/__tests__/Decision.test.ts > AutonomicSystem > checkNeeds > returns seek_sleep when energy is below 0.3 (30%)
AssertionError: expected null not to be null
 â¯ packages/core/src/decision/__tests__/Decision.test.ts:53:26
     51|       const result = autonomicSystem.checkNeeds(needs);
     52| 
     53|       expect(result).not.toBeNull();
       |                          ^
     54|       expect(result!.behavior).toBe('seek_sleep');
     55|       expect(result!.priority).toBe(85);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[329/746]âŽ¯

 FAIL  packages/core/src/divinity/__tests__/BeliefSystem.test.ts > Belief Generation > should generate massive belief from witnessing miracles
AssertionError: expected 80.7 to be greater than 100
 â¯ packages/core/src/divinity/__tests__/BeliefSystem.test.ts:135:30
    133|     const generated = calculateBeliefGeneration(believer, miracleActivâ€¦
    134| 
    135|     expect(generated.amount).toBeGreaterThan(100); // Miracles generatâ€¦
       |                              ^
    136|     expect(generated.quality).toBeGreaterThan(0.8);
    137|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[330/746]âŽ¯

 FAIL  packages/core/src/divinity/__tests__/BeliefSystem.test.ts > Belief Decay > should decay belief over time without maintenance
AssertionError: expected 132.61955589475295 to be close to 366, received difference is 233.38044410524705, but expected 0.5
 â¯ packages/core/src/divinity/__tests__/BeliefSystem.test.ts:185:33
    183|     expect(decayed.totalBelief).toBeLessThan(1000);
    184|     // After 100 ticks at 1% decay: 1000 * (0.99)^100 â‰ˆ 366
    185|     expect(decayed.totalBelief).toBeCloseTo(366, 0);
       |                                 ^
    186|   });
    187| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[331/746]âŽ¯

 FAIL  packages/core/src/divinity/__tests__/BeliefSystem.test.ts > Belief Quality and Growth > should detect belief plateau
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/divinity/__tests__/BeliefSystem.test.ts:375:23
    373|     const isPlateau = Math.abs(growthRate) < 0.01; // Nearly flat
    374| 
    375|     expect(isPlateau).toBe(true);
       |                       ^
    376|   });
    377| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[332/746]âŽ¯

 FAIL  packages/core/src/divinity/__tests__/DeityEmergence.test.ts > Deity Emergence > should allow belief to shape nascent deity
TypeError: actual value must be number or bigint, received "undefined"
 â¯ packages/core/src/divinity/__tests__/DeityEmergence.test.ts:134:49
    132|     // Nascent deity should be flexible
    133|     expect(updated.identity.domains.war).toBeGreaterThan(0);
    134|     expect(updated.identity.personality.fierce).toBeGreaterThan(0);
       |                                                 ^
    135|   });
    136| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[333/746]âŽ¯

 FAIL  packages/core/src/divinity/__tests__/DeityEmergence.test.ts > Alignment Calculation > should calculate alignment from actions
AssertionError: expected 0 to be greater than 0
 â¯ packages/core/src/divinity/__tests__/DeityEmergence.test.ts:317:33
    315| 
    316|     expect(alignment.good_evil).toBeGreaterThan(0); // More good actioâ€¦
    317|     expect(alignment.law_chaos).toBeGreaterThan(0); // Consistent rewaâ€¦
       |                                 ^
    318|   });
    319| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[334/746]âŽ¯

 FAIL  packages/core/src/divinity/__tests__/DeityEmergence.test.ts > Alignment Calculation > should detect chaotic neutral deity
AssertionError: expected 0 to be less than 0
 â¯ packages/core/src/divinity/__tests__/DeityEmergence.test.ts:333:33
    331| 
    332|     expect(Math.abs(alignment.good_evil)).toBeLessThan(0.3); // Neutral
    333|     expect(alignment.law_chaos).toBeLessThan(0); // Chaotic
       |                                 ^
    334|   });
    335| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[335/746]âŽ¯

 FAIL  packages/core/src/divinity/__tests__/DeityEmergence.test.ts > Alignment Calculation > should detect lawful evil deity
AssertionError: expected 0 to be greater than 0
 â¯ packages/core/src/divinity/__tests__/DeityEmergence.test.ts:349:33
    347| 
    348|     expect(alignment.good_evil).toBeLessThan(0); // Evil
    349|     expect(alignment.law_chaos).toBeGreaterThan(0); // Lawful
       |                                 ^
    350|   });
    351| });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[336/746]âŽ¯

 FAIL  packages/core/src/divinity/__tests__/DeityEmergence.test.ts > Divine Form Development > should develop forms from believer visions
AssertionError: expected [ 'height', 'aura', 'presence' ] to include 'golden'
 â¯ packages/core/src/divinity/__tests__/DeityEmergence.test.ts:379:31
    377| 
    378|     expect(forms.length).toBeGreaterThan(0);
    379|     expect(forms[0].features).toContain('golden'); // Common feature
       |                               ^
    380|   });
    381| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[337/746]âŽ¯

 FAIL  packages/core/src/divinity/__tests__/DeityEmergence.test.ts > Divine Form Development > should prefer consistent forms for nascent deities
TypeError: existing.features.includes is not a function
 â¯ addFormFromVision packages/core/src/divinity/__tests__/DeityEmergence.test.ts:617:32
    615|       const existing = updated.identity.forms[0];
    616|       for (const [feature, value] of Object.entries(vision.features)) {
    617|         if (!existing.features.includes(feature)) {
       |                                ^
    618|           existing.features.push(feature);
    619|         }
 â¯ packages/core/src/divinity/__tests__/DeityEmergence.test.ts:413:21

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[338/746]âŽ¯

 FAIL  packages/core/src/divinity/__tests__/DivinePowers.test.ts > Divine Power - Blessings and Curses > should lift curse when condition met
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/divinity/__tests__/DivinePowers.test.ts:445:23
    443|     const satisfied = checkCurseLiftCondition(curse, 'sacrifice_perforâ€¦
    444| 
    445|     expect(satisfied).toBe(true);
       |                       ^
    446| 
    447|     const lifted = liftCurse(curse, mockWorld);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[339/746]âŽ¯

 FAIL  packages/core/src/divinity/__tests__/DivinitySystemEdgeCases.test.ts > Pantheon Relationship Deadlocks > should detect circular dependency in pantheon hierarchy
RangeError: Invalid array length
 â¯ detectCircularHierarchy packages/core/src/divinity/__tests__/DivinitySystemEdgeCases.test.ts:801:12
    799|         return { detected: true, cycle: [...path, (current as any).supâ€¦
    800|       }
    801|       path.push((current as any).superior);
       |            ^
    802|       current = deities.find((d) => d.id === (current as any).superiorâ€¦
    803|     }
 â¯ packages/core/src/divinity/__tests__/DivinitySystemEdgeCases.test.ts:364:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[340/746]âŽ¯

 FAIL  packages/core/src/components/__tests__/BuildingComponent.test.ts > BuildingComponent - Phase 8 Breaking Changes > Acceptance Criterion 10: Building Heat Properties > should HAVE insulation field for buildings after Phase 8
AssertionError: expected +0 to be 0.3 // Object.is equality

- Expected
+ Received

- 0.3
+ 0

 â¯ packages/core/src/components/__tests__/BuildingComponent.test.ts:28:33
     26|       const leanTo = createBuildingComponent(BuildingType.LeanTo);
     27|       expect(leanTo).toHaveProperty('insulation');
     28|       expect(leanTo.insulation).toBe(0.3); // Per spec: 30% insulation
       |                                 ^
     29|     });
     30| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[341/746]âŽ¯

 FAIL  packages/core/src/components/__tests__/BuildingComponent.test.ts > BuildingComponent - Phase 8 Breaking Changes > Acceptance Criterion 10: Building Heat Properties > should HAVE baseTemperature field for buildings after Phase 8
AssertionError: expected +0 to be 5 // Object.is equality

- Expected
+ Received

- 5
+ 0

 â¯ packages/core/src/components/__tests__/BuildingComponent.test.ts:34:38
     32|       const leanTo = createBuildingComponent(BuildingType.LeanTo);
     33|       expect(leanTo).toHaveProperty('baseTemperature');
     34|       expect(leanTo.baseTemperature).toBe(5); // Per spec: +5Â°C
       |                                      ^
     35|     });
     36| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[342/746]âŽ¯

 FAIL  packages/core/src/components/__tests__/BuildingComponent.test.ts > BuildingComponent - Phase 8 Breaking Changes > Acceptance Criterion 10: Building Heat Properties > should HAVE weatherProtection field for buildings after Phase 8
AssertionError: expected +0 to be 0.5 // Object.is equality

- Expected
+ Received

- 0.5
+ 0

 â¯ packages/core/src/components/__tests__/BuildingComponent.test.ts:40:40
     38|       const leanTo = createBuildingComponent(BuildingType.LeanTo);
     39|       expect(leanTo).toHaveProperty('weatherProtection');
     40|       expect(leanTo.weatherProtection).toBe(0.5); // Per spec: 50% proâ€¦
       |                                        ^
     41|     });
     42| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[343/746]âŽ¯

 FAIL  packages/core/src/components/__tests__/BuildingComponent.test.ts > BuildingComponent - Phase 8 Breaking Changes > Acceptance Criterion 10: Building Heat Properties > should HAVE interior field for buildings after Phase 8
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/components/__tests__/BuildingComponent.test.ts:46:31
     44|       const leanTo = createBuildingComponent(BuildingType.LeanTo);
     45|       expect(leanTo).toHaveProperty('interior');
     46|       expect(leanTo.interior).toBe(true);
       |                               ^
     47|     });
     48| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[344/746]âŽ¯

 FAIL  packages/core/src/components/__tests__/BuildingComponent.test.ts > BuildingComponent - Phase 8 Breaking Changes > Acceptance Criterion 10: Building Heat Properties > should HAVE interiorRadius field for interior buildings after Phase 8
AssertionError: expected +0 to be 2 // Object.is equality

- Expected
+ Received

- 2
+ 0

 â¯ packages/core/src/components/__tests__/BuildingComponent.test.ts:52:37
     50|       const leanTo = createBuildingComponent(BuildingType.LeanTo);
     51|       expect(leanTo).toHaveProperty('interiorRadius');
     52|       expect(leanTo.interiorRadius).toBe(2); // Per spec: 2 tile radius
       |                                     ^
     53|     });
     54|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[345/746]âŽ¯

 FAIL  packages/core/src/components/__tests__/BuildingComponent.test.ts > BuildingComponent - Phase 8 Breaking Changes > lean-to building type > should set insulation=0.3 for lean-to
AssertionError: expected +0 to be 0.3 // Object.is equality

- Expected
+ Received

- 0.3
+ 0

 â¯ packages/core/src/components/__tests__/BuildingComponent.test.ts:79:33
     77|     it('should set insulation=0.3 for lean-to', () => {
     78|       const leanTo = createBuildingComponent(BuildingType.LeanTo);
     79|       expect(leanTo.insulation).toBe(0.3);
       |                                 ^
     80|     });
     81| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[346/746]âŽ¯

 FAIL  packages/core/src/components/__tests__/BuildingComponent.test.ts > BuildingComponent - Phase 8 Breaking Changes > lean-to building type > should set baseTemperature=5 for lean-to
AssertionError: expected +0 to be 5 // Object.is equality

- Expected
+ Received

- 5
+ 0

 â¯ packages/core/src/components/__tests__/BuildingComponent.test.ts:84:38
     82|     it('should set baseTemperature=5 for lean-to', () => {
     83|       const leanTo = createBuildingComponent(BuildingType.LeanTo);
     84|       expect(leanTo.baseTemperature).toBe(5);
       |                                      ^
     85|     });
     86| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[347/746]âŽ¯

 FAIL  packages/core/src/components/__tests__/BuildingComponent.test.ts > BuildingComponent - Phase 8 Breaking Changes > lean-to building type > should set weatherProtection=0.5 for lean-to
AssertionError: expected +0 to be 0.5 // Object.is equality

- Expected
+ Received

- 0.5
+ 0

 â¯ packages/core/src/components/__tests__/BuildingComponent.test.ts:89:40
     87|     it('should set weatherProtection=0.5 for lean-to', () => {
     88|       const leanTo = createBuildingComponent(BuildingType.LeanTo);
     89|       expect(leanTo.weatherProtection).toBe(0.5);
       |                                        ^
     90|     });
     91| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[348/746]âŽ¯

 FAIL  packages/core/src/components/__tests__/BuildingComponent.test.ts > BuildingComponent - Phase 8 Breaking Changes > lean-to building type > should set interior=true for lean-to
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/components/__tests__/BuildingComponent.test.ts:94:31
     92|     it('should set interior=true for lean-to', () => {
     93|       const leanTo = createBuildingComponent(BuildingType.LeanTo);
     94|       expect(leanTo.interior).toBe(true);
       |                               ^
     95|       expect(leanTo.interiorRadius).toBe(2);
     96|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[349/746]âŽ¯

 FAIL  packages/core/src/components/__tests__/BuildingComponent.test.ts > BuildingComponent - Phase 8 Breaking Changes > tent building type > should have temperature properties for tent
AssertionError: expected 0 to be greater than 0.3
 â¯ packages/core/src/components/__tests__/BuildingComponent.test.ts:109:31
    107|     it('should have temperature properties for tent', () => {
    108|       const tent = createBuildingComponent(BuildingType.Tent);
    109|       expect(tent.insulation).toBeGreaterThan(0.3); // Better than leaâ€¦
       |                               ^
    110|       expect(tent.baseTemperature).toBeGreaterThan(5); // Better than â€¦
    111|       expect(tent.interior).toBe(true);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[350/746]âŽ¯

 FAIL  packages/core/src/help/__tests__/HelpSystem.demo.test.ts > Help System Demo > demonstrates search capabilities
AssertionError: expected [ { id: 'sword', â€¦(5) }, â€¦(1) ] to have a length of 1 but got 2

- Expected
+ Received

- 1
+ 2

 â¯ packages/core/src/help/__tests__/HelpSystem.demo.test.ts:223:26
    221|     // Search by text
    222|     const sharpResults = helpRegistry.search({ search: 'sharp' });
    223|     expect(sharpResults).toHaveLength(1); // Only 'sword' has 'sharp' â€¦
       |                          ^
    224| 
    225|     // Filter by tag

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[351/746]âŽ¯

 FAIL  packages/core/src/magic/__tests__/CostCalculators.test.ts > CostCalculators - Divine Paradigm > should cost favor as primary resource
AssertionError: expected 14 to be 12 // Object.is equality

- Expected
+ Received

- 12
+ 14

 â¯ packages/core/src/magic/__tests__/CostCalculators.test.ts:569:31
    567| 
    568|     expect(favorCost).toBeDefined();
    569|     expect(favorCost?.amount).toBe(Math.ceil(40 * 0.3));
       |                               ^
    570|   });
    571| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[352/746]âŽ¯

 FAIL  packages/core/src/magic/__tests__/CostCalculators.test.ts > CostCalculators - Divine Paradigm > should reduce cost for aligned spells
AssertionError: expected 17 to be less than or equal to 15
 â¯ packages/core/src/magic/__tests__/CostCalculators.test.ts:590:31
    588| 
    589|     const baseCost = Math.ceil(50 * 0.3);
    590|     expect(favorCost?.amount).toBeLessThanOrEqual(baseCost);
       |                               ^
    591|   });
    592| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[353/746]âŽ¯

 FAIL  packages/core/src/magic/__tests__/CostSystemIntegration.test.ts > Cost System Integration > MagicLawEnforcer Integration > should use cost calculator to calculate costs
TypeError: Cannot read properties of undefined (reading 'academic')
 â¯ MagicLawEnforcer.checkLaw packages/core/src/magic/MagicLawEnforcer.ts:338:34
    336|     caster: MagicComponent
    337|   ): LawCheckResult {
    338|     const paradigmState = caster.paradigmState[this.paradigm.id];
       |                                  ^
    339| 
    340|     switch (law.type) {
 â¯ MagicLawEnforcer.validateSpell packages/core/src/magic/MagicLawEnforcer.ts:234:30
 â¯ packages/core/src/magic/__tests__/CostSystemIntegration.test.ts:112:31

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[354/746]âŽ¯

 FAIL  packages/core/src/magic/__tests__/CostSystemIntegration.test.ts > Cost System Integration > MagicLawEnforcer Integration > should pass validation when caster has enough resources
TypeError: Cannot read properties of undefined (reading 'academic')
 â¯ MagicLawEnforcer.checkLaw packages/core/src/magic/MagicLawEnforcer.ts:338:34
    336|     caster: MagicComponent
    337|   ): LawCheckResult {
    338|     const paradigmState = caster.paradigmState[this.paradigm.id];
       |                                  ^
    339| 
    340|     switch (law.type) {
 â¯ MagicLawEnforcer.validateSpell packages/core/src/magic/MagicLawEnforcer.ts:234:30
 â¯ packages/core/src/magic/__tests__/CostSystemIntegration.test.ts:121:31

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[355/746]âŽ¯

 FAIL  packages/core/src/magic/__tests__/CostSystemIntegration.test.ts > Cost System Integration > MagicLawEnforcer Integration > should fail validation when caster lacks resources
TypeError: Cannot read properties of undefined (reading 'academic')
 â¯ MagicLawEnforcer.checkLaw packages/core/src/magic/MagicLawEnforcer.ts:338:34
    336|     caster: MagicComponent
    337|   ): LawCheckResult {
    338|     const paradigmState = caster.paradigmState[this.paradigm.id];
       |                                  ^
    339| 
    340|     switch (law.type) {
 â¯ MagicLawEnforcer.validateSpell packages/core/src/magic/MagicLawEnforcer.ts:234:30
 â¯ packages/core/src/magic/__tests__/CostSystemIntegration.test.ts:131:31

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[356/746]âŽ¯

 FAIL  packages/core/src/magic/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Cost Calculator Integration > should reject spell if caster cannot afford costs
AssertionError: expected [ 'Insufficient mana: need 30 more' ] to include StringContaining "Insufficient mana"
 â¯ packages/core/src/magic/__tests__/MagicLawEnforcerIntegration.test.ts:78:27
     76| 
     77|     expect(result.valid).toBe(false);
     78|     expect(result.errors).toContain(expect.stringContaining('Insufficiâ€¦
       |                           ^
     79|   });
     80| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[357/746]âŽ¯

 FAIL  packages/core/src/magic/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Cost Calculator Integration > should detect law violations
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/magic/__tests__/MagicLawEnforcerIntegration.test.ts:159:27
    157|     // Should have warnings or errors about law violations
    158|     const hasViolations = result.errors.length > 0 || result.warnings.â€¦
    159|     expect(hasViolations).toBe(true);
       |                           ^
    160|   });
    161| });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[358/746]âŽ¯

 FAIL  packages/core/src/magic/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Cross-Paradigm Validation > should validate multi-paradigm casters
TypeError: Cannot read properties of undefined (reading 'find')
 â¯ NameCostCalculator.canAfford packages/core/src/magic/costs/CostCalculator.ts:284:43
    282|       if (!pool) {
    283|         // Check if it's in manaPools instead (for legacy support)
    284|         const manaPool = caster.manaPools.find(
       |                                           ^
    285|           p => p.source === cost.type || (cost.type === 'mana' && p.soâ€¦
    286|         );
 â¯ MagicLawEnforcer.validateSpell packages/core/src/magic/MagicLawEnforcer.ts:220:38
 â¯ packages/core/src/magic/__tests__/MagicLawEnforcerIntegration.test.ts:191:33

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[359/746]âŽ¯

 FAIL  packages/core/src/magic/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Risk Assessment > should assess mishap risks based on proficiency
TypeError: Cannot read properties of undefined (reading 'find')
 â¯ AcademicCostCalculator.canAfford packages/core/src/magic/costs/CostCalculator.ts:284:43
    282|       if (!pool) {
    283|         // Check if it's in manaPools instead (for legacy support)
    284|         const manaPool = caster.manaPools.find(
       |                                           ^
    285|           p => p.source === cost.type || (cost.type === 'mana' && p.soâ€¦
    286|         );
 â¯ MagicLawEnforcer.validateSpell packages/core/src/magic/MagicLawEnforcer.ts:220:38
 â¯ packages/core/src/magic/__tests__/MagicLawEnforcerIntegration.test.ts:252:29

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[360/746]âŽ¯

 FAIL  packages/core/src/magic/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Risk Assessment > should assess corruption risks for dark magic
AssertionError: expected undefined not to be undefined
 â¯ packages/core/src/magic/__tests__/MagicLawEnforcerIntegration.test.ts:304:31
    302|     // Should warn about corruption threshold
    303|     const corruptionWarning = result.warnings.find((w) => w.includes('â€¦
    304|     expect(corruptionWarning).toBeDefined();
       |                               ^
    305|   });
    306| });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[361/746]âŽ¯

 FAIL  packages/core/src/magic/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Spell Modification > should calculate bonuses from favorable conditions
TypeError: Cannot read properties of undefined (reading 'find')
 â¯ AcademicCostCalculator.canAfford packages/core/src/magic/costs/CostCalculator.ts:284:43
    282|       if (!pool) {
    283|         // Check if it's in manaPools instead (for legacy support)
    284|         const manaPool = caster.manaPools.find(
       |                                           ^
    285|           p => p.source === cost.type || (cost.type === 'mana' && p.soâ€¦
    286|         );
 â¯ MagicLawEnforcer.validateSpell packages/core/src/magic/MagicLawEnforcer.ts:220:38
 â¯ packages/core/src/magic/__tests__/MagicLawEnforcerIntegration.test.ts:333:29

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[362/746]âŽ¯

 FAIL  packages/core/src/magic/__tests__/MagicLawEnforcerIntegration.test.ts > MagicLawEnforcer - Spell Modification > should calculate penalties from unfavorable conditions
TypeError: Cannot read properties of undefined (reading 'find')
 â¯ DivineCostCalculator.canAfford packages/core/src/magic/costs/CostCalculator.ts:284:43
    282|       if (!pool) {
    283|         // Check if it's in manaPools instead (for legacy support)
    284|         const manaPool = caster.manaPools.find(
       |                                           ^
    285|           p => p.source === cost.type || (cost.type === 'mana' && p.soâ€¦
    286|         );
 â¯ MagicLawEnforcer.validateSpell packages/core/src/magic/MagicLawEnforcer.ts:220:38
 â¯ packages/core/src/magic/__tests__/MagicLawEnforcerIntegration.test.ts:369:35

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[363/746]âŽ¯

 FAIL  packages/core/src/magic/__tests__/MagicSystemEdgeCases.test.ts > Resource Depletion Edge Cases > should handle casting when resources hit zero mid-cast
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/magic/__tests__/MagicSystemEdgeCases.test.ts:66:30
     64| 
     65|     // Mana should have hit zero, cast should fail
     66|     expect(castState.failed).toBe(true);
       |                              ^
     67|     expect(castState.failureReason).toBe('resource_depleted_during_casâ€¦
     68|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[364/746]âŽ¯

 FAIL  packages/core/src/magic/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Protection > should apply protection effect
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/magic/__tests__/SpellEffectAppliers.test.ts:230:28
    228|     const result = applier.apply(effect, mockCaster, mockTarget, mockWâ€¦
    229| 
    230|     expect(result.success).toBe(true);
       |                            ^
    231|     expect(result.appliedValues.absorption).toBe(50);
    232|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[365/746]âŽ¯

 FAIL  packages/core/src/magic/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Protection > should stack protection effects additively
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/magic/__tests__/SpellEffectAppliers.test.ts:256:29
    254|     const result2 = applier.apply(effect, mockCaster, mockTarget, mockâ€¦
    255| 
    256|     expect(result1.success).toBe(true);
       |                             ^
    257|     expect(result2.success).toBe(true);
    258|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[366/746]âŽ¯

 FAIL  packages/core/src/magic/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Protection > should expire protection after duration
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/magic/__tests__/SpellEffectAppliers.test.ts:275:28
    273|     const result = applier.apply(effect, mockCaster, mockTarget, mockWâ€¦
    274| 
    275|     expect(result.success).toBe(true);
       |                            ^
    276|     expect(result.appliedValues.absorption).toBe(40);
    277|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[367/746]âŽ¯

 FAIL  packages/core/src/magic/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Control > should apply stun effect
TypeError: Cannot read properties of undefined (reading 'isStunned')
 â¯ packages/core/src/magic/__tests__/SpellEffectAppliers.test.ts:424:26
    422|     expect(result.success).toBe(true);
    423|     const statusEffects = mockTarget.getComponent('status_effects');
    424|     expect(statusEffects.isStunned).toBe(true);
       |                          ^
    425|   });
    426| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[368/746]âŽ¯

 FAIL  packages/core/src/magic/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Control > should apply fear effect
TypeError: Cannot read properties of undefined (reading 'currentBehavior')
 â¯ packages/core/src/magic/__tests__/SpellEffectAppliers.test.ts:450:21
    448| 
    449|     const behavior = mockTarget.getComponent('behavior');
    450|     expect(behavior.currentBehavior).toBe('flee');
       |                     ^
    451|   });
    452| });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[369/746]âŽ¯

 FAIL  packages/core/src/magic/__tests__/SpellEffectAppliers.test.ts > Effect Appliers - Transform > should transform entity form
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/magic/__tests__/SpellEffectAppliers.test.ts:539:28
    537|     const result = applier.apply(effect, mockCaster, mockTarget, mockWâ€¦
    538| 
    539|     expect(result.success).toBe(true);
       |                            ^
    540|     expect(mockTarget.getComponent('appearance').form).toBe('sheep');
    541|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[370/746]âŽ¯

 FAIL  packages/core/src/multiverse/__tests__/MultiverseNetworkManager.test.ts > MultiverseNetworkManager > Peer Connection > should handle connection timeout
AssertionError: promise resolved "'peer-1767698218249-qhwrox'" instead of rejecting

- Expected: 
[Error: rejected promise]

+ Received: 
"peer-1767698218249-qhwrox"

 â¯ packages/core/src/multiverse/__tests__/MultiverseNetworkManager.test.ts:154:7
    152|       await expect(
    153|         networkManager.connectToPeer('ws://localhost:8080')
    154|       ).rejects.toThrow('Connection timeout');
       |       ^
    155|     });
    156| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[371/746]âŽ¯

 FAIL  packages/core/src/navigation/__tests__/EmotionalNavigationSystem.integration.test.ts > EmotionalNavigationSystem Integration Tests > Crew Coherence > calculates zero coherence for ships with no crew
AssertionError: expected 0.5 to be +0 // Object.is equality

- Expected
+ Received

- 0
+ 0.5

 â¯ packages/core/src/navigation/__tests__/EmotionalNavigationSystem.integration.test.ts:105:43
    103|       const updatedShip = ship.getComponent(CT.Spaceship);
    104|       expect(updatedShip?.crew.member_ids).toHaveLength(0);
    105|       expect(updatedShip?.crew.coherence).toBe(0);
       |                                           ^
    106|     });
    107| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[372/746]âŽ¯

 FAIL  packages/core/src/navigation/__tests__/KnowledgeTransmission.test.ts > KnowledgeTransmission > recordMovement > records traversal in map knowledge
AssertionError: expected 0.5 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0.5

 â¯ packages/core/src/navigation/__tests__/KnowledgeTransmission.test.ts:252:43
    250|       const sector = mapKnowledge.getSector(0, 0);
    251| 
    252|       expect(sector.pathTraffic.get('e')).toBe(1);
       |                                           ^
    253|     });
    254| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[373/746]âŽ¯

 FAIL  packages/core/src/navigation/__tests__/KnowledgeTransmission.test.ts > KnowledgeTransmission > recordMovement > accumulates traffic on repeated movements
AssertionError: expected 1 to be 5 // Object.is equality

- Expected
+ Received

- 5
+ 1

 â¯ packages/core/src/navigation/__tests__/KnowledgeTransmission.test.ts:263:43
    261|       const sector = mapKnowledge.getSector(0, 0);
    262| 
    263|       expect(sector.pathTraffic.get('e')).toBe(5);
       |                                           ^
    264|     });
    265|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[374/746]âŽ¯

 FAIL  packages/core/src/navigation/__tests__/MapKnowledge.test.ts > MapKnowledge > worn paths (traffic tracking) > records traversal between sectors
AssertionError: expected 0.5 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0.5

 â¯ packages/core/src/navigation/__tests__/MapKnowledge.test.ts:52:43
     50|       // Check traffic was recorded
     51|       const sector = mapKnowledge.getSector(0, 0);
     52|       expect(sector.pathTraffic.get('e')).toBe(1);
       |                                           ^
     53|     });
     54| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[375/746]âŽ¯

 FAIL  packages/core/src/navigation/__tests__/MapKnowledge.test.ts > MapKnowledge > worn paths (traffic tracking) > accumulates traffic on repeated traversals
AssertionError: expected 1 to be 5 // Object.is equality

- Expected
+ Received

- 5
+ 1

 â¯ packages/core/src/navigation/__tests__/MapKnowledge.test.ts:62:43
     60| 
     61|       const sector = mapKnowledge.getSector(0, 0);
     62|       expect(sector.pathTraffic.get('e')).toBe(5);
       |                                           ^
     63|     });
     64| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[376/746]âŽ¯

 FAIL  packages/core/src/navigation/__tests__/MapKnowledge.test.ts > MapKnowledge > worn paths (traffic tracking) > records bidirectional traffic
AssertionError: expected 0.5 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0.5

 â¯ packages/core/src/navigation/__tests__/MapKnowledge.test.ts:70:47
     68|       // From sector should have east traffic
     69|       const fromSector = mapKnowledge.getSector(0, 0);
     70|       expect(fromSector.pathTraffic.get('e')).toBe(1);
       |                                               ^
     71| 
     72|       // To sector should have west traffic (reverse direction)

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[377/746]âŽ¯

 FAIL  packages/core/src/navigation/__tests__/MapKnowledge.test.ts > MapKnowledge > decay > removes very low traffic
AssertionError: expected 0.18384771238548175 to be undefined
 â¯ packages/core/src/navigation/__tests__/MapKnowledge.test.ts:276:23
    274| 
    275|       const traffic = mapKnowledge.getSector(0, 0).pathTraffic.get('e'â€¦
    276|       expect(traffic).toBeUndefined();
       |                       ^
    277|     });
    278|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[378/746]âŽ¯

 FAIL  packages/core/src/navigation/__tests__/MapKnowledge.test.ts > MapKnowledge > serialization > serializes and deserializes correctly
AssertionError: expected 0.5 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0.5

 â¯ packages/core/src/navigation/__tests__/MapKnowledge.test.ts:294:61
    292| 
    293|       // Check state preserved
    294|       expect(restored.getSector(0, 0).pathTraffic.get('e')).toBe(1);
       |                                                             ^
    295|       expect(restored.getSector(1, 1).resourceAbundance.get('food')).tâ€¦
    296|       expect(restored.getSector(1, 1).areaName).toBe('Test Area');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[379/746]âŽ¯

 FAIL  packages/core/src/navigation/__tests__/SpaceshipComponent.test.ts > SpaceshipComponent > createSpaceshipComponent > initializes crew with empty emotional state
AssertionError: expected 0.7 to be +0 // Object.is equality

- Expected
+ Received

- 0
+ 0.7

 â¯ packages/core/src/navigation/__tests__/SpaceshipComponent.test.ts:63:35
     61|       expect(ship.crew.collective_emotional_state.emotions).toEqual({}â€¦
     62|       expect(ship.crew.member_ids).toHaveLength(0);
     63|       expect(ship.crew.coherence).toBe(0);
       |                                   ^
     64|     });
     65| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[380/746]âŽ¯

 FAIL  packages/core/src/navigation/__tests__/SpaceshipComponent.test.ts > SpaceshipComponent > createSpaceshipComponent > initializes personality with empty arrays
AssertionError: expected [ 'exploration', 'trade', 'research' ] to have a length of +0 but got 3

- Expected
+ Received

- 0
+ 3

 â¯ packages/core/src/navigation/__tests__/SpaceshipComponent.test.ts:70:72
     68| 
     69|       expect(ship.narrative.personality.dominant_emotions).toHaveLengtâ€¦
     70|       expect(ship.narrative.personality.preferences.destination_types)â€¦
       |                                                                        ^
     71|       expect(ship.narrative.personality.preferences.mission_types).toHâ€¦
     72|       expect(ship.narrative.personality.resistance.to_emotions).toHaveâ€¦

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[381/746]âŽ¯

 FAIL  packages/core/src/perception/__tests__/Perception.integration.test.ts > Perception Integration Tests > Vision and Memory Integration > agent detects plants and remembers their state
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 â¯ packages/core/src/perception/__tests__/Perception.integration.test.ts:207:45
    205|       expect(plantMemory).toBeDefined();
    206|       expect(plantMemory.metadata.speciesId).toBe('berry-bush');
    207|       expect(plantMemory.metadata.hasSeeds).toBe(true);
       |                                             ^
    208|       expect(plantMemory.metadata.hasFruit).toBe(true);
    209|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[382/746]âŽ¯

 FAIL  packages/core/src/uplift/__tests__/ConsciousnessEmergenceSystem.test.ts > ConsciousnessEmergenceSystem - Event Emission > should emit consciousness_awakened event
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/uplift/__tests__/ConsciousnessEmergenceSystem.test.ts:435:24
    433|     }
    434| 
    435|     expect(eventFired).toBe(true);
       |                        ^
    436|   });
    437| });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[383/746]âŽ¯

 FAIL  packages/core/src/uplift/__tests__/ProtoSapienceObservationSystem.test.ts > ProtoSapienceObservationSystem - Communication Patterns > should track communication pattern development
AssertionError: expected 0 to be greater than 0
 â¯ packages/core/src/uplift/__tests__/ProtoSapienceObservationSystem.test.ts:344:48
    342| 
    343|     expect(proto.hasProtocolanguage).toBe(true);
    344|     expect(proto.communicationPatterns.length).toBeGreaterThan(0);
       |                                                ^
    345|   });
    346| });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[384/746]âŽ¯

 FAIL  packages/core/src/uplift/__tests__/ProtoSapienceObservationSystem.test.ts > ProtoSapienceObservationSystem - Milestone Events > should emit milestone event for first tool use
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/uplift/__tests__/ProtoSapienceObservationSystem.test.ts:403:33
    401|     expect(proto.usesTools).toBe(true);
    402|     // Verify event fired
    403|     expect(milestoneEventFired).toBe(true);
       |                                 ^
    404|   });
    405| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[385/746]âŽ¯

 FAIL  packages/core/src/uplift/__tests__/ProtoSapienceObservationSystem.test.ts > ProtoSapienceObservationSystem - Milestone Events > should emit milestone event for proto-language emergence
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/uplift/__tests__/ProtoSapienceObservationSystem.test.ts:439:33
    437|     }
    438| 
    439|     expect(milestoneEventFired).toBe(true);
       |                                 ^
    440|   });
    441| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[386/746]âŽ¯

 FAIL  packages/core/src/uplift/__tests__/UpliftBreedingProgramSystem.test.ts > UpliftBreedingProgramSystem - Population Management > should handle population extinction
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/uplift/__tests__/UpliftBreedingProgramSystem.test.ts:404:34
    402|     }
    403| 
    404|     expect(extinctionEventFired).toBe(true);
       |                                  ^
    405|   });
    406| });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[387/746]âŽ¯

 FAIL  packages/core/src/uplift/__tests__/UpliftIntegration.test.ts > Uplift Integration - Full Wolf Uplift Flow > should complete full uplift from Gen 0 to awakening
AssertionError: expected 0 to be greater than 0
 â¯ packages/core/src/uplift/__tests__/UpliftIntegration.test.ts:120:39
    118| 
    119|     // Verify program advanced
    120|     expect(program.currentGeneration).toBeGreaterThan(0);
       |                                       ^
    121| 
    122|     // Verify intelligence increased

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[388/746]âŽ¯

 FAIL  packages/core/src/uplift/__tests__/UpliftIntegration.test.ts > Uplift Integration - Full Wolf Uplift Flow > should track generation results throughout uplift
AssertionError: expected +0 to be 5 // Object.is equality

- Expected
+ Received

- 5
+ 0

 â¯ packages/core/src/uplift/__tests__/UpliftIntegration.test.ts:136:46
    134|     }
    135| 
    136|     expect(program.generationResults.length).toBe(5);
       |                                              ^
    137| 
    138|     // Each result should have required fields

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[389/746]âŽ¯

 FAIL  packages/core/src/uplift/__tests__/UpliftIntegration.test.ts > Uplift Integration - Full Wolf Uplift Flow > should emit events during uplift process
AssertionError: expected [] to include 'generation_advanced'
 â¯ packages/core/src/uplift/__tests__/UpliftIntegration.test.ts:167:20
    165|     }
    166| 
    167|     expect(events).toContain('generation_advanced');
       |                    ^
    168|   });
    169| });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[390/746]âŽ¯

 FAIL  packages/core/src/uplift/__tests__/UpliftIntegration.test.ts > Uplift Integration - Technology Effects > should accelerate with genetic engineering tech
AssertionError: expected 0 to be greater than 0
 â¯ packages/core/src/uplift/__tests__/UpliftIntegration.test.ts:220:30
    218| 
    219|     const intelligenceGain = programWithTech.currentIntelligence - iniâ€¦
    220|     expect(intelligenceGain).toBeGreaterThan(0);
       |                              ^
    221|   });
    222| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[391/746]âŽ¯

 FAIL  packages/core/src/uplift/__tests__/UpliftIntegration.test.ts > Uplift Integration - Edge Cases > should handle population extinction
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/uplift/__tests__/UpliftIntegration.test.ts:297:32
    295|     breedingSystem.update(world, [programEntity], 0.05);
    296| 
    297|     expect(extinctionDetected).toBe(true);
       |                                ^
    298|   });
    299| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[392/746]âŽ¯

 FAIL  packages/core/src/uplift/__tests__/UpliftIntegration.test.ts > Uplift Integration - Edge Cases > should handle very low initial intelligence
AssertionError: expected 0.3 to be greater than 0.3
 â¯ packages/core/src/uplift/__tests__/UpliftIntegration.test.ts:329:41
    327| 
    328|     // Should make progress even with very low intelligence
    329|     expect(program.currentIntelligence).toBeGreaterThan(0.30);
       |                                         ^
    330|   });
    331| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[393/746]âŽ¯

 FAIL  packages/core/src/uplift/__tests__/UpliftIntegration.test.ts > Uplift Integration - Edge Cases > should handle concurrent uplift programs
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 â¯ packages/core/src/uplift/__tests__/UpliftIntegration.test.ts:382:43
    380| 
    381|     // Both should advance independently
    382|     expect(wolfProgram.currentGeneration).toBe(1);
       |                                           ^
    383|     expect(ravenProgram.currentGeneration).toBe(1);
    384|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[394/746]âŽ¯

 FAIL  packages/core/src/uplift/__tests__/UpliftIntegration.test.ts > Uplift Integration - Proto-Sapience to Sapience Transition > should transition from proto-sapient to sapient
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/uplift/__tests__/UpliftIntegration.test.ts:444:43
    442| 
    443|     // Should have transformed to agent
    444|     expect(entity.hasComponent(CT.Agent)).toBe(true);
       |                                           ^
    445|     expect(entity.hasComponent(CT.UpliftedTrait)).toBe(true);
    446|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[395/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/AgentBrainSystem.test.ts > AgentBrainSystem > autonomic override > switches to seek_sleep when energy is critical
AssertionError: expected 'wander' to be 'seek_sleep' // Object.is equality

- Expected
+ Received

- seek_sleep
+ wander

 â¯ packages/core/src/systems/__tests__/AgentBrainSystem.test.ts:182:37
    180|       // Should have switched to seek_sleep
    181|       const updatedAgent = entity.getComponent(ComponentType.Agent) asâ€¦
    182|       expect(updatedAgent.behavior).toBe('seek_sleep');
       |                                     ^
    183|       expect(sleepHandler).toHaveBeenCalled();
    184|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[396/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/AgentBrainSystem.test.ts > AgentBrainSystem > behavior queue > emits queue:interrupted when autonomic overrides
AssertionError: expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ]

Received: 



Number of calls: 0

 â¯ packages/core/src/systems/__tests__/AgentBrainSystem.test.ts:245:35
    243|       system.update(world, [entity], 0.05);
    244| 
    245|       expect(world.eventBus.emit).toHaveBeenCalledWith(
       |                                   ^
    246|         expect.objectContaining({
    247|           type: 'agent:queue:interrupted',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[397/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/AgentBuildingOrchestration.test.ts > Agent Building Orchestration - Phase 7 > Criterion 1: Construction Progress Automation > should automatically increment progress each tick for buildings < 100%
Error: Unknown building type: undefined. Cannot determine construction time.
 â¯ BuildingSystem.getConstructionTime packages/core/src/systems/BuildingSystem.ts:900:13
    898|     if (time === undefined) {
    899|       // Per CLAUDE.md: No silent fallbacks
    900|       throw new Error(`Unknown building type: ${buildingType}. Cannot â€¦
       |             ^
    901|     }
    902| 
 â¯ BuildingSystem.advanceConstruction packages/core/src/systems/BuildingSystem.ts:456:42
 â¯ BuildingSystem.update packages/core/src/systems/BuildingSystem.ts:433:14
 â¯ packages/core/src/systems/__tests__/AgentBuildingOrchestration.test.ts:73:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[398/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/AgentBuildingOrchestration.test.ts > Agent Building Orchestration - Phase 7 > Criterion 1: Construction Progress Automation > should calculate progress based on buildTime
Error: Unknown building type: undefined. Cannot determine construction time.
 â¯ BuildingSystem.getConstructionTime packages/core/src/systems/BuildingSystem.ts:900:13
    898|     if (time === undefined) {
    899|       // Per CLAUDE.md: No silent fallbacks
    900|       throw new Error(`Unknown building type: ${buildingType}. Cannot â€¦
       |             ^
    901|     }
    902| 
 â¯ BuildingSystem.advanceConstruction packages/core/src/systems/BuildingSystem.ts:456:42
 â¯ BuildingSystem.update packages/core/src/systems/BuildingSystem.ts:433:14
 â¯ packages/core/src/systems/__tests__/AgentBuildingOrchestration.test.ts:88:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[399/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/AgentBuildingOrchestration.test.ts > Agent Building Orchestration - Phase 7 > Criterion 3: Building Completion > should emit building:complete event when progress reaches 100%
Error: Unknown building type: undefined. Cannot determine construction time.
 â¯ BuildingSystem.getConstructionTime packages/core/src/systems/BuildingSystem.ts:900:13
    898|     if (time === undefined) {
    899|       // Per CLAUDE.md: No silent fallbacks
    900|       throw new Error(`Unknown building type: ${buildingType}. Cannot â€¦
       |             ^
    901|     }
    902| 
 â¯ BuildingSystem.advanceConstruction packages/core/src/systems/BuildingSystem.ts:456:42
 â¯ BuildingSystem.update packages/core/src/systems/BuildingSystem.ts:433:14
 â¯ packages/core/src/systems/__tests__/AgentBuildingOrchestration.test.ts:207:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[400/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/AgentBuildingOrchestration.test.ts > Agent Building Orchestration - Phase 7 > Criterion 3: Building Completion > should mark building as complete when progress reaches 100%
Error: Unknown building type: undefined. Cannot determine construction time.
 â¯ BuildingSystem.getConstructionTime packages/core/src/systems/BuildingSystem.ts:900:13
    898|     if (time === undefined) {
    899|       // Per CLAUDE.md: No silent fallbacks
    900|       throw new Error(`Unknown building type: ${buildingType}. Cannot â€¦
       |             ^
    901|     }
    902| 
 â¯ BuildingSystem.advanceConstruction packages/core/src/systems/BuildingSystem.ts:456:42
 â¯ BuildingSystem.update packages/core/src/systems/BuildingSystem.ts:433:14
 â¯ packages/core/src/systems/__tests__/AgentBuildingOrchestration.test.ts:225:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[401/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/AgentCombat.integration.test.ts > AgentCombatSystem Integration > should resolve agent vs agent combat with skill-based outcome
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/systems/__tests__/AgentCombat.integration.test.ts:103:12

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[402/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/AgentCombat.integration.test.ts > AgentCombatSystem Integration > should apply injuries when combat causes damage
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/systems/__tests__/AgentCombat.integration.test.ts:197:12

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[403/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/AgentCombat.integration.test.ts > AgentCombatSystem Integration > should emit combat events through EventBus
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/systems/__tests__/AgentCombat.integration.test.ts:307:12

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[404/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/AgentCombat.integration.test.ts > AgentCombatSystem Integration > should update relationships after combat
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ packages/core/src/systems/__tests__/AgentCombat.integration.test.ts:398:12

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[405/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Construction Progress Advancement > should advance construction progress based on time elapsed
Error: Unknown building type: undefined. Cannot determine construction time.
 â¯ BuildingSystem.getConstructionTime packages/core/src/systems/BuildingSystem.ts:900:13
    898|     if (time === undefined) {
    899|       // Per CLAUDE.md: No silent fallbacks
    900|       throw new Error(`Unknown building type: ${buildingType}. Cannot â€¦
       |             ^
    901|     }
    902| 
 â¯ BuildingSystem.advanceConstruction packages/core/src/systems/BuildingSystem.ts:456:42
 â¯ BuildingSystem.update packages/core/src/systems/BuildingSystem.ts:433:14
 â¯ packages/core/src/systems/__tests__/ConstructionProgress.test.ts:60:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[406/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Construction Progress Advancement > should advance different buildings at different rates based on buildTime
Error: Unknown building type: undefined. Cannot determine construction time.
 â¯ BuildingSystem.getConstructionTime packages/core/src/systems/BuildingSystem.ts:900:13
    898|     if (time === undefined) {
    899|       // Per CLAUDE.md: No silent fallbacks
    900|       throw new Error(`Unknown building type: ${buildingType}. Cannot â€¦
       |             ^
    901|     }
    902| 
 â¯ BuildingSystem.advanceConstruction packages/core/src/systems/BuildingSystem.ts:456:42
 â¯ BuildingSystem.update packages/core/src/systems/BuildingSystem.ts:433:14
 â¯ packages/core/src/systems/__tests__/ConstructionProgress.test.ts:82:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[407/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Construction Progress Advancement > should clamp progress to 100% maximum
Error: Unknown building type: undefined. Cannot determine construction time.
 â¯ BuildingSystem.getConstructionTime packages/core/src/systems/BuildingSystem.ts:900:13
    898|     if (time === undefined) {
    899|       // Per CLAUDE.md: No silent fallbacks
    900|       throw new Error(`Unknown building type: ${buildingType}. Cannot â€¦
       |             ^
    901|     }
    902| 
 â¯ BuildingSystem.advanceConstruction packages/core/src/systems/BuildingSystem.ts:456:42
 â¯ BuildingSystem.update packages/core/src/systems/BuildingSystem.ts:433:14
 â¯ packages/core/src/systems/__tests__/ConstructionProgress.test.ts:98:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[408/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Construction Progress Advancement > should handle multiple simultaneous constructions
Error: Unknown building type: undefined. Cannot determine construction time.
 â¯ BuildingSystem.getConstructionTime packages/core/src/systems/BuildingSystem.ts:900:13
    898|     if (time === undefined) {
    899|       // Per CLAUDE.md: No silent fallbacks
    900|       throw new Error(`Unknown building type: ${buildingType}. Cannot â€¦
       |             ^
    901|     }
    902| 
 â¯ BuildingSystem.advanceConstruction packages/core/src/systems/BuildingSystem.ts:456:42
 â¯ BuildingSystem.update packages/core/src/systems/BuildingSystem.ts:433:14
 â¯ packages/core/src/systems/__tests__/ConstructionProgress.test.ts:139:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[409/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Construction Completion > should mark building as complete when progress reaches 100%
Error: Unknown building type: undefined. Cannot determine construction time.
 â¯ BuildingSystem.getConstructionTime packages/core/src/systems/BuildingSystem.ts:900:13
    898|     if (time === undefined) {
    899|       // Per CLAUDE.md: No silent fallbacks
    900|       throw new Error(`Unknown building type: ${buildingType}. Cannot â€¦
       |             ^
    901|     }
    902| 
 â¯ BuildingSystem.advanceConstruction packages/core/src/systems/BuildingSystem.ts:456:42
 â¯ BuildingSystem.update packages/core/src/systems/BuildingSystem.ts:433:14
 â¯ packages/core/src/systems/__tests__/ConstructionProgress.test.ts:155:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[410/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Construction Completion > should emit "building:complete" event on completion
Error: Unknown building type: undefined. Cannot determine construction time.
 â¯ BuildingSystem.getConstructionTime packages/core/src/systems/BuildingSystem.ts:900:13
    898|     if (time === undefined) {
    899|       // Per CLAUDE.md: No silent fallbacks
    900|       throw new Error(`Unknown building type: ${buildingType}. Cannot â€¦
       |             ^
    901|     }
    902| 
 â¯ BuildingSystem.advanceConstruction packages/core/src/systems/BuildingSystem.ts:456:42
 â¯ BuildingSystem.update packages/core/src/systems/BuildingSystem.ts:433:14
 â¯ packages/core/src/systems/__tests__/ConstructionProgress.test.ts:172:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[411/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Construction Completion > should only emit event once when crossing 100% threshold
Error: Unknown building type: undefined. Cannot determine construction time.
 â¯ BuildingSystem.getConstructionTime packages/core/src/systems/BuildingSystem.ts:900:13
    898|     if (time === undefined) {
    899|       // Per CLAUDE.md: No silent fallbacks
    900|       throw new Error(`Unknown building type: ${buildingType}. Cannot â€¦
       |             ^
    901|     }
    902| 
 â¯ BuildingSystem.advanceConstruction packages/core/src/systems/BuildingSystem.ts:456:42
 â¯ BuildingSystem.update packages/core/src/systems/BuildingSystem.ts:433:14
 â¯ packages/core/src/systems/__tests__/ConstructionProgress.test.ts:212:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[412/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Edge Cases > should handle progress from 99% to 101% (clamped to 100%)
Error: Unknown building type: undefined. Cannot determine construction time.
 â¯ BuildingSystem.getConstructionTime packages/core/src/systems/BuildingSystem.ts:900:13
    898|     if (time === undefined) {
    899|       // Per CLAUDE.md: No silent fallbacks
    900|       throw new Error(`Unknown building type: ${buildingType}. Cannot â€¦
       |             ^
    901|     }
    902| 
 â¯ BuildingSystem.advanceConstruction packages/core/src/systems/BuildingSystem.ts:456:42
 â¯ BuildingSystem.update packages/core/src/systems/BuildingSystem.ts:433:14
 â¯ packages/core/src/systems/__tests__/ConstructionProgress.test.ts:312:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[413/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Edge Cases > should handle zero deltaTime
Error: Unknown building type: undefined. Cannot determine construction time.
 â¯ BuildingSystem.getConstructionTime packages/core/src/systems/BuildingSystem.ts:900:13
    898|     if (time === undefined) {
    899|       // Per CLAUDE.md: No silent fallbacks
    900|       throw new Error(`Unknown building type: ${buildingType}. Cannot â€¦
       |             ^
    901|     }
    902| 
 â¯ BuildingSystem.advanceConstruction packages/core/src/systems/BuildingSystem.ts:456:42
 â¯ BuildingSystem.update packages/core/src/systems/BuildingSystem.ts:433:14
 â¯ packages/core/src/systems/__tests__/ConstructionProgress.test.ts:324:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[414/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > BuildingComponent Properties > should set correct properties for shelters
AssertionError: expected +0 to be 0.5 // Object.is equality

- Expected
+ Received

- 0.5
+ 0

 â¯ packages/core/src/systems/__tests__/ConstructionProgress.test.ts:404:31
    402|     it('should set correct properties for shelters', () => {
    403|       const tent = createBuildingComponent(BuildingType.Tent, 1, 0);
    404|       expect(tent.insulation).toBe(0.5);
       |                               ^
    405|       expect(tent.baseTemperature).toBe(8);
    406|       expect(tent.weatherProtection).toBe(0.7);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[415/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/CraftingQuality.integration.test.ts > CraftingSystem Quality Integration > should include task familiarity bonus in quality over repeated crafts
Error: Cannot add crafted wheat_bread to inventory: Inventory full. Cannot add legendary wheat_bread.
 â¯ CraftingSystem.completeJob packages/core/src/crafting/CraftingSystem.ts:505:13
    503|     } catch (error) {
    504|       // Inventory full - throw per CLAUDE.md guidelines
    505|       throw new Error(
       |             ^
    506|         `Cannot add crafted ${recipe.output.itemId} to inventory: ${(eâ€¦
    507|       );
 â¯ CraftingSystem.updateJob packages/core/src/crafting/CraftingSystem.ts:415:12
 â¯ CraftingSystem.update packages/core/src/crafting/CraftingSystem.ts:342:14
 â¯ packages/core/src/systems/__tests__/CraftingQuality.integration.test.ts:253:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[416/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DeathBargainSystem.test.ts > DeathBargainSystem > offerDeathBargain > should create death bargain component
AssertionError: expected undefined not to be undefined
 â¯ packages/core/src/systems/__tests__/DeathBargainSystem.test.ts:66:23
     64|       const bargain = entity.getComponent(ComponentType.DeathBargain) â€¦
     65| 
     66|       expect(bargain).toBeDefined();
       |                       ^
     67|       expect(bargain.type).toBe('death_bargain');
     68|       expect(bargain.status).toBe('offered');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[417/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DeathBargainSystem.test.ts > DeathBargainSystem > offerDeathBargain > should emit death:bargain_offered event
AssertionError: expected 0 to be greater than 0
 â¯ packages/core/src/systems/__tests__/DeathBargainSystem.test.ts:90:29
     88| 
     89|       // Events should now be processed
     90|       expect(events.length).toBeGreaterThan(0);
       |                             ^
     91|       expect(events[0].type).toBe('death:bargain_offered');
     92|       expect(events[0].data.entityId).toBe(entity.id);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[418/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DeathBargainSystem.test.ts > DeathBargainSystem > Sphinx Riddle - Direct Component Manipulation > should reject wrong answer and allow retry
AssertionError: expected 'a dog' to be undefined
 â¯ packages/core/src/systems/__tests__/DeathBargainSystem.test.ts:212:43
    210|       expect(updatedBargain.attempts).toBe(1);
    211|       expect(updatedBargain.status).toBe('in_progress');
    212|       expect(updatedBargain.heroResponse).toBeUndefined(); // Cleared â€¦
       |                                           ^
    213|     });
    214| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[419/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DeathBargainSystem.test.ts > DeathBargainSystem > Sphinx Riddle - Direct Component Manipulation > should fail after max attempts
AssertionError: expected 'in_progress' to be 'failed' // Object.is equality

- Expected
+ Received

- failed
+ in_progress

 â¯ packages/core/src/systems/__tests__/DeathBargainSystem.test.ts:245:37
    243|       const updatedBargain = entity.getComponent(ComponentType.DeathBaâ€¦
    244| 
    245|       expect(updatedBargain.status).toBe('failed');
       |                                     ^
    246|       expect(updatedBargain.succeeded).toBe(false);
    247|       expect(updatedBargain.attempts).toBe(3);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[420/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DeathBargainSystem.test.ts > DeathBargainSystem > Core functionality smoke test > should handle full death bargain flow
TypeError: Cannot read properties of undefined (reading 'status')
 â¯ packages/core/src/systems/__tests__/DeathBargainSystem.test.ts:259:22
    257| 
    258|       let bargain = entity.getComponent(ComponentType.DeathBargain) asâ€¦
    259|       expect(bargain.status).toBe('offered');
       |                      ^
    260| 
    261|       // Step 2: Accept bargain

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[421/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DeityEmergence.integration.test.ts > Phase 4: Deity Emergence Integration > Emergence Detection > should detect when enough agents share belief pattern
 FAIL  packages/core/src/systems/__tests__/DeityEmergence.integration.test.ts > Phase 4: Deity Emergence Integration > Emergence Detection > should not emerge with insufficient believers
 FAIL  packages/core/src/systems/__tests__/DeityEmergence.integration.test.ts > Phase 4: Deity Emergence Integration > Emergence Detection > should assign believers to newly emerged deity
 FAIL  packages/core/src/systems/__tests__/DeityEmergence.integration.test.ts > Phase 4: Deity Emergence Integration > AI God Behavior > should answer prayers when deity has enough belief
 FAIL  packages/core/src/systems/__tests__/DeityEmergence.integration.test.ts > Phase 4: Deity Emergence Integration > AI God Behavior > should not act when belief is too low
 FAIL  packages/core/src/systems/__tests__/DeityEmergence.integration.test.ts > Phase 4: Deity Emergence Integration > Deity Relationships > should create hostile relationship when domains overlap
 FAIL  packages/core/src/systems/__tests__/DeityEmergence.integration.test.ts > Phase 4: Deity Emergence Integration > Deity Relationships > should create friendly relationship when domains are synergistic
 FAIL  packages/core/src/systems/__tests__/DeityEmergence.integration.test.ts > Phase 4: Deity Emergence Integration > Deity Relationships > should calculate domain synergy correctly
 FAIL  packages/core/src/systems/__tests__/DeityEmergence.integration.test.ts > Phase 4: Deity Emergence Integration > Complete Emergence Flow > should go from shared beliefs -> emergence -> AI behavior -> relationships
TypeError: World is not a constructor
 â¯ packages/core/src/systems/__tests__/DeityEmergence.integration.test.ts:31:13
     29| 
     30|   beforeEach(() => {
     31|     world = new World();
       |             ^
     32|     emergenceSystem = new DeityEmergenceSystem({
     33|       minBelievers: 3,

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[422/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Chat Room Creation > should create chat room singleton on first update
AssertionError: expected null not to be null
 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:63:24
     61|       // Chat room should now exist
     62|       const chat = getChatRoom();
     63|       expect(chat).not.toBeNull();
       |                        ^
     64|       expect(chat?.messages).toEqual([]);
     65|       expect(chat?.config.membership.members).toEqual([]);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[423/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Member Entry Notifications > should generate entry notification when first god appears
AssertionError: the given combination of arguments (undefined and string) is invalid for this assertion. You can use an array, a map, an object, a set, a string, or a weakset instead of a string
 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:89:47
     87| 
     88|       const chat = getChatRoom();
     89|       expect(chat?.config.membership.members).toContain(deathGodId);
       |                                               ^
     90|       expect(chat?.pendingNotifications).toHaveLength(1);
     91|       expect(chat?.pendingNotifications[0]?.type).toBe('joined');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[424/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Member Entry Notifications > should generate entry notifications for multiple gods
AssertionError: Target cannot be null or undefined.
 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:105:47
    103| 
    104|       const chat = getChatRoom();
    105|       expect(chat?.config.membership.members).toHaveLength(2);
       |                                               ^
    106|       expect(chat?.config.membership.members).toContain(deathGodId);
    107|       expect(chat?.config.membership.members).toContain(harvestGodId);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[425/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Member Exit Notifications > should generate exit notification when god is removed
AssertionError: the given combination of arguments (undefined and string) is invalid for this assertion. You can use an array, a map, an object, a set, a string, or a weakset instead of a string
 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:140:51
    138| 
    139|       const chat = getChatRoom();
    140|       expect(chat?.config.membership.members).not.toContain(deathGodIdâ€¦
       |                                                   ^
    141|       expect(chat?.config.membership.members).toHaveLength(1);
    142| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[426/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Member Exit Notifications > should handle all gods leaving
AssertionError: Target cannot be null or undefined.
 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:162:47
    160| 
    161|       const chat = getChatRoom();
    162|       expect(chat?.config.membership.members).toHaveLength(0);
       |                                               ^
    163|       expect(chat?.isActive).toBe(false);
    164|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[427/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Chat Activation > should be inactive with 0 gods
AssertionError: expected undefined to be false // Object.is equality

- Expected: 
false

+ Received: 
undefined

 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:172:30
    170| 
    171|       const chat = getChatRoom();
    172|       expect(chat?.isActive).toBe(false);
       |                              ^
    173|     });
    174| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[428/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Chat Activation > should be inactive with 1 god
AssertionError: expected undefined to be false // Object.is equality

- Expected: 
false

+ Received: 
undefined

 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:182:30
    180| 
    181|       const chat = getChatRoom();
    182|       expect(chat?.isActive).toBe(false);
       |                              ^
    183|     });
    184| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[429/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Chat Activation > should activate with 2 gods
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:193:30
    191| 
    192|       const chat = getChatRoom();
    193|       expect(chat?.isActive).toBe(true);
       |                              ^
    194|     });
    195| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[430/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Chat Activation > should activate with 3+ gods
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:205:30
    203| 
    204|       const chat = getChatRoom();
    205|       expect(chat?.isActive).toBe(true);
       |                              ^
    206|       expect(chat?.config.membership.members).toHaveLength(3);
    207|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[431/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Chat Activation > should deactivate when god count drops below 2
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:216:39
    214|       chatSystem.update(world, [], 0);
    215| 
    216|       expect(getChatRoom()?.isActive).toBe(true);
       |                                       ^
    217| 
    218|       // Remove one god

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[432/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Message Sending > should send message from deity
AssertionError: Target cannot be null or undefined.
 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:242:30
    240| 
    241|       const chat = getChatRoom();
    242|       expect(chat?.messages).toHaveLength(1);
       |                              ^
    243| 
    244|       const message = chat?.messages[0];

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[433/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Message Sending > should send multiple messages and maintain order
AssertionError: Target cannot be null or undefined.
 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:263:30
    261| 
    262|       const chat = getChatRoom();
    263|       expect(chat?.messages).toHaveLength(3);
       |                              ^
    264| 
    265|       expect(chat?.messages[0]?.content).toBe('Hello');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[434/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Message Sending > should update lastMessageTick when message sent
AssertionError: expected +0 to be 100 // Object.is equality

- Expected
+ Received

- 100
+ 0

 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:285:25
    283| 
    284|       const tickAfter = getChatRoom()?.lastMessageTick || 0;
    285|       expect(tickAfter).toBe(world.tick);
       |                         ^
    286|       expect(tickAfter).toBeGreaterThan(tickBefore);
    287|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[435/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Message Sending > should handle sending message from non-existent sender gracefully
TypeError: actual value must be number or bigint, received "undefined"
 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:297:37
    295|       const chat = getChatRoom();
    296|       // Message is still sent (with 'Unknown' name) - the sender doesâ€¦
    297|       expect(chat?.messages.length).toBeGreaterThanOrEqual(0);
       |                                     ^
    298|     });
    299|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[436/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Public API Methods > isInRoom > should return true for member in room
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:309:79
    307|         chatSystem.update(world, [], 0);
    308| 
    309|         expect(chatSystem.isInRoom(world, DIVINE_CHAT_CONFIG.id, deathâ€¦
       |                                                                               ^
    310|       });
    311| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[437/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Public API Methods > isInRoom > should return false after member leaves
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:325:79
    323|         chatSystem.update(world, [], 0);
    324| 
    325|         expect(chatSystem.isInRoom(world, DIVINE_CHAT_CONFIG.id, deathâ€¦
       |                                                                               ^
    326| 
    327|         world.destroyEntity(deathGodId);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[438/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Public API Methods > getRoomMembers > should return info of all present members
AssertionError: expected [] to have a length of 3 but got +0

- Expected
+ Received

- 3
+ 0

 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:350:25
    348| 
    349|         const members = chatSystem.getRoomMembers(world, DIVINE_CHAT_Câ€¦
    350|         expect(members).toHaveLength(3);
       |                         ^
    351| 
    352|         const names = members.map(m => m.name);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[439/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Public API Methods > getRoomMembers > should update when members leave
AssertionError: expected [] to have a length of 2 but got +0

- Expected
+ Received

- 2
+ 0

 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:365:73
    363|         chatSystem.update(world, [], 0);
    364| 
    365|         expect(chatSystem.getRoomMembers(world, DIVINE_CHAT_CONFIG.id)â€¦
       |                                                                         ^
    366| 
    367|         world.destroyEntity(deathGodId);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[440/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Public API Methods > getRoom > should return chat component after initialization
AssertionError: expected null not to be null
 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:388:26
    386| 
    387|         const chat = chatSystem.getRoom(world, DIVINE_CHAT_CONFIG.id);
    388|         expect(chat).not.toBeNull();
       |                          ^
    389|         expect(chat?.config).toBeDefined();
    390|         expect(chat?.isActive).toBeDefined();

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[441/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Complete Chat Flow > should handle complete god interaction scenario
AssertionError: expected undefined to be false // Object.is equality

- Expected: 
false

+ Received: 
undefined

 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:413:39
    411|       chatSystem.update(world, [], 0);
    412| 
    413|       expect(getChatRoom()?.isActive).toBe(false);
       |                                       ^
    414|       expect(getChatRoom()?.pendingNotifications).toHaveLength(1);
    415| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[442/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Tick Tracking > should update lastActivityTick on each update
AssertionError: expected undefined to be +0 // Object.is equality

- Expected: 
0

+ Received: 
undefined

 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:481:47
    479|       const initialTick = world.tick;
    480|       chatSystem.update(world, [], 0);
    481|       expect(getChatRoom()?.lastActivityTick).toBe(initialTick);
       |                                               ^
    482| 
    483|       // Advance tick

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[443/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Edge Cases > should handle rapid member creation and deletion
AssertionError: Target cannot be null or undefined.
 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:508:56
    506|       chatSystem.update(world, [], 0);
    507| 
    508|       expect(getChatRoom()?.config.membership.members).toHaveLength(3);
       |                                                        ^
    509| 
    510|       world.destroyEntity(god1);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[444/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/DivineChat.integration.test.ts > Chat Room System - Integration (Divine Chat) > Edge Cases > should preserve messages when members join/leave
AssertionError: Target cannot be null or undefined.
 â¯ packages/core/src/systems/__tests__/DivineChat.integration.test.ts:555:39
    553| 
    554|       // Message should still be there
    555|       expect(getChatRoom()?.messages).toHaveLength(1);
       |                                       ^
    556|       expect(getChatRoom()?.messages[0]?.content).toBe('Important messâ€¦
    557|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[445/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/EpisodicMemory.integration.test.ts > Episodic Memory Integration > Memory Formation from Events > should handle multiple events in sequence
AssertionError: expected 1 to be 3 // Object.is equality

- Expected
+ Received

- 3
+ 1

 â¯ packages/core/src/systems/__tests__/EpisodicMemory.integration.test.ts:156:46
    154|       // Should have 3 memories
    155|       const memory = agent.getComponent(ComponentType.EpisodicMemory) â€¦
    156|       expect(memory.episodicMemories.length).toBe(3);
       |                                              ^
    157|     });
    158|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[446/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/EpisodicMemory.integration.test.ts > Episodic Memory Integration > Full Memory Lifecycle > should handle multiple agents with independent memory systems
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 â¯ packages/core/src/systems/__tests__/EpisodicMemory.integration.test.ts:523:47
    521|       const memory2 = agent2.getComponent(ComponentType.EpisodicMemoryâ€¦
    522| 
    523|       expect(memory1.episodicMemories.length).toBe(1);
       |                                               ^
    524|       expect(memory2.episodicMemories.length).toBe(1);
    525|       expect(memory1.episodicMemories[0]?.summary).toContain('wheat');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[447/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/EquipmentCombat.integration.test.ts > Equipment + Combat Integration > Iron Armor Set vs Unarmored > should give significant advantage to fully armored fighter
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ runCombat packages/core/src/systems/__tests__/EquipmentCombat.integration.test.ts:413:18
 â¯ packages/core/src/systems/__tests__/EquipmentCombat.integration.test.ts:437:25

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[448/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/EquipmentCombat.integration.test.ts > Equipment + Combat Integration > Steel Armor Set vs Iron Armor Set > should give advantage to better armor material
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ runCombat packages/core/src/systems/__tests__/EquipmentCombat.integration.test.ts:413:18
 â¯ packages/core/src/systems/__tests__/EquipmentCombat.integration.test.ts:472:23

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[449/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/EquipmentCombat.integration.test.ts > Equipment + Combat Integration > Statistical Combat Outcomes > should show consistent advantage for superior equipment over many battles
TypeError: Cannot read properties of undefined (reading 'combatSkill')
 â¯ AgentCombatSystem.calculateCombatPower packages/core/src/systems/AgentCombatSystem.ts:326:45
    324|     // Get magical skill bonuses from equipment (Phase 36: Combat Inteâ€¦
    325|     let attackerCombatSkill = attackerStats.combatSkill;
    326|     let defenderCombatSkill = defenderStats.combatSkill;
       |                                             ^
    327| 
    328|     // Apply magical skill bonuses from equipment
 â¯ AgentCombatSystem.update packages/core/src/systems/AgentCombatSystem.ts:148:68
 â¯ runCombat packages/core/src/systems/__tests__/EquipmentCombat.integration.test.ts:413:18
 â¯ packages/core/src/systems/__tests__/EquipmentCombat.integration.test.ts:618:25

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[450/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/MovementOscillation.integration.test.ts > Movement Oscillation Detection > Oscillation Detection Algorithm > should detect no oscillation for stationary agent
TypeError: Cannot read properties of undefined (reading 'velocityX')
 â¯ MovementSystem.update packages/core/src/systems/MovementSystem.ts:180:20
    178| 
    179|       // Skip if not moving
    180|       if (movement.velocityX === 0 && movement.velocityY === 0) {
       |                    ^
    181|         continue;
    182|       }
 â¯ packages/core/src/systems/__tests__/MovementOscillation.integration.test.ts:219:24

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[451/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/MovementOscillation.integration.test.ts > Movement Oscillation Detection > Oscillation Detection Algorithm > should detect no oscillation for agent moving in straight line
TypeError: Cannot read properties of undefined (reading 'velocityX')
 â¯ MovementSystem.update packages/core/src/systems/MovementSystem.ts:180:20
    178| 
    179|       // Skip if not moving
    180|       if (movement.velocityX === 0 && movement.velocityY === 0) {
       |                    ^
    181|         continue;
    182|       }
 â¯ packages/core/src/systems/__tests__/MovementOscillation.integration.test.ts:250:24

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[452/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/MovementOscillation.integration.test.ts > Movement Oscillation Detection > Oscillation Detection Algorithm > should detect oscillation for agent with alternating velocity
TypeError: Cannot read properties of undefined (reading 'velocityX')
 â¯ MovementSystem.update packages/core/src/systems/MovementSystem.ts:180:20
    178| 
    179|       // Skip if not moving
    180|       if (movement.velocityX === 0 && movement.velocityY === 0) {
       |                    ^
    181|         continue;
    182|       }
 â¯ packages/core/src/systems/__tests__/MovementOscillation.integration.test.ts:289:24

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[453/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/MovementOscillation.integration.test.ts > Movement Oscillation Detection > Steering vs AgentBrainSystem Conflict Detection > should not oscillate when MovementSystem syncs velocity to movement
Error: SteeringSystem failed for entity df2e95fa-5076-48ff-95e9-993aa0900665: Error: Steering component missing
 â¯ SteeringSystem.update packages/core/src/systems/SteeringSystem.ts:60:15
     58|       } catch (error) {
     59|         // Per CLAUDE.md, re-throw with context
     60|         throw new Error(`SteeringSystem failed for entity ${entity.id}â€¦
       |               ^
     61|       }
     62|     }
 â¯ packages/core/src/systems/__tests__/MovementOscillation.integration.test.ts:333:24

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[454/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/MovementOscillation.integration.test.ts > Movement Oscillation Detection > Steering vs AgentBrainSystem Conflict Detection > should detect oscillation if velocity is externally modified each tick
TypeError: Cannot read properties of undefined (reading 'velocityX')
 â¯ MovementSystem.update packages/core/src/systems/MovementSystem.ts:180:20
    178| 
    179|       // Skip if not moving
    180|       if (movement.velocityX === 0 && movement.velocityY === 0) {
       |                    ^
    181|         continue;
    182|       }
 â¯ packages/core/src/systems/__tests__/MovementOscillation.integration.test.ts:382:24

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[455/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/MovementOscillation.integration.test.ts > Movement Oscillation Detection > Extended Duration Tests > should not develop oscillation over 1000 ticks with full agent
Error: SteeringSystem failed for entity 1a606722-5958-42c6-800a-18e1a51010ee: Error: Steering component missing
 â¯ SteeringSystem.update packages/core/src/systems/SteeringSystem.ts:60:15
     58|       } catch (error) {
     59|         // Per CLAUDE.md, re-throw with context
     60|         throw new Error(`SteeringSystem failed for entity ${entity.id}â€¦
       |               ^
     61|       }
     62|     }
 â¯ trackPosition packages/core/src/systems/__tests__/MovementOscillation.integration.test.ts:87:24
 â¯ packages/core/src/systems/__tests__/MovementOscillation.integration.test.ts:584:23

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[456/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/MovementSteering.integration.test.ts > MovementSystem + SteeringSystem Integration > should handle obstacle avoidance with buildings
TypeError: Cannot read properties of undefined (reading 'velocityX')
 â¯ MovementSystem.update packages/core/src/systems/MovementSystem.ts:180:20
    178| 
    179|       // Skip if not moving
    180|       if (movement.velocityX === 0 && movement.velocityY === 0) {
       |                    ^
    181|         continue;
    182|       }
 â¯ packages/core/src/systems/__tests__/MovementSteering.integration.test.ts:189:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[457/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/MovementSteering.integration.test.ts > MovementSystem + SteeringSystem Integration > should combined steering behavior use obstacle avoidance
Error: SteeringSystem failed for entity 752227e6-512f-4741-ac37-205d989db599: Error: Steering component missing
 â¯ SteeringSystem.update packages/core/src/systems/SteeringSystem.ts:60:15
     58|       } catch (error) {
     59|         // Per CLAUDE.md, re-throw with context
     60|         throw new Error(`SteeringSystem failed for entity ${entity.id}â€¦
       |               ^
     61|       }
     62|     }
 â¯ packages/core/src/systems/__tests__/MovementSteering.integration.test.ts:312:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[458/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/PerformanceOptimizations.integration.test.ts > Performance Optimizations Integration > Acceptance Criterion 3: Cached Collision Data > should MovementSystem cache building positions and reuse
TypeError: Cannot read properties of undefined (reading 'velocityX')
 â¯ MovementSystem.update packages/core/src/systems/MovementSystem.ts:180:20
    178| 
    179|       // Skip if not moving
    180|       if (movement.velocityX === 0 && movement.velocityY === 0) {
       |                    ^
    181|         continue;
    182|       }
 â¯ packages/core/src/systems/__tests__/PerformanceOptimizations.integration.test.ts:184:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[459/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/PerformanceOptimizations.integration.test.ts > Performance Optimizations Integration > Acceptance Criterion 3: Cached Collision Data > should MovementSystem invalidate cache on building change events
TypeError: Cannot read properties of undefined (reading 'velocityX')
 â¯ MovementSystem.update packages/core/src/systems/MovementSystem.ts:180:20
    178| 
    179|       // Skip if not moving
    180|       if (movement.velocityX === 0 && movement.velocityY === 0) {
       |                    ^
    181|         continue;
    182|       }
 â¯ packages/core/src/systems/__tests__/PerformanceOptimizations.integration.test.ts:221:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[460/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/RealityAnchorSystem.integration.test.ts > RealityAnchorSystem Integration > should emit reality_anchor:field_collapse when field collapses
AssertionError: expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ]

Received: 



Number of calls: 0

 â¯ packages/core/src/systems/__tests__/RealityAnchorSystem.integration.test.ts:243:22
    241| 
    242|     // Verify field collapse event and gods released
    243|     expect(eventSpy).toHaveBeenCalledWith(
       |                      ^
    244|       expect.objectContaining({
    245|         type: 'reality_anchor:field_collapse',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[461/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/RealityAnchorSystem.integration.test.ts > RealityAnchorSystem Integration > should emit charging_interrupted event when power lost mid-charge
AssertionError: expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ]

Received: 



Number of calls: 0

 â¯ packages/core/src/systems/__tests__/RealityAnchorSystem.integration.test.ts:393:22
    391| 
    392|     // Verify event emitted
    393|     expect(eventSpy).toHaveBeenCalledWith(
       |                      ^
    394|       expect.objectContaining({
    395|         type: 'reality_anchor:charging_interrupted',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[462/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/RealityAnchorSystem.integration.test.ts > RealityAnchorSystem Integration > should handle partial power scenarios correctly
AssertionError: expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ]

Received: 



Number of calls: 0

 â¯ packages/core/src/systems/__tests__/RealityAnchorSystem.integration.test.ts:440:22
    438| 
    439|     // Verify partial power warning emitted
    440|     expect(eventSpy).toHaveBeenCalledWith(
       |                      ^
    441|       expect.objectContaining({
    442|         type: 'reality_anchor:power_insufficient',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[463/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/SteeringSystem.test.ts > SteeringSystem > AC2: Navigation Reaches Targets > should avoid obstacles using ray-casting
Error: SteeringSystem failed for entity f78e658f-8595-42f8-a6f8-8695ec0af961: Error: Steering component missing
 â¯ SteeringSystem.update packages/core/src/systems/SteeringSystem.ts:60:15
     58|       } catch (error) {
     59|         // Per CLAUDE.md, re-throw with context
     60|         throw new Error(`SteeringSystem failed for entity ${entity.id}â€¦
       |               ^
     61|       }
     62|     }
 â¯ packages/core/src/systems/__tests__/SteeringSystem.test.ts:105:16

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[464/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/SteeringSystem.test.ts > SteeringSystem > combined behaviors > should blend seek and obstacle avoidance
Error: SteeringSystem failed for entity 962e937f-5df7-4c01-ad06-5cad74e9a03e: Error: Steering component missing
 â¯ SteeringSystem.update packages/core/src/systems/SteeringSystem.ts:60:15
     58|       } catch (error) {
     59|         // Per CLAUDE.md, re-throw with context
     60|         throw new Error(`SteeringSystem failed for entity ${entity.id}â€¦
       |               ^
     61|       }
     62|     }
 â¯ packages/core/src/systems/__tests__/SteeringSystem.test.ts:297:16

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[465/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/UniversityFullSystem.end-to-end.test.ts > University Research System - Full E2E > should complete full university research flow with technology unlocks
TypeError: Cannot read properties of undefined (reading 'enable')
 â¯ TechnologyUnlockSystem.enableSystemsForTechnology packages/core/src/systems/TechnologyUnlockSystem.ts:293:27
    291|     if (buildingType === 'library' || buildingType === 'university') {
    292|       console.log('[TechnologyUnlock] Enabling Plot & Narrative systemâ€¦
    293|       this.systemRegistry.enable('PlotAssignmentSystem');
       |                           ^
    294|       this.systemRegistry.enable('PlotProgressionSystem');
    295|       this.systemRegistry.enable('NarrativePressureSystem');
 â¯ TechnologyUnlockSystem.unlockBuildingGlobally packages/core/src/systems/TechnologyUnlockSystem.ts:235:10
 â¯ TechnologyUnlockSystem.scanForNewBuildings packages/core/src/systems/TechnologyUnlockSystem.ts:120:14
 â¯ TechnologyUnlockSystem.update packages/core/src/systems/TechnologyUnlockSystem.ts:67:12
 â¯ packages/core/src/systems/__tests__/UniversityFullSystem.end-to-end.test.ts:115:16

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[466/746]âŽ¯

 FAIL  packages/core/src/systems/__tests__/UniversityResearch.integration.test.ts > University Research Integration > Technology unlock integration > should enable university collaboration multiplier (1.5x) when first university built
TypeError: Cannot read properties of undefined (reading 'enable')
 â¯ TechnologyUnlockSystem.enableSystemsForTechnology packages/core/src/systems/TechnologyUnlockSystem.ts:293:27
    291|     if (buildingType === 'library' || buildingType === 'university') {
    292|       console.log('[TechnologyUnlock] Enabling Plot & Narrative systemâ€¦
    293|       this.systemRegistry.enable('PlotAssignmentSystem');
       |                           ^
    294|       this.systemRegistry.enable('PlotProgressionSystem');
    295|       this.systemRegistry.enable('NarrativePressureSystem');
 â¯ TechnologyUnlockSystem.unlockBuildingGlobally packages/core/src/systems/TechnologyUnlockSystem.ts:235:10
 â¯ TechnologyUnlockSystem.scanForNewBuildings packages/core/src/systems/TechnologyUnlockSystem.ts:120:14
 â¯ TechnologyUnlockSystem.update packages/core/src/systems/TechnologyUnlockSystem.ts:67:12
 â¯ packages/core/src/systems/__tests__/UniversityResearch.integration.test.ts:211:18

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[467/746]âŽ¯

 FAIL  packages/world/src/chunks/__tests__/ChunkSerializerEdgeCases.test.ts > ChunkSerializer Edge Cases > Large Terrain Snapshots > should handle many chunks efficiently
AssertionError: expected 1903.0218329999989 to be less than 1000
 â¯ packages/world/src/chunks/__tests__/ChunkSerializerEdgeCases.test.ts:567:29
    565| 
    566|       // Should serialize 100 chunks in reasonable time
    567|       expect(serializeTime).toBeLessThan(1000); // <1 second
       |                             ^
    568| 
    569|       // Deserialize

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[468/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Tree Layout > should position foundation nodes at top
Error: Tree layout requires a tree with at least one node
 â¯ TreeLayoutEngine.calculateLayout packages/renderer/src/panels/magic/TreeLayoutEngine.ts:29:13
     27|   calculateLayout(tree: MagicSkillTree): TreeLayout {
     28|     if (!tree || !tree.nodes || tree.nodes.length === 0) {
     29|       throw new Error('Tree layout requires a tree with at least one nâ€¦
       |             ^
     30|     }
     31| 
 â¯ ParadigmTreeView.calculateLayout packages/renderer/src/panels/magic/ParadigmTreeView.ts:307:38
 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts:35:27

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[469/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Tree Layout > should position mastery nodes at bottom
Error: Tree layout requires a tree with at least one node
 â¯ TreeLayoutEngine.calculateLayout packages/renderer/src/panels/magic/TreeLayoutEngine.ts:29:13
     27|   calculateLayout(tree: MagicSkillTree): TreeLayout {
     28|     if (!tree || !tree.nodes || tree.nodes.length === 0) {
     29|       throw new Error('Tree layout requires a tree with at least one nâ€¦
       |             ^
     30|     }
     31| 
 â¯ ParadigmTreeView.calculateLayout packages/renderer/src/panels/magic/ParadigmTreeView.ts:307:38
 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts:47:27

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[470/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Tree Layout > should spread nodes horizontally within category
Error: Tree layout requires a tree with at least one node
 â¯ TreeLayoutEngine.calculateLayout packages/renderer/src/panels/magic/TreeLayoutEngine.ts:29:13
     27|   calculateLayout(tree: MagicSkillTree): TreeLayout {
     28|     if (!tree || !tree.nodes || tree.nodes.length === 0) {
     29|       throw new Error('Tree layout requires a tree with at least one nâ€¦
       |             ^
     30|     }
     31| 
 â¯ ParadigmTreeView.calculateLayout packages/renderer/src/panels/magic/ParadigmTreeView.ts:307:38
 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts:59:27

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[471/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Tree Layout > should avoid node overlap
Error: Tree layout requires a tree with at least one node
 â¯ TreeLayoutEngine.calculateLayout packages/renderer/src/panels/magic/TreeLayoutEngine.ts:29:13
     27|   calculateLayout(tree: MagicSkillTree): TreeLayout {
     28|     if (!tree || !tree.nodes || tree.nodes.length === 0) {
     29|       throw new Error('Tree layout requires a tree with at least one nâ€¦
       |             ^
     30|     }
     31| 
 â¯ ParadigmTreeView.calculateLayout packages/renderer/src/panels/magic/ParadigmTreeView.ts:307:38
 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts:71:27

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[472/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Tree Layout > should recalculate layout when tree changes
Error: Tree layout requires a tree with at least one node
 â¯ TreeLayoutEngine.calculateLayout packages/renderer/src/panels/magic/TreeLayoutEngine.ts:29:13
     27|   calculateLayout(tree: MagicSkillTree): TreeLayout {
     28|     if (!tree || !tree.nodes || tree.nodes.length === 0) {
     29|       throw new Error('Tree layout requires a tree with at least one nâ€¦
       |             ^
     30|     }
     31| 
 â¯ ParadigmTreeView.calculateLayout packages/renderer/src/panels/magic/ParadigmTreeView.ts:307:38
 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts:92:28

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[473/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Dependency Lines > should draw line from prerequisite to dependent node
Error: ParadigmTreeView.render requires ctx, tree, progress, and evaluationContext
 â¯ ParadigmTreeView.render packages/renderer/src/panels/magic/ParadigmTreeView.ts:70:13
     68|   ): void {
     69|     if (!ctx || !tree || !progress || !evaluationContext) {
     70|       throw new Error('ParadigmTreeView.render requires ctx, tree, proâ€¦
       |             ^
     71|     }
     72| 
 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts:117:12

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[474/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Dependency Lines > should use arrow style for dependency lines
Error: ParadigmTreeView.render requires ctx, tree, progress, and evaluationContext
 â¯ ParadigmTreeView.render packages/renderer/src/panels/magic/ParadigmTreeView.ts:70:13
     68|   ): void {
     69|     if (!ctx || !tree || !progress || !evaluationContext) {
     70|       throw new Error('ParadigmTreeView.render requires ctx, tree, proâ€¦
       |             ^
     71|     }
     72| 
 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts:130:12

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[475/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Dependency Lines > should highlight dependency line when node hovered
Error: ParadigmTreeView.render requires ctx, tree, progress, and evaluationContext
 â¯ ParadigmTreeView.render packages/renderer/src/panels/magic/ParadigmTreeView.ts:70:13
     68|   ): void {
     69|     if (!ctx || !tree || !progress || !evaluationContext) {
     70|       throw new Error('ParadigmTreeView.render requires ctx, tree, proâ€¦
       |             ^
     71|     }
     72| 
 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts:146:12

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[476/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Dependency Lines > should draw dotted line for optional prerequisites
Error: ParadigmTreeView.render requires ctx, tree, progress, and evaluationContext
 â¯ ParadigmTreeView.render packages/renderer/src/panels/magic/ParadigmTreeView.ts:70:13
     68|   ): void {
     69|     if (!ctx || !tree || !progress || !evaluationContext) {
     70|       throw new Error('ParadigmTreeView.render requires ctx, tree, proâ€¦
       |             ^
     71|     }
     72| 
 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts:177:12

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[477/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Node Rendering > should render unlocked nodes with green background
Error: ParadigmTreeView.render requires ctx, tree, progress, and evaluationContext
 â¯ ParadigmTreeView.render packages/renderer/src/panels/magic/ParadigmTreeView.ts:70:13
     68|   ): void {
     69|     if (!ctx || !tree || !progress || !evaluationContext) {
     70|       throw new Error('ParadigmTreeView.render requires ctx, tree, proâ€¦
       |             ^
     71|     }
     72| 
 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts:209:12

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[478/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Node Rendering > should render available nodes with yellow glow
Error: ParadigmTreeView.render requires ctx, tree, progress, and evaluationContext
 â¯ ParadigmTreeView.render packages/renderer/src/panels/magic/ParadigmTreeView.ts:70:13
     68|   ): void {
     69|     if (!ctx || !tree || !progress || !evaluationContext) {
     70|       throw new Error('ParadigmTreeView.render requires ctx, tree, proâ€¦
       |             ^
     71|     }
     72| 
 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts:238:12

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[479/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Node Rendering > should render locked nodes with gray background
Error: ParadigmTreeView.render requires ctx, tree, progress, and evaluationContext
 â¯ ParadigmTreeView.render packages/renderer/src/panels/magic/ParadigmTreeView.ts:70:13
     68|   ): void {
     69|     if (!ctx || !tree || !progress || !evaluationContext) {
     70|       throw new Error('ParadigmTreeView.render requires ctx, tree, proâ€¦
       |             ^
     71|     }
     72| 
 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts:273:12

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[480/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Node Rendering > should render hidden nodes as "???"
Error: ParadigmTreeView.render requires ctx, tree, progress, and evaluationContext
 â¯ ParadigmTreeView.render packages/renderer/src/panels/magic/ParadigmTreeView.ts:70:13
     68|   ): void {
     69|     if (!ctx || !tree || !progress || !evaluationContext) {
     70|       throw new Error('ParadigmTreeView.render requires ctx, tree, proâ€¦
       |             ^
     71|     }
     72| 
 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts:302:12

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[481/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Scroll and Zoom > should offset node positions when scrolled
Error: ParadigmTreeView.render requires ctx, tree, progress, and evaluationContext
 â¯ ParadigmTreeView.render packages/renderer/src/panels/magic/ParadigmTreeView.ts:70:13
     68|   ): void {
     69|     if (!ctx || !tree || !progress || !evaluationContext) {
     70|       throw new Error('ParadigmTreeView.render requires ctx, tree, proâ€¦
       |             ^
     71|     }
     72| 
 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts:322:12

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[482/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Scroll and Zoom > should scale node sizes when zoomed
Error: ParadigmTreeView.render requires ctx, tree, progress, and evaluationContext
 â¯ ParadigmTreeView.render packages/renderer/src/panels/magic/ParadigmTreeView.ts:70:13
     68|   ): void {
     69|     if (!ctx || !tree || !progress || !evaluationContext) {
     70|       throw new Error('ParadigmTreeView.render requires ctx, tree, proâ€¦
       |             ^
     71|     }
     72| 
 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts:339:12

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[483/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Scroll and Zoom > should handle mouse wheel zoom
AssertionError: expected 1 to be greater than 1
 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts:357:30
    355|       view.handleMouseWheel(1); // Zoom in
    356| 
    357|       expect(view.getZoom()).toBeGreaterThan(1.0);
       |                              ^
    358| 
    359|       view.handleMouseWheel(-1); // Zoom out

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[484/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Interaction Handling > should detect click on node
Error: Tree layout requires a tree with at least one node
 â¯ TreeLayoutEngine.calculateLayout packages/renderer/src/panels/magic/TreeLayoutEngine.ts:29:13
     27|   calculateLayout(tree: MagicSkillTree): TreeLayout {
     28|     if (!tree || !tree.nodes || tree.nodes.length === 0) {
     29|       throw new Error('Tree layout requires a tree with at least one nâ€¦
       |             ^
     30|     }
     31| 
 â¯ ParadigmTreeView.calculateLayout packages/renderer/src/panels/magic/ParadigmTreeView.ts:307:38
 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts:384:27

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[485/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Interaction Handling > should detect hover on node
Error: Tree layout requires a tree with at least one node
 â¯ TreeLayoutEngine.calculateLayout packages/renderer/src/panels/magic/TreeLayoutEngine.ts:29:13
     27|   calculateLayout(tree: MagicSkillTree): TreeLayout {
     28|     if (!tree || !tree.nodes || tree.nodes.length === 0) {
     29|       throw new Error('Tree layout requires a tree with at least one nâ€¦
       |             ^
     30|     }
     31| 
 â¯ ParadigmTreeView.calculateLayout packages/renderer/src/panels/magic/ParadigmTreeView.ts:307:38
 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts:403:27

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[486/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Interaction Handling > should clear hover when mouse leaves node
Error: Tree layout requires a tree with at least one node
 â¯ TreeLayoutEngine.calculateLayout packages/renderer/src/panels/magic/TreeLayoutEngine.ts:29:13
     27|   calculateLayout(tree: MagicSkillTree): TreeLayout {
     28|     if (!tree || !tree.nodes || tree.nodes.length === 0) {
     29|       throw new Error('Tree layout requires a tree with at least one nâ€¦
       |             ^
     30|     }
     31| 
 â¯ ParadigmTreeView.calculateLayout packages/renderer/src/panels/magic/ParadigmTreeView.ts:307:38
 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts:414:27

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[487/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Error Handling > should throw when tree is null
AssertionError: expected [Function] to throw an error

- Expected: 
null

+ Received: 
undefined

 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts:433:10
    431|       expect(() => {
    432|         new ParadigmTreeView(null);
    433|       }).toThrow('Tree is required');
       |          ^
    434|     });
    435| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[488/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Error Handling > should throw when rendering without evaluation results
AssertionError: expected [Function] to throw error including 'Evaluation results not set' but got 'ParadigmTreeView.render requires ctx,â€¦'

- Expected
+ Received

- Evaluation results not set
+ ParadigmTreeView.render requires ctx, tree, progress, and evaluationContext

 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts:443:10
    441|       expect(() => {
    442|         view.render(ctx, 0, 0, 800, 600, mockEvaluationContext);
    443|       }).toThrow('Evaluation results not set');
       |          ^
    444|     });
    445| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[489/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts > ParadigmTreeView > Error Handling > should throw when node layout fails
AssertionError: expected [Function] to throw an error

- Expected: 
null

+ Received: 
undefined

 â¯ packages/renderer/src/panels/magic/__tests__/ParadigmTreeView.test.ts:456:10
    454|       expect(() => {
    455|         new ParadigmTreeView(badTree);
    456|       }).toThrow('Duplicate node ID');
       |          ^
    457|     });
    458|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[490/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillNodeRenderer.test.ts > SkillNodeRenderer > Node State Rendering > should render unlocked node with green background
AssertionError: expected '#ffffff' to match /green|#0f0|#00ff00/i

- Expected: 
/green|#0f0|#00ff00/i

+ Received: 
"#ffffff"

 â¯ packages/renderer/src/panels/magic/__tests__/SkillNodeRenderer.test.ts:42:29
     40| 
     41|       // Check for green fill (property assignment, not function call)
     42|       expect(ctx.fillStyle).toMatch(/green|#0f0|#00ff00/i);
       |                             ^
     43|     });
     44| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[491/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillNodeRenderer.test.ts > SkillNodeRenderer > Node State Rendering > should render locked node with gray background
AssertionError: expected '#ffffff' to match /gray|#888|#999/i

- Expected: 
/gray|#888|#999/i

+ Received: 
"#ffffff"

 â¯ packages/renderer/src/panels/magic/__tests__/SkillNodeRenderer.test.ts:71:29
     69| 
     70|       // Check for gray fill - property assignment, not function call
     71|       expect(ctx.fillStyle).toMatch(/gray|#888|#999/i);
       |                             ^
     72|     });
     73| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[492/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillNodeRenderer.test.ts > SkillNodeRenderer > Node State Rendering > should add pulsing animation to available nodes
AssertionError: expected 1 not to be 1 // Object.is equality
 â¯ packages/renderer/src/panels/magic/__tests__/SkillNodeRenderer.test.ts:104:26
    102| 
    103|       // Alpha should change over time (pulsing)
    104|       expect(alpha1).not.toBe(alpha2);
       |                          ^
    105|     });
    106|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[493/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillNodeRenderer.test.ts > SkillNodeRenderer > Node Content > should truncate long node names
AssertionError: expected undefined not to be undefined
 â¯ packages/renderer/src/panels/magic/__tests__/SkillNodeRenderer.test.ts:209:24
    207|         typeof call[0] === 'string' && call[0].includes('...')
    208|       );
    209|       expect(nameCall).toBeDefined();
       |                        ^
    210|     });
    211|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[494/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillNodeRenderer.test.ts > SkillNodeRenderer > Hover State > should highlight node border when hovered
TypeError: '#ffffff' is not a spy or a call to a spy!
 â¯ packages/renderer/src/panels/magic/__tests__/SkillNodeRenderer.test.ts:226:31
    224| 
    225|       // Check for highlighted stroke
    226|       expect(ctx.strokeStyle).toHaveBeenCalled();
       |                               ^
    227|       expect(ctx.lineWidth).toBeGreaterThanOrEqual(2);
    228|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[495/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillNodeRenderer.test.ts > SkillNodeRenderer > Category-Specific Rendering > should render forbidden nodes with red tint
AssertionError: expected '#ffffff' to match /red|#f00|#ff0000/i

- Expected: 
/red|#f00|#ff0000/i

+ Received: 
"#ffffff"

 â¯ packages/renderer/src/panels/magic/__tests__/SkillNodeRenderer.test.ts:287:29
    285| 
    286|       // Check for red color overlay - property assignment, not functiâ€¦
    287|       expect(ctx.fillStyle).toMatch(/red|#f00|#ff0000/i);
       |                             ^
    288|     });
    289|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[496/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.integration.test.ts > SkillTreePanel Backend Integration > Node unlocking via backend > should unlock node through SkillTreeManager and emit event
 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.integration.test.ts > SkillTreePanel Backend Integration > Node unlocking via backend > should handle spell unlock when unlocking skill tree node
 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.integration.test.ts > SkillTreePanel Backend Integration > XP accumulation and availability > should track XP changes from backend
 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.integration.test.ts > SkillTreePanel Backend Integration > XP accumulation and availability > should reflect XP deduction after unlock
 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.integration.test.ts > SkillTreePanel Backend Integration > Multi-paradigm handling > should handle multiple paradigms with independent XP pools
 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.integration.test.ts > SkillTreePanel Backend Integration > Prerequisite chain unlocking > should enforce prerequisites across multiple unlocks
 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.integration.test.ts > SkillTreePanel Backend Integration > Event-driven UI updates > should respond to magic:skill_node_unlocked events from backend
 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.integration.test.ts > SkillTreePanel Backend Integration > Edge cases > should handle entity with no magic component gracefully
 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.integration.test.ts > SkillTreePanel Backend Integration > Edge cases > should handle paradigm with no registered tree
 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.integration.test.ts > SkillTreePanel Backend Integration > Edge cases > should handle unlocking with exact XP amount
TypeError: Cannot read properties of undefined (reading 'resetInstance')
 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.integration.test.ts:49:28
     47|     world = new WorldImpl(eventBus);
     48| 
     49|     MagicSkillTreeRegistry.resetInstance();
       |                            ^
     50|     registry = MagicSkillTreeRegistry.getInstance();
     51| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[497/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 1: Tree Visualization > should draw dependency lines between nodes
AssertionError: expected "spy" to be called at least once
 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:111:29
    109| 
    110|       // Verify lines drawn between prerequisite nodes
    111|       expect(ctx.beginPath).toHaveBeenCalled();
       |                             ^
    112|       expect(ctx.moveTo).toHaveBeenCalled();
    113|       expect(ctx.lineTo).toHaveBeenCalled();

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[498/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 1: Tree Visualization > should display XP available for current paradigm
AssertionError: expected undefined not to be undefined
 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:133:22
    131|         call[0].includes('450')
    132|       );
    133|       expect(xpText).toBeDefined();
       |                      ^
    134|     });
    135|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[499/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 2: Node States > should display unlocked nodes with green background
AssertionError: expected 0 to be greater than 0
 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:158:33
    156|         call.includes('#0f0') || call.includes('green')
    157|       );
    158|       expect(greenFills.length).toBeGreaterThan(0);
       |                                 ^
    159|     });
    160| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[500/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 2: Node States > should display available nodes with yellow glow
AssertionError: expected 0 to be greater than 0
 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:178:36
    176|         call.includes('yellow') || call.includes('#ff0')
    177|       );
    178|       expect(yellowStrokes.length).toBeGreaterThan(0);
       |                                    ^
    179|     });
    180| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[501/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 2: Node States > should display locked nodes with gray background
AssertionError: expected 0 to be greater than 0
 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:198:32
    196|         call.includes('gray') || call.includes('#888')
    197|       );
    198|       expect(grayFills.length).toBeGreaterThan(0);
       |                                ^
    199|     });
    200| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[502/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 2: Node States > should display hidden nodes as "???"
AssertionError: expected undefined not to be undefined
 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:217:30
    215|         call[0] === '???'
    216|       );
    217|       expect(hiddenNodeText).toBeDefined();
       |                              ^
    218|     });
    219|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[503/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 3: Unlock Conditions Display > should show all unlock conditions on node hover
AssertionError: expected undefined not to be undefined
 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:244:29
    242|         call[0].includes('Requirements:')
    243|       );
    244|       expect(conditionText).toBeDefined();
       |                             ^
    245|     });
    246| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[504/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 3: Unlock Conditions Display > should display met conditions with checkmark icon
AssertionError: expected 0 to be greater than 0
 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:265:33
    263|         call[0].includes('âœ“') || call[0].includes('âœ…')
    264|       );
    265|       expect(checkmarks.length).toBeGreaterThan(0);
       |                                 ^
    266|     });
    267| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[505/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 3: Unlock Conditions Display > should display unmet conditions with X icon
AssertionError: expected 0 to be greater than 0
 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:286:29
    284|         call[0].includes('âœ—') || call[0].includes('âŒ')
    285|       );
    286|       expect(xMarks.length).toBeGreaterThan(0);
       |                             ^
    287|     });
    288| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[506/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 3: Unlock Conditions Display > should display XP cost prominently
AssertionError: expected undefined not to be undefined
 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:305:24
    303|         call[0].includes('Cost:') && call[0].includes('XP')
    304|       );
    305|       expect(costText).toBeDefined();
       |                        ^
    306|     });
    307|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[507/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 4: Node Unlocking > should unlock node when player clicks available node
AssertionError: expected "spy" to be called with arguments: [ â€¦(4) ]

Received: 



Number of calls: 0

 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:328:63
    326| 
    327|       // Verify unlock method called on SkillTreeManager
    328|       expect(mockWorld.getSkillTreeManager().unlockSkillNode).toHaveBeâ€¦
       |                                                               ^
    329|         entity,
    330|         'shinto',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[508/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 4: Node Unlocking > should deduct XP when node unlocked
AssertionError: expected 500 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 500

 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:352:55
    350|       // Verify XP deducted
    351|       const magicComponent = entity.getComponent('magic');
    352|       expect(magicComponent.skillTreeState.shinto.xp).toBe(initialXP -â€¦
       |                                                       ^
    353|     });
    354| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[509/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 4: Node Unlocking > should emit magic:skill_node_unlocked event
AssertionError: expected "spy" to be called with arguments: [ 'magic:skill_node_unlocked', â€¦(1) ]

Received: 



Number of calls: 0

 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:368:27
    366|       panel.handleClick(150, 200, mockWorld);
    367| 
    368|       expect(eventBusSpy).toHaveBeenCalledWith('magic:skill_node_unlocâ€¦
       |                           ^
    369|         entityId: entity.id,
    370|         paradigmId: 'shinto',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[510/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 4: Node Unlocking > should update UI immediately after unlock
AssertionError: expected 0 to be greater than 0
 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:424:33
    422|         call.includes('green')
    423|       );
    424|       expect(greenFills.length).toBeGreaterThan(0);
       |                                 ^
    425|     });
    426|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[511/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 5: Multi-Paradigm Support > should show independent XP pools for each paradigm
AssertionError: expected undefined not to be undefined
 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:448:24
    446|       panel.render(ctx, 0, 0, 800, 600, mockWorld);
    447|       const shintoXP = ctx.fillText.mock.calls.find((call: any[]) => câ€¦
    448|       expect(shintoXP).toBeDefined();
       |                        ^
    449| 
    450|       // Render Allomancy tab

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[512/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 5: Multi-Paradigm Support > should switch paradigm when tab clicked
AssertionError: expected null to be 'allomancy' // Object.is equality

- Expected: 
"allomancy"

+ Received: 
null

 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:469:41
    467|       panel.handleClick(100, 30, mockWorld);
    468| 
    469|       expect(panel.getActiveParadigm()).toBe('allomancy');
       |                                         ^
    470|     });
    471| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[513/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 5: Multi-Paradigm Support > should not allow XP cross-contamination between paradigms
AssertionError: expected 500 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 500

 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:512:55
    510| 
    511|       // Verify only Shinto XP deducted
    512|       expect(magicComponent.skillTreeState.shinto.xp).toBe(400);
       |                                                       ^
    513|       expect(magicComponent.skillTreeState.allomancy.xp).toBe(200); //â€¦
    514|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[514/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 6: Discovery Mechanics > should reveal hidden node when prerequisite met
AssertionError: expected undefined not to be undefined
 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:544:32
    542|         call[0].includes('River Kami')
    543|       );
    544|       expect(revealedNodeText).toBeDefined();
       |                                ^
    545|     });
    546| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[515/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 6: Discovery Mechanics > should show notification when hidden node reveals
AssertionError: expected "spy" to be called with arguments: [ 'ui:notification', { â€¦(2) } ]

Received: 



Number of calls: 0

 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:565:27
    563| 
    564|       // Verify notification event
    565|       expect(eventBusSpy).toHaveBeenCalledWith('ui:notification', {
       |                           ^
    566|         message: expect.stringContaining('New ability discovered'),
    567|         type: 'discovery'

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[516/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 6: Discovery Mechanics > should display tooltip explaining what unlocked hidden node
AssertionError: expected undefined not to be undefined
 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:588:27
    586|         call[0].includes('Unlocked by:') && call[0].includes('river kaâ€¦
    587|       );
    588|       expect(explanation).toBeDefined();
       |                           ^
    589|     });
    590|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[517/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 7: Keyboard Navigation > should navigate nodes with arrow keys
AssertionError: expected null not to be null // Object.is equality
 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:612:45
    610|       const firstNode = panel.getSelectedNodeId();
    611|       panel.handleKeyDown('ArrowRight', mockWorld);
    612|       expect(panel.getSelectedNodeId()).not.toBe(firstNode);
       |                                             ^
    613|     });
    614| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[518/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 7: Keyboard Navigation > should unlock selected node with Enter key
AssertionError: expected "spy" to be called at least once
 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:630:63
    628| 
    629|       // Verify unlock called
    630|       expect(mockWorld.getSkillTreeManager().unlockSkillNode).toHaveBeâ€¦
       |                                                               ^
    631|     });
    632| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[519/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Criterion 7: Keyboard Navigation > should close panel with Escape key
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:658:33
    656|       panel.handleKeyDown('Escape', mockWorld);
    657| 
    658|       expect(panel.isVisible()).toBe(false);
       |                                 ^
    659|     });
    660|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[520/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Edge Cases > should hide tabs when agent has only one paradigm
AssertionError: expected 1 to be +0 // Object.is equality

- Expected
+ Received

- 0
+ 1

 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:699:30
    697|         call[2] < 50 // Tab bar is at top
    698|       );
    699|       expect(tabText.length).toBe(0); // No tabs needed
       |                              ^
    700|     });
    701| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[521/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Edge Cases > should handle scrollable tab bar when agent has 10+ paradigms
AssertionError: expected 0 to be greater than 0
 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:716:35
    714|         call[0] === '<' || call[0] === '>'
    715|       );
    716|       expect(scrollArrows.length).toBeGreaterThan(0);
       |                                   ^
    717|     });
    718| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[522/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Edge Cases > should handle node with 10+ unlock conditions via scrollable tooltip
AssertionError: expected undefined not to be undefined
 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:754:26
    752|         call[0].includes('more...') || call[0].includes('â†“')
    753|       );
    754|       expect(scrollHint).toBeDefined();
       |                          ^
    755|     });
    756|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[523/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Error Handling > should throw when required entity is missing
AssertionError: expected [Function] to throw an error

- Expected: 
null

+ Received: 
undefined

 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:768:10
    766|       expect(() => {
    767|         panel.render(createMockCanvasContext(), 0, 0, 800, 600, mockWoâ€¦
    768|       }).toThrow('No entity selected');
       |          ^
    769|     });
    770| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[524/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Error Handling > should throw when paradigm tree not found
AssertionError: expected [Function] to throw an error

- Expected: 
null

+ Received: 
undefined

 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:781:10
    779|       expect(() => {
    780|         panel.render(createMockCanvasContext(), 0, 0, 800, 600, mockWoâ€¦
    781|       }).toThrow('Skill tree not found for paradigm: nonexistent_paradâ€¦
       |          ^
    782|     });
    783| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[525/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts > SkillTreePanel > Error Handling > should throw when magic component missing on magic entity
AssertionError: expected [Function] to throw an error

- Expected: 
null

+ Received: 
undefined

 â¯ packages/renderer/src/panels/magic/__tests__/SkillTreePanel.test.ts:792:10
    790|       expect(() => {
    791|         panel.render(createMockCanvasContext(), 0, 0, 800, 600, mockWoâ€¦
    792|       }).toThrow('Entity missing magic component');
       |          ^
    793|     });
    794|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[526/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Unlock Flow Integration > should complete full unlock flow when player clicks available node
AssertionError: expected 0 to be greater than 0
 â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts:59:38
     57|         call.includes('yellow')
     58|       );
     59|       expect(yellowGlowCalls.length).toBeGreaterThan(0);
       |                                      ^
     60| 
     61|       // Step 2: Click on available node

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[527/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Unlock Flow Integration > should apply node effects when unlocked
AssertionError: expected "spy" to be called with arguments: [ â€¦(3) ]

Received: 



Number of calls: 0

 â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts:105:49
    103|       // Verify effects applied
    104|       const skillTreeManager = mockWorld.getSkillTreeManager();
    105|       expect(skillTreeManager.applyNodeEffects).toHaveBeenCalledWith(
       |                                                 ^
    106|         entity,
    107|         'shinto',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[528/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Unlock Flow Integration > should show error notification when unlock fails
AssertionError: expected "spy" to be called with arguments: [ 'ui:notification', { â€¦(2) } ]

Received: 



Number of calls: 0

 â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts:168:33
    166| 
    167|       // Verify error notification
    168|       expect(mockEventBus.emit).toHaveBeenCalledWith('ui:notification'â€¦
       |                                 ^
    169|         message: expect.stringContaining('Insufficient XP'),
    170|         type: 'error'

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[529/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Backend Sync Integration > should update UI when backend unlocks node
AssertionError: expected 0 to be greater than 0
 â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts:214:33
    212|         call.includes('green')
    213|       );
    214|       expect(greenFills.length).toBeGreaterThan(0);
       |                                 ^
    215|     });
    216| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[530/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Backend Sync Integration > should listen to magic:skill_node_unlocked events
AssertionError: expected "spy" to be called with arguments: [ 'magic:skill_node_unlocked', â€¦(1) ]

Received: 



Number of calls: 0

 â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts:221:31
    219| 
    220|       // Verify event listener registered
    221|       expect(mockEventBus.on).toHaveBeenCalledWith(
       |                               ^
    222|         'magic:skill_node_unlocked',
    223|         expect.any(Function)

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[531/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Backend Sync Integration > should refresh UI when receiving backend unlock event
AssertionError: expected "refresh" to be called at least once
 â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts:249:26
    247| 
    248|       // Verify refresh called
    249|       expect(refreshSpy).toHaveBeenCalled();
       |                          ^
    250|     });
    251|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[532/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > XP Gain Integration > should update XP counter when XP gained
AssertionError: expected undefined not to be undefined
 â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts:274:29
    272|         call[0].includes('450')
    273|       );
    274|       expect(initialXPText).toBeDefined();
       |                             ^
    275| 
    276|       // Gain XP

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[533/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > XP Gain Integration > should highlight newly available nodes after XP gain
AssertionError: expected 0 to be greater than 0
 â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts:324:34
    322|         call.includes('yellow')
    323|       );
    324|       expect(yellowGlows.length).toBeGreaterThan(0);
       |                                  ^
    325|     });
    326|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[534/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Discovery Integration > should reveal hidden node when discovery condition met
AssertionError: expected 0 to be greater than 0
 â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts:350:35
    348|         call[0] === '???'
    349|       );
    350|       expect(hiddenNodes1.length).toBeGreaterThan(0);
       |                                   ^
    351| 
    352|       // Meet discovery condition (encounter kami)

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[535/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Discovery Integration > should show discovery notification when hidden node reveals
AssertionError: expected "spy" to be called with arguments: [ 'ui:notification', { â€¦(2) } ]

Received: 



Number of calls: 0

 â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts:390:33
    388| 
    389|       // Verify notification
    390|       expect(mockEventBus.emit).toHaveBeenCalledWith('ui:notification'â€¦
       |                                 ^
    391|         message: expect.stringContaining('New ability discovered'),
    392|         type: 'discovery'

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[536/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Discovery Integration > should track which nodes were recently discovered
AssertionError: expected [] to include 'shinto_river_blessing'
 â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts:414:33
    412|       // Verify recently discovered nodes tracked
    413|       const recentDiscoveries = panel.getRecentDiscoveries();
    414|       expect(recentDiscoveries).toContain('shinto_river_blessing');
       |                                 ^
    415|     });
    416|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[537/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Multi-Paradigm XP Isolation > should not affect other paradigms XP when unlocking node
AssertionError: expected 500 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 500

 â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts:442:55
    440| 
    441|       // Verify only Shinto XP deducted
    442|       expect(magicComponent.skillTreeState.shinto.xp).toBe(400); // 50â€¦
       |                                                       ^
    443|       expect(magicComponent.skillTreeState.allomancy.xp).toBe(300); //â€¦
    444|       expect(magicComponent.skillTreeState.sympathy.xp).toBe(200); // â€¦

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[538/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Multi-Paradigm XP Isolation > should maintain separate unlocked nodes per paradigm
AssertionError: expected [] to not deeply equal []

Compared values have no visual difference.

 â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts:467:70
    465| 
    466|       // Verify nodes tracked separately
    467|       expect(magicComponent.skillTreeState.shinto.unlockedNodes).not.tâ€¦
       |                                                                      ^
    468|         magicComponent.skillTreeState.allomancy.unlockedNodes
    469|       );

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[539/746]âŽ¯

 FAIL  packages/renderer/src/panels/magic/__tests__/integration.test.ts > Integration: Magic Skill Tree UI > Error Recovery > should show error notification if unlock fails
AssertionError: expected "spy" to be called with arguments: [ 'ui:notification', { â€¦(2) } ]

Received: 



Number of calls: 0

 â¯ packages/renderer/src/panels/magic/__tests__/integration.test.ts:516:33
    514| 
    515|       // Verify error shown
    516|       expect(mockEventBus.emit).toHaveBeenCalledWith('ui:notification'â€¦
       |                                 ^
    517|         message: expect.stringContaining('error'),
    518|         type: 'error'

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[540/746]âŽ¯

 Test Files  115 failed | 251 passed | 19 skipped (385)
      Tests  708 failed | 8755 passed | 492 skipped (9955)
   Start at  03:16:31
   Duration  53.63s (transform 16.16s, setup 481.61s, collect 19.23s, tests 38.31s, environment 148.85s, prepare 20.27s)

