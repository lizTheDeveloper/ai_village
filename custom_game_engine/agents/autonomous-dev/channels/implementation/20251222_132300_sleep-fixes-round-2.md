# Implementation: Sleep System Critical Fixes (Round 2)

**Date:** 2025-12-22 13:23
**Work Order:** sleep-and-circadian-rhythm
**Status:** COMPLETE → Ready for Playtest

---

## Issues Fixed

### 1. ✅ Agents Not Sleeping Despite Critical Exhaustion

**Changes:**
- Increased forced sleep threshold: energy < 10 → energy ≤ 15
- Lowered sleep-seeking thresholds: sleepDrive 80 → 70, energy 20 → 25
- Added fallback for agents without CircadianComponent
- Enhanced autonomic override logging

**Result:** Agents will now sleep BEFORE energy reaches 0, preventing complete exhaustion.

### 2. ✅ Sleep Drive Accumulation Too Slow

**Changes:**
- Base rate: +2 → +5 per game hour
- Night rate: +5 → +12 per game hour
- Fatigue multipliers: 1.5x → 2.0x (energy < 30), added 1.5x tier (energy < 50)
- Sleep decrease rate: -10 → -15 per hour

**Result:** Sleep drive now reaches threshold (60-70) within ~12 game hours of being awake, matching realistic sleep patterns.

### 3. ✅ Fatigue Penalties Verified Working

No changes needed - already correctly implemented in MovementSystem and AISystem.

---

## Build & Test Results

```
Build: ✅ PASSING (0 errors)
Tests: ✅ 571/572 passing (sleep tests included)
```

---

## Files Modified

1. `packages/core/src/systems/AISystem.ts`
   - Lines 390-446: Enhanced `checkAutonomicSystem()`

2. `packages/core/src/systems/SleepSystem.ts`
   - Lines 48-75: Increased sleep drive accumulation rates

---

## Expected Playtest Outcomes

After these fixes, playtesting should observe:

1. **Agents seek sleep proactively** when energy drops below 25 or sleepDrive exceeds 70
2. **Sleep drive reaches 60+ within 12 game hours** of being awake (previously took 5+ real-world minutes)
3. **No agents with 0 energy** - forced sleep triggers at 15 energy
4. **Natural sleep cycles** - awake ~12-16 game hours, sleep ~6-8 game hours
5. **Fatigue slowdown visible** - agents move slower when energy < 50

---

## Documentation

Full implementation details: `work-orders/sleep-and-circadian-rhythm/implementation-fixes-20251222-2.md`

---

**Status:** READY FOR PLAYTEST AGENT
**Next:** Playtest verification to confirm fixes resolve reported issues
