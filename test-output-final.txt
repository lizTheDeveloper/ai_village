
> @ai-village/game-engine@0.1.0 test
> vitest run


 RUN  v1.6.1 /Users/annhoward/src/ai_village/custom_game_engine

 ✓ packages/core/src/metrics/events/__tests__/MetricEvents.test.ts  (26 tests) 4ms
 ✓ packages/core/src/buildings/__tests__/PlacementValidator.test.ts  (22 tests) 8ms
 ✓ packages/core/src/buildings/__tests__/CraftingStations.test.ts  (30 tests) 9ms
 ✓ packages/core/src/buildings/__tests__/BuildingDefinitions.test.ts  (44 tests) 11ms
 ✓ packages/core/src/__tests__/AnimalHousing.test.ts  (27 tests | 5 skipped) 7ms
stdout | packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Construction Progress Advancement > should clamp progress to 100% maximum
[BuildingSystem] Construction complete! tent at (0, 0)

stdout | packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Construction Completion > should mark building as complete when progress reaches 100%
[BuildingSystem] Construction complete! tent at (0, 0)

stdout | packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Construction Completion > should emit "building:complete" event on completion
[BuildingSystem] Construction complete! tent at (16, 32)

stdout | packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Construction Completion > should emit event with correct entity ID and building type
[BuildingSystem] Construction complete! campfire at (0, 0)

stdout | packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Construction Completion > should only emit event once when crossing 100% threshold
[BuildingSystem] Construction complete! tent at (0, 0)

stdout | packages/core/src/systems/__tests__/ConstructionProgress.test.ts > Construction Progress System - Phase 7 > Edge Cases > should handle progress from 99% to 101% (clamped to 100%)
[BuildingSystem] Construction complete! tent at (0, 0)

 ✓ packages/core/src/systems/__tests__/ConstructionProgress.test.ts  (27 tests) 12ms
 ✓ packages/core/src/__tests__/AnimalHousingCleanliness.test.ts  (24 tests) 24ms
 ✓ packages/core/src/__tests__/AnimalHousingIntegration.test.ts  (14 tests | 1 skipped) 4ms
 ✓ packages/core/src/__tests__/TamingSystem.test.ts  (17 tests) 9ms
 ✓ packages/core/src/__tests__/AnimalSystem.test.ts  (18 tests) 12ms
 ✓ packages/core/src/buildings/__tests__/BuildingBlueprintRegistry.test.ts  (16 tests) 6ms
 ✓ packages/core/src/systems/__tests__/Phase9-SoilWeatherIntegration.test.ts  (39 tests) 7ms
 ✓ packages/core/src/__tests__/AnimalProduction.test.ts  (15 tests) 14ms
 ✓ packages/core/src/systems/__tests__/ResourceGathering.test.ts  (37 tests) 21ms
 ✓ packages/core/src/buildings/__tests__/BuildingPlacement.integration.test.ts  (14 tests) 8ms
stdout | packages/llm/src/__tests__/OllamaProvider.test.ts > OllamaProvider > Tool Definition > should define all 12 action tools
[OllamaProvider] Response: {
  model: 'qwen3:4b',
  action: 'wander',
  thinking: 'test...',
  speaking: '(silent)',
  tokensUsed: undefined
}

stdout | packages/llm/src/__tests__/OllamaProvider.test.ts > OllamaProvider > Tool Definition > should define tools with no parameters
[OllamaProvider] Response: {
  model: 'qwen3:4b',
  action: '(no action)',
  thinking: '(no thoughts)',
  speaking: '(silent)',
  tokensUsed: undefined
}
[OllamaProvider] No tool call, using text fallback

stderr | packages/llm/src/__tests__/OllamaProvider.test.ts > OllamaProvider > Tool Definition > should define tools with no parameters
[OllamaProvider] Empty response from Ollama: { message: { content: '', tool_calls: [] } }

stdout | packages/llm/src/__tests__/OllamaProvider.test.ts > OllamaProvider > Response Parsing > should parse structured response with tool call
[OllamaProvider] Response: {
  model: 'qwen3:4b',
  action: 'explore',
  thinking: 'I should explore...',
  speaking: 'Let me look around!',
  tokensUsed: 150
}

stdout | packages/llm/src/__tests__/OllamaProvider.test.ts > OllamaProvider > Response Parsing > should handle empty thinking field
[OllamaProvider] Response: {
  model: 'qwen3:4b',
  action: 'rest',
  thinking: '(no thoughts)',
  speaking: 'Time to rest',
  tokensUsed: undefined
}

stdout | packages/llm/src/__tests__/OllamaProvider.test.ts > OllamaProvider > Response Parsing > should handle empty speaking (silent action)
[OllamaProvider] Response: {
  model: 'qwen3:4b',
  action: 'wander',
  thinking: 'Just going to wander...',
  speaking: '(silent)',
  tokensUsed: undefined
}

stdout | packages/llm/src/__tests__/OllamaProvider.test.ts > OllamaProvider > Response Parsing > should fall back to text when no tool call
[OllamaProvider] Response: {
  model: 'qwen3:4b',
  action: '(no action)',
  thinking: '(no thoughts)',
  speaking: 'I will explore the area',
  tokensUsed: undefined
}
[OllamaProvider] No tool call, using text fallback

stdout | packages/llm/src/__tests__/OllamaProvider.test.ts > OllamaProvider > API Configuration > should use /api/chat endpoint
[OllamaProvider] Response: {
  model: 'qwen3:4b',
  action: '(no action)',
  thinking: '(no thoughts)',
  speaking: '(silent)',
  tokensUsed: undefined
}
[OllamaProvider] No tool call, using text fallback

stderr | packages/llm/src/__tests__/OllamaProvider.test.ts > OllamaProvider > API Configuration > should use /api/chat endpoint
[OllamaProvider] Empty response from Ollama: { message: { content: '', tool_calls: [] } }

stdout | packages/llm/src/__tests__/OllamaProvider.test.ts > OllamaProvider > API Configuration > should send correct request format
[OllamaProvider] Response: {
  model: 'qwen3:4b',
  action: '(no action)',
  thinking: '(no thoughts)',
  speaking: '(silent)',
  tokensUsed: undefined
}
[OllamaProvider] No tool call, using text fallback

stderr | packages/llm/src/__tests__/OllamaProvider.test.ts > OllamaProvider > API Configuration > should send correct request format
[OllamaProvider] Empty response from Ollama: { message: { content: '', tool_calls: [] } }

stdout | packages/llm/src/__tests__/OllamaProvider.test.ts > OllamaProvider > API Configuration > should use default values when not specified
[OllamaProvider] Response: {
  model: 'qwen3:4b',
  action: '(no action)',
  thinking: '(no thoughts)',
  speaking: '(silent)',
  tokensUsed: undefined
}
[OllamaProvider] No tool call, using text fallback

stderr | packages/llm/src/__tests__/OllamaProvider.test.ts > OllamaProvider > API Configuration > should use default values when not specified
[OllamaProvider] Empty response from Ollama: { message: { content: '', tool_calls: [] } }

stderr | packages/llm/src/__tests__/OllamaProvider.test.ts > OllamaProvider > Error Handling > should throw on HTTP error
[OllamaProvider] Ollama generate error: Error: Ollama API error: 500 Internal Server Error
    at OllamaProvider.generate (/Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/OllamaProvider.ts:135:15)
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/OllamaProvider.test.ts:255:7
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:11)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runFiles (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:958:5)
    at startTests (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:967:3)
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7
    at withEnv (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:83:5)
[OllamaProvider] Error details: {
  message: 'Ollama API error: 500 Internal Server Error',
  model: 'qwen3:4b',
  url: 'http://localhost:11434/api/generate'
}

stderr | packages/llm/src/__tests__/OllamaProvider.test.ts > OllamaProvider > Error Handling > should throw on network error
[OllamaProvider] Ollama generate error: Error: Network error
    at /Users/annhoward/src/ai_village/custom_game_engine/packages/llm/src/__tests__/OllamaProvider.test.ts:260:51
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:909:15)
    at runFiles (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:958:5)
    at startTests (file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/@vitest/runner/dist/index.js:967:3)
    at file:///Users/annhoward/src/ai_village/custom_game_engine/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7
[OllamaProvider] Error details: {
  message: 'Network error',
  model: 'qwen3:4b',
  url: 'http://localhost:11434/api/generate'
}

stdout | packages/llm/src/__tests__/OllamaProvider.test.ts > OllamaProvider > Error Handling > should log empty responses
[OllamaProvider] Response: {
  model: 'qwen3:4b',
  action: '(no action)',
  thinking: '(no thoughts)',
  speaking: '(silent)',
  tokensUsed: undefined
}
[OllamaProvider] No tool call, using text fallback

 ✓ packages/llm/src/__tests__/OllamaProvider.test.ts  (15 tests) 37ms
 ✓ packages/core/src/systems/__tests__/StorageDeposit.test.ts  (14 tests) 9ms
 ✓ packages/core/src/__tests__/WildAnimalSpawning.test.ts  (19 tests) 9ms
stdout | packages/core/src/systems/__tests__/Phase8-WeatherTemperature.test.ts > Phase 8: Weather & Temperature Systems > WeatherSystem > should update weather duration over time
[WeatherSystem] Weather changed: clear → clear (intensity: 0%). Temp modifier: 0.0°C, Movement modifier: 100%

 ✓ packages/core/src/systems/__tests__/Phase8-WeatherTemperature.test.ts  (19 tests) 8ms
 ✓ packages/core/src/components/__tests__/BuildingComponent.test.ts  (35 tests) 8ms
 ✓ packages/core/src/systems/__tests__/FertilizerAction.test.ts  (26 tests) 6ms
 ❯ packages/renderer/src/__tests__/ContainerPanel.test.ts  (0 test)
stdout | packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > buildPrompt > should build complete prompt with all sections
[StructuredPromptBuilder] Vision state: {
  seenResources: [],
  seenResourcesCount: 0,
  seenAgents: [],
  seenAgentsCount: 0,
  canSeeResources: undefined
}

stdout | packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > buildPrompt > should include personality traits in prompt
[StructuredPromptBuilder] Vision state: {
  seenResources: [],
  seenResourcesCount: 0,
  seenAgents: [],
  seenAgentsCount: 0,
  canSeeResources: undefined
}

stdout | packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > buildPrompt > should describe hunger levels correctly
[StructuredPromptBuilder] Vision state: {
  seenResources: [],
  seenResourcesCount: 0,
  seenAgents: [],
  seenAgentsCount: 0,
  canSeeResources: undefined
}
[StructuredPromptBuilder] Vision state: {
  seenResources: [],
  seenResourcesCount: 0,
  seenAgents: [],
  seenAgentsCount: 0,
  canSeeResources: undefined
}

stdout | packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > buildPrompt > should describe energy levels correctly
[StructuredPromptBuilder] Vision state: {
  seenResources: [],
  seenResourcesCount: 0,
  seenAgents: [],
  seenAgentsCount: 0,
  canSeeResources: undefined
}
[StructuredPromptBuilder] Vision state: {
  seenResources: [],
  seenResourcesCount: 0,
  seenAgents: [],
  seenAgentsCount: 0,
  canSeeResources: undefined
}

stdout | packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > context collapse > should not show empty memories section
[StructuredPromptBuilder] Vision state: {
  seenResources: [],
  seenResourcesCount: 0,
  seenAgents: [],
  seenAgentsCount: 0,
  canSeeResources: undefined
}

stdout | packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > context collapse > should show memories when present
[StructuredPromptBuilder] Vision state: {
  seenResources: [],
  seenResourcesCount: 0,
  seenAgents: [],
  seenAgentsCount: 0,
  canSeeResources: undefined
}

stdout | packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > context collapse > should show empty area when nothing nearby
[StructuredPromptBuilder] Vision state: {
  seenResources: [],
  seenResourcesCount: 0,
  seenAgents: [],
  seenAgentsCount: 0,
  canSeeResources: undefined
}

stdout | packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > instruction clarity > should include "don't overthink" instruction
[StructuredPromptBuilder] Vision state: {
  seenResources: [],
  seenResourcesCount: 0,
  seenAgents: [],
  seenAgentsCount: 0,
  canSeeResources: undefined
}

stdout | packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > instruction clarity > should end with response prompt
[StructuredPromptBuilder] Vision state: {
  seenResources: [],
  seenResourcesCount: 0,
  seenAgents: [],
  seenAgentsCount: 0,
  canSeeResources: undefined
}

stdout | packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > resource type descriptions > should describe trees when wood resources are visible
[StructuredPromptBuilder] Vision state: {
  seenResources: [ 'tree1', 'tree2' ],
  seenResourcesCount: 2,
  seenAgents: [],
  seenAgentsCount: 0,
  canSeeResources: undefined
}

stdout | packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > resource type descriptions > should describe rocks when stone resources are visible
[StructuredPromptBuilder] Vision state: {
  seenResources: [ 'rock1' ],
  seenResourcesCount: 1,
  seenAgents: [],
  seenAgentsCount: 0,
  canSeeResources: undefined
}

stdout | packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > resource type descriptions > should describe mixed resources correctly
[StructuredPromptBuilder] Vision state: {
  seenResources: [ 'tree1', 'rock1', 'food1' ],
  seenResourcesCount: 3,
  seenAgents: [],
  seenAgentsCount: 0,
  canSeeResources: undefined
}

 ✓ packages/renderer/src/__tests__/ItemTooltip.test.ts  (16 tests) 3ms
 ❯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts  (15 tests | 4 failed) 10ms
   ❯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > hearing system integration > should include heard speech in prompt
     → world.getEntity is not a function
   ❯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > hearing system integration > should not show hearing section when no speech
     → world.getEntity is not a function
   ❯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > hearing system integration > should show agents present even if silent
     → world.getEntity is not a function
   ❯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > context collapse > should show memories when present
     → expected 'You are TestAgent, a villager in a fo…' to contain 'agent_seen'
 ✓ packages/core/src/components/__tests__/InventoryComponent.test.ts  (16 tests) 4ms
 ✓ packages/core/src/systems/__tests__/SoilSystem.test.ts  (27 tests) 6ms
 ✓ packages/renderer/src/__tests__/GhostPreview.test.ts  (19 tests) 6ms
 ❯ packages/renderer/src/__tests__/ItemContextMenu.test.ts  (0 test)
 ✓ packages/world/src/chunks/__tests__/Tile.test.ts  (10 tests) 9ms
 ✓ packages/core/src/__tests__/AnimalComponent.test.ts  (8 tests) 4ms
stdout | packages/core/src/__tests__/PlantSeedProduction.test.ts > PlantSeedProduction Integration > should produce seeds when transitioning vegetative → mature

Test: Plant created - stage=vegetative, seedsProduced=0
Emitting time:day_changed event
[PlantSystem] New day started - will advance all plants by 1 day (total pending: 1 days)
After emit - daySkipCount should be > 0
Calling plantSystem.update with entities: 1
[PlantSystem] Active with 1 plants, accumulated 0.00 game hours
[PlantSystem] Processing 1 skipped day(s) = 24 hours for 1 plants
[PlantSystem] 4c384c39: Age increased by 1.0000 days (5.00 → 6.00) from 24.00 hours
[PlantSystem] 4c384c39: Test Plant (vegetative) age=6.0d progress=120% health=100
[PlantSystem] 4c384c39: test-plant stage vegetative → mature (age=6.0d, health=100)
[PlantSystem] 4c384c39: Executing 1 transition effect(s) for vegetative → mature
[PlantSystem] 4c384c39: Plant state before effects - seedsProduced=0, flowerCount=0, fruitCount=0
[PlantSystem] 4c384c39: Processing effect: produce_seeds
[PlantSystem] 4c384c39: produce_seeds effect START - plant.seedsProduced=0
[PlantSystem] 4c384c39: produce_seeds effect EXECUTED - species.seedsPerPlant=10, yieldModifier=1.00, calculated=10, plant.seedsProduced 0 → 10
[PlantSystem] 4c384c39: All effects complete - seedsProduced=10, flowerCount=0, fruitCount=0
Test: After update - stage=mature, seedsProduced=10

stdout | packages/core/src/__tests__/PlantSeedProduction.test.ts > PlantSeedProduction Integration > should produce MORE seeds when transitioning mature → seeding

Test: Plant created - stage=mature, seedsProduced=10
[PlantSystem] New day started - will advance all plants by 1 day (total pending: 1 days)
[PlantSystem] Active with 1 plants, accumulated 0.00 game hours
[PlantSystem] Processing 1 skipped day(s) = 24 hours for 1 plants
[PlantSystem] 84f5b89d: Age increased by 1.0000 days (10.00 → 11.00) from 24.00 hours
[PlantSystem] 84f5b89d: Test Plant (mature) age=11.0d progress=133% health=100
[PlantSystem] 84f5b89d: test-plant stage mature → seeding (age=11.0d, health=100)
[PlantSystem] 84f5b89d: Executing 2 transition effect(s) for mature → seeding
[PlantSystem] 84f5b89d: Plant state before effects - seedsProduced=10, flowerCount=0, fruitCount=0
[PlantSystem] 84f5b89d: Processing effect: produce_seeds
[PlantSystem] 84f5b89d: produce_seeds effect START - plant.seedsProduced=10
[PlantSystem] 84f5b89d: produce_seeds effect EXECUTED - species.seedsPerPlant=10, yieldModifier=1.00, calculated=10, plant.seedsProduced 10 → 20
[PlantSystem] 84f5b89d: Processing effect: drop_seeds
[PlantSystem] 84f5b89d: disperseSeeds called - plant.seedsProduced=20, count param=undefined
[PlantSystem] 84f5b89d: Dispersing 6 seeds in 3-tile radius
[PlantSystem] 84f5b89d: Dispersed seed at (-2.0, -2.0)
[PlantSystem] 84f5b89d: Dispersed seed at (0.0, -4.0)
[PlantSystem] 84f5b89d: Placed 2/6 seeds in 3-tile radius (14 remaining)
[PlantSystem] 84f5b89d: All effects complete - seedsProduced=14, flowerCount=0, fruitCount=0
Test: After update - stage=seeding, seedsProduced=14

stdout | packages/core/src/__tests__/PlantSeedProduction.test.ts > PlantSeedProduction Integration > should produce seeds correctly through full lifecycle vegetative → mature → seeding

Test: Initial - stage=vegetative, seedsProduced=0
[PlantSystem] New day started - will advance all plants by 1 day (total pending: 1 days)
[PlantSystem] Active with 1 plants, accumulated 0.00 game hours
[PlantSystem] Processing 1 skipped day(s) = 24 hours for 1 plants
[PlantSystem] 278b79cc: Age increased by 1.0000 days (5.00 → 6.00) from 24.00 hours
[PlantSystem] 278b79cc: Test Plant (vegetative) age=6.0d progress=120% health=100
[PlantSystem] 278b79cc: test-plant stage vegetative → mature (age=6.0d, health=100)
[PlantSystem] 278b79cc: Executing 1 transition effect(s) for vegetative → mature
[PlantSystem] 278b79cc: Plant state before effects - seedsProduced=0, flowerCount=0, fruitCount=0
[PlantSystem] 278b79cc: Processing effect: produce_seeds
[PlantSystem] 278b79cc: produce_seeds effect START - plant.seedsProduced=0
[PlantSystem] 278b79cc: produce_seeds effect EXECUTED - species.seedsPerPlant=10, yieldModifier=1.00, calculated=10, plant.seedsProduced 0 → 10
[PlantSystem] 278b79cc: All effects complete - seedsProduced=10, flowerCount=0, fruitCount=0
Test: After vegetative → mature - stage=mature, seedsProduced=10
[PlantSystem] New day started - will advance all plants by 1 day (total pending: 1 days)
[PlantSystem] Processing 1 skipped day(s) = 24 hours for 1 plants
[PlantSystem] 278b79cc: Age increased by 1.0000 days (6.00 → 7.00) from 24.00 hours
[PlantSystem] 278b79cc: Test Plant (mature) age=7.0d progress=133% health=100
[PlantSystem] 278b79cc: test-plant stage mature → seeding (age=7.0d, health=100)
[PlantSystem] 278b79cc: Executing 2 transition effect(s) for mature → seeding
[PlantSystem] 278b79cc: Plant state before effects - seedsProduced=10, flowerCount=0, fruitCount=0
[PlantSystem] 278b79cc: Processing effect: produce_seeds
[PlantSystem] 278b79cc: produce_seeds effect START - plant.seedsProduced=10
[PlantSystem] 278b79cc: produce_seeds effect EXECUTED - species.seedsPerPlant=10, yieldModifier=1.00, calculated=10, plant.seedsProduced 10 → 20
[PlantSystem] 278b79cc: Processing effect: drop_seeds
[PlantSystem] 278b79cc: disperseSeeds called - plant.seedsProduced=20, count param=undefined
[PlantSystem] 278b79cc: Dispersing 6 seeds in 3-tile radius
[PlantSystem] 278b79cc: Dispersed seed at (2.0, -2.0)
[PlantSystem] 278b79cc: Dispersed seed at (-2.0, -1.0)
[PlantSystem] 278b79cc: Dispersed seed at (2.0, -1.0)
[PlantSystem] 278b79cc: Placed 3/6 seeds in 3-tile radius (14 remaining)
[PlantSystem] 278b79cc: All effects complete - seedsProduced=14, flowerCount=0, fruitCount=0
Test: After mature → seeding - stage=seeding, seedsProduced=14

 ✓ packages/core/src/__tests__/PlantSeedProduction.test.ts  (3 tests) 4ms
 ✓ packages/core/src/systems/__tests__/SoilDepletion.test.ts  (14 tests) 10ms
 ✓ packages/core/src/systems/__tests__/TillingAction.test.ts  (19 tests) 5ms
 ✓ packages/world/src/terrain/__tests__/PerlinNoise.test.ts  (10 tests) 19ms
 ✓ packages/core/src/systems/__tests__/HearingSystem.test.ts  (5 tests) 3ms
 ✓ packages/core/src/systems/__tests__/WateringAction.test.ts  (10 tests) 5ms
 ✓ packages/core/src/systems/__tests__/SleepSystem.test.ts  (17 tests) 9ms
 ✓ packages/world/src/chunks/__tests__/Chunk.test.ts  (16 tests) 6ms
 ✓ packages/renderer/src/__tests__/InventorySearch.test.ts  (13 tests) 214ms
 ✓ packages/core/src/ecs/__tests__/ComponentRegistry.test.ts  (9 tests) 3ms
 ✓ packages/core/src/events/__tests__/EventBus.test.ts  (10 tests) 4ms
 ↓ packages/renderer/src/__tests__/BuildingPlacementUI.test.ts  (1 test | 1 skipped)
stdout | packages/llm/src/__tests__/ResponseParser.test.ts > ResponseParser > parseResponse - Structured JSON > should parse valid structured response
[ResponseParser] Structured response: {
  action: 'explore',
  thinking: 'I should explore to find food',
  speaking: 'Time to look around!'
}

stdout | packages/llm/src/__tests__/ResponseParser.test.ts > ResponseParser > parseResponse - Structured JSON > should handle response with no speaking
[ResponseParser] Structured response: {
  action: 'wander',
  thinking: 'Just going to wander',
  speaking: '(silent)'
}

stdout | packages/llm/src/__tests__/ResponseParser.test.ts > ResponseParser > parseResponse - Structured JSON > should parse all 12 valid actions
[ResponseParser] Structured response: { action: 'wander', thinking: 'test', speaking: '(silent)' }
[ResponseParser] Structured response: { action: 'idle', thinking: 'test', speaking: '(silent)' }
[ResponseParser] Structured response: { action: 'seek_food', thinking: 'test', speaking: '(silent)' }
[ResponseParser] Structured response: { action: 'follow_agent', thinking: 'test', speaking: '(silent)' }
[ResponseParser] Structured response: { action: 'talk', thinking: 'test', speaking: '(silent)' }
[ResponseParser] Structured response: { action: 'gather', thinking: 'test', speaking: '(silent)' }
[ResponseParser] Structured response: { action: 'explore', thinking: 'test', speaking: '(silent)' }
[ResponseParser] Structured response: { action: 'approach', thinking: 'test', speaking: '(silent)' }
[ResponseParser] Structured response: { action: 'observe', thinking: 'test', speaking: '(silent)' }
[ResponseParser] Structured response: { action: 'rest', thinking: 'test', speaking: '(silent)' }
[ResponseParser] Structured response: { action: 'work', thinking: 'test', speaking: '(silent)' }
[ResponseParser] Structured response: { action: 'help', thinking: 'test', speaking: '(silent)' }

stdout | packages/llm/src/__tests__/ResponseParser.test.ts > ResponseParser > parseResponse - Text Fallback > should parse plain text with action name
[ResponseParser] Text-based match: explore

stdout | packages/llm/src/__tests__/ResponseParser.test.ts > ResponseParser > parseResponse - Text Fallback > should find action anywhere in text
[ResponseParser] Text-based match: seek_food

stdout | packages/llm/src/__tests__/ResponseParser.test.ts > ResponseParser > parseBehavior - Legacy API > should extract just the action from structured response
[ResponseParser] Structured response: { action: 'talk', thinking: 'test', speaking: 'hello' }

stdout | packages/llm/src/__tests__/ResponseParser.test.ts > ResponseParser > parseBehavior - Legacy API > should work with text response
[ResponseParser] Text-based match: idle

 ✓ packages/llm/src/__tests__/ResponseParser.test.ts  (12 tests) 7ms
 ✓ packages/core/src/actions/__tests__/AgentAction.test.ts  (12 tests) 6ms
 ✓ packages/core/src/ecs/__tests__/Entity.test.ts  (10 tests) 6ms
 ✓ packages/world/src/chunks/__tests__/ChunkManager.test.ts  (9 tests) 78ms
 ✓ packages/renderer/src/__tests__/DragDropSystem.test.ts  (29 tests) 10ms
 ❯ packages/renderer/src/__tests__/AnimalHusbandryUI.test.ts  (0 test)
 ❯ packages/renderer/src/__tests__/AnimalRosterPanel.test.ts  (0 test)
 ❯ packages/renderer/src/__tests__/ProductionTrackingPanel.test.ts  (0 test)
 ↓ packages/renderer/src/__tests__/AgentInfoPanel-thought-speech.test.ts  (19 tests | 19 skipped)
 ❯ packages/renderer/src/__tests__/InventoryIntegration.test.ts  (0 test)
 ❯ packages/renderer/src/__tests__/AnimalDetailsPanel.test.ts  (0 test)
 ❯ packages/renderer/src/__tests__/BreedingManagementPanel.test.ts  (0 test)
 ❯ packages/renderer/src/__tests__/QuickBarUI.test.ts  (0 test)
 ❯ packages/renderer/src/__tests__/EnclosureManagementPanel.test.ts  (0 test)
 ✓ packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts  (32 tests) 254ms
stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 1: Inventory Section Appears > should render inventory section below needs section when agent is selected
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 1: Inventory Section Appears > should render inventory divider line before inventory section
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 1: Inventory Section Appears > should not render inventory section if agent has no inventory component
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 2: Resource Counts Display > should display wood resources with icon and quantity
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 2: Resource Counts Display > should display stone resources with icon and quantity
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 2: Resource Counts Display > should display food resources with icon and quantity
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 2: Resource Counts Display > should display water resources with icon and quantity
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 2: Resource Counts Display > should display all resource types simultaneously
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 2: Resource Counts Display > should not display resources with zero quantity
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 3: Empty Inventory State > should show "(empty)" when inventory has no items
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 3: Empty Inventory State > should show capacity as "Weight: 0/100 Slots: 0/8" when empty
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 4: Capacity Display > should display current weight and max weight
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 4: Capacity Display > should display current slots and max slots
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 4: Capacity Display > should calculate weight correctly for mixed resources
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 5: Capacity Warning Colors > should use white color when weight is below 80%
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 5: Capacity Warning Colors > should use yellow color when weight exceeds 80%
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 5: Capacity Warning Colors > should use red color when weight reaches 100%
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 5: Capacity Warning Colors > should use yellow color when slots exceed 80%
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 5: Capacity Warning Colors > should use red color when slots reach 100%
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 6: Real-time Updates > should reflect inventory changes when entity is re-rendered
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 6: Real-time Updates > should update capacity display when weight changes
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Acceptance Criterion 6: Real-time Updates > should show empty state when all resources are consumed
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Error Handling (per CLAUDE.md) > should throw when inventory.maxWeight is missing
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Error Handling (per CLAUDE.md) > should throw when inventory.maxWeight is undefined
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Error Handling (per CLAUDE.md) > should throw when inventory.slots is not an array
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Error Handling (per CLAUDE.md) > should throw when inventory.slots is null
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Error Handling (per CLAUDE.md) > should throw when inventory.currentWeight is missing
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Error Handling (per CLAUDE.md) > should throw when inventory.maxSlots is missing
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Edge Cases > should handle inventory with only empty slots
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Edge Cases > should handle inventory with partial slots filled
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Edge Cases > should handle very large resource quantities
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stdout | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Edge Cases > should not overflow panel bounds with many resources
[AgentInfoPanel] setSelectedEntity called with: test-agent-12345678

stderr | packages/renderer/src/__tests__/AgentInfoPanel-inventory.test.ts > AgentInfoPanel - Inventory Display > Edge Cases > should not overflow panel bounds with many resources
[AgentInfoPanel] World not available or missing getEntity method

 ✓ packages/renderer/src/__tests__/InventoryUI.test.ts  (24 tests) 38ms

⎯⎯⎯⎯⎯⎯ Failed Suites 10 ⎯⎯⎯⎯⎯⎯

 FAIL  packages/renderer/src/__tests__/AnimalDetailsPanel.test.ts [ packages/renderer/src/__tests__/AnimalDetailsPanel.test.ts ]
Error: Failed to resolve import "../AnimalDetailsPanel" from "packages/renderer/src/__tests__/AnimalDetailsPanel.test.ts". Does the file exist?
 ❯ TransformPluginContext._formatError node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 ❯ TransformPluginContext.error node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 ❯ normalizeUrl node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 ❯ async file:/Users/annhoward/src/ai_village/custom_game_engine/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 ❯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 ❯ PluginContainer.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 ❯ loadAndTransform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/14]⎯

 FAIL  packages/renderer/src/__tests__/AnimalHusbandryUI.test.ts [ packages/renderer/src/__tests__/AnimalHusbandryUI.test.ts ]
Error: Failed to resolve import "../AnimalHusbandryUI" from "packages/renderer/src/__tests__/AnimalHusbandryUI.test.ts". Does the file exist?
 ❯ TransformPluginContext._formatError node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 ❯ TransformPluginContext.error node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 ❯ normalizeUrl node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 ❯ async file:/Users/annhoward/src/ai_village/custom_game_engine/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 ❯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 ❯ PluginContainer.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 ❯ loadAndTransform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/14]⎯

 FAIL  packages/renderer/src/__tests__/AnimalRosterPanel.test.ts [ packages/renderer/src/__tests__/AnimalRosterPanel.test.ts ]
Error: Failed to resolve import "../AnimalRosterPanel" from "packages/renderer/src/__tests__/AnimalRosterPanel.test.ts". Does the file exist?
 ❯ TransformPluginContext._formatError node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 ❯ TransformPluginContext.error node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 ❯ normalizeUrl node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 ❯ async file:/Users/annhoward/src/ai_village/custom_game_engine/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 ❯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 ❯ PluginContainer.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 ❯ loadAndTransform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/14]⎯

 FAIL  packages/renderer/src/__tests__/BreedingManagementPanel.test.ts [ packages/renderer/src/__tests__/BreedingManagementPanel.test.ts ]
Error: Failed to resolve import "../BreedingManagementPanel" from "packages/renderer/src/__tests__/BreedingManagementPanel.test.ts". Does the file exist?
 ❯ TransformPluginContext._formatError node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 ❯ TransformPluginContext.error node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 ❯ normalizeUrl node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 ❯ async file:/Users/annhoward/src/ai_village/custom_game_engine/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 ❯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 ❯ PluginContainer.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 ❯ loadAndTransform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/14]⎯

 FAIL  packages/renderer/src/__tests__/ContainerPanel.test.ts [ packages/renderer/src/__tests__/ContainerPanel.test.ts ]
Error: Failed to load url ../ui/ContainerPanel.js (resolved id: ../ui/ContainerPanel.js) in /Users/annhoward/src/ai_village/custom_game_engine/packages/renderer/src/__tests__/ContainerPanel.test.ts. Does the file exist?
 ❯ loadAndTransform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51969:17

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/14]⎯

 FAIL  packages/renderer/src/__tests__/EnclosureManagementPanel.test.ts [ packages/renderer/src/__tests__/EnclosureManagementPanel.test.ts ]
Error: Failed to resolve import "../EnclosureManagementPanel" from "packages/renderer/src/__tests__/EnclosureManagementPanel.test.ts". Does the file exist?
 ❯ TransformPluginContext._formatError node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 ❯ TransformPluginContext.error node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 ❯ normalizeUrl node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 ❯ async file:/Users/annhoward/src/ai_village/custom_game_engine/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 ❯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 ❯ PluginContainer.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 ❯ loadAndTransform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/14]⎯

 FAIL  packages/renderer/src/__tests__/InventoryIntegration.test.ts [ packages/renderer/src/__tests__/InventoryIntegration.test.ts ]
Error: Failed to resolve import "../ui/QuickBarUI.js" from "packages/renderer/src/__tests__/InventoryIntegration.test.ts". Does the file exist?
 ❯ TransformPluginContext._formatError node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 ❯ TransformPluginContext.error node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 ❯ normalizeUrl node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 ❯ async file:/Users/annhoward/src/ai_village/custom_game_engine/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 ❯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 ❯ PluginContainer.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 ❯ loadAndTransform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/14]⎯

 FAIL  packages/renderer/src/__tests__/ItemContextMenu.test.ts [ packages/renderer/src/__tests__/ItemContextMenu.test.ts ]
Error: Failed to load url ../ui/ItemContextMenu.js (resolved id: ../ui/ItemContextMenu.js) in /Users/annhoward/src/ai_village/custom_game_engine/packages/renderer/src/__tests__/ItemContextMenu.test.ts. Does the file exist?
 ❯ loadAndTransform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51969:17

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[8/14]⎯

 FAIL  packages/renderer/src/__tests__/ProductionTrackingPanel.test.ts [ packages/renderer/src/__tests__/ProductionTrackingPanel.test.ts ]
Error: Failed to resolve import "../ProductionTrackingPanel" from "packages/renderer/src/__tests__/ProductionTrackingPanel.test.ts". Does the file exist?
 ❯ TransformPluginContext._formatError node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 ❯ TransformPluginContext.error node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 ❯ normalizeUrl node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 ❯ async file:/Users/annhoward/src/ai_village/custom_game_engine/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 ❯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 ❯ PluginContainer.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 ❯ loadAndTransform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[9/14]⎯

 FAIL  packages/renderer/src/__tests__/QuickBarUI.test.ts [ packages/renderer/src/__tests__/QuickBarUI.test.ts ]
Error: Failed to resolve import "../ui/QuickBarUI.js" from "packages/renderer/src/__tests__/QuickBarUI.test.ts". Does the file exist?
 ❯ TransformPluginContext._formatError node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49258:41
 ❯ TransformPluginContext.error node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49253:16
 ❯ normalizeUrl node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64307:23
 ❯ async file:/Users/annhoward/src/ai_village/custom_game_engine/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64439:39
 ❯ TransformPluginContext.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:64366:7
 ❯ PluginContainer.transform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:49099:18
 ❯ loadAndTransform node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:51978:27

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[10/14]⎯

⎯⎯⎯⎯⎯⎯⎯ Failed Tests 4 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > hearing system integration > should include heard speech in prompt
TypeError: world.getEntity is not a function
 ❯ StructuredPromptBuilder.getSeenAgentsInfo packages/llm/src/StructuredPromptBuilder.ts:477:27
    475| 
    476|     for (const agentId of seenAgentIds) {
    477|       const agent = world.getEntity(agentId);
       |                           ^
    478|       if (!agent) continue;
    479| 
 ❯ StructuredPromptBuilder.buildWorldContext packages/llm/src/StructuredPromptBuilder.ts:276:32
 ❯ StructuredPromptBuilder.buildPrompt packages/llm/src/StructuredPromptBuilder.ts:36:31
 ❯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts:93:30

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[11/14]⎯

 FAIL  packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > hearing system integration > should not show hearing section when no speech
TypeError: world.getEntity is not a function
 ❯ StructuredPromptBuilder.getSeenAgentsInfo packages/llm/src/StructuredPromptBuilder.ts:477:27
    475| 
    476|     for (const agentId of seenAgentIds) {
    477|       const agent = world.getEntity(agentId);
       |                           ^
    478|       if (!agent) continue;
    479| 
 ❯ StructuredPromptBuilder.buildWorldContext packages/llm/src/StructuredPromptBuilder.ts:276:32
 ❯ StructuredPromptBuilder.buildPrompt packages/llm/src/StructuredPromptBuilder.ts:36:31
 ❯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts:105:30

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[12/14]⎯

 FAIL  packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > hearing system integration > should show agents present even if silent
TypeError: world.getEntity is not a function
 ❯ StructuredPromptBuilder.getSeenAgentsInfo packages/llm/src/StructuredPromptBuilder.ts:477:27
    475| 
    476|     for (const agentId of seenAgentIds) {
    477|       const agent = world.getEntity(agentId);
       |                           ^
    478|       if (!agent) continue;
    479| 
 ❯ StructuredPromptBuilder.buildWorldContext packages/llm/src/StructuredPromptBuilder.ts:276:32
 ❯ StructuredPromptBuilder.buildPrompt packages/llm/src/StructuredPromptBuilder.ts:36:31
 ❯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts:118:30

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[13/14]⎯

 FAIL  packages/llm/src/__tests__/StructuredPromptBuilder.test.ts > StructuredPromptBuilder > context collapse > should show memories when present
AssertionError: expected 'You are TestAgent, a villager in a fo…' to contain 'agent_seen'

- Expected
+ Received

- agent_seen
+ You are TestAgent, a villager in a forest village.
+
+ Personality:
+ - You are curious and adventurous
+ - You are outgoing and social
+
+
+ Current Situation:
+ - Hunger: 50% (could eat)
+ - Energy: 60% (rested)
+ - The area around you is empty
+
+
+ Recent Memories:
+ 1. agent seen
+ 2. resource found
+
+
+ Available Actions:
+ - wander - Explore the area
+ - idle - Do nothing, rest and recover
+ - build - Construct a building (say "build <type>": campfire, tent, storage-chest, bed, etc.)
+
+ What should you do? Don't overthink - give your gut reaction and choose an action.
+
+ Your response:

 ❯ packages/llm/src/__tests__/StructuredPromptBuilder.test.ts:149:22
    147| 
    148|       expect(prompt).toContain('Recent Memories:');
    149|       expect(prompt).toContain('agent_seen');
       |                      ^
    150|     });
    151| 

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[14/14]⎯

 Test Files  11 failed | 45 passed | 2 skipped (58)
      Tests  4 failed | 853 passed | 26 skipped (883)
   Start at  16:39:23
   Duration  2.94s (transform 4.40s, setup 35ms, collect 11.63s, tests 956ms, environment 7.54s, prepare 4.86s)

